---
title: "【WordPress】GCEでヘルスチェックと起動スクリプトを試してみた"
pubDate: 2024-02-16
categories: ["WordPress"]
tags: []
---

こんにちは、フリーランスエンジニアの太田雅昭です。

## ヘルスチェック

GCEでは、ヘルスチェック機能を用いて、サーバーが生きているかどうかの確認を自動で行えます。

特定のURLを指定するhttpsタイプを用いました。以下のURLに対してヘルスチェックを行います。　

```
/wp-json/wp-site-health/v1
```

なおこのエンドポイントは、特にこういった用途というわけではありません。ヘルスチェックの用途が違うようです。WordPressならこうした、サーバーが生きているかどうかの判定を行うエンドポイントがあるだろうと探してみたのですが、無いようです。仕方なく、代わりに使えそうなエンドポイントを使用しています。

## 起動スクリプト

起動スクリプトを指定することで、自動実行スクリプトを埋め込みます。dockerを使用しているので、以下のようになりました。

```
cd /home/wp1
sh reup.prod.sh
```

shellファイルの中身は以下のようになってます。

```
docker compose down
docker compose up -d
```

これで安心です。

## 2024/05/06追記。自動再起動されるわけではない

本来欲しかったのは、サーバーの自動再起動機能でした。欲しかった情報を見つけられなかったため試しで上記方法を行っていたのですが、自動再起動されるわけではないようです。GCEで自動再起動させるには、他に監視用のサーバーを用意するなりしないといけないのかもしれません。

## 小話

睡眠時間を削りたいのですが、なかなか難しいです。睡眠不足だと、全然仕事が捗りません。。。悲しい。何かいい方法はないでしょうか。