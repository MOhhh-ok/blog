---
title: 【Next.js】TurbopackでCannot find module as expression is too dynamic
pubDate: 2026-01-14
categories: ["Next.js"]
---

こんにちは、フリーランスエンジニアの太田雅昭です。

## 環境

- パッケージマネージャー: pnpm
- 依存パッケージ
  - next: 16.1.1 (Turbopack)
  - @google-cloud/tasks: 6.2.1

## 問題

Next.jsのTurbopackで以下のエラーになりました。

```sh
Error: Cannot find module as expression is too dynamic
```

直訳すると、動的インポートが多すぎるということが理由のようです。

エラー全文を見れば原因がわかるでしょうか？全文は以下です。

```sh
▲ Next.js 16.1.1 (Turbopack)

  Creating an optimized production build ...
✓ Compiled successfully in 1762.2ms
✓ Finished TypeScript in 951.9ms
  Collecting page data using 7 workers  ..Error: Failed to collect configuration for /
    at ignore-listed frames {
  [cause]: Error: Cannot find module as expression is too dynamic
      at <unknown> (.next/server/chunks/ssr/[root-of-the-server]__006d6436._.js:15:287766)
      at c.getJSON (.next/server/chunks/ssr/[root-of-the-server]__006d6436._.js:15:287858)
      at module evaluation (.next/server/chunks/ssr/[root-of-the-server]__006d6436._.js:16:596)
      at instantiateModule (.next/server/chunks/ssr/[turbopack]_runtime.js:740:9)
      at getOrInstantiateModuleFromParent (.next/server/chunks/ssr/[turbopack]_runtime.js:763:12)
      at Context.esmImport [as i] (.next/server/chunks/ssr/[turbopack]_runtime.js:228:20)
      at module evaluation (.next/server/chunks/ssr/_7c907267._.js:1:60)
      at instantiateModule (.next/server/chunks/ssr/[turbopack]_runtime.js:740:9)
      at getOrInstantiateModuleFromParent (.next/server/chunks/ssr/[turbopack]_runtime.js:763:12)
      at Context.commonJsRequire [as r] (.next/server/chunks/ssr/[turbopack]_runtime.js:249:12) {
    code: 'MODULE_NOT_FOUND'
  }
}

> Build error occurred
Error: Failed to collect page data for /
    at ignore-listed frames {
  type: 'Error'
}
```

エラー全文を見てもさっぱりわかりません。AIに聞いても見当違いなライブラリを指摘したりで、全く解決しませんでした。せめてエラーでわかるようにして欲しいのは切実な願いです。

## 原因を探す

コードをコメントアウトしたり専用のエクスポートファイルを用意したりして絞込みを行いました。結果的に@google-cloud/tasksを使用する場所でエラーになっていました。

## 解決法

エラーの原因がわかったため、@google-cloud/tasksを外部ライブラリとして登録します。

```ts
// next.config.ts
import type { NextConfig } from "next";

const nextConfig: NextConfig = {
  serverExternalPackages: ["@google-cloud/tasks"],
};

export default nextConfig;
```

これでビルドできるようになりました。
