<?xml version="1.0" encoding="UTF-8" ?>
<!-- This is a WordPress eXtended RSS file generated by WordPress as an export of your site. -->
<!-- It contains information about your site's posts, pages, comments, categories, and other content. -->
<!-- You may use this file to transfer that content from one site to another. -->
<!-- This file is not intended to serve as a complete backup of your site. -->

<!-- To import this information into a WordPress site follow these steps: -->
<!-- 1. Log in to that site as an administrator. -->
<!-- 2. Go to Tools: Import in the WordPress admin panel. -->
<!-- 3. Install the "WordPress" importer from the list. -->
<!-- 4. Activate & Run Importer. -->
<!-- 5. Upload this file using the form provided on that page. -->
<!-- 6. You will first be asked to map the authors in this export file to users -->
<!--    on the site. For each author, you may choose to map to an -->
<!--    existing user on the site or to create a new user. -->
<!-- 7. WordPress will then import each of the posts, pages, comments, categories, etc. -->
<!--    contained in this file into your site. -->

	<!-- generator="WordPress/6.8.3" created="2025-11-10 11:05" -->
<rss version="2.0"
	xmlns:excerpt="http://wordpress.org/export/1.2/excerpt/"
	xmlns:content="http://purl.org/rss/1.0/modules/content/"
	xmlns:wfw="http://wellformedweb.org/CommentAPI/"
	xmlns:dc="http://purl.org/dc/elements/1.1/"
	xmlns:wp="http://wordpress.org/export/1.2/"
>

<channel>
	<title>太田雅昭</title>
	<link>https://www.masaakiota.net</link>
	<description>フリーランスエンジニア</description>
	<pubDate>Mon, 10 Nov 2025 11:05:03 +0000</pubDate>
	<language>ja</language>
	<wp:wxr_version>1.2</wp:wxr_version>
	<wp:base_site_url>https://www.masaakiota.net</wp:base_site_url>
	<wp:base_blog_url>https://www.masaakiota.net</wp:base_blog_url>

		<wp:author><wp:author_id>1</wp:author_id><wp:author_login><![CDATA[masaakiota]]></wp:author_login><wp:author_email><![CDATA[masaota5681@gmail.com]]></wp:author_email><wp:author_display_name><![CDATA[masaakiota]]></wp:author_display_name><wp:author_first_name><![CDATA[]]></wp:author_first_name><wp:author_last_name><![CDATA[]]></wp:author_last_name></wp:author>

				
	<generator>https://wordpress.org/?v=6.8.3</generator>

		<item>
		<title><![CDATA[Hello world!]]></title>
		<link>https://www.masaakiota.net/2023/03/16/hello-world/</link>
		<pubDate>Thu, 16 Mar 2023 10:07:38 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、太田雅昭です。よろしくお願いいたします。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1</wp:post_id>
		<wp:post_date><![CDATA[2023-03-16 19:07:38]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-03-16 10:07:38]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-03-17 12:07:10]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-03-17 03:07:10]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[hello-world]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="uncategorized"><![CDATA[未分類]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:comment>
			<wp:comment_id>1</wp:comment_id>
			<wp:comment_author><![CDATA[WordPress コメントの投稿者]]></wp:comment_author>
			<wp:comment_author_email><![CDATA[wapuu@wordpress.example]]></wp:comment_author_email>
			<wp:comment_author_url>https://ja.wordpress.org/</wp:comment_author_url>
			<wp:comment_author_IP><![CDATA[]]></wp:comment_author_IP>
			<wp:comment_date><![CDATA[2023-03-16 19:07:38]]></wp:comment_date>
			<wp:comment_date_gmt><![CDATA[2023-03-16 10:07:38]]></wp:comment_date_gmt>
			<wp:comment_content><![CDATA[こんにちは、これはコメントです。
コメントの承認、編集、削除を始めるにはダッシュボードの「コメント」画面にアクセスしてください。
コメントのアバターは「<a href="https://ja.gravatar.com/">Gravatar</a>」から取得されます。]]></wp:comment_content>
			<wp:comment_approved><![CDATA[1]]></wp:comment_approved>
			<wp:comment_type><![CDATA[comment]]></wp:comment_type>
			<wp:comment_parent>0</wp:comment_parent>
			<wp:comment_user_id>0</wp:comment_user_id>
							</wp:comment>
					<wp:comment>
			<wp:comment_id>2</wp:comment_id>
			<wp:comment_author><![CDATA[masaakiota]]></wp:comment_author>
			<wp:comment_author_email><![CDATA[masaota5681@gmail.com]]></wp:comment_author_email>
			<wp:comment_author_url>http://35.221.87.155</wp:comment_author_url>
			<wp:comment_author_IP><![CDATA[133.175.19.168]]></wp:comment_author_IP>
			<wp:comment_date><![CDATA[2023-03-17 12:08:02]]></wp:comment_date>
			<wp:comment_date_gmt><![CDATA[2023-03-17 03:08:02]]></wp:comment_date_gmt>
			<wp:comment_content><![CDATA[返信テストです。]]></wp:comment_content>
			<wp:comment_approved><![CDATA[1]]></wp:comment_approved>
			<wp:comment_type><![CDATA[comment]]></wp:comment_type>
			<wp:comment_parent>1</wp:comment_parent>
			<wp:comment_user_id>1</wp:comment_user_id>
							</wp:comment>
					</item>
					<item>
		<title><![CDATA[GCEの無料枠でWordPressを立ち上げてみた]]></title>
		<link>https://www.masaakiota.net/2023/03/17/gce%e3%81%ae%e7%84%a1%e6%96%99%e6%9e%a0%e3%81%a7wordpress%e3%82%92%e7%ab%8b%e3%81%a1%e4%b8%8a%e3%81%92%e3%81%a6%e3%81%bf%e3%81%9f/</link>
		<pubDate>Thu, 16 Mar 2023 16:02:48 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=5</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:image {"align":"center","id":23,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image aligncenter size-full"><img src="http://35.221.87.155/wp-content/uploads/2023/03/server-2546330_640.jpg" alt="" class="wp-image-23"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>こんにちは。フリーランス太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回GCPの無料枠内でWordPressを立ち上げましたので、備忘録も兼ねてメモを残させて頂きます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>[rtoc_mokuji]</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2><strong>GCE</strong>の無料枠について</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GCE(Google Cloud Engine)は、Googleの提供するGCP(Google Cloud Platform)の一部です。一定の範囲内は無料で使えます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Compute Engineの無料枠の条件については以下のように書かれています。（2023/03/10時点）</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>非プリエンプティブル（Google側の負荷などの都合で急に停止されたりしない）である「e2-micro&nbsp;VM」 インスタンスを使用。このインスタンスは以下のリージョンで利用可能。<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>オレゴン:&nbsp;us-west1</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>アイオワ:&nbsp;us-central1</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>サウスカロライナ:&nbsp;us-east1</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>30 GB-月の標準永続ディスク（デフォルトはバランス永続ディスクとなっているので注意）</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>5 GB 月のスナップショット ストレージ。次のリージョンで利用可能。<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>オレゴン:&nbsp;us-west1</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>アイオワ:&nbsp;us-central1</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>サウスカロライナ:&nbsp;us-east1</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>台湾:&nbsp;asia-east1</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ベルギー:&nbsp;europe-west1</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>1 GB の北米から全リージョン宛ての下りネットワーク（1 か月あたり、中国とオーストラリアを除く）</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:embed {"url":"https://cloud.google.com/free/docs/free-cloud-features?hl=ja#compute"} -->
<figure class="wp-block-embed"><div class="wp-block-embed__wrapper">
https://cloud.google.com/free/docs/free-cloud-features?hl=ja#compute
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2><strong>ドメインについて</strong></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>サイトを公開するにはドメインが必要です。ドメインがないとIPアドレス直書きとなってしまいますし、またhttpsも使えません。ですので泣く泣く以下のサイトでドメインを取得しました。一年で千円代とまぁリーズナブルです。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.onamae.com"} -->
<figure class="wp-block-embed"><div class="wp-block-embed__wrapper">
https://www.onamae.com
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2><strong>WordPress</strong>構築手順</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3><strong>GCP</strong>のCompute EngineでVMインスタンス生成</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GCPサイトで、e2-micro VMインスタンスを立ち上げます。内容は冒頭にお伝えした通り、無料枠の範囲で設定します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3><strong>Docker</strong>をいじる</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回はDockerを使用しました。以下の構成となっています。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>MySQL</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>WordPress(Apache, PHP含む)</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>PHPMyAdmin</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Nginx(https-portlに内蔵)</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>これらが独立したコンテナとして仮想構築され、それぞれで通信を行います。これがDockerです。一方MAMPなどを使用するとファイルがあちこちに分散して干渉し合わないかヒヤヒヤするのですが、そういった心配をしなくていいのも魅力的です。ただしその分容量は増えるため、昔のPCを使っている私のような場合はローカルテストはなかなか辛い面もあります。それでも、コンテナを消したり復活させたりするだけで環境がリセットされるのは、だいぶ嬉しいですね。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3>インストール</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>VMには以下の説明に従ってインストールします。なおローカルテストを行うMACには、代わりにDocker Desktopをインストールします。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://docs.docker.com/engine/install/ubuntu/"} -->
<figure class="wp-block-embed"><div class="wp-block-embed__wrapper">
https://docs.docker.com/engine/install/ubuntu/
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading {"level":3} -->
<h3>ファイル構成</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ファイル構成は以下のようにしています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="yaml" class="language-yaml">- .env
- .env.prod
- docker-compose.yml
- mysql
  |- data
- https-portal
  |- data
- phpmy
  |- sessions
- wordpress
  |- data
    |- plubins
    |- themes
    |- puloads</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3>docker-compose.yml</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>docker-compose.ymlは色々参考にさせていただいて、以下のように設定しました。後々の拡張を考えるとhttps-portalは別ファイルにした方が良かったかもしれませんが、まぁその時は別でNginxを用意して分散させればいいかなと、そもそもそんなに拡張するのかと言うのもありまして、全部まとめて書きました。なお別途 .env ファイルにパスワードなどの情報を書き込んでいます。</p>
<!-- /wp:paragraph -->

<!-- wp:code {"lineNumbers":true} -->
<pre class="wp-block-code"><code lang="yaml" class="language-yaml line-numbers">version: '3.4'

services:

  ###
  ## mysql
  #
  db:
    image: mysql:5.7
    volumes:
      - ./mysql/data:/var/lib/mysql
    restart: always
    environment:
      MYSQL_ROOT_PASSWORD: ${MYSQL_PASS}
      MYSQL_DATABASE: wordpress
      MYSQL_USER: ${MYSQL_USER}
      MYSQL_PASSWORD: ${MYSQL_PASS}

  ###
  ## phpmyadmin
  #
  phpmyadmin:
    image: phpmyadmin/phpmyadmin
    depends_on:
      - db
    environment:
      - PMA_HOST=db
    volumes:
      - ./phpmy/sessions:/sessions
  
  ###
  ## wordpress
  #
  wordpress:
    image: wordpress:latest
    depends_on:
      - db
    restart: always
    volumes:
      - ./wordpress/data/themes:/var/www/html/wp_dev_blog/wp-content/themes
      - ./wordpress/data/plugins:/var/www/html/wp_dev_blog/wp-content/plugins
      - ./wordpress/data/uploads:/var/www/html/wp_dev_blog/wp-content/uploads
    environment:
      WORDPRESS_DB_HOST: db:3306
      WORDPRESS_DB_USER: ${MYSQL_USER}
      WORDPRESS_DB_PASSWORD: ${MYSQL_PASS}

  ###
  ## https
  #
  https-portal:
    image: steveltn/https-portal:1
    depends_on:
      - wordpress
    ports:
      - '80:80'
      - '443:443'
    volumes:
      - ./https-portal/data:/var/lib/https-portal
    environment:
      STAGE: ${HTTPS_PORTAL_STAGE}
      DOMAINS: '${HOST} -&gt; http://wordpress, ${PHPMY_HOST} -&gt; http://phpmyadmin'
    restart: always
    # FORCE_RENEW: 'true' #Let's Encryptを最生成。数制限に注意。

</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3><strong>WordPress</strong>の設定</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>WordPressの設定はWordPressのAdmin画面で行います。これはほぼ問題ありません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2><strong>まとめ</strong></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以上、GCPの無料範囲内でWordPressを立ち上げた話でした。必要経費は以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>ドメイン名：年間千円とちょっと</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>他費用：なし</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>サイト速度：小規模なら悪くない</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>というわけで、非常にコスパが良くいいですね。あとはDockerや色々勉強して、さらに拡張して行けたらと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>最後までお読み頂き、ありがとうございました。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>5</wp:post_id>
		<wp:post_date><![CDATA[2023-03-17 01:02:48]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-03-16 16:02:48]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-03-17 01:46:02]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-03-16 16:46:02]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[gce%e3%81%ae%e7%84%a1%e6%96%99%e6%9e%a0%e3%81%a7wordpress%e3%82%92%e7%ab%8b%e3%81%a1%e4%b8%8a%e3%81%92%e3%81%a6%e3%81%bf%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="post_tag" nicename="docker"><![CDATA[Docker]]></category>
		<category domain="post_tag" nicename="gcp"><![CDATA[GCP]]></category>
		<category domain="category" nicename="gcp"><![CDATA[Google Cloud]]></category>
		<category domain="post_tag" nicename="wordpress"><![CDATA[WordPress]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_458a3dd8ce5309d83183fe99f811674b]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_8c753e7c793efc82cdadc1a39d1303f9]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_d39156dcd0166a4518df9dd065cc932e]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_fa78c3b53ba8f7e546ebff1e75a9f0ef]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_thumbnail_id]]></wp:meta_key>
		<wp:meta_value><![CDATA[23]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクレイピング不可サイトへのブックマークレット戦術]]></title>
		<link>https://www.masaakiota.net/2023/03/17/%e3%82%b9%e3%82%af%e3%83%ac%e3%82%a4%e3%83%94%e3%83%b3%e3%82%b0%e4%b8%8d%e5%8f%af%e3%82%b5%e3%82%a4%e3%83%88%e3%81%b8%e3%81%ae%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83/</link>
		<pubDate>Thu, 16 Mar 2023 20:12:25 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=25</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:image {"align":"center","id":27,"sizeSlug":"full","linkDestination":"none","className":"is-style-default"} -->
<figure class="wp-block-image aligncenter size-full is-style-default"><img src="http://35.221.87.155/wp-content/uploads/2023/03/スクリーンショット-2023-03-17-3.24.05.png" alt="" class="wp-image-27"/></figure>
<!-- /wp:image -->

<!-- wp:image {"align":"center","id":28,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image aligncenter size-full"><img src="http://35.221.87.155/wp-content/uploads/2023/03/スクリーンショット-2023-03-17-3.24.46.png" alt="" class="wp-image-28"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>みなさまこんにちは、フリーランス太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回はブックマークレットを用いたスクレイピングについて解説させて頂きます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>[rtoc_mokuji]</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">スクレイピングについて</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>スクレイピングはウェブサイトから情報を抽出する技術を指します。手法は様々で、Pythonで仮想ブラウザを通して行うなどがあります。情報を抽出する立場から見れば、わざわざ目で必要な情報を探すよりもスクリプトで一気に取得する方が便利なのは間違いありません。ですがそれはあくまで利用者の立場で見た考えであり、情報提供者から見ればまた違った視点となります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>サーバーの負荷や収益などの観点からスクレイピングをされたくない情報提供者は、スクレイピングを防止する為の対策を講じることもあります。例えば以下のような対策があります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>HTML直出力ではなくJavaScriptで動的にコンテンツを生成</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>怪しいアクセスには「私はロボットではありません」のRECAPTCHA認証を表示</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>APIを提供してサーバーの負荷を下げようとする、利用者と情報提供者お互いに利益のあるWin-Winな方法</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>この他にも様々あるかと思われますが、こうしたスクレイピングをする側とされる側のいたちごっこの中で、情報提供者に迷惑をかけないブックマークレットによる情報抽出方法があります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">公開データのスクレイピングは基本的に違法ではない</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ログインなどを必要としない、一般的に公開されているデータのスクレイピングは違法ではありません。一方で、ログインしないと見れないデータをスクレイピングし、再利用する際には違法かどうかを個別に判断する必要があります。以下のサイトが参考になるかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://self-development.info/%e5%85%ac%e9%96%8b%e3%81%95%e3%82%8c%e3%81%a6%e3%81%84%e3%82%8b%e3%82%a6%e3%82%a7%e3%83%96%e3%82%b5%e3%82%a4%e3%83%88%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e3%80%8c%e3%82%b9%e3%82%af%e3%83%ac/">https://self-development.info/%e5%85%ac%e9%96%8b%e3%81%95%e3%82%8c%e3%81%a6%e3%81%84%e3%82%8b%e3%82%a6%e3%82%a7%e3%83%96%e3%82%b5%e3%82%a4%e3%83%88%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e3%80%8c%e3%82%b9%e3%82%af%e3%83%ac/</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ブックマークレットについて</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ブックマークレットはBookmark（ブックマーク）とApplet（アプレット）を組み合わせた造語とされており、小さなスクリプトをブックマークとして機能させる方法です。このブックマークレットをクリックすることで、現在表示しているウェブサイト上で、任意のスクリプトを実行することができます。以下に簡単なブックマークレットの例を示します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">javascript: alert(document.querySelector('head title').textContent);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これはサイトのタイトルを表示するブックマークレットです。これを使用するには、以下のような方法があります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>クロームなどブラウザのアドレスバーに直接打ち込む</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>任意のブックマークを作成してからURLを編集</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>HTMLでリンクを生成してブックマークバーにドラッグ&amp;ドロップ</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>これらのうち、開発者なら１つ目が手っ取り早いでしょうし、ブックマークレット利用者なら３つ目が最もお手軽でしょう。３つ目は例えば</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="javascript: alert(document.querySelector('head title').textContent);">サイトタイトルを取得</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>といったリンクを作成し、それをブックマークバーにドラッグ&amp;ドロップすることでブックマークレットの登録が完了します。あとは任意のサイトでそれを実行するだけとなります。試しに上のリンクをブックマークバーにドロップして試していただければ、このページのタイトルが以下のようにアラート表示されるはずです。なお執筆時点のスクリーンショットですので、タイトルなど変更されている可能性もあります。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":34,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image aligncenter size-full"><img src="http://35.221.87.155/wp-content/uploads/2023/03/スクリーンショット-2023-03-17-4.39.31-edited.png" alt="" class="wp-image-34"/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">ブックマークレットによるスクレイピングと対策</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ブックマークレットによるスクレイピングの対策は難しいでしょう。実際に人が視認できる状態までレンダリングされ、DOMエレメントもしっかり展開されている状態がほとんどです。ほとんどのサイトで有効と思われます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">ブックマークレットによるスクレイピングとサーバー負荷</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ブックマークレットによるスクレイピングは、ほぼ人の手による情報収集に近い性質を持っていると言えます。自動で複数のIPアドレスから連続的にアクセスすることも無ければ、サイトの重要なお知らせを見逃すことも少ないでしょう。2023年3月現在、飲食店への迷惑行為のために、性善説で成り立っていたシステムが立ち行かなくなると言ったニュースが話題となりました。クラッカーとそれへの対抗のいたちごっこはテクノロジーを進歩させますが、そのために本来受けられていたであろうサービスを受けれなくなる可能性があるのも否定できません。その点、ブックマークレットによるスクレイピングは利用者にも運営者にも優しいものであり、そういったリスクも少なくなるでしょう。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">スプレッドシートとの連携</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>上記で述べさせていただいた通り、ブックマークレットでデータを取得できることは分かりました。続いてそのデータを送信する場所を作っていきます。ブックマークレットからアクセスする先は、以下のようなものがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>ブラウザのストレージ</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>各種サービスのAPI</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>スプレッドシートのウェブアプリ</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>このうちブラウザのストレージは何かの拍子で消えてしまう可能性もあります。各種サービスのAPIは、用途によっては良い選択肢です。一方スプレッドシートのウェブアプリは大抵の用途に対応でき、費用もかからずお手軽です。またデータ集計も楽に行えます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">ウェブアプリ</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>スプレッドシートのウェブアプリを使えば、まるでウェブサイトのようなページを作成することができます。今回はデータ受信用にのみ使いますので、以下のようなGASを作成します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">function doPost(e = {
  parameter: {},
}) {
  const useParams = 'name,price,likeNum,commentNum,img1,img2,description';
  const data = e.parameter;

  const row = [];
  for (let title of useParams.split(',')) {
    row.push(data[title]);
  }

  SpreadsheetApp.getActiveSpreadsheet().getSheetByName('データ').appendRow(row);
}
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>あとはこのウェブアプリをデプロイし、ブックマークレットから送信するだけです。なお実際のコードはそれぞれの項目を整形してスプレッドシートに書き込むため、もう少しだけ複雑となります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">まとめ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>いかがでしたでしょうか？ブックマークレットによるスクレイピングは実際に人の手で１つ１つのページを表示しなければならず手間もありますが、様々な対策のされているサイトでも抽出できる可能性があります。ぜひ参考にしていただけましたら幸いです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>最後までお読み頂き、ありがとうございました。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>25</wp:post_id>
		<wp:post_date><![CDATA[2023-03-17 05:12:25]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-03-16 20:12:25]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-08 16:19:30]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-08 07:19:30]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%ac%e3%82%a4%e3%83%94%e3%83%b3%e3%82%b0%e4%b8%8d%e5%8f%af%e3%82%b5%e3%82%a4%e3%83%88%e3%81%b8%e3%81%ae%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
		<category domain="post_tag" nicename="gas"><![CDATA[GAS]]></category>
		<category domain="post_tag" nicename="%e3%82%b9%e3%83%97%e3%83%ac%e3%83%83%e3%83%89%e3%82%b7%e3%83%bc%e3%83%88"><![CDATA[スプレッドシート]]></category>
		<category domain="post_tag" nicename="%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88"><![CDATA[ブックマークレット]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_thumbnail_id]]></wp:meta_key>
		<wp:meta_value><![CDATA[28]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_d7d5a020fdf7abc4fce2741c43a5d36e]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[ChatGPTでLINEオカマバー開設しました]]></title>
		<link>https://www.masaakiota.net/2023/03/19/chatgpt%e3%81%a7line%e3%82%aa%e3%82%ab%e3%83%9e%e3%83%90%e3%83%bc%e9%96%8b%e8%a8%ad%e3%81%97%e3%81%be%e3%81%97%e3%81%9f/</link>
		<pubDate>Sat, 18 Mar 2023 18:18:14 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=50</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランス太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回はChatGPTのAPIを使用して、LINEでオカマバーを開設しました。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":51,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image size-full"><img src="http://35.221.87.155/wp-content/uploads/2023/03/スクリーンショット-2023-03-19-3.01.31.png" alt="" class="wp-image-51"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><a href="https://lin.ee/ES1OXed">https://lin.ee/ES1OXed</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なお現在一日一人10回までの制限を設けています。なにせAPIはお金がかかりますので、収益化が見込めるようになるまでは安全運転でいきたい次第です。ご了承いただけますと幸いです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>背景</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近ChatGPTの案件に携わらせていただいて今色々と調整中なのですが、AIは面白いなと言うことでやってみました。これからはAIの時代ですので、実際に作ってみて新しい発見などがあれば良いなと。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>もんもんチョコレット　ママの設定</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ママの発言のtempertureは0.8（高め。創造性が増える）にしています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>またGPT3.5では以下のようにロールという概念が導入されています。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>system: システムメッセージ。アシスタントの性格づけなどに利用</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>assistant: アシスタントメッセージ。GPTが返す部分</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>user: ユーザーメッセージ。クライアントがGPTに送信する部分</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>このsystemの部分で、以下のようにキャラクター設定をしています。</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">あなたはオカマバー「もんもんチョコレット」のママです。スタッフはいません。常に100文字以上で、ギャグを混ぜて発言します。
本名：助六
一人称：ママ
通称：ママ
年齢：33歳
性格：常にハイテンションで話し上手。
口調：オカマ
血液型：O型
結婚：していない
出身地：フィリピンセブ島
おすすめメニュー：お好み焼き。でも作れない
全ての料理：作れない
趣味：スクワット
得意なもの：ウクレレ
好きなもの：20歳くらいの男の二の腕
嫌いなもの：カタツムリ</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>なおこういった設定は必ずしも守られるわけではありません。常に100文字以上と支持しているため長めの文章にはなりますが、少ない時もあります。この辺りはさすがAIといった所ですね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>50</wp:post_id>
		<wp:post_date><![CDATA[2023-03-19 03:18:14]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-03-18 18:18:14]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-03-22 09:12:18]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-03-22 00:12:18]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[chatgpt%e3%81%a7line%e3%82%aa%e3%82%ab%e3%83%9e%e3%83%90%e3%83%bc%e9%96%8b%e8%a8%ad%e3%81%97%e3%81%be%e3%81%97%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="post_tag" nicename="ai"><![CDATA[AI]]></category>
		<category domain="post_tag" nicename="gpt"><![CDATA[GPT]]></category>
		<category domain="category" nicename="gpt"><![CDATA[GPT]]></category>
		<category domain="post_tag" nicename="line"><![CDATA[LINE]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_thumbnail_id]]></wp:meta_key>
		<wp:meta_value><![CDATA[51]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[プライベートでGCPのOAuthクライアントID・シークレット取得方法]]></title>
		<link>https://www.masaakiota.net/2023/04/14/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88/</link>
		<pubDate>Fri, 14 Apr 2023 01:15:41 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=67</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>GCPでのOAuthクライアントIDおよびクライアントシークレットの取得方法を解説させて頂きます。公開する必要のないプライベート環境、テストユーザーでの使用を想定しています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">プロジェクトの作成</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記URLからプロジェクトを新規作成します。プロジェクト名はお好きな名前を入れてください。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://console.cloud.google.com/projectcreate" target="_blank" rel="noreferrer noopener">https://console.cloud.google.com/projectcreate</a></p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":69,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image aligncenter size-full"><img src="http://35.221.87.155/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.28.35.png" alt="" class="wp-image-69"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>作成したプロジェクトを選択します。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":70,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image aligncenter size-full"><img src="http://35.221.87.155/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.29.35.png" alt="" class="wp-image-70"/></figure>
<!-- /wp:image -->

<!-- wp:heading -->
<h2 class="wp-block-heading">APIの有効化</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記URLより、該当するAPIを有効化します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>・Youtube Analytics</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://console.cloud.google.com/marketplace/product/google/youtubeanalytics.googleapis.com">https://console.cloud.google.com/marketplace/product/google/youtubeanalytics.googleapis.com</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>・Youtube Data API v3</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://console.cloud.google.com/marketplace/product/google/youtube.googleapis.com">https://console.cloud.google.com/marketplace/product/google/youtube.googleapis.com</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">認証情報を作成</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">OAuth同意画面</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記リンクより、同意画面を作成します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://console.cloud.google.com/apis/credentials/consent">https://console.cloud.google.com/apis/credentials/consent</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>外部を選択</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":71,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image aligncenter size-full"><img src="http://35.221.87.155/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.34.43.png" alt="" class="wp-image-71"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>アプリ名、ユーザーサポートメールを入力。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":72,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image aligncenter size-full"><img src="http://35.221.87.155/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.36.53.png" alt="" class="wp-image-72"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>デベロッパーの連絡先情報を入力</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":73,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image aligncenter size-full"><img src="http://35.221.87.155/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.37.13.png" alt="" class="wp-image-73"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>スコープを追加します。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":74,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image aligncenter size-full"><img src="http://35.221.87.155/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.38.27.png" alt="" class="wp-image-74"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>今回は、Youtube Analytics APIとYoutube Data API v3を選択します。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":76,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image aligncenter size-full"><img src="http://35.221.87.155/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.40.10.png" alt="" class="wp-image-76"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>テストユーザーを追加します。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":77,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image aligncenter size-full"><img src="http://35.221.87.155/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.40.25.png" alt="" class="wp-image-77"/></figure>
<!-- /wp:image -->

<!-- wp:heading -->
<h2 class="wp-block-heading">認証情報を作成</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記リンクより、認証情報を作成します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://console.cloud.google.com/apis/credentials/oauthclient" target="_blank" rel="noreferrer noopener">https://console.cloud.google.com/apis/credentials/oauthclient</a></p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":78,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image aligncenter size-full"><img src="http://35.221.87.155/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.44.27.png" alt="" class="wp-image-78"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>完了したら、下記画像ボタンよりクライアントIDとクライアントシークレットを取得してください。お疲れ様でした。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"align":"center","id":79,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image aligncenter size-large"><img src="http://35.221.87.155/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.50.41-1024x86.png" alt="" class="wp-image-79"/></figure>
<!-- /wp:image -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>67</wp:post_id>
		<wp:post_date><![CDATA[2023-04-14 10:15:41]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-04-14 01:15:41]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-04-14 10:26:36]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-04-14 01:26:36]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gcp"><![CDATA[Google Cloud]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GAS】google.script.runで渡せるデータのサイズ制限]]></title>
		<link>https://www.masaakiota.net/2023/05/12/%e3%80%90gas%e3%80%91google-script-run%e3%81%a7%e6%b8%a1%e3%81%9b%e3%82%8b%e3%83%87%e3%83%bc%e3%82%bf%e3%81%ae%e3%82%b5%e3%82%a4%e3%82%ba%e5%88%b6%e9%99%90/</link>
		<pubDate>Fri, 12 May 2023 02:43:22 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=89</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回は、GASでのgoogle.script.runにおけるデータ量の制限について書かせていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">google.script.runについて</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>google.script.runはGASダイアログなどで使用できるjavascript関数です。以下のように使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">const onSuccess=(data)=&gt;{};
const onFailure=(e)=&gt;{};
google.script.run.withSuccessHandler(onSuccess).withFailureHandler(onFailure).func(); // funcはGASに書いた関数</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">制限について</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>google.script.runはGASで作成した関数を呼び出すために使用するのですが、多くは引数を渡すことになります。その引数のデータサイズに制限があるようで、これは公式ドキュメントでは見つけられなかったため下記のようなコードでテストを行いました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">/**
 * google.script.runで呼び出すテスト関数
 */
function test(str) {
    return 'Success';
}

/**
 * ダイアログを表示する
 */
function showDialog() {
    // ダイアログに表示するHTML
    const html = `
        &lt;div id='log'>&lt;/div>
        &lt;script>
            // ログを出力する関数
            const log = str => document.querySelector('#log').innerHTML+=str+'&lt;br/>';
            
            // 文字数指定
            const length = prompt('文字数を入力してください');
            
            // テスト文字列生成
            const testString='a'.repeat(length);
            
            // テスト文字列のサイズを取得
            const size=new Blob([testString]).size;
            log('size: '+(size/1000/1000)+'MB');

            // google.script.run
            google.script.run
                .withSuccessHandler(log)
                .withFailureHandler(log)
                .test(testString);
        &lt;/script>`;

    // ダイアログを表示
    SpreadsheetApp.getUi().showModalDialog(
        HtmlService.createHtmlOutput(html),
        'Dialog'
    );
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記コードを実行するとテスト用に生成する文字列の文字数を入力するプロンプトが出ます。50MBまでは大丈夫ですが、60MBの文字列では以下のエラーが表示されます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">NetworkError: 次の原因のために接続できませんでした: HTTP 413</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>413はPayloadの容量オーバーを表しています。60MB以上のデータは送信できないことが分かります。なお50MBでも52MBでも送信できましたので、上限設定は曖昧かもしれません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">対策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>サイズ制限の対策として、以下が挙げられます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">不要なデータを削除</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ユーザーから渡されたデータなどを使用する場合、不要な部分を削除できることがあります。その際はJavaScript側で一旦不要なデータを削除してから、GASに渡すとサイズ制限を突破する手助けとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">圧縮</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>データを圧縮アルゴリズムで圧縮してから、GASに渡します。JavaScript側とGAS側で同じアルゴリズムを使用する必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">分割</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>データを指定サイズで分割し、少しずつGASに渡す方法です。あまりにデータが多すぎて上記の対策でも追いつかない場合の最終手段となります。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>89</wp:post_id>
		<wp:post_date><![CDATA[2023-05-12 11:43:22]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-05-12 02:43:22]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-05-15 10:22:35]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-05-15 01:22:35]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gas%e3%80%91google-script-run%e3%81%a7%e6%b8%a1%e3%81%9b%e3%82%8b%e3%83%87%e3%83%bc%e3%82%bf%e3%81%ae%e3%82%b5%e3%82%a4%e3%82%ba%e5%88%b6%e9%99%90]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="post_tag" nicename="gas"><![CDATA[GAS]]></category>
		<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【JS】フロントエンドでそのまま使えるCSVパーサ【Papa Parse】]]></title>
		<link>https://www.masaakiota.net/?p=94</link>
		<pubDate></pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=94</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:embed {"url":"https://www.papaparse.com/","type":"rich","providerNameSlug":"papaparse"} -->
<figure class="wp-block-embed is-type-rich is-provider-papaparse wp-block-embed-papaparse"><div class="wp-block-embed__wrapper">
https://www.papaparse.com/
</div></figure>
<!-- /wp:embed -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>94</wp:post_id>
		<wp:post_date><![CDATA[2023-05-12 19:07:54]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[0000-00-00 00:00:00]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-05-12 19:07:54]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-05-12 10:07:54]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[]]></wp:post_name>
		<wp:status><![CDATA[draft]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="uncategorized"><![CDATA[未分類]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_b9568740f40ba24651404ebee1b3fa16]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://www.papaparse.com/">Papa Parse</a></h4><p>Parse CSV string var data = Papa.parse(csv); // Convert back to CSV var csv = Papa.unparse(data); // Parse local CSV file Papa.parse(file, { complete: function(results) { console.log("Finished:", results.data); } }); // Stream big file in worker thread Papa.parse(bigFile, { worker: true, step: function(results) { console.log("Row:", results.data); } }); Now the</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_b9568740f40ba24651404ebee1b3fa16]]></wp:meta_key>
		<wp:meta_value><![CDATA[1683886074]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[docker-compose.ymlでDocker Hubのタグ付けを終わらせる]]></title>
		<link>https://www.masaakiota.net/2023/07/22/docker-compose-yml%e3%81%a7docker-hub%e3%81%ae%e3%82%bf%e3%82%b0%e4%bb%98%e3%81%91%e3%82%92%e7%b5%82%e3%82%8f%e3%82%89%e3%81%9b%e3%82%8b/</link>
		<pubDate>Sat, 22 Jul 2023 04:39:07 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=99</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>最近Djangoを勉強し始めて、ようやく理解できてきました、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回、生まれて初めてDocker Hubを使用して本番サーバー環境を構築しようとしています。色々調べながら、以下の点に気づきましたので共有させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">本題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Docker Hubにpushする時、通常は以下のようにすると思います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">docker build -t your-image-name
docker tag your-image-name:latest your-username/your-image-name:1.0.0
docker push your-username/your-image-name:1.0.0</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>しかし、docker-compose.ymlを以下のようにすれば</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">version: '3'

services:
  myapp:
    build: .
    image: your-username/your-image-name:1.0.0
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>次のコマンドだけでpushできます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">docker compose build
docker push your-username/your-image-name:1.0.0</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>っていうお話でした。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>99</wp:post_id>
		<wp:post_date><![CDATA[2023-07-22 13:39:07]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-07-22 04:39:07]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-07-22 13:39:08]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-07-22 04:39:08]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[docker-compose-yml%e3%81%a7docker-hub%e3%81%ae%e3%82%bf%e3%82%b0%e4%bb%98%e3%81%91%e3%82%92%e7%b5%82%e3%82%8f%e3%82%89%e3%81%9b%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="docker"><![CDATA[Docker]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[PythonでのPagination]]></title>
		<link>https://www.masaakiota.net/2023/08/02/python%e3%81%a7%e3%81%aepagination/</link>
		<pubDate>Tue, 01 Aug 2023 16:48:38 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=111</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>PythonでPaginationを実装しました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>案外時間のかかる作業だったのですが、その原因の一つにインターネットであまりサンプルらしいものに出会えなかったのがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ChatGPTに作ってもらったりもしましたが、なかなかうまくいかなかったので結局１から自分で書きました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ということで、共有させていただきます。次のようなPaginationが作成されます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>&lt; 1 ... 6 7 8 9 10 ... 16 ></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>省略記号に加え、前へ、次へのリンクもあり、現在のページにはcurrentクラスも付与されます。Paginationではおそらく最大限の実装かと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Pythonコードは以下です。</p>
<!-- /wp:paragraph -->

<!-- wp:code {"lineNumbers":false} -->
<pre class="wp-block-code"><code lang="python" class="language-python">def make_a(num: int, current: bool, text: str = None):
    """
    ページ番号をリンクに変換する
    """

    # 文字列が指定されていない場合は、ページ番号をそのまま表示
    if not text:
        text = num

    current_str = "current" if current else ""

    # 数字ならリンクを作成。
    if isinstance(num, int):
        return (
            f"&lt;a class='page-link {current_str}' href='?page={num}'>{text}&lt;/a>"
        )
    # 省略記号ならリンクを作成しない。
    else:
        return f"&lt;a class='page-link' name=''>{text}&lt;/a>"


def pagination(page: int, page_count: int):
    """
    ページネーションを作成する

    page: 現在のページ番号
    page_count: ページ数

    例: page=8, page_count=16 の場合
    &lt; 1 ... 6 7 8 9 10 ... 16 >
    
    選択中のページはcurrentクラスが付与される
    """

    if page_count &lt;= 1:
        return ""

    nums = set()

    # 現在のページの前後2ページを取得
    for num in range(page - 2, page + 3):
        if num > 0 and num &lt;= page_count:
            nums.add(num)

    nums = sorted(list(nums))

    # 省略記号を追加
    if nums[0] > 2:
        nums.insert(0, "...")
    if nums[-1] &lt; page_count - 1:
        nums.append("...")

    # 最初と最後のページを追加
    if nums[0] != 1:
        nums.insert(0, 1)
    if nums[-1] != page_count:
        nums.append(page_count)

    # ここまでのページ番号をリンクに変換
    a_list = [make_a(num, num == page) for num in nums]

    # 次へ、前へのリンクを追加
    if page > 1:
        a_list.insert(0, make_a(page - 1,False, "&amp;lt;"))
    if page &lt; page_count:
        a_list.append(make_a(page + 1, False,"&amp;gt;"))

    li_list = [f"&lt;li class='page-item'>{a}&lt;/li>" for a in a_list]

    nav = f"""
&lt;nav aria-label="Page navigation example">
    &lt;ul class="pagination">
        {"".join(li_list)}
    &lt;/ul>   
&lt;/nav>"""

    return nav
</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>111</wp:post_id>
		<wp:post_date><![CDATA[2023-08-02 01:48:38]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-08-01 16:48:38]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-08-02 01:48:38]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-08-01 16:48:38]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[python%e3%81%a7%e3%81%aepagination]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="python"><![CDATA[Python]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[GASのフォーム送信(doGet, doPost)でForbiddenになる問題を解決]]></title>
		<link>https://www.masaakiota.net/2023/08/06/gas%e3%81%ae%e3%83%95%e3%82%a9%e3%83%bc%e3%83%a0%e9%80%81%e4%bf%a1doget-dopost%e3%81%a7forbidden%e3%81%ab%e3%81%aa%e3%82%8b%e5%95%8f%e9%a1%8c%e3%82%92%e8%a7%a3%e6%b1%ba/</link>
		<pubDate>Sun, 06 Aug 2023 08:19:21 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=116</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>狭い部屋でクーラーが効きすぎるので、扇風機の前に保冷剤を置いてパソコンを叩いてます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GASのdoGetで生成したフォームで送信するもForbidden</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GASのdoGetでテンプレートファイルを読み込み、フォームを生成したのはいいものの、そこから送信するとなぜかForbiddenに。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>過去にも経験したはずなのに、他の言語を叩いているうちについ忘れてしまうプログラマの性。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>GPT4先生にいくら聞いても、解決に至らないこの問題。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>結局Google先生に聞いた方が早かったこの問題。（2023/08/06現在、海外ではGoogleもAI搭載されているとか。TikTok情報）</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下に解決方法を書かせていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">犯人はiFrame</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GASはテンプレートをそのまま出力するのではなく、iFrameの中に書き込んでいます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そのためそのiFrameの中から外のURLに送信しようとするので、Forbiddenになるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>解決策としましては、以下のように target に "_top" を設定することです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">function doGet(e) {
    const q = e.parameter.q;

    const template = HtmlService.createTemplateFromFile('index');
    template.self=ScriptApp.getService().getUrl();
    
    if (q) {
        const data = request(q);
        template.json = JSON.stringify(data, null, 4);
    }
    return template.evaluate();
}
</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="markup" class="language-markup">&lt;form action="&lt;?= self ?&gt;" method="get" target="_top"&gt;
    &lt;input type="text" name="q" placeholder="検索"&gt;
    &lt;button type="submit"&gt;検索&lt;/button&gt;
&lt;/form&gt;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ところで業務スーパーのレモネードベースが美味しすぎて、毎日飲んでます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>カルピスのように水で薄めて飲むので、ゴミも少ないし最高です。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>116</wp:post_id>
		<wp:post_date><![CDATA[2023-08-06 17:19:21]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-08-06 08:19:21]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-08-06 17:21:08]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-08-06 08:21:08]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[gas%e3%81%ae%e3%83%95%e3%82%a9%e3%83%bc%e3%83%a0%e9%80%81%e4%bf%a1doget-dopost%e3%81%a7forbidden%e3%81%ab%e3%81%aa%e3%82%8b%e5%95%8f%e9%a1%8c%e3%82%92%e8%a7%a3%e6%b1%ba]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[VSCode(V1.81)で、日本語化出来なかったのでダウングレードした話]]></title>
		<link>https://www.masaakiota.net/2023/08/08/vscodev1-81%e3%81%a7%e3%80%81%e6%97%a5%e6%9c%ac%e8%aa%9e%e5%8c%96%e5%87%ba%e6%9d%a5%e3%81%aa%e3%81%8b%e3%81%a3%e3%81%9f%e3%81%ae%e3%81%a7%e3%83%80%e3%82%a6%e3%83%b3%e3%82%b0%e3%83%ac%e3%83%bc/</link>
		<pubDate>Tue, 08 Aug 2023 04:16:43 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=122</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>愛用しているVSCodeにて、突然英語に戻ってしまったので、それについてです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Japanese Language Pack for Visual Studio Code</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>調べてみると、どうやらJapanese Language Pack for Visual Studio Codeが消えていました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>再度インストールしても反応なし。試しに再起動するとJapanese Language Pack for Visual Studio Codeが再び消えていました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そうしたことを３回ほど繰り返した後、ようやくVSCodeの更新履歴を見にいきました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>どうやらV1.81が７月にリリースされており、これかなと思い試しにV1.80に落としてみた所、該当のプラグインを正常にインストールすることができました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ダウングレード方法</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下から、VSCode 1.80をダウンロードできます。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://code.visualstudio.com/updates/v1_80","type":"rich","providerNameSlug":"visualstudio"} -->
<figure class="wp-block-embed is-type-rich is-provider-visualstudio wp-block-embed-visualstudio"><div class="wp-block-embed__wrapper">
https://code.visualstudio.com/updates/v1_80
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>VSCodeは再起動せずにPCをスリープさせる運用でずっと来ていましたので、おそらくこの更新が今まで反映されていなかったのかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>また、djlint周りでもおかしな挙動をしていましたので、ついでにこれも治ってくれればいいなと。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>122</wp:post_id>
		<wp:post_date><![CDATA[2023-08-08 13:16:43]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-08-08 04:16:43]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-20 09:40:15]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-20 00:40:15]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[vscodev1-81%e3%81%a7%e3%80%81%e6%97%a5%e6%9c%ac%e8%aa%9e%e5%8c%96%e5%87%ba%e6%9d%a5%e3%81%aa%e3%81%8b%e3%81%a3%e3%81%9f%e3%81%ae%e3%81%a7%e3%83%80%e3%82%a6%e3%83%b3%e3%82%b0%e3%83%ac%e3%83%bc]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="%e3%82%a8%e3%83%87%e3%82%a3%e3%82%bf"><![CDATA[エディタ]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_bd8545e3457d01d73f685427fe00f607]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://code.visualstudio.com/updates/v1_80">Visual Studio Code June 2023</a></h4><p>Learn what is new in the Visual Studio Code June 2023 Release (1.80)</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_bd8545e3457d01d73f685427fe00f607]]></wp:meta_key>
		<wp:meta_value><![CDATA[1691468142]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[プログラマのための金融知識（株・市場・為替・etc...）]]></title>
		<link>https://www.masaakiota.net/?p=126</link>
		<pubDate></pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=126</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回は、プログラマのための金融知識と題して、やっていきます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なお私自身どこかの株を保有していたり、為替で荒稼ぎしていたりなどする猛者などではありません。あくまでプログラマとして必要なときに必要な知識を得ているだけの金融素人であることを、最初に明言しておきます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>126</wp:post_id>
		<wp:post_date><![CDATA[2023-08-11 19:51:35]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[0000-00-00 00:00:00]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-08-11 19:51:35]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-08-11 10:51:35]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[]]></wp:post_name>
		<wp:status><![CDATA[draft]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="uncategorized"><![CDATA[未分類]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[プログラミングコード生成。Claude vs GPT-4]]></title>
		<link>https://www.masaakiota.net/2023/08/21/%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e3%82%b3%e3%83%bc%e3%83%89%e7%94%9f%e6%88%90%e3%80%82claude-vs-gpt-4/</link>
		<pubDate>Sun, 20 Aug 2023 23:25:50 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=129</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは。フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ChatGPTが登場してから、プログラミングにはAIによるサポートが欠かせなくなりました。VSCodeのGithub Copilotなどはその典型ですが、今回はブラウザでのChatの使用について。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ClaudeとGPT-4の違い</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Claudeは2023年8月21日現在、2023年前半までのデータを持っています。対してGPT-4は2021年までのデータですので、最新情報を取れるClaudeの方が良いかと思って、使用してみました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Claudeは現在日本では使用できないため、Poeを介して利用することとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://poe.com/"} -->
<figure class="wp-block-embed"><div class="wp-block-embed__wrapper">
https://poe.com/
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2 class="wp-block-heading">試してみた</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下は、米国株のランキングを取得するためのサンプルコードを作ってもらったときの、ClaudeとGPT-4の違いです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Claude</h3>
<!-- /wp:heading -->

<!-- wp:image {"id":132,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="http://35.221.87.155/wp-content/uploads/2023/08/スクリーンショット-2023-08-21-8.08.56-777x1024.png" alt="" class="wp-image-132"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Alpha Vantageのドキュメントには、GLOBAL_RANKING関数などは存在しません。AIによくある、息をするように嘘をつく現象が出ています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">GPT-4</h3>
<!-- /wp:heading -->

<!-- wp:image {"id":133,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="http://35.221.87.155/wp-content/uploads/2023/08/スクリーンショット-2023-08-21-8.09.48-897x1024.png" alt="" class="wp-image-133"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>こちらは自前でランキングを取得することを提案してくれています。まだこのコードは試していませんが、少なくともClaudeよりは地に足がついているかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">最後に</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Claudeには少し期待していたのですが、この結果からはあまりプログラミングには使えないかなという印象でした。以上、簡単ですが、ClaudeとGPT-4のプログラミングでの使用についてでした。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>129</wp:post_id>
		<wp:post_date><![CDATA[2023-08-21 08:25:50]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-08-20 23:25:50]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-08-21 16:12:40]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-08-21 07:12:40]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e3%82%b3%e3%83%bc%e3%83%89%e7%94%9f%e6%88%90%e3%80%82claude-vs-gpt-4]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="ai"><![CDATA[AI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_aab43aef537b1472e3963b3ffc8b7b9c]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_1ea67b6b56c18c66dcac0e5c6672b4fe]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[ストリーミング時のhttps-portal設定]]></title>
		<link>https://www.masaakiota.net/2023/08/22/%e3%82%b9%e3%83%88%e3%83%aa%e3%83%bc%e3%83%9f%e3%83%b3%e3%82%b0%e6%99%82%e3%81%aehttps-portal%e8%a8%ad%e5%ae%9a/</link>
		<pubDate>Mon, 21 Aug 2023 18:07:08 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=138</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>OpenAIなどのChat系のAPIを使う場合、逐次結果を表示するのがセオリーです。今回は、Dockerイメージの１つであるhttps-portalを使用する際の、逐次表示の設定についてです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">https-portal</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>https-portalは、Dockerイメージの一つで、サイトを簡単にhttps化することができます。内部でnginxが動いてますので、設定はこのnginxをいじることとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">CUSTOM_NGINX_SERVER_CONFIG_BLOCK</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>docker-compose.ymlで、CUSTOM_NGINX_SERVER_CONFIG_BLOCKを設定します。具体的には、以下のようになります。JavaScriptのEventSourceで、xxx/stream/xxxといったURLからストリーミングするのを想定しています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class=""> CUSTOM_NGINX_SERVER_CONFIG_BLOCK: |
        location ~ /stream/ {
            proxy_pass http://web:8000;
            proxy_http_version 1.1;
            proxy_set_header Host $$host;
            proxy_set_header X-Real-IP $$remote_addr;
            proxy_set_header X-Forwarded-For $$proxy_add_x_forwarded_for;
            proxy_buffering off;
            add_header 'Cache-Control' 'no-cache';
        }</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここに入れた文字列が、nginx設定のserver{}内に入ることとなります。注意点としましては、$を入れると展開されてしまうので、$$とする部分です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>全体だと、以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">version: '3'

services:
  web:
    image: python:latest
    
    command: gunicorn main.wsgi:application --bind 0.0.0.0:8000
    ports:
      - "8000:8000"
    volumes:
      - docker-vol:/vol

  https-portal:
    image: steveltn/https-portal:1
    ports:
      - '80:80'
      - '443:443'
    links:
      - web
    restart: always
    environment:
      DOMAINS: 'xxx.com -&gt; http://web:8000'
      STAGE: 'local' # Don't use production until staging works
      CUSTOM_NGINX_SERVER_CONFIG_BLOCK: |
        location /static/ {
            alias /vol/static/;
        }
        location ~ /stream/ {
            proxy_pass http://web:8000;
            proxy_http_version 1.1;
            proxy_set_header Host $$host;
            proxy_set_header X-Real-IP $$remote_addr;
            proxy_set_header X-Forwarded-For $$proxy_add_x_forwarded_for;
            proxy_buffering off;
            add_header 'Cache-Control' 'no-cache';
        }
    volumes:
      - docker-https:/var/lib/https-portal
      - docker-vol:/vol

volumes:
  docker-vol:
  docker-https:</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以上、簡単ですが、https-portalでストリーミングを設定する方法でした。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>138</wp:post_id>
		<wp:post_date><![CDATA[2023-08-22 03:07:08]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-08-21 18:07:08]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-08-22 03:08:09]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-08-21 18:08:09]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%83%88%e3%83%aa%e3%83%bc%e3%83%9f%e3%83%b3%e3%82%b0%e6%99%82%e3%81%aehttps-portal%e8%a8%ad%e5%ae%9a]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="docker"><![CDATA[Docker]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[Larvel無しでIlluminate Database使用時にEvent発火しない問題]]></title>
		<link>https://www.masaakiota.net/2023/08/31/larvel%e7%84%a1%e3%81%97%e3%81%a7illuminate-database%e4%bd%bf%e7%94%a8%e6%99%82%e3%81%abevent%e7%99%ba%e7%81%ab%e3%81%97%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Thu, 31 Aug 2023 02:39:30 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=142</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは。フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>最近ちょっと涼しくなって、またエアコンなしでも行けるかなとガンガン扇風機を回しています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Illuminate Databaseでイベントが発火しない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Larvelを使ったことのない私ですが、DjangoのようなORMモデルを使用したいと探した結果、とりあえずIlluminate Databaseを使用しています。これはもともとLarvelに搭載されているもので、それを単体で使っているわけですが、以下の問題が発生しました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>どうやってもイベントが発火しない。。。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ライブラリにprint文を加えたり、ChatGPT大先生とすったもんだしながら、ようやく以下の解決方法が出てきましたので、共有させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Illuminate Database単体でもイベント発火させる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>結論としましては、まずEventsをComposerに加えます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">composer require illuminate/events</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>そして、以下の「ここ」の部分数行をコードに加えるだけです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">use \Illuminate\Database\Capsule\Manager as DB;
use \Illuminate\Events\Dispatcher;
use \Illuminate\Container\Container;

$db = new DB;

$db-&gt;addConnection([
    'driver'   =&gt; 'sqlite',
    'database' =&gt; SQLITE_DB_FILE,
    'prefix'   =&gt; '',
]);

// ここ。イベントディスパッチャを手動で設定
$dispatcher = new Dispatcher(new Container());
$db-&gt;setEventDispatcher($dispatcher);</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">最後に</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近リカーマウンテンにはまってます。メガ盛りカレーが美味しい割にめちゃ安いので、行けば3,4つはまとめ買いしています。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>142</wp:post_id>
		<wp:post_date><![CDATA[2023-08-31 11:39:30]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-08-31 02:39:30]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-12 11:40:48]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-12 02:40:48]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[larvel%e7%84%a1%e3%81%97%e3%81%a7illuminate-database%e4%bd%bf%e7%94%a8%e6%99%82%e3%81%abevent%e7%99%ba%e7%81%ab%e3%81%97%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="illuminate-database"><![CDATA[Illuminate Database]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Next.js】middlewareではdotenv, fsなど色々使えない]]></title>
		<link>https://www.masaakiota.net/?p=498</link>
		<pubDate></pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=498</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Next.jsのmiddleware</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Next.js 13以降（たぶん）では以下のファイルがmiddlwareとして認識されます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">src
  - middleware.ts</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このmiddlewareで認証などを行い、適切なパスにリダイレクトしたりします。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">色々使えない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>色々便利なmiddlewareですが、その代わり色々使えません。例えばdotenvやfsなどは使えません。これはmiddlewareがEdge Functionで動いているためです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>498</wp:post_id>
		<wp:post_date><![CDATA[2024-01-27 17:14:30]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[0000-00-00 00:00:00]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-27 17:14:30]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-27 08:14:30]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[]]></wp:post_name>
		<wp:status><![CDATA[draft]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="uncategorized"><![CDATA[未分類]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Apollo】Subscription使用時のReact Form操作]]></title>
		<link>https://www.masaakiota.net/?p=535</link>
		<pubDate></pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=535</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Apollo</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ApolloはNode.jsで使えるGraphQL用のクライアントです。Hasuraと一緒に使うことで、かなり便利です。例えばテーブルの更新をサブスクリプションするのも簡単にできてしまいます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Form使用時の考慮点</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ReactでForm操作をする時は、react-hook-formが候補として挙げられるかと思います。ただApolloのSubscriptionを使う場合、どうも以下の問題点が出てきます。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>react-hook-formではデフォルト値を設定するため、apolloでのsubscriptionの恩恵を受けれない。</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>つまりデフォルト値が入ってしまうと、</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>535</wp:post_id>
		<wp:post_date><![CDATA[2024-02-06 05:53:19]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[0000-00-00 00:00:00]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-02-06 05:53:19]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-02-05 20:53:19]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[]]></wp:post_name>
		<wp:status><![CDATA[draft]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="uncategorized"><![CDATA[未分類]]></category>
						</item>
					<item>
		<title><![CDATA[【Next.js】"use client" + αで、クライアント限定にする]]></title>
		<link>https://www.masaakiota.net/?p=599</link>
		<pubDate>Mon, 18 Mar 2024 01:57:38 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=599</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">use client</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>use clientを使えば、クライアント限定にできると思いがちですが、そうではありません。どうやらNext.jsでは、最適化のためuse clientとされたコードであっても、サーバーとクライアントと両方で実行されます。そのため、たとえばwindowといったクライアント限定コードを書くとエラーになったり、あるいはそれを回避しても、サーバーとクライアントとで実行結果が違うといったエラーが出たりします。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">クライアント限定にする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そのため、強制的にクライアント限定にするために以下のようにできます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">const Context = createContext&lt;ContextType>({} as any)

export function useClientCode(){
  return useContext(Context);
}

export function ClientCodeProvider(props:{children:React.ReactNode){
  
  return &lt;Context.provider value={
    // ここに色々クライアントのみで使いたい関数を入れる
  }>{props.children}&lt;/Context.provider>
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記では、プロバイダーを使用して関数を渡しています。プロバイダーはクライアント限定なので、サーバーで実行されることはありません。これで安心して眠れます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>酒はロング缶があるのに、コーヒーにないのはなぜでしょう。がぶ飲みしたいがためにコーヒーではなく酒のロング缶を買ってしまい、眠くなってしまうという。コーヒーもロング缶、ロングペットボトルを作ってください業者さんお願いします。っていうお話。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>599</wp:post_id>
		<wp:post_date><![CDATA[2024-03-18 10:57:38]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-03-18 01:57:38]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-03-20 00:12:05]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-03-19 15:12:05]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90next-js%e3%80%91use-client-%ce%b1%e3%81%a7%e3%80%81%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88%e9%99%90%e5%ae%9a%e3%81%ab%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[draft]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="next-js"><![CDATA[Next.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【FLUX】Dreambooth + LoRAで学習が反映されない時]]></title>
		<link>https://www.masaakiota.net/?p=1816</link>
		<pubDate>Thu, 17 Jul 2025 11:57:18 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1816</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリラーンスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">FLUX</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>FLUXは2025年7月17日現在、かなり最強の部類にある画像生成モデルです。これをDreambooth + LoRAで学習しようという話です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">目的</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、特定人物の複数画像生成を目的にしています。Dreamboothによる学習 + LoRAによる保存を行います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">意図した結果が出ない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>特定人物の画像を学習し、画像を生成するのですが、何度やっても違う人物が生成されていました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">INSTANCE_PROMPT: Final = f"A photo of sks person"
GENERATE_PROMPT: Final = f"A photo of sks person"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>色々調べた結果、以下のようなことがわかりました。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>class promptは、fluxでは使わないのが良いらしい</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>prior reservationも、fluxでは使わないのが良いらしい</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>lora rank &lt; lora alphaで、学習の優先度が上がる &lt;= これ！</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>lora rankとlora alphaの調整が、今回最も効果があったように思います。alphaをrankの２倍程度にすると、学習効果がはっきり表れるようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1816</wp:post_id>
		<wp:post_date><![CDATA[2025-07-17 20:57:18]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-07-17 11:57:18]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-07-17 22:26:03]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-07-17 13:26:03]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90flux%e3%80%91dreambooth-lora%e3%81%a7%e5%ad%a6%e7%bf%92%e3%81%8c%e5%8f%8d%e6%98%a0%e3%81%95%e3%82%8c%e3%81%aa%e3%81%84%e6%99%82]]></wp:post_name>
		<wp:status><![CDATA[draft]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="ai"><![CDATA[AI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【AI】2025年半ばでの個人的AIコーディング事情【Cursor】]]></title>
		<link>https://www.masaakiota.net/?p=1827</link>
		<pubDate></pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1827</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回は、私が個人的に経験したCursorを用いたAIコーディングを書いていきます。情報より読み物としてお楽しみいただければと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">環境</h2>
<!-- /wp:heading -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>IDE: Cursor 1.2.4</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>モデル: 主にClaude 4 sonnet</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>言語: TypeScript, Python, Dartなど</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">AIへの不満</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まずは読者の関心を惹くため、AIへの不満を書いていきます。エンジニアはAIに色々溜まっておられるかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">とにかくアホ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>かなり頭がいいと思うこともあれば、いやぁいつも通りアホやなぁと思わされることも多々あります。そういう時に限ってよぎるのは</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">「プロンプトが悪いんじゃない？」</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>という誰かが言った言葉です。いやぁ、確かにプロンプトを厳密に作れば、ある程度正確に対応してくれます。ただそれほど綿密にプロンプトを書くぐらいなら初めから自分で作った方が早いです。それに綿密にプロンプトを書いても、無視されたりします。やつらは常に、自分本位の論理展開をしてきやがります。そこに私が細かな指示を入れても、まるで海辺に捨てられた釣り針の先についた砂つぶ。無視されるのが定番です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>とは言っても、綿密なプロンプトが正しい反応に繋がるのは事実ではあります。ただ、もうちょっとうまいこと出来ないの？とは思ってしまいます。人相手なら諦めもつくのですが、ツール相手なのでどうしても欲が出てしまいます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>その度にこう思うのです。こいつアホやなぁと。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余計なことしかしない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1827</wp:post_id>
		<wp:post_date><![CDATA[2025-07-26 20:59:44]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[0000-00-00 00:00:00]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-07-26 20:59:44]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-07-26 11:59:44]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[]]></wp:post_name>
		<wp:status><![CDATA[draft]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="uncategorized"><![CDATA[未分類]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[Django compilemessagesでvenvが対象になってしまう問題と解消方法]]></title>
		<link>https://www.masaakiota.net/2023/09/05/django-compilemessages%e3%81%a7venv%e3%81%8c%e5%af%be%e8%b1%a1%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%a6%e3%81%97%e3%81%be%e3%81%86%e5%95%8f%e9%a1%8c%e3%81%a8%e8%a7%a3%e6%b6%88%e6%96%b9%e6%b3%95/</link>
		<pubDate>Tue, 05 Sep 2023 00:19:35 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=146</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>最近Reactを初めて触りまして、自動でwebpackしてくれる快適さに鼻水を垂らして感激している今日この頃です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Django compilemessages</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Djangoで以下のコマンドを入れると、翻訳ファイルをコンパイルしてくれるというものです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">python manage.py compilemessages</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これが、python仮想環境用フォルダのvenv内まで走査してしまって、とんでもない量のメッセージを吐き出すんですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>この解決に、以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">python manage.py compilemessages --ignore=venv</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで解決しました。いやぁ、めでたいめでたい。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>146</wp:post_id>
		<wp:post_date><![CDATA[2023-09-05 09:19:35]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-09-05 00:19:35]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-09-05 09:19:35]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-09-05 00:19:35]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[django-compilemessages%e3%81%a7venv%e3%81%8c%e5%af%be%e8%b1%a1%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%a6%e3%81%97%e3%81%be%e3%81%86%e5%95%8f%e9%a1%8c%e3%81%a8%e8%a7%a3%e6%b6%88%e6%96%b9%e6%b3%95]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="django"><![CDATA[Django]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[Djangoで.envが読み込めない問題と解決法]]></title>
		<link>https://www.masaakiota.net/2023/09/05/django%e3%81%a7-env%e3%81%8c%e8%aa%ad%e3%81%bf%e8%be%bc%e3%82%81%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c%e3%81%a8%e8%a7%a3%e6%b1%ba%e6%b3%95/</link>
		<pubDate>Tue, 05 Sep 2023 07:08:43 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=149</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Djangoで.envが読み込めない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、以下の問題に遭遇しました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>通常のDjangoではsettings.pyが存在するのですが、その派生であるWagtailでは、settingsディレクトリにあるbase.pyを編集する形となっています。今回の問題がそれによるものかよく分かっていないのですが、.envが読み込めませんでした。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">from decouple import Config

BASE_DIR = os.path.dirname(PROJECT_DIR)

env_path = os.path.join(BASE_DIR, '.env')
config = Config(env_path)
SECRET_KEY =config.get("DJANGO_SECRET_KEY")</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>このissueが、Githubに立てられています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下の投稿がありました。</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:paragraph -->
<p>.env is searched starting on the main module directory going upwards on the directory tree.</p>
<!-- /wp:paragraph --><cite>https://github.com/HBNetwork/python-decouple/issues/99</cite></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>ほほうなるほど、よくわからないですがともかくこの投稿に合った解決策が以下です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">from decouple import Config, RepositoryEnv

config = Config(RepositoryEnv("path/to/env_file"))</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>なんでもファイルパスをspecifyするそうです。何はともあれ、これで動くようになりました。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>149</wp:post_id>
		<wp:post_date><![CDATA[2023-09-05 16:08:43]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-09-05 07:08:43]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-09-05 16:08:44]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-09-05 07:08:44]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[django%e3%81%a7-env%e3%81%8c%e8%aa%ad%e3%81%bf%e8%be%bc%e3%82%81%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c%e3%81%a8%e8%a7%a3%e6%b1%ba%e6%b3%95]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="django"><![CDATA[Django]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_3985ce2ea2aeec76fbf8427ca9fd9e6b]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/HBNetwork/python-decouple/issues/99">decouple.UndefinedValueError: SECRET_KEY not found. · Issue #99 · HBNetwork/python-decouple</a></h4><p>Hi, I am getting following error- raise UndefinedValueError('{} not found. Declare it as envvar or define a default value.'.format(option)) decouple.UndefinedValueError: SECRET_KEY not found. Declare it as envvar or define a default valu...</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_3985ce2ea2aeec76fbf8427ca9fd9e6b]]></wp:meta_key>
		<wp:meta_value><![CDATA[1693897508]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[2023/09/07 GASのWebアプリモバイル表示がバグってる]]></title>
		<link>https://www.masaakiota.net/2023/09/07/2023-09-07-gas%e3%81%aeweb%e3%82%a2%e3%83%97%e3%83%aa%e3%83%a2%e3%83%90%e3%82%a4%e3%83%ab%e8%a1%a8%e7%a4%ba%e3%81%8c%e3%83%90%e3%82%b0%e3%81%a3%e3%81%a6%e3%82%8b/</link>
		<pubDate>Wed, 06 Sep 2023 22:54:29 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=151</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GASのWebアプリでモバイル表示がおかしい</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>昨日、クライアント様からWebアプリの表示がおかしいとのご報告をいただきました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>かちかちに固めてるはずのWebアプリで、なぜか横にスクロール可能に。。。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>探してみたところ、以下のissueが立てられていました。</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:paragraph -->
<p>The grey web app warning bar has been redesigned to be blue, with an "i" icon and two buttons. The flexbox layout of the redesigned warning bar does not adapt for screens narrower than 704px wide, effectively forcing the GAS application's parent iframe to be 704px wide. A responsive GAS app designed to scale to 100% of the device width will now scale to 100% of 704px instead. The result is that a portion of the GAS app UI is now hidden on viewports narrower than 704px and the user must scroll on the device in order to see everything.</p>
<!-- /wp:paragraph --><cite><a href="https://issuetracker.google.com/issues/298287665?pli=1">https://issuetracker.google.com/issues/298287665?pli=1</a></cite></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>上部のワーニングバーが変更され、その横幅が大きすぎるらしいです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>上記のバー表示と、私が現在表示できるバー表示と様子が違う（前と同じ）ですが、横幅だけ直ってないのでしょうか。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">結論</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Googleの対応待ちですねー。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>151</wp:post_id>
		<wp:post_date><![CDATA[2023-09-07 07:54:29]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-09-06 22:54:29]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-09-07 07:57:25]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-09-06 22:57:25]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[2023-09-07-gas%e3%81%aeweb%e3%82%a2%e3%83%97%e3%83%aa%e3%83%a2%e3%83%90%e3%82%a4%e3%83%ab%e8%a1%a8%e7%a4%ba%e3%81%8c%e3%83%90%e3%82%b0%e3%81%a3%e3%81%a6%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[footnotes]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[Next.js Error: NEXT_REDIRECT]]></title>
		<link>https://www.masaakiota.net/2023/09/13/next-js-error-next_redirect/</link>
		<pubDate>Wed, 13 Sep 2023 07:21:52 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=156</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Next.jsは最近になって大きなアップデートがあったよう。そのタイミングで使い始めていることもあり、新旧の情報が入り乱れている状態は、初学者にはなかなか大変ですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ユーザーのフォーム入力から、Server Actionに渡して認証し、リダイレクトするという単純な作業に何時間もかかってしまいました。。。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>結論から言えば、redirectはtryで囲ってはだめだそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">"use server";

import { redirect } from 'next/navigation';
import { RedirectType } from 'next/dist/client/components/redirect';
import { getAuth } from '@apis/Auth';
import { ROUTES } from '@components/Common';

async function HandleSubmit(formData: FormData) {
    const data = formData;

    try {
        const client = await getAuth();
        const res = await client.requestAndSetPair(data.get('email') as string, data.get('password') as string);
        console.log('ログイン成功');
        // !! tryに入れてはだめ
        // redirect(ROUTES.USER_PROFILE, RedirectType.push); 
    } catch (err) {
        console.error('ログインできません', err);
    }

    // tryの外に出せば動く
    redirect(ROUTES.USER_PROFILE, RedirectType.push); 
}

export default HandleSubmit;
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>一生解決しないんじゃないかと思ってましたが、こんなあっさり。まさかtryで囲ってはだめだなんて、予想すらしてませんでした。アップデートが最近なので、ChatGPT先生も当てにならない状態はなかなかですね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>156</wp:post_id>
		<wp:post_date><![CDATA[2023-09-13 16:21:52]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-09-13 07:21:52]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-09-13 16:21:53]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-09-13 07:21:53]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[next-js-error-next_redirect]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="next-js"><![CDATA[Next.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[Mac M1でStrapiのDockerイメージをビルドする]]></title>
		<link>https://www.masaakiota.net/2023/09/15/mac-m1%e3%81%a7strapi%e3%81%aedocker%e3%82%a4%e3%83%a1%e3%83%bc%e3%82%b8%e3%82%92%e3%83%93%e3%83%ab%e3%83%89%e3%81%99%e3%82%8b/</link>
		<pubDate>Thu, 14 Sep 2023 23:15:26 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=160</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>WindowsはVistaまでしか経験がありません。その後PCから離れていたのですが、再開したのはMacでした。で、最近安かったのでMac Miniを購入したのですが、これがM1チップなので色々と問題が多発します。今回は、Strapiでの問題と解決です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Strapi 公式Dockerfile</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>すでにビルドされたStrapiイメージもありますが、バージョンが古かったので自前でビルドすることにしました。公式で紹介されていたのは、以下のDockerfileです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="docker" class="language-docker">FROM node:18-alpine
# Installing libvips-dev for sharp Compatibility
RUN apk update &amp;&amp; apk add --no-cache build-base gcc autoconf automake zlib-dev libpng-dev nasm bash vips-dev
ARG NODE_ENV=development
ENV NODE_ENV=${NODE_ENV}

WORKDIR /opt/
COPY package.json package-lock.json ./
RUN npm config set fetch-retry-maxtimeout 600000 -g &amp;&amp; npm install
ENV PATH /opt/node_modules/.bin:$PATH

WORKDIR /opt/app
COPY . .
RUN chown -R node:node /opt/app
USER node
RUN ["npm", "run", "build"]
EXPOSE 1337
CMD ["npm", "run", "develop"]
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ところがこれが途中でエラーになります。原因は、ローカルで生成したnode_modulesが、Mac M1チップ用のため、Docker環境で一致しないことでした。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">改善版 Dockerfile</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下が、改善版です。まず、.dockerignoreに以下を書き込みます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre title=".dockerignore" class="wp-block-code"><code class="">node_modules</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>Dockerfileです。Chat GPT4先生にお世話になりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="docker" class="language-docker">FROM node:18-alpine
# Installing libvips-dev for sharp Compatibility
RUN apk update &amp;&amp; apk add --no-cache build-base gcc autoconf automake zlib-dev libpng-dev nasm bash vips-dev
ARG NODE_ENV=development
ENV NODE_ENV=${NODE_ENV}

# /opt/ に package.json と package-lock.json をコピー
WORKDIR /opt/
COPY package.json package-lock.json ./

# 依存関係のインストール
RUN npm config set fetch-retry-maxtimeout 600000 -g &amp;&amp; npm ci

# PATH を設定
ENV PATH /opt/node_modules/.bin:$PATH

# アプリケーションコードをコピー。.dockerignore に記載されたファイルはコピーされない
WORKDIR /opt/app
COPY . .

# 所有権の変更
RUN chown -R node:node /opt/app

# ユーザーを node に変更
USER node

# ビルド
RUN npm run build

# ポートを開放
EXPOSE 1337

# アプリケーションを実行
CMD ["npm", "run", "develop"]
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>こうすることで、ローカルのnode_modulesを使用せず、ベースイメージ上でnode_modulesを生成することになり、問題が解決します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>160</wp:post_id>
		<wp:post_date><![CDATA[2023-09-15 08:15:26]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-09-14 23:15:26]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-09-26 09:05:54]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-09-26 00:05:54]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[mac-m1%e3%81%a7strapi%e3%81%aedocker%e3%82%a4%e3%83%a1%e3%83%bc%e3%82%b8%e3%82%92%e3%83%93%e3%83%ab%e3%83%89%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="docker"><![CDATA[Docker]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[WordPressでCall to undefined method GuzzleHttp\Utils::chooseHandler()]]></title>
		<link>https://www.masaakiota.net/2023/09/15/wordpress%e3%81%a7call-to-undefined-method-guzzlehttputilschoosehandler/</link>
		<pubDate>Fri, 15 Sep 2023 10:08:36 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=166</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>PHPでWordPressプラグイン開発も行っているのですが、他プラグインとの競合が起こりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Call to undefined method GuzzleHttp\Utils::chooseHandler()</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これはWordPressに複数インストールしているプラグインが、競合を起こしてこうなっているようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">他プラグインとの競合</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>具体的には、BackWpUpというプラグインですね。コードを見てもGuzzleHttpのバージョンが分かりませんでしたので、更新履歴から推察することにします。2023/09/15現在このプラグインが現在はバージョン4ですが、3.1.2の時にGuzzleHttp SDKを3.8.1にアップデートしたとあります。その後特にGuzzleHttpに関する記述がないことから、おそらく今でもGuzzleHttpは3.8.1と思われます。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://ja.wordpress.org/plugins/backwpup/#developers","type":"rich","providerNameSlug":"wordpress-org-日本語"} -->
<figure class="wp-block-embed is-type-rich is-provider-wordpress-org-日本語 wp-block-embed-wordpress-org-日本語"><div class="wp-block-embed__wrapper">
https://ja.wordpress.org/plugins/backwpup/#developers
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>一方で今のGuzzleHttpはバージョンは2023/09/15時点で7.8.0で、私が今開発に使っているのは7.7です。7.7と3.8.1との間の差で、今回のエラーとなっているようです。実際にBackWpUpプラグインを無効化すると、正常に動くことを確認しました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ならどうするか</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>私自身Composerのことをあまりよく理解できていなかったこともあり、どうにか出来るのではないかとかなり調べましたが、どうも根本的な解決は無理そうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>大局的に考えれば、古いバージョンのライブラリを使い続けるより新しいバージョンに合わせるのがセオリーだとは思うのですが、作者の都合や事情もあるのかなと。これだけ古いバージョンを使い続けているのですから、何か根幹的ないじりにくい部分で変えにくいと言うこともあるのかも知れません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ちなみに、以下では力技を紹介されています。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://capitalp.jp/2023/06/23/avoid-conflict-with-php-scoper/","type":"rich","providerNameSlug":"capital-p"} -->
<figure class="wp-block-embed is-type-rich is-provider-capital-p wp-block-embed-capital-p"><div class="wp-block-embed__wrapper">
https://capitalp.jp/2023/06/23/avoid-conflict-with-php-scoper/
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>これはComposerライブラリの名前空間を置換すると言う力技です。まぁ私の場合ここまですることもありませんので、とりあえずGuzzleHttpを使わずに、他ので代替することにしようかなと。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>最近は曇りが多く涼しかったのですが、今日はまた暑いです。夏はまだまだ続きそうですね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>166</wp:post_id>
		<wp:post_date><![CDATA[2023-09-15 19:08:36]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-09-15 10:08:36]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-09-15 19:15:14]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-09-15 10:15:14]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[wordpress%e3%81%a7call-to-undefined-method-guzzlehttputilschoosehandler]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="wordpress"><![CDATA[WordPress]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[footnotes]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_8eab69d076794dc6db4e78361547abd3]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://capitalp.jp/2023/06/23/avoid-conflict-with-php-scoper/">PHP-ScoperでWordPressプラグインのコンフリクトを解決する</a></h4><p>PHPにはcomposerという高度なパッケージ管理ツールが存在しており、WordPressでもcomposerを利用した開発がさかんに行われている。しかし、ついにコンフリクトが発生するようになったため、その解決方法と知 [...]</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_8eab69d076794dc6db4e78361547abd3]]></wp:meta_key>
		<wp:meta_value><![CDATA[1694772849]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_e0e283267584c5dddf89111958902d3c]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://ja.wordpress.org/plugins/backwpup/#developers">BackWPup - WordPress Backup Plugin</a></h4><p>WordPress の完全自動バックアップを予約します。保存するコンテンツ (Dropbox、S3など) を指定できます。これは無料版です</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_e0e283267584c5dddf89111958902d3c]]></wp:meta_key>
		<wp:meta_value><![CDATA[1694772913]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[PHPにPOSTしたJSONがデコードできなかった話（マジッククォート）]]></title>
		<link>https://www.masaakiota.net/2023/09/23/php%e3%81%abpost%e3%81%97%e3%81%9fjson%e3%81%8c%e3%83%87%e3%82%b3%e3%83%bc%e3%83%89%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%8b%e3%81%a3%e3%81%9f%e8%a9%b1%ef%bc%88%e3%83%9e%e3%82%b8%e3%83%83%e3%82%af%e3%82%af/</link>
		<pubDate>Sat, 23 Sep 2023 06:48:19 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=174</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは。フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>PHP歴は学生時代から触っていてその後ブランクがあったのですが、今更PHPのクセを新たに知りましたので、メモがわりに共有させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">JSONが勝手にエスケープされる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>JSONに限った話ではないと思うのですが、JavaScriptでhidden要素に入れたJSONデータがデコードできなくなる問題に直面しました。原因はマジッククォートのようです。マジッククォートはPHPの設定で切り替えるようで、自動でエスケープするかしないかを指定できます。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.1ft-seabass.jp/memo/2012/12/03/php-magicquotes-json_encode-tips/","type":"rich","providerNameSlug":"1-ft-seabass"} -->
<figure class="wp-block-embed is-type-rich is-provider-1-ft-seabass wp-block-embed-1-ft-seabass"><div class="wp-block-embed__wrapper">
https://www.1ft-seabass.jp/memo/2012/12/03/php-magicquotes-json_encode-tips/
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>デフォルトでエスケープするようなので、大抵のサーバーではそうなのだそう。PHPはだいぶ古い言語ですので、こういった無茶な要素があったりするわけですね。知ってたら問題ないのですが、知らないとなかなかハマります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ちなみにこの機能はPHP5.4で廃止になったそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なるほど、ちなみに私のテスト環境は。。。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>。。。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>PHP7.4...？</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>え？</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>174</wp:post_id>
		<wp:post_date><![CDATA[2023-09-23 15:48:19]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-09-23 06:48:19]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-09-23 15:55:29]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-09-23 06:55:29]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[php%e3%81%abpost%e3%81%97%e3%81%9fjson%e3%81%8c%e3%83%87%e3%82%b3%e3%83%bc%e3%83%89%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%8b%e3%81%a3%e3%81%9f%e8%a9%b1%ef%bc%88%e3%83%9e%e3%82%b8%e3%83%83%e3%82%af%e3%82%af]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="php"><![CDATA[PHP]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_5c19f13119ff4232e351dba9ab8e1b7d]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://www.1ft-seabass.jp/memo/2012/12/03/php-magicquotes-json_encode-tips/">PHPでFORMデータから受け取った値をjson_decodeでJSON変換するときマジッククォートでハマった話 |</a></h4><p>PHPでFORMデータから受け取った値をjson_encodeでJSON変換するときマジッククォートでハマった話をメモしておきます。 結論としてはマジッククォートがONであればjson_encodeにFORMデータを流しこむ前にstripslashesで取り除くことに落ち着きました。 症状 ...</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_5c19f13119ff4232e351dba9ab8e1b7d]]></wp:meta_key>
		<wp:meta_value><![CDATA[1695452075]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[footnotes]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[PHPのarrayについてGPT4に議論させてみた]]></title>
		<link>https://www.masaakiota.net/2023/09/25/php%e3%81%aearray%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6gpt4%e3%81%ab%e8%ad%b0%e8%ab%96%e3%81%95%e3%81%9b%e3%81%a6%e3%81%bf%e3%81%9f/</link>
		<pubDate>Sun, 24 Sep 2023 19:55:54 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=181</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>PHPは古い言語であるため、モダンなTypeScriptなどに慣れているとつい猿のようにムッキーしてしまうこともあるかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>しかし人気CMSのWordPressに使われていたりするため、PHPを触らないといけないことも多いのが実情です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回は、そんなPHPにムッキーした時にGPT4を使って気分を紛らわせてみましたので、その様子をご紹介させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これを読んで、少しでもPHPへのムッキーを解消していただければと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">PHPのarrayにムッキー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そもそもの発端は、WordPressのプラグイン作成をしている時でした。PHPはObject型、Array型があり、Object型は謎の記法で書きます。謎と言っても他の言語と比べて独特であるというだけなのですが、ともかくObject型はアローで属性にアクセスし、Array型だと角カッコでアクセスします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>このObjectのアローでの表現が、キーに変数を使う時など非常にみずらい。また初期化時も、いちいち一つずつ代入しないといけない（Arrayからキャストする方法はある）。だからDictionary的な機能はArrayを使いたいのですが、Arrayはなぜか、他の言語でいうListとDictionaryの性質を併せ持っています。これらの型はそれぞれ用途が違いますし、分けた方が圧倒的に使いやすいと思います。せっかく関数の引数や返り型を指定できるのに、arrayで一緒くたになっていたら意味がないじゃないですか。しかしこれはPHPが古い言語ということもあり、プログラミングに対する概念が進んでいない状態で最初の仕様が固まってしまったためでしょう。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>さてそんなところについついムッキーしてしまうわけですが、以下のように発散させました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GPT4に議論させる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GPT４に議論させてみました。以下を参考にさせていただきました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://blog.front-mind.com/chatgpt-disc/" data-type="link" data-id="https://blog.front-mind.com/chatgpt-disc/">https://blog.front-mind.com/chatgpt-disc/</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>上記を参考に、指示を出してみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">あなたは[司会者]と[専門家１]と[専門家２]の役割を持ちます。[テーマ]についてそれぞれの役割が交互に発話し、課題と解決方法も混ぜながら議論してください。[ゴール]に向かって議論してください。かならず[ゴール]について結論を出してください。
各条件は以下の通りです

[テーマ]
PHPのarrayは、配列と連想配列との役割分担を明確にするよう改変すべきか。

[専門家１]
改変すべきと主張するエンジニア

[専門家２]
改変すべきでないと主張するエンジニア

[ゴール]
何度か議論を経て、それを見た読者に考えるきっかけを与える。</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下、GPT4の回答、それに続けていきます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">もちろん、議論を始めましょう。今回のテーマは「PHPのarrayは、配列と連想配列との役割分担を明確にするよう改変すべきか」というものですね。専門家１、あなたは改変すべきと主張するエンジニアとして、まずどのような理由がありますか？

専門家１：PHPのarrayについて、配列と連想配列の役割を明確に分けるべきだと考えます。現在のarrayは、添字が数値の場合と文字列の場合を区別せずに扱います。これは混乱を招く可能性があり、プログラムの品質を低下させる原因となります。例えば、配列として使用しているのに連想配列のように振る舞うことがあるため、予測困難なバグが発生しやすいです。

専門家２：一方で、PHPのarrayはその柔軟性が魅力です。必要に応じて添字を数値または文字列で使用でき、同じ変数に異なるタイプのデータを格納できます。改変すれば、既存のコードが影響を受け、互換性の問題が生じる可能性があります。また、この柔軟性は多くの開発者にとって便利で、制約を加えることは逆に開発を妨げることになるかもしれません。

どちらの主張にも一理あるようですね。ゴールに向かって、この問題に対する結論を出すために、もう少し詳しく議論してみましょう。特に、既存のコードへの影響や開発効率についても考慮しながら、議論を進めましょう。</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">続けて</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">もちろん、議論を続けましょう。専門家１と専門家２、前回の議論で示された観点をさらに深めてみましょう。専門家１、改変の主張を強化するために、具体的な利点や例を挙げていただけますか？

専門家１：確かにです。PHPのarrayを改変し、配列と連想配列の役割を明確に分けることにより、コードの予測可能性が向上します。例えば、関数やメソッドの引数として受け取るデータの型を明確に指定でき、誤った型のデータが渡された場合にエラーを検出しやすくなります。また、コードの可読性も向上し、新たな開発者がプロジェクトに参加する際にもスムーズなコード理解が可能となります。

専門家２：しかし、改変が既存のコードに与える影響を考える必要があります。PHPは多くの既存プロジェクトで使用されており、それらのプロジェクトは現在のarrayの柔軟性を利用しています。改変が行われると、これらのプロジェクトは大規模な修正を必要とし、時間とリソースがかかる可能性があります。また、柔軟性を削減することは一部の開発者にとって不便で、新しい制約が生まれることになります。

議論を通じて、改変の利点と欠点が明らかになってきました。ゴールに向かって、どちらの主張を支持するかについて意見をまとめ、結論を出しましょう。読者に、この問題について考えるきっかけを提供しましょう。</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">続けて</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">理論的な面と実用的な面からの観点を踏まえた議論は非常に重要です。専門家１と専門家２、最終的な結論に向けて、さらに深く議論を進めてみましょう。

専門家１、改変が行われる場合、具体的なステップやベストプラクティスを提案できますか？

専門家１：もちろんです。改変が行われる場合、段階的なアプローチが必要です。まず、既存のコードと連携しながら、新しい配列型を導入することが大切です。また、PHPのバージョンアップと連動して実施することで、プロジェクトに最小限の影響を与えることができるでしょう。そして、開発者コミュニティとの協力が不可欠で、変更の受け入れを円滑に進めるための議論と説明が必要です。

専門家２、改変しないことに対する最終的な主張は何ですか？

専門家２：改変しないことに対する主張は、既存のコードベースへの影響を最小限に抑えることと、開発者が柔軟なアプローチを維持できることです。PHPのarrayは柔軟で多目的なデータ構造であり、多くのプロジェクトで成功裏に使用されています。改変を行うことで、これらの利点が損なわれる可能性があり、新しい制約が生まれることになります。

最終的な結論として、読者に提供する情報は何か、どちらの主張にも賛同できる観点はあるか、という点を考えてみましょう。そして、この問題についての結論を出してみてください。</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">最後に司会者としてまとめてください</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">議論を進めてきた専門家１と専門家２、PHPのarrayに関する改変の是非について、非常に興味深い議論が展開されました。その結論をまとめると、以下のようになります。

専門家１は、PHPのarrayを改変して、配列と連想配列の役割を明確に分けるべきだと主張しました。これにより、コードの予測可能性が向上し、可読性が向上するという利点があります。また、新しい配列型を段階的に導入するアプローチを提案しました。

一方、専門家２は、改変しないほうが良いと主張しました。PHPのarrayの柔軟性が多くのプロジェクトで重要であり、改変が既存のコードに大きな影響を及ぼす可能性があると指摘しました。

最終的な結論として、PHPのarrayの改変については、プロジェクトのコンテキストや要件に依存すると言えます。新しい配列型の導入は、新規プロジェクトや特定のユースケースに適しているかもしれませんが、既存のプロジェクトには影響があるため、</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">続けて</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">続けてまとめます。

結論として、PHPのarray改変については以下のポイントを考慮すべきです。

プロジェクトのコンテキスト: 既存のプロジェクトでは、柔軟性を活かす必要があるかどうかを検討する必要があります。新規プロジェクトや特定のユースケースでは改変が有益かもしれませんが、既存のコードベースへの影響を考慮することが大切です。

開発者コミュニティの意見: PHPのコミュニティやプロジェクトのメンバーと協力し、議論を行い、改変についての意見を集約することが重要です。

段階的なアプローチ: もし改変を行う場合、段階的なアプローチを採用し、既存のコードとの互換性を確保する方法を検討すべきです。

最終的な結論は、プロジェクトの要件や目標に応じて異なるかもしれません。議論を通じて、読者に対して考える材料を提供し、プロジェクトごとに最適な決定をする手助けとなることを願っています。

この議論に参加いただいた皆さん、貴重な意見を共有していただき、ありがとうございました。議論はゴールに向かって進展しました。</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">最後に</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>いかがでしたでしょうか。皆様はどうか分かりませんが、少なくとも私はすっきりすることができました。しかしこのようにGPTのやり取りをコピペするだけのページは、ネットの質を落としかねないですね。皆様はこのようなページは作ってはいけませんよ。え？私？いやぁ、ははは。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>181</wp:post_id>
		<wp:post_date><![CDATA[2023-09-25 04:55:54]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-09-24 19:55:54]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-09-25 10:39:21]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-09-25 01:39:21]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[php%e3%81%aearray%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6gpt4%e3%81%ab%e8%ad%b0%e8%ab%96%e3%81%95%e3%81%9b%e3%81%a6%e3%81%bf%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="php"><![CDATA[PHP]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[footnotes]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_c5aeee6dfe493621db769b2359785911]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://blog.front-mind.com/chatgpt-disc/">【AI/ChatGPT】AIにテーマを与えて議論・結論を導く（マインドマップで整理）</a></h4><p>ChatGPTに役割を与え、議論させることで、様々な専門家のアイデアや知見を得ることができます。本記事では、ChatGPTを活用して、特定のテーマについての議論を行い、その結果をマインドマップで整理する方法について紹介します。この方法は、複</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_c5aeee6dfe493621db769b2359785911]]></wp:meta_key>
		<wp:meta_value><![CDATA[1695585636]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[CodeMirrorをモジュールで使用する]]></title>
		<link>https://www.masaakiota.net/2023/09/25/codemirror%e3%82%92%e3%83%a2%e3%82%b8%e3%83%a5%e3%83%bc%e3%83%ab%e3%81%a7%e4%bd%bf%e7%94%a8%e3%81%99%e3%82%8b/</link>
		<pubDate>Mon, 25 Sep 2023 00:51:58 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=194</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>１万行ほどのデータをtextareaに入れていたのですが、動作が重すぎるためCodeMirrorを使用することにしました。仮想スクロールで動作がサクサクになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>WordPressのプラグインということもあって、できるだけ他のプラグインと干渉しないように、JavaScriptはmoduleでいきたいです。ただCodeMirrorはCDN経由でのmodule使用はバグがあるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://gist.github.com/Potherca/028514c75f581db115797ecb50c6f945">https://gist.github.com/Potherca/028514c75f581db115797ecb50c6f945</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>上記サイトによると、esm.shで読み込めば問題ないとのこと。そこで、以下のようにしました。フォーム内の全てのテキストエリアをCodeMirrorで置き換え、送信時にはデータをテキストエリアに反映させています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">
import { basicSetup, EditorView } from 'https://esm.sh/codemirror@6.0.1'

// フォーム要素を取得
const form = document.getElementById('settings-form');

// すべてのtextarea要素を取得
const textareas = form.querySelectorAll('textarea');

textareas.forEach((textarea, index) =&gt; {
    // 新しいdiv要素を作成してtextareaの隣に挿入
    const div = document.createElement('div');
    div.classList.add('editor-container');
    textarea.parentNode.insertBefore(div, textarea.nextSibling);

    // CodeMirrorインスタンスを作成
    const editorView = new EditorView({
        doc: textarea.value,
        extensions: [basicSetup],
        parent: div,
    });

    // フォーム送信時に隠しinput要素とCodeMirrorの内容を同期
    form.addEventListener('submit', () =&gt; {
        textarea.value = editorView.state.doc.toString();
    });
});

</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>194</wp:post_id>
		<wp:post_date><![CDATA[2023-09-25 09:51:58]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-09-25 00:51:58]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:12:29]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:12:29]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[codemirror%e3%82%92%e3%83%a2%e3%82%b8%e3%83%a5%e3%83%bc%e3%83%ab%e3%81%a7%e4%bd%bf%e7%94%a8%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_2d5a170b98fac934677bc67be0cf819c]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://gist.github.com/Potherca/028514c75f581db115797ecb50c6f945">Loading CodeMirror through a CDN</a></h4><p>Loading CodeMirror through a CDN. GitHub Gist: instantly share code, notes, and snippets.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_2d5a170b98fac934677bc67be0cf819c]]></wp:meta_key>
		<wp:meta_value><![CDATA[1695602924]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[Node.js xlsxモジュールでhigh severity vulnerability]]></title>
		<link>https://www.masaakiota.net/2023/09/26/node-js-xlsx%e3%83%a2%e3%82%b8%e3%83%a5%e3%83%bc%e3%83%ab%e3%81%a7high-severity-vulnerability/</link>
		<pubDate>Mon, 25 Sep 2023 23:59:06 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=201</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">xlsxの脆弱性</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>strapiにexcelでのインポート機能を実装しようと以下を実行しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npm install xlsx</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>すると以下のメッセージが。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">1 high severity vulnerability

Some issues need review, and may require choosing
a different dependency.

Run `npm audit` for details.</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>言われたコマンドを実行すると</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npm audit
# npm audit report

xlsx  *
Severity: high
Prototype Pollution in sheetJS - https://github.com/advisories/GHSA-4r6h-8v6p-xvw6
No fix available
node_modules/xlsx

1 high severity vulnerability

Some issues need review, and may require choosing
a different dependency.</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>どうやら悪意のあるExcelファイルを読み込んだ時の脆弱性があるようです。high severityとのことですので、これはやばい。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">対策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下に対策が書かれています。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://github.com/SheetJS/sheetjs/issues/2822","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/SheetJS/sheetjs/issues/2822
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>上記によると、脆弱性対応バージョンが存在するものの、メンテナンスされてないため、npm経由ではインストールできないとのこと。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこで以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npm install https://cdn.sheetjs.com/xlsx-0.19.3/xlsx-0.19.3.tgz</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>すると以下のようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">found 0 vulnerabilities</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>いやぁ、よかったよかった。しかしnode.jsでExcelファイルを読み込むのに、メンテナンスされてないモジュールしか選択肢がないのは厳しいですね。一応他にもライブラリはあるようなのですが、どうも調べた感じだと今回の用途には適さないようですので。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">2024/02/04追記</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>現行バージョンは以下になっています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">https://cdn.sheetjs.com/xlsx-0.20.1/xlsx-0.20.1.tgz</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>公式サイトがあるんですね。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://docs.sheetjs.com/docs/getting-started/installation/nodejs","type":"rich","providerNameSlug":"sheetjs"} -->
<figure class="wp-block-embed is-type-rich is-provider-sheetjs wp-block-embed-sheetjs"><div class="wp-block-embed__wrapper">
https://docs.sheetjs.com/docs/getting-started/installation/nodejs
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>201</wp:post_id>
		<wp:post_date><![CDATA[2023-09-26 08:59:06]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-09-25 23:59:06]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:20:51]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:20:51]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[node-js-xlsx%e3%83%a2%e3%82%b8%e3%83%a5%e3%83%bc%e3%83%ab%e3%81%a7high-severity-vulnerability]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_a521d283058912c5a328cc641c1d42c9]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/SheetJS/sheetjs/issues/2822">[Security] Prototype Pollution in sheetJS · Issue #2822 · SheetJS/sheetjs</a></h4><p>Security] Prototype Pollution in sheetJS GHSA-4r6h-8v6p-xvw6 Affected version: 0.19.3 Description All versions of SheetJS CE through 0.19.2 are vulnerable to "Prototype Pollution" when reading specially crafted files. Workflows that do ...</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_a521d283058912c5a328cc641c1d42c9]]></wp:meta_key>
		<wp:meta_value><![CDATA[1707053565]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_85e57cdc77117dddfb34cb0ff950c1d4]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://docs.sheetjs.com/docs/getting-started/installation/nodejs">NodeJS | SheetJS Community Edition</a></h4><p>Package tarballs are available on .</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_85e57cdc77117dddfb34cb0ff950c1d4]]></wp:meta_key>
		<wp:meta_value><![CDATA[1707053562]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Chart.js】aspectRatioの動的設定がうまくいかなかった話]]></title>
		<link>https://www.masaakiota.net/2023/10/10/chart-js%e3%80%80aspectratio%e3%81%ae%e5%8b%95%e7%9a%84%e8%a8%ad%e5%ae%9a%e3%81%8c%e3%81%86%e3%81%be%e3%81%8f%e3%81%84%e3%81%8b%e3%81%aa%e3%81%8b%e3%81%a3%e3%81%9f%e8%a9%b1/</link>
		<pubDate>Tue, 10 Oct 2023 06:21:42 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=209</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>世の中にはChart.jsなんていう素晴らしいライブラリを無償で提供してくださっている方がおられるんですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そのChart.jsでうまくいかなかった話と、解決方法を書かせていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">aspectRatioの動的変更</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>aspectRatioを設定すれば、チャート全体の縦横比を変えることができます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">this.chartInstance = new Chart(ctx, {
            type: 'line',
            data: {
                labels: this.timestamps,
                datasets,
            },
            options: {
                aspectRatio: 2.0, // &lt;- ここ</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>で、これを動的に変更するために、以下のようにしてたんですね。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">this.chartInstance.options.aspectRatio = 1.0;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>するとなぜか、横幅いっぱいに広がらず、隣がスカスカになるんですよ。cssではwidth100%を設定してるのに構わずです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決方法</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>どうやら、最初に設定したaspectRatioと、次に設定する値との関係で、そのような状況になるみたいです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>たとえば最初は1.0にしておいて（縦長）、そこから動的に2.0（横長）に設定するとうまくいきました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>最近寒くなってきましたね。夏が恋しいです。ではでは。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>209</wp:post_id>
		<wp:post_date><![CDATA[2023-10-10 15:21:42]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-10 06:21:42]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:13:15]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:13:15]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[chart-js%e3%80%80aspectratio%e3%81%ae%e5%8b%95%e7%9a%84%e8%a8%ad%e5%ae%9a%e3%81%8c%e3%81%86%e3%81%be%e3%81%8f%e3%81%84%e3%81%8b%e3%81%aa%e3%81%8b%e3%81%a3%e3%81%9f%e8%a9%b1]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[SMTPテストならmailtrap]]></title>
		<link>https://www.masaakiota.net/2023/10/11/smtp%e3%83%86%e3%82%b9%e3%83%88%e3%81%aa%e3%82%89mailtrap/</link>
		<pubDate>Wed, 11 Oct 2023 07:42:48 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=217</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>nodemailerでお名前.comのSMTPにメールを送信までは行けるのですが、なぜか送信先で受信ができず四苦八苦していました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そもそもテスト用に取得したメールアカウントだったので、他に代替品はないかと。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Gmailは普段使いしてる関係から、パスワードを.envとは言え書き込むのは躊躇しますし、その他Yahooメールも同様。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこで調べて見たら、素晴らしいのを見つけました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">MailTrap</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>なんとテスト送信専用に使用できる、MailTrapなるものがありました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://mailtrap.io/home","type":"rich","providerNameSlug":"mailtrap"} -->
<figure class="wp-block-embed is-type-rich is-provider-mailtrap wp-block-embed-mailtrap"><div class="wp-block-embed__wrapper">
https://mailtrap.io/home
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>ここならテスト用にUser IDとPasswordを取得でき、Web上で送信されたメールもしっかりと確認できます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>いやぁ、いいものがあるんですね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>217</wp:post_id>
		<wp:post_date><![CDATA[2023-10-11 16:42:48]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-11 07:42:48]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-11 16:42:50]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-11 07:42:50]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[smtp%e3%83%86%e3%82%b9%e3%83%88%e3%81%aa%e3%82%89mailtrap]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="uncategorized"><![CDATA[未分類]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_cb3351cc4657ab7f8740b1b315114380]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://mailtrap.io/home">Mailtrap - Safe Email Testing</a></h4><p>Sign in and cover your entire email infrastructure in one place: test and debug emails in staging with Email Testing, then send and control them with Email Sending.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_cb3351cc4657ab7f8740b1b315114380]]></wp:meta_key>
		<wp:meta_value><![CDATA[1697010099]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[Illuminate Database古いバージョンでsave()時に値が変わる問題]]></title>
		<link>https://www.masaakiota.net/2023/10/12/illuminate-database%e5%8f%a4%e3%81%84%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e3%81%a7save%e6%99%82%e3%81%ab%e5%80%a4%e3%81%8c%e5%a4%89%e3%82%8f%e3%82%8b%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Thu, 12 Oct 2023 02:26:06 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=219</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>古くから使っているシステムなどの場合、古いバージョンを使い続けなければならない状況もあるかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回、古いバージョンのIlluminate Databaseを使用した時の問題について書かせていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Illuminate Databaseのバージョン</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>2023/10/12現在、最新バージョンは10を超えていますが、今回使用しているのはバージョン8です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>newで作成して値を入れたのはいいのですが、save()した途端なぜか代わりにIDらしきものが入り込んでいるという状況でした。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">対策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>newのあと一旦save()し、改めて値を入れ直してから再度save()することで正常動作まで持っていくことができました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">追記</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>という話だったのですが、その後実際に動作を最後まで見てみると、色々処理したあと最終的に全てNull値になっているという事象が発生しました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>結局、インサートはSQLで直書きし、その後Eloquentで取得するということにしました。SQLばんざいおばんざい。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>219</wp:post_id>
		<wp:post_date><![CDATA[2023-10-12 11:26:06]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-12 02:26:06]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-12 12:11:36]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-12 03:11:36]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[illuminate-database%e5%8f%a4%e3%81%84%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e3%81%a7save%e6%99%82%e3%81%ab%e5%80%a4%e3%81%8c%e5%a4%89%e3%82%8f%e3%82%8b%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="illuminate-database"><![CDATA[Illuminate Database]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[footnotes]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[VSCode Github Copilot Chatに日本語で答えてもらう]]></title>
		<link>https://www.masaakiota.net/2023/10/13/vscode-github-copilot-chat%e3%81%ab%e6%97%a5%e6%9c%ac%e8%aa%9e%e3%81%a7%e7%ad%94%e3%81%88%e3%81%a6%e3%82%82%e3%82%89%e3%81%86/</link>
		<pubDate>Thu, 12 Oct 2023 19:07:53 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=225</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>みなさん、AI活用してますか？僕はAIなしでは生きられない頭になってしまいました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そんな豆腐脳みそですが、今回はVSCode Github Copilotに日本語で答えてもらう小技を紹介させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">VSCode Github Copilot Chatとは</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>VSCodeのGithub Copilot拡張機能です。Githubのアカウントで設定を行い、VSCodeでプラグインをインストールして使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これをインストールすると、右クリックでCopilotメニューが現れますので、そこで「explain」などの便利な機能が使用できるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ですがこのexplainを使用しても、英語で返ってくるんですね。設定項目にも、言語設定らしきものが見当たらない（2023/10/13時点の話です）。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今後設定が追加されれば嬉しいのですが、それまでの間ひとまずどうやって使うのが最も効率がいいか考えました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">結論</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Ctrl + Iでコマンド入力画面を呼び出し、そこで以下のように入力します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">/explain jp</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>はい、なんとこれで日本語で説明してくれます。パチパチパチ。少し面倒ですが、設定項目が追加されるまでの辛抱ですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>225</wp:post_id>
		<wp:post_date><![CDATA[2023-10-13 04:07:53]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-12 19:07:53]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-20 09:40:05]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-20 00:40:05]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[vscode-github-copilot-chat%e3%81%ab%e6%97%a5%e6%9c%ac%e8%aa%9e%e3%81%a7%e7%ad%94%e3%81%88%e3%81%a6%e3%82%82%e3%82%89%e3%81%86]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="%e3%82%a8%e3%83%87%e3%82%a3%e3%82%bf"><![CDATA[エディタ]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[[Chart.js] グラフのY軸とX軸を太くする]]></title>
		<link>https://www.masaakiota.net/2023/10/17/chart-js-%e3%82%b0%e3%83%a9%e3%83%95%e3%81%aey%e8%bb%b8%e3%81%a8x%e8%bb%b8%e3%82%92%e5%a4%aa%e3%81%8f%e3%81%99%e3%82%8b/</link>
		<pubDate>Tue, 17 Oct 2023 01:27:19 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=228</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニア太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ちらっと聞いた話ですが、趣味に関して。発達障害の人は趣味そのものを楽しみ、そうでない人は趣味を通した人間関係を楽しむのだそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>はたして私はどちらでしょう。学生の頃はプログラミングを趣味にしていましたが、今は仕事としてさせていただいています。プログラミングも楽しいと言えば楽しいですが、それよりも楽しいこともたくさんありますからね。時代の流れでプログラミングに将来性を見出してさせていただいています。もし将来AIがプログラマーの仕事を奪うようなことがあれば、次は何の仕事をしましょうか。話がそれました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Chart.jsでグラフのY軸とX軸を太くする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>グラフには必ずY軸とX軸がありますが、その縦横の線を描いている場合の話ですね。目盛りとはまた違いまして、軸の話です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>軸だけを太くするには、以下のように自作pluginを作成します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const chartAreaBorder = {
    id: 'chartAreaBorder',
    afterDraw(chart, args, options) {
        const { ctx, chartArea: { left, top, width, height } } = chart
        ctx.save();
        ctx.globalAlpha = 0.5; // 効いてない？
        ctx.strokeStyle = options.borderColor
        ctx.lineWidth = options.borderWidth
        ctx.borderStyle = options.borderDash
        ctx.borderTopWidth = options.borderTopWidth
        ctx.setLineDash(options.borderDash || [])
        ctx.lineDashOffset = options.borderDashOffset

        // 下の線
        ctx.lineWidth = 2;  // 線の太さを設定
        ctx.beginPath();
        ctx.moveTo(left, top + height);
        ctx.lineTo(left + width, top + height);
        ctx.stroke();

        // 左の線
        ctx.lineWidth = options.borderWidth;
        ctx.beginPath();
        ctx.moveTo(left, top + height);
        ctx.lineTo(left, top);
        ctx.stroke();

        // ctx.strokeRect(left, top, width, height)
        ctx.restore()
    }
};</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このpluginを以下のように適用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript"> new Chart(ctx, {
            plugins: [chartAreaBorder],
            ...</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>Chart.jsのプラグイン関係はかなり複雑なこともできそうですが、ひとまず私にとって現在必要な部分だけとなっています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>228</wp:post_id>
		<wp:post_date><![CDATA[2023-10-17 10:27:19]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-17 01:27:19]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:13:26]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:13:26]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[chart-js-%e3%82%b0%e3%83%a9%e3%83%95%e3%81%aey%e8%bb%b8%e3%81%a8x%e8%bb%b8%e3%82%92%e5%a4%aa%e3%81%8f%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Next.js】useFormState, useFormStatusが見つからない？]]></title>
		<link>https://www.masaakiota.net/2023/10/19/%e3%80%90next-js%e3%80%91useformstate-useformstatus%e3%81%8c%e8%a6%8b%e3%81%a4%e3%81%8b%e3%82%89%e3%81%aa%e3%81%84%ef%bc%9f/</link>
		<pubDate>Wed, 18 Oct 2023 23:23:17 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=233</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。Next.jsのApp Router機能は、現在GPT先生に聞いても知らぬ存ぜぬで、まいっちんぐまちこ先生です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">useFormState, useFormStatusがない？</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回は、表題の通り特定のライブラリが見つからなかった時のお話です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>それぞれNext.jsの最新機能であるForm Actionを使用する際に使うものなのですが、公式サイトのリファレンスには以下のようにあります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">import { useFormState, useFormStatus } from 'react-dom';</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>しかしこれが、私の環境で出来なかったんですね。具体的には、この名前ではエクスポートされていませんでした。唯一useFormStatusは別の名前でexportされていたためasでインポートできたのですが、useFormStateはそもそも出てこない。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">原因と対処</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回Next.jsは、確か何かパッケージ的なものを使用してインストールしていました。そのため必要なものが揃っていなかったようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>具体的には、以下のようにしました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npm install react@latest
npm install @types/react@latest
npm install react-dom@latest
npm install @types/react-dom@latest</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>上記のように行い、ついでにnextに関しても同様にバージョンアップを行いました。これで、importのエラーは解決です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ただ、なぜか実行時に useFormStatus is not function と言われるんですよね。。。調査中です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>というお話でした。ではでは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>233</wp:post_id>
		<wp:post_date><![CDATA[2023-10-19 08:23:17]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-18 23:23:17]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-19 09:23:11]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-19 00:23:11]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90next-js%e3%80%91useformstate-useformstatus%e3%81%8c%e8%a6%8b%e3%81%a4%e3%81%8b%e3%82%89%e3%81%aa%e3%81%84%ef%bc%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="next-js"><![CDATA[Next.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[footnotes]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Strapi】SwaggerのテストURLを変更する]]></title>
		<link>https://www.masaakiota.net/2023/10/19/%e3%80%90strapi%e3%80%91swagger%e3%81%ae%e3%83%86%e3%82%b9%e3%83%88url%e3%82%92%e5%a4%89%e6%9b%b4%e3%81%99%e3%82%8b/</link>
		<pubDate>Thu, 19 Oct 2023 05:46:50 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=241</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>StrapiにはDocumentationというプラグインがあり、そこでAPIのテストを行ったりすることができます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">テスト用のURLを変更する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>SwaggerはデフォルトでURLがlocalhostとなっています。これに新しいURLを足したり、変更したりするには、/config/plugins.tsファイルに以下の記述を足します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">module.exports = ({ env }) =&gt; ({
    ...

    documentation: {
        config: {
            servers: [
                {
                    url: env('API_URL', 'http://localhost:1337'),
                    description: 'Development server',
                },
            ],
        }
    },
});
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここではAPI_URL環境変数を読み込んでいますが、もちろん直接記述することもできます。また複数指定すれば、ページ表示時にどれかを選択できるようになります。便利ですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>他の設定項目は以下に書かれています。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://docs.strapi.io/dev-docs/plugins/documentation","type":"rich","providerNameSlug":"strapi"} -->
<figure class="wp-block-embed is-type-rich is-provider-strapi wp-block-embed-strapi"><div class="wp-block-embed__wrapper">
https://docs.strapi.io/dev-docs/plugins/documentation
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>241</wp:post_id>
		<wp:post_date><![CDATA[2023-10-19 14:46:50]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-19 05:46:50]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-19 14:49:02]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-19 05:49:02]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90strapi%e3%80%91swagger%e3%81%ae%e3%83%86%e3%82%b9%e3%83%88url%e3%82%92%e5%a4%89%e6%9b%b4%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="strapi"><![CDATA[Strapi]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_399f32b3e9c9cd9f00c972c8d80c7dc7]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://docs.strapi.io/dev-docs/plugins/documentation">Documentation | Strapi Documentation</a></h4><p>By using Swagger UI, the API documentation plugin takes out most of your pain to generate your documentation.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_399f32b3e9c9cd9f00c972c8d80c7dc7]]></wp:meta_key>
		<wp:meta_value><![CDATA[1697694540]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Strapi】API応答のattributesを再帰的に平滑化する]]></title>
		<link>https://www.masaakiota.net/2023/10/20/%e3%80%90strapi%e3%80%91api%e5%bf%9c%e7%ad%94%e3%81%aeattributes%e3%82%92%e5%86%8d%e5%b8%b0%e7%9a%84%e3%81%ab%e5%b9%b3%e6%bb%91%e5%8c%96%e3%81%99%e3%82%8b/</link>
		<pubDate>Thu, 19 Oct 2023 23:58:55 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=245</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>strapiは管理画面でデータタイプを作成すれば、自動でAPIを作成してくれるなど便利な機能があります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ですがそのAPIの送信と取得にちょっと難があったので、それを吸収する関数を作りました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">attributesが送信時と受信時とで入ったり入らなかったりする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>表題の通りなのですが、送信時は特にattributes属性を入れなくていいものの、受信時にはattributesが入って返ってきます。以下のような感じです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">{
    id: number,
    attributes: []
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これが送信時も受信時も同様にattributesを入れる仕様ならまだいいのですがそうではないので、型定義が余分に増えてしまい複雑になってしまいます。1, 2階層程度ならまだしも、ネストするほどに複雑になるので以下の関数を作りました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">attributesを再帰的に平滑化する関数</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>作ったといっても、ほとんどGPT4先生にあれこれお願いして出来上がったものです。自分の頭だけで作るのはさすがにしんどそうな代物となっています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type FlattenAttributesObject = { [key: string]: any };


/**
 * attributes属性をフラットにする
 */
function flattenAttributes(obj: FlattenAttributesObject | any[], result: FlattenAttributesObject = {}): FlattenAttributesObject | any[] {
    if (Array.isArray(obj)) {
        return obj.map(item => {
            if (typeof item === 'object' &amp;&amp; item !== null) {
                return flattenAttributes(item);
            }
            return item;
        });
    }

    const newObj: FlattenAttributesObject = { ...result };
    for (const [key, value] of Object.entries(obj)) {
        if (Array.isArray(value)) {
            newObj[key] = value.map(item => {
                if (typeof item === 'object' &amp;&amp; item !== null) {
                    return flattenAttributes(item);
                }
                return item;
            });
        } else if (key === 'attributes') {
            Object.assign(newObj, flattenAttributes(value));
        } else if (typeof value === 'object' &amp;&amp; value !== null) {
            newObj[key] = flattenAttributes(value);
        } else {
            newObj[key] = value;
        }
    }
    return newObj;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>245</wp:post_id>
		<wp:post_date><![CDATA[2023-10-20 08:58:55]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-19 23:58:55]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-20 08:58:57]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-19 23:58:57]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90strapi%e3%80%91api%e5%bf%9c%e7%ad%94%e3%81%aeattributes%e3%82%92%e5%86%8d%e5%b8%b0%e7%9a%84%e3%81%ab%e5%b9%b3%e6%bb%91%e5%8c%96%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="strapi"><![CDATA[Strapi]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Strapi】Error creating endpoint xxx xxx Cannot read properties of undefined (reading xxx)]]></title>
		<link>https://www.masaakiota.net/2023/10/20/%e3%80%90strapi%e3%80%91error-creating-endpoint-xxx-xxx-cannot-read-properties-of-undefined-reading-xxx/</link>
		<pubDate>Fri, 20 Oct 2023 04:58:45 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=247</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回、表題のようなエラーが出まして、さっぱり分からずエラー内容で検索してみたら、ぴったりな記事を見つけました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://forum.strapi.io/t/error-when-trying-to-create-a-simple-custom-route-error-creating-endpoint-get-route-cannot-read-property-controller-function-of-undefined/14413","type":"rich","providerNameSlug":"strapi-community-forum"} -->
<figure class="wp-block-embed is-type-rich is-provider-strapi-community-forum wp-block-embed-strapi-community-forum"><div class="wp-block-embed__wrapper">
https://forum.strapi.io/t/error-when-trying-to-create-a-simple-custom-route-error-creating-endpoint-get-route-cannot-read-property-controller-function-of-undefined/14413
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>通常、以下のような構成になります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="" class="">custom-xxx
 ┗ controllers
    ┗ custom-xxx.ts
 ┗ documentation
    ┗ 1.0.0
       ┗ custom-xxx.json
 ┗ routes
    ┗ custom-xxx.ts
 ┗ services
    ┗ custom-xxx.ts</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>結論としましては、カスタムAPIのファイル名に、大文字やアンダーバーを使ってはいけないとのことです。キャメルケースもスネークケースもダメで、ケバブケースでやれとのことですね。いやいや、誰が気づくねんこんな仕様。リンク先で教えてくださっている方は、すごい。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>247</wp:post_id>
		<wp:post_date><![CDATA[2023-10-20 13:58:45]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-20 04:58:45]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-20 14:09:02]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-20 05:09:02]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90strapi%e3%80%91error-creating-endpoint-xxx-xxx-cannot-read-properties-of-undefined-reading-xxx]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="strapi"><![CDATA[Strapi]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_91a4cd5d1491d85757a4734f3907b198]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://forum.strapi.io/t/error-when-trying-to-create-a-simple-custom-route-error-creating-endpoint-get-route-cannot-read-property-controller-function-of-undefined/14413">Error when trying to create a simple custom route: Error creating endpoint GET : Cannot read property of undefined</a></h4><p>System Information Strapi Version: V4 Operating System: aws linux AMI Database: mysql Node Version: 14.18.1 NPM Version: 6.14.15 I am trying to get the example code from the docs "Development/Back-end customization" to run for a simple custom route "/api/customizeUser/...".</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_91a4cd5d1491d85757a4734f3907b198]]></wp:meta_key>
		<wp:meta_value><![CDATA[1697778543]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[footnotes]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Strapi】Componentを含めてデータを登録する【カスタムAPI】]]></title>
		<link>https://www.masaakiota.net/2023/10/20/%e3%80%90strapi%e3%80%91component%e3%82%92%e5%90%ab%e3%82%81%e3%81%a6%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e7%99%bb%e9%8c%b2%e3%81%99%e3%82%8b%e3%80%90%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%a0api%e3%80%91/</link>
		<pubDate>Fri, 20 Oct 2023 08:07:19 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=253</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">カスタムAPIでデータを登録する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ファイル構成などは省かせていただきますが、controllers/xxxのファイルでの話です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>データベースを操作するにはEntity Service APIとQuery Engine APIの２つがあります。このうち公式サイトの説明ではEntity Service APIの方が簡単だということでこちらを使いたかったのですが、create関数の説明が見当たらない。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なるほど、createするにはQuery Engine APIしかないのねと思いそちらで頑張ってみたのですが、どうしてもComponentが絡むとうまくいかない。そもそもComponentが入っているテーブルがわからない。APIディレクトリにもそれらしきものは見当たらない。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこでGoogle先生にお伺いすると、以下で同じような状況の方がおられました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://forum.strapi.io/t/populate-components-while-creating-updating-an-entry-with-query-engine-api/29577","type":"rich","providerNameSlug":"strapi-community-forum"} -->
<figure class="wp-block-embed is-type-rich is-provider-strapi-community-forum wp-block-embed-strapi-community-forum"><div class="wp-block-embed__wrapper">
https://forum.strapi.io/t/populate-components-while-creating-updating-an-entry-with-query-engine-api/29577
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Componentを含めて登録するには</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>結局、Entity Service APIにcreate関数が存在しましたので、以下のようにすれば簡単にComponentも含めて登録できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">await strapi.entityService.create("api::xxx.xxx", { data: item });</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>うーむ、どこにEntity Service APIのcreate関数の説明があるのだろうか。。。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>253</wp:post_id>
		<wp:post_date><![CDATA[2023-10-20 17:07:19]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-20 08:07:19]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-20 17:08:37]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-20 08:08:37]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90strapi%e3%80%91component%e3%82%92%e5%90%ab%e3%82%81%e3%81%a6%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e7%99%bb%e9%8c%b2%e3%81%99%e3%82%8b%e3%80%90%e3%82%ab%e3%82%b9%e3%82%bf%e3%83%a0api%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="strapi"><![CDATA[Strapi]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_5a25cf67c3bdda474a22780fafb38fbd]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://forum.strapi.io/t/populate-components-while-creating-updating-an-entry-with-query-engine-api/29577">Populate components while creating/updating an entry with query engine api</a></h4><p>System Information Strapi Version: 4.11.2 Database: mySQL Node Version: 18.16.0 NPM Version: 9.5.1 Hello, I am using an external API to create some entries on my strapi backend. My collection type uses 2 components and I want to pass data to them. I am using the query engine API but I cannot populate the components.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_5a25cf67c3bdda474a22780fafb38fbd]]></wp:meta_key>
		<wp:meta_value><![CDATA[1697789053]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Strapi】Componentを含めた検索をする]]></title>
		<link>https://www.masaakiota.net/2023/10/21/%e3%80%90strapi%e3%80%91component%e3%82%92%e5%90%ab%e3%82%81%e3%81%9f%e6%a4%9c%e7%b4%a2%e3%82%92%e3%81%99%e3%82%8b/</link>
		<pubDate>Sat, 21 Oct 2023 03:21:07 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=256</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Componentを含めた検索方法</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようなモデルの場合です。カテゴリーモデルのnameフィールドに、リピータブルなComponentを入れています。このComponentは翻訳用で、localeとtextの２つのフィールドを持っています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Category
|- name
    |- Translation Component (Repeatable)
        |- locale
        |- text </code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここから指定の翻訳テキストのレコードを取得するには、以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">res = await strapi.db.query("api::category.category").findOne({
    where: { name: {  text: { $contains: 'あいうえお' }  } },
    populate: { "name": true },
});
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>レスポンスは以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">{
   id: 2,
   createdAt: '2023-10-21T02:48:19.907Z',
   updatedAt: '2023-10-21T02:48:19.907Z',
   name: [
     { id: 32025, locale: 'ja', text: 'あいうえお' },
     { id: 32026, locale: 'en', text: 'abcdefg' }
   ]
 }</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>256</wp:post_id>
		<wp:post_date><![CDATA[2023-10-21 12:21:07]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-21 03:21:07]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-21 12:22:06]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-21 03:22:06]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90strapi%e3%80%91component%e3%82%92%e5%90%ab%e3%82%81%e3%81%9f%e6%a4%9c%e7%b4%a2%e3%82%92%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="strapi"><![CDATA[Strapi]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Strapi】TypeScriptでDB操作時のContent Type入力を楽にする]]></title>
		<link>https://www.masaakiota.net/2023/10/22/%e3%80%90strapi%e3%80%91typescript%e3%81%a7db%e6%93%8d%e4%bd%9c%e6%99%82%e3%81%aecontent-type%e5%85%a5%e5%8a%9b%e3%82%92%e6%a5%bd%e3%81%ab%e3%81%99%e3%82%8b/</link>
		<pubDate>Sun, 22 Oct 2023 05:14:09 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=259</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Strapi DB操作でのContent Type</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>StrapiではDB操作に以下のような文字列を渡す必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">await strapi.entityService.create(
    "api::category.category", // &lt;= これ
    data
)</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>この文字列をいちいち管理画面からContent Typeの名前を確認して、いざ入力してみたはいいものの合わないなどなかなか</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこでStrapiは便利な機能を用意してくれています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Typeファイル生成コマンド</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のコマンドをプロジェクトのルートで打てば、自動で型定義ファイルが生成されます。これにより自動保管が有効になり、入力が楽になります。うーん、便利。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npm run strapi ts:generate-types</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>なおテーブルを更新するたびに実行しなければいけないので、shファイルなどを生成しておくと覚えておかなくて良いので良いかもしれません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>259</wp:post_id>
		<wp:post_date><![CDATA[2023-10-22 14:14:09]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-22 05:14:09]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-22 14:16:14]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-22 05:16:14]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90strapi%e3%80%91typescript%e3%81%a7db%e6%93%8d%e4%bd%9c%e6%99%82%e3%81%aecontent-type%e5%85%a5%e5%8a%9b%e3%82%92%e6%a5%bd%e3%81%ab%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="strapi"><![CDATA[Strapi]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MUI】動作がおかしい時に試してみること]]></title>
		<link>https://www.masaakiota.net/2023/10/23/%e3%80%90react%e3%80%91mui%e3%81%ae%e5%8b%95%e4%bd%9c%e3%81%8c%e3%81%8a%e3%81%8b%e3%81%97%e3%81%84%e6%99%82%e3%81%ab%e8%a9%a6%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b%e3%81%93%e3%81%a8/</link>
		<pubDate>Mon, 23 Oct 2023 10:13:11 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=263</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">MUIの動作がおかしい</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>MUIに限った話ではないのかもしれませんが、検証する時間がないためMUIで話をさせていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>例えば以下のようなコンポーネントを作成したとします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">
const handleChange = async (e: React.ChangeEvent&lt;{ name?: string; value: unknown }>) => {
    const name = e.target.name;
    let value = e.target.value;
    if (e.target instanceof HTMLInputElement &amp;&amp; e.target.type == "checkbox") {
        value = e.target.checked;
    }
    setSettings({ ...settings, [name as string]: value });
}

const MySwitch = (prop: { label: string, name: keyof LiveSettings }) => {
    const { label, name, ...rest } = prop;
    return &lt;FormControlLabel label={label} control={
        &lt;Switch name={name} key={name} checked={settings[name] ? true : false} disabled={submitting || loading}
            onChange={handleChange} {...rest} />}
    />
}
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを２通りの方法で使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">{MySwitch({ label: "停止 / 実行", name: "active" })}
&lt;MySwitch label="非公開 / 公開" name="public" /></code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>そう、お分かりのように、この言い方で合っているか分からず恐縮ですが、JSXで呼び出すか、関数で呼び出すかの違いとなっています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>関数で呼び出す時は正常に動作するのですが、JSXで呼び出す時はアニメーションが効きません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">どうするか</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>とりあえず関数で呼び出しておけば間違いはないのかなと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>263</wp:post_id>
		<wp:post_date><![CDATA[2023-10-23 19:13:11]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-23 10:13:11]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-13 21:26:04]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-13 12:26:04]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91mui%e3%81%ae%e5%8b%95%e4%bd%9c%e3%81%8c%e3%81%8a%e3%81%8b%e3%81%97%e3%81%84%e6%99%82%e3%81%ab%e8%a9%a6%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b%e3%81%93%e3%81%a8]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mui"><![CDATA[MUI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】バックエンドとフロントエンドとで共通のライブラリを使う]]></title>
		<link>https://www.masaakiota.net/2023/10/26/%e3%80%90node-js%e3%80%91%e3%83%90%e3%83%83%e3%82%af%e3%82%a8%e3%83%b3%e3%83%89%e3%81%a8%e3%83%95%e3%83%ad%e3%83%b3%e3%83%88%e3%82%a8%e3%83%b3%e3%83%89%e3%81%a8%e3%81%a7%e5%85%b1%e9%80%9a%e3%81%ae/</link>
		<pubDate>Thu, 26 Oct 2023 01:33:52 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=265</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>現在StrapiとNext.jsとでシステムを組んでいるのですが、Socket通信で使うための型定義ファイルを共有化したいなと思い色々試行錯誤しました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>通常は単純にローカルで参照すればいい話なのですが、Dockerを使っていることもあり、また将来サーバーを分けるとなった時のことを考えると単純ではないなと。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">方法</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>色々方法があるようです。通常ならローカルパスを指定してimportすれば良いかと思います。そのほかにGithubでプライベートでnpmを登録したりする方法もあるようですが、今回は見送りました。複数人で分担するようになったら、Githubでのプライベートnpmも考えたいと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回、それぞれのDockerイメージに無理やり共通化ライブラリを入れました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Dockerの仕様上親Dockerfileの親を参照できないことから、親で実行するといった技を使っています。そしてそこからローカルでimportしようとしたのですがなぜか上手くいかず、結局npmでローカルインストールする方法を取りました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">構成</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>構成は以下のようになってます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">- /strapi/
  - Dockerfile
  - ...
- /next/
  - Dockerfile
  - ...
- /global-lib/
  - package.json
  - tsconfig.json
  - src/
  - dist/
- docker-compose.yml</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>各ファイルです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">/global-lib/package.json</h3>
<!-- /wp:heading -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
  "name": "global-lib",
  "version": "1",
  "description": "shared between server and client",
  "license": "MIT",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "scripts": {
    "build": "tsc"
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">/global-lib/tsconfig.json</h3>
<!-- /wp:heading -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
  "compilerOptions": {
    "target": "es2016",
    "module": "commonjs",
    "rootDir": "./src/",
    "declaration": true,
    "outDir": "./dist/",
    "esModuleInterop": true,
    "forceConsistentCasingInFileNames": true,
    "strict": true,
    "skipLibCheck": true
  }
}
</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">/docker-compose.yml</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Dockerの仕様でDockerfileより親を読み込めないので、contextとdockerfileを指定しています。これでdocker-compose（Dockerfileの親）から実行したことになり、その子にあたるglobal-libを取得できるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="docker" class="language-docker">...
  strapi:
    container_name: strapi
    build:
      context: .
      dockerfile: ./strapi/Dockerfile
...</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">/strapi/Dockerfile</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>docker-composeから見た相対パスを指定してCOPYしています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="docker" class="language-docker">FROM node:18-alpine
# Installing libvips-dev for sharp Compatibility
RUN apk update &amp;&amp; apk add --no-cache build-base gcc autoconf automake zlib-dev libpng-dev nasm bash vips-dev curl
ARG NODE_ENV=development
ENV NODE_ENV=${NODE_ENV}

# /opt/ に package.json と package-lock.json をコピー
WORKDIR /opt/strapi/
COPY ./strapi/package.json ./strapi/package-lock.json ./

# 依存関係のインストール
RUN npm config set fetch-retry-maxtimeout 600000 -g &amp;&amp; npm ci

# PATH を設定
ENV PATH /opt/strapi/node_modules/.bin:$PATH

# アプリケーションコードをコピー。.dockerignore に記載されたファイルはコピーされない
COPY ./strapi/ /opt/strapi/
COPY ./global-lib/ /opt/global-lib/

# 所有権の変更
RUN chown -R node:node /opt/strapi
RUN chown -R node:node /opt/global-lib

RUN chmod +x /opt/strapi/entrypoint.sh
ENTRYPOINT ["/opt/strapi/entrypoint.sh"]

# ユーザーを node に変更
USER node

# ビルド
# RUN npm run build

# ポートを開放
EXPOSE 1337

# アプリケーションを実行
CMD ["npm", "run", "develop"]
</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">/strapi/entrypoint.sh</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>entrypointでglobal-libをnpmインストールし直すことで、コンテナ再起動時に自動でglobal-libの変更が反映されます。なおこのファイルをホストにマウントしている場合は、実行できないこともあります。その場合は、ホスト側でも実行権限を付与してください。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>2023/10/28追記：これは不要かもしれないです。どうやらローカルファイルをインストールした場合、特にupdate操作は必要ない可能性があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">#!/bin/sh

npm uninstall global-lib
npm install ../global-lib

exec "$@"</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">他</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>省略</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">install</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のように相対パスを指定すればnpmで読み込めます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npm install ../global-lib</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">まとめ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以上でglobal-libをstrapiからimportして型定義を共通化できるようになりました。色々省略していますが、時間の関係上ご容赦ください。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>265</wp:post_id>
		<wp:post_date><![CDATA[2023-10-26 10:33:52]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-26 01:33:52]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:20:51]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:20:51]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node-js%e3%80%91%e3%83%90%e3%83%83%e3%82%af%e3%82%a8%e3%83%b3%e3%83%89%e3%81%a8%e3%83%95%e3%83%ad%e3%83%b3%e3%83%88%e3%82%a8%e3%83%b3%e3%83%89%e3%81%a8%e3%81%a7%e5%85%b1%e9%80%9a%e3%81%ae]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[footnotes]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】useState使用時に画面が一瞬消える問題]]></title>
		<link>https://www.masaakiota.net/2023/10/27/%e3%80%90react%e3%80%91usestate%e4%bd%bf%e7%94%a8%e6%99%82%e3%81%ab%e7%94%bb%e9%9d%a2%e3%81%8c%e4%b8%80%e7%9e%ac%e6%b6%88%e3%81%88%e3%82%8b%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Fri, 27 Oct 2023 07:40:46 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=288</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回は、useStateで値を更新した時に、なぜか画面がチラつく現象が起きましたので、その解決方法を共有させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ちらつくコード</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のコードで、画面がちらついてしまいます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">"use client"

import { useState } from "react";

export default async function Test() {
    const [test, setTest] = useState&lt;string&gt;('test');


    const handleChange = (e: any) =&gt; {
        setTest(e.target.value)
    }

    return (&lt;&gt;
        &lt;div&gt;
            &lt;input type="text" value={test} onChange={handleChange} /&gt;
        &lt;/div&gt;
    &lt;/&gt;);
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決方法</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>非同期にしていたことが問題でした。サーバーだと非同期にしないといけないので、その辺りで混在してしまったものと思われます。ですので、上記からasyncを外せば、正常に動作するようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>layoutの問題なのか、muiにバグがあるのか、middlewareかなどなど問題の切り分けに苦労しました。特にlayoutを入れ子にしているので、きっとどこかのlayoutで問題があるに違いない。テーマプロバイダーか？バックエンドとの通信か？などなど。まさかこんな単純な話だったとは。なかなか気づかないものですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>288</wp:post_id>
		<wp:post_date><![CDATA[2023-10-27 16:40:46]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-27 07:40:46]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-27 16:43:39]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-27 07:43:39]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91usestate%e4%bd%bf%e7%94%a8%e6%99%82%e3%81%ab%e7%94%bb%e9%9d%a2%e3%81%8c%e4%b8%80%e7%9e%ac%e6%b6%88%e3%81%88%e3%82%8b%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Strapi】queryで階層的にwhereを指定する]]></title>
		<link>https://www.masaakiota.net/2023/10/30/%e3%80%90strapi%e3%80%91query%e3%81%a7%e9%9a%8e%e5%b1%a4%e7%9a%84%e3%81%abwhere%e3%82%92%e6%8c%87%e5%ae%9a%e3%81%99%e3%82%8b/</link>
		<pubDate>Sun, 29 Oct 2023 15:05:25 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=294</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Strapiのquery</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Strapiはquery APIが用意されています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const res = await strapi.query("api:book.book").find({
    where: { id: 1}
})</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記では、id=1のbookを取得しています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>さて、このbookは以下のフィールドを持つとします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">id: number
author: relation of author</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>authorは以下とします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">id: number
name: string</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>この場合、authorのnameが"山田"であるレコードを取得するには、どうすればいいでしょうか？</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">階層的な指定</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>strapiでは階層構造を指定してqueryでの抽出が可能です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>具体的には、先述の要望を実現するには、以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const res = await strapi.query("api::book.book").find({
    where: {
        author: {
            name: "山田"
        }
    }
})</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このように、オブジェクトを入れ子にすることで階層構造での指定が可能です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>whereについては以下に記載されています。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://docs.strapi.io/dev-docs/api/query-engine/filtering/","type":"rich","providerNameSlug":"strapi"} -->
<figure class="wp-block-embed is-type-rich is-provider-strapi wp-block-embed-strapi"><div class="wp-block-embed__wrapper">
https://docs.strapi.io/dev-docs/api/query-engine/filtering/
</div></figure>
<!-- /wp:embed -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>294</wp:post_id>
		<wp:post_date><![CDATA[2023-10-30 00:05:25]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-29 15:05:25]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-30 00:06:25]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-29 15:06:25]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90strapi%e3%80%91query%e3%81%a7%e9%9a%8e%e5%b1%a4%e7%9a%84%e3%81%abwhere%e3%82%92%e6%8c%87%e5%ae%9a%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="strapi"><![CDATA[Strapi]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_e0f61bff96605c89482a3bff05ea8ccf]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://docs.strapi.io/dev-docs/api/query-engine/filtering/">Filtering | Strapi Documentation</a></h4><p>Use Strapi's Query Engine API to filter the results of your queries.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_e0f61bff96605c89482a3bff05ea8ccf]]></wp:meta_key>
		<wp:meta_value><![CDATA[1698591984]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Next.js】存在するファイルでModule Not Foundエラー]]></title>
		<link>https://www.masaakiota.net/2023/10/31/%e3%80%90next-js%e3%80%91%e5%ad%98%e5%9c%a8%e3%81%99%e3%82%8b%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%81%a7module-not-found%e3%82%a8%e3%83%a9%e3%83%bc/</link>
		<pubDate>Mon, 30 Oct 2023 23:45:48 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=298</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">存在するのにNot Foundと言われる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>例えば以下のような記載をしたとします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { Orange } from "./Orange.tsx"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>当然のことながら、Orange.tsxファイル内の記述が正しければ、このimport文は通ります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ところが、なぜか通らない時があります。そのような時は以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>一度import文の一部を変更して保存し、また戻して保存します。例えばOrangeのeを消してOrangで保存し、またOrangeに戻して保存するといった形ですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>298</wp:post_id>
		<wp:post_date><![CDATA[2023-10-31 08:45:48]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-30 23:45:48]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-31 08:45:49]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-30 23:45:49]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90next-js%e3%80%91%e5%ad%98%e5%9c%a8%e3%81%99%e3%82%8b%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%81%a7module-not-found%e3%82%a8%e3%83%a9%e3%83%bc]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="next-js"><![CDATA[Next.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Strapi】APIでUnpublishedのデータを取得する]]></title>
		<link>https://www.masaakiota.net/2023/10/31/%e3%80%90strapi%e3%80%91api%e3%81%a7unpublished%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b/</link>
		<pubDate>Tue, 31 Oct 2023 05:51:22 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=300</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">StrapiのAPIでUnpublishedのデータを取得</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Strapiではデフォルトで、APIではPublishedのデータしか返しません。またPublishedといったboolean値があるわけでもありません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ただし、UnpublishedのデータはpublishedAtがnullになります。それを利用します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下のようなクエリを投げます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">{ where: { $not: { publishedAt: null } } }</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでOKです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>300</wp:post_id>
		<wp:post_date><![CDATA[2023-10-31 14:51:22]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-10-31 05:51:22]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-10-31 14:51:23]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-10-31 05:51:23]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90strapi%e3%80%91api%e3%81%a7unpublished%e3%81%ae%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="strapi"><![CDATA[Strapi]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【ブックマークレット】ブックマークレットによるスクレイピングの使用感]]></title>
		<link>https://www.masaakiota.net/2023/11/03/%e3%80%90%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88%e3%80%91%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88%e3%81%ab%e3%82%88/</link>
		<pubDate>Fri, 03 Nov 2023 08:50:46 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=302</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。今回は、ブックマークレットによるスクレイピングの使用感について書かせていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ブックマークレットをインストール</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下の画像のように、インストール画面からブックマークレットをインストールします。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":305,"width":"1110px","height":"auto","aspectRatio":"2.0813008130081303","sizeSlug":"large","linkDestination":"none","style":{"border":{"width":"1px","radius":"5px"}},"className":"is-style-default"} -->
<figure class="wp-block-image size-large is-resized has-custom-border is-style-default"><img src="http://35.221.87.155/wp-content/uploads/2023/11/スクリーンショット-2023-11-03-17.38.28-1-1024x492.png" alt="" class="wp-image-305" style="border-width:1px;border-radius:5px;aspect-ratio:2.0813008130081303;width:1110px;height:auto"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>具体的な操作は以下となります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>ブックマークレットのリンクをドラッグ</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ブックマークバーにドロップ</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>なおブックマークバーに登録する際の表示名は後から自由に変更可能です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ブックマークレットを使用</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>使用するページで、先ほどインストールしたブックマークレットをクリックします。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":304,"sizeSlug":"large","linkDestination":"none","style":{"border":{"width":"1px","radius":"5px"}}} -->
<figure class="wp-block-image size-large has-custom-border"><img src="http://35.221.87.155/wp-content/uploads/2023/11/スクリーンショット-2023-11-03-17.40.54-1024x598.png" alt="" class="wp-image-304" style="border-width:1px;border-radius:5px"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>すると、以下のようにデータの抽出が行われます。この動作は、ブックマークレットによって変わります。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":306,"sizeSlug":"large","linkDestination":"none","style":{"border":{"width":"1px","radius":"5px"}}} -->
<figure class="wp-block-image size-large has-custom-border"><img src="http://35.221.87.155/wp-content/uploads/2023/11/スクリーンショット-2023-11-03-17.40.59-1024x680.png" alt="" class="wp-image-306" style="border-width:1px;border-radius:5px"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>なお今回はサンプルですので、実際にデータを取得しているわけではありません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以上、ブックマークレットによるスクレイピングの使用感についてでした。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>302</wp:post_id>
		<wp:post_date><![CDATA[2023-11-03 17:50:46]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-03 08:50:46]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-03 17:52:20]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-03 08:52:20]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88%e3%80%91%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88%e3%81%ab%e3%82%88]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="bookmarklet"><![CDATA[Bookmarklet]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[footnotes]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【ChatGPT】APIでGPT4-turboが使えるようになったらしい]]></title>
		<link>https://www.masaakiota.net/2023/11/07/%e3%80%90chatgpt%e3%80%91api%e3%81%a7gpt4-turbo%e3%81%8c%e4%bd%bf%e3%81%88%e3%82%8b%e3%82%88%e3%81%86%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%9f%e3%82%89%e3%81%97%e3%81%84/</link>
		<pubDate>Tue, 07 Nov 2023 03:17:36 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=310</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GPT4-turbo プレビュー版が公開された</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>本日2023/11/07の朝、OpenAIからこんなメールが来ました。</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:paragraph -->
<p><strong>New GPT-4 Turbo:</strong></p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>We announced GPT-4 Turbo, our most advanced model. It offers a 128K context window and knowledge of world events up to April 2023.&nbsp;</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>We’ve&nbsp;<a href="http://url3243.email.openai.com/ls/click?upn=8NGuCp9HhBmIwvt7K-2Bq2nG-2B03i7yt9uv618u0mXC775T260mqJ9396ibUIDnu7WRIyl7_A-2FAGuqrHqmYgFisMHi0GuusGIJD5O5ewRnrWzZDSvDaPoFPITxSE5ZSYXa1tMPb0XVGBBsBWnPSW7J4B4Px91-2BxmZEc7Jq1HfKQ75ugbFqTssy-2FQywqL5BRnolO85KsvMmBzzQcEXS8f0On17JrK-2BbhKb95YrDcyfcolrgqtBBvBH4uHs3PETnG1UaylGPRlooiLmH5YCygjXF71D3k15CzaccP1D05w3oMXc-2FFVkkj-2BsU-2FmuQ6XRHE3z5vb1NWgdeDfgofBkEWLh4Q-2Fxr-2BVcpZ7ZCJSC6UPikOpBy8JeB-2FGNEmpwMenP3zg7gbzSHGlEzGRK5BrtWqv6KY63DFV8GNFjbYybzWwgb4cAMHyPpfyONj2MU5wm6-2F3-2FzkUQpjmpXkmyzrxyHVRb3HIAA7-2BrG5EPSk8trdX5g7bOGMZ-2FRpDpAWlG5SXcsO9l6zPYAK5uJtDegwUz6Gfkz2kxY7TdRaPJJ24jWIlg4ho5c-2F-2FhVrFo4gtGiAa6At304q0XvbtPIVaGwJ0s26Z4nC72I5K3g89VMJGJWCbJAHG-2BCBXhxcDQy-2FiSP7oIpxUiWVOaEuavjSO-2BDJwZPgxrOD2M6N6D4uUax-2BHWhzj2qsO8fhhpRJXdqMv7D2WZmluJjmiMMzIO0XcZ0jgDtWMZGzDR3LKJR7chijMFGgXWBiQGJUW7ArjRt0eZaiEweUnztVc2GRvf249Ivv7aevqImBNAoXabbXXhDA0qS485HBlXIb6VxlAwtQRlamKukYFbKc237lWxdGnKHrMUry8ot7Fj-2BrWEdMC6RAXvWid4pdMh-2BGXnn2PgrZ-2F52CuosKI5s8Vh4TxaOd8vVZfEbEQGM1S7ycP3PKUCoqDjldyl5jckPkk3tMQJWwoQ56IRcIXA-2Bu808rvEXBsdC-2FpVH59mxq-2BaHtUxj-2Bs2GKb3MDw4u7rfd2ItbN4l3eGc6ZVeoyUTcEf6twFeF-2BQT6X90FICsXozynixZhEHRT1q5zepsiVhRIffo0Kxu49D3kMcJJf-2FE1LLg-2FBT0n3-2BT3H7GlcqctYNYOKgEw-3D-3D" target="_blank" rel="noreferrer noopener">reduced pricing</a>&nbsp;for GPT-4 Turbo considerably: input tokens are now priced at $0.01/1K and output tokens at $0.03/1K, making it 3x and 2x cheaper respectively compared to the previous GPT-4 pricing.&nbsp;</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>We’ve improved&nbsp;<a href="http://url3243.email.openai.com/ls/click?upn=8NGuCp9HhBmIwvt7K-2Bq2nILX-2B5rHUfYyvCd2ZUkBec819gUbMOcpnK5enS3RP52OZj9RtiNVlbbr9vXeGNdH6Voz7eEGC5gtyVisH7oprEM-3Dyj9K_A-2FAGuqrHqmYgFisMHi0GuusGIJD5O5ewRnrWzZDSvDaPoFPITxSE5ZSYXa1tMPb0XVGBBsBWnPSW7J4B4Px91-2BxmZEc7Jq1HfKQ75ugbFqTssy-2FQywqL5BRnolO85KsvMmBzzQcEXS8f0On17JrK-2BbhKb95YrDcyfcolrgqtBBvBH4uHs3PETnG1UaylGPRlooiLmH5YCygjXF71D3k15CzaccP1D05w3oMXc-2FFVkkj-2BsU-2FmuQ6XRHE3z5vb1NWgdeDfgofBkEWLh4Q-2Fxr-2BVcpZ7ZCJSC6UPikOpBy8JeB-2FGNEmpwMenP3zg7gbzSHGlEzGRK5BrtWqv6KY63DFV8GNFjbYybzWwgb4cAMHyPpfyONj2MU5wm6-2F3-2FzkUQpjmpXkmyzrxyHVRb3HIAA7-2BrG5EPSk8trdX5g7bOGMZ-2FRpDpAWlG5SXcsO9l6zPYAK5uJtDegwUz6Gfkz2kxY7TdRaPJJ24jWIlg4ho5c-2F-2FhVrFo4gtGiAa6At304q0XvbtPIVaGwJ0s26Z4nC72I5K3g89VMJGJWCbJAHG-2BCBXhxcDQy-2FiSP7oIpxUiWVOaEuavjSO-2BDJwZPgxrOD2M6N6D4uUax-2BHWhzj2qsO8fhhpRJXdqMv7D2WZmluJjmiMMzIO0XcZ0jgDtWMZGzDR3LKJR7chijMFGgXWBiQGJUW7ArjRt0eZaiEweUnztVc2GRvf249Ivv7aevqImBNAoXabbXXhDA0qS485HBlXIb6VxlAwtQRlamKukYFbKc237lWxdGnKHrMUry8ot7Fj-2BrWEdMC6RAXvWid4pdMh-2BGXnn2PgrZ-2F52CuosKI5s8Vh4Tx-2FW9lJ9tszZFTwzcIbfSRwK2ps0jyy2xgimAkFGuVNbnXUGNlaVQeOq-2FJePlJvg-2BHuFxwpKigKP5-2BS3a-2FD5qxoR3-2FgydC-2Ff641X1fqHUXIBi0I53GhVvSC41Eei6JgsAeiMNtkYkvMQkcrH2RTI8Ma2Ij7BRbOsu4k0MOvBFUsArj-2FMNI-2FC1s3d0hlQijN6T0-2BrmJRdKdfQbybqy8KBSPUw-3D-3D" target="_blank" rel="noreferrer noopener">function calling</a>, including the ability to call multiple functions in a single message, to always return valid functions with&nbsp;<a href="http://url3243.email.openai.com/ls/click?upn=8NGuCp9HhBmIwvt7K-2Bq2nNTkwh6TyW2mR7jWPA3eyGoZZT0rGx4wEy417B3sBSPfAAKaBeOAtcfbgyEN6gWyQJJnOeJ-2BYB0fWKQiwygmYB0-3D7MdH_A-2FAGuqrHqmYgFisMHi0GuusGIJD5O5ewRnrWzZDSvDaPoFPITxSE5ZSYXa1tMPb0XVGBBsBWnPSW7J4B4Px91-2BxmZEc7Jq1HfKQ75ugbFqTssy-2FQywqL5BRnolO85KsvMmBzzQcEXS8f0On17JrK-2BbhKb95YrDcyfcolrgqtBBvBH4uHs3PETnG1UaylGPRlooiLmH5YCygjXF71D3k15CzaccP1D05w3oMXc-2FFVkkj-2BsU-2FmuQ6XRHE3z5vb1NWgdeDfgofBkEWLh4Q-2Fxr-2BVcpZ7ZCJSC6UPikOpBy8JeB-2FGNEmpwMenP3zg7gbzSHGlEzGRK5BrtWqv6KY63DFV8GNFjbYybzWwgb4cAMHyPpfyONj2MU5wm6-2F3-2FzkUQpjmpXkmyzrxyHVRb3HIAA7-2BrG5EPSk8trdX5g7bOGMZ-2FRpDpAWlG5SXcsO9l6zPYAK5uJtDegwUz6Gfkz2kxY7TdRaPJJ24jWIlg4ho5c-2F-2FhVrFo4gtGiAa6At304q0XvbtPIVaGwJ0s26Z4nC72I5K3g89VMJGJWCbJAHG-2BCBXhxcDQy-2FiSP7oIpxUiWVOaEuavjSO-2BDJwZPgxrOD2M6N6D4uUax-2BHWhzj2qsO8fhhpRJXdqMv7D2WZmluJjmiMMzIO0XcZ0jgDtWMZGzDR3LKJR7chijMFGgXWBiQGJUW7ArjRt0eZaiEweUnztVc2GRvf249Ivv7aevqImBNAoXabbXXhDA0qS485HBlXIb6VxlAwtQRlamKukYFbKc237lWxdGnKHrMUry8ot7Fj-2BrWEdMC6RAXvWid4pdMh-2BGXnn2PgrZ-2F52CuosKI5s8Vh4Txm3XjH3IzizR27YUXPyND5AumDlLd4xZ7OO1pLEw6ts7792MlUiO9BIINGjw-2FECEhhep6sRsDEho-2FtJ6zZS1nly96tl-2BntQJN-2BN0X4MPh-2BZ1dP7MEhW9NcOrJvIxFEKaCj6BKEhJXo-2FAI0aBFmn8fqJ2SGMTBsShVixpcVrXPQwuL6P0jLuFZHHn28ndlQJEYvvMG0uz7-2B1Qzn4LSPtK34A-3D-3D" target="_blank" rel="noreferrer noopener">JSON mode</a>, and improved accuracy on returning the right function parameters.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Model outputs are more deterministic with our new&nbsp;<a href="http://url3243.email.openai.com/ls/click?upn=8NGuCp9HhBmIwvt7K-2Bq2nILX-2B5rHUfYyvCd2ZUkBec819gUbMOcpnK5enS3RP52OjulIed6qAfI1DapnMNfvMStZCH0XfiUUiJasN-2FhbHBCIa2HGuw6bAMsQgEFT5U7Jg4i__A-2FAGuqrHqmYgFisMHi0GuusGIJD5O5ewRnrWzZDSvDaPoFPITxSE5ZSYXa1tMPb0XVGBBsBWnPSW7J4B4Px91-2BxmZEc7Jq1HfKQ75ugbFqTssy-2FQywqL5BRnolO85KsvMmBzzQcEXS8f0On17JrK-2BbhKb95YrDcyfcolrgqtBBvBH4uHs3PETnG1UaylGPRlooiLmH5YCygjXF71D3k15CzaccP1D05w3oMXc-2FFVkkj-2BsU-2FmuQ6XRHE3z5vb1NWgdeDfgofBkEWLh4Q-2Fxr-2BVcpZ7ZCJSC6UPikOpBy8JeB-2FGNEmpwMenP3zg7gbzSHGlEzGRK5BrtWqv6KY63DFV8GNFjbYybzWwgb4cAMHyPpfyONj2MU5wm6-2F3-2FzkUQpjmpXkmyzrxyHVRb3HIAA7-2BrG5EPSk8trdX5g7bOGMZ-2FRpDpAWlG5SXcsO9l6zPYAK5uJtDegwUz6Gfkz2kxY7TdRaPJJ24jWIlg4ho5c-2F-2FhVrFo4gtGiAa6At304q0XvbtPIVaGwJ0s26Z4nC72I5K3g89VMJGJWCbJAHG-2BCBXhxcDQy-2FiSP7oIpxUiWVOaEuavjSO-2BDJwZPgxrOD2M6N6D4uUax-2BHWhzj2qsO8fhhpRJXdqMv7D2WZmluJjmiMMzIO0XcZ0jgDtWMZGzDR3LKJR7chijMFGgXWBiQGJUW7ArjRt0eZaiEweUnztVc2GRvf249Ivv7aevqImBNAoXabbXXhDA0qS485HBlXIb6VxlAwtQRlamKukYFbKc237lWxdGnKHrMUry8ot7Fj-2BrWEdMC6RAXvWid4pdMh-2BGXnn2PgrZ-2F52CuosKI5s8Vh4TxLGDLkr8PvdTOAI0phtxP2aNGZERwymSPyaJg1OkPX5nHEnVRpJd-2F3Y6y1rj-2FX7j3g6YhRfdmg9X4HM9pq9-2FRXlnYJ-2Bcijn94ng6YrEIGMrsBtgX5Qy9LXqRufY2R1Rx2qfR47SD9lkmGKLMqxMMkmrA-2F4CBnq3eVsf9ej6bvns-2B14a2zxxiapez7X0asf1saFIPxJSa-2FKZsY2eG-2BdCF3tQ-3D-3D" target="_blank" rel="noreferrer noopener">reproducible outputs</a>&nbsp;beta feature.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>You can access GPT-4 Turbo by passing&nbsp;gpt-4-1106-preview&nbsp;in the API, with a stable production-ready model release planned later this year.</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>これによると、ついにGPT4-turboのプレビュー版が公開されたとのことです。これまでもGPT4-32kがドキュメントに記載されていたのですが、なぜかAPIでは使えませんでした（理由は未だよく分からない）</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回使えるようになったとされるGPT4-turboは、主に以下のような特徴があります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>とりあえず安い</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>2023年4月までの情報が格納されている</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>そのほかFunction機能、JSONモードに加え、新しいベータ版のReproducible Outputs機能がある</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>分かりやすいのは情報が新しくなっていることと、価格が安くなっていることですね。インプットトークン、アウトプットトークンそれぞれで3倍、2倍ほど安いそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">画像などのマルチメディアに対応</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>さらにマルチメディアに対応したそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:paragraph -->
<p><strong>Multimodal capabilities:</strong></p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>GPT-4 Turbo now supports&nbsp;<a href="http://url3243.email.openai.com/ls/click?upn=8NGuCp9HhBmIwvt7K-2Bq2nILX-2B5rHUfYyvCd2ZUkBec819gUbMOcpnK5enS3RP52OUIwPOSWByw-2F-2FqxKrcZFWKw-3D-3DsUrS_A-2FAGuqrHqmYgFisMHi0GuusGIJD5O5ewRnrWzZDSvDaPoFPITxSE5ZSYXa1tMPb0XVGBBsBWnPSW7J4B4Px91-2BxmZEc7Jq1HfKQ75ugbFqTssy-2FQywqL5BRnolO85KsvMmBzzQcEXS8f0On17JrK-2BbhKb95YrDcyfcolrgqtBBvBH4uHs3PETnG1UaylGPRlooiLmH5YCygjXF71D3k15CzaccP1D05w3oMXc-2FFVkkj-2BsU-2FmuQ6XRHE3z5vb1NWgdeDfgofBkEWLh4Q-2Fxr-2BVcpZ7ZCJSC6UPikOpBy8JeB-2FGNEmpwMenP3zg7gbzSHGlEzGRK5BrtWqv6KY63DFV8GNFjbYybzWwgb4cAMHyPpfyONj2MU5wm6-2F3-2FzkUQpjmpXkmyzrxyHVRb3HIAA7-2BrG5EPSk8trdX5g7bOGMZ-2FRpDpAWlG5SXcsO9l6zPYAK5uJtDegwUz6Gfkz2kxY7TdRaPJJ24jWIlg4ho5c-2F-2FhVrFo4gtGiAa6At304q0XvbtPIVaGwJ0s26Z4nC72I5K3g89VMJGJWCbJAHG-2BCBXhxcDQy-2FiSP7oIpxUiWVOaEuavjSO-2BDJwZPgxrOD2M6N6D4uUax-2BHWhzj2qsO8fhhpRJXdqMv7D2WZmluJjmiMMzIO0XcZ0jgDtWMZGzDR3LKJR7chijMFGgXWBiQGJUW7ArjRt0eZaiEweUnztVc2GRvf249Ivv7aevqImBNAoXabbXXhDA0qS485HBlXIb6VxlAwtQRlamKukYFbKc237lWxdGnKHrMUry8ot7Fj-2BrWEdMC6RAXvWid4pdMh-2BGXnn2PgrZ-2F52CuosKI5s8Vh4Txf9LYDQ914MC8bxbZNiKSTWFCRdhwN0iwvAKivxAU4g7NEWMrAZ5-2FB1aG3XPOEgkgiwW99o-2BRmA7eRwWz4ZXSzQpuBVE44SmBM-2F09JCLj6w2KmZQ1RR6MtvwuYDtFfElIyalzaWufwGXxXMrpkQTr9-2BTBz41ROCQR-2FhvLpLEMOIYS-2FjGrTZqZGE1RItGUOIeZtG6RbTN6zL3atZ6kKCFD-2FA-3D-3D" target="_blank" rel="noreferrer noopener"><strong>visual inputs</strong></a>&nbsp;in the Chat Completions API, enabling use cases like caption generation and visual analysis. You can access the vision features by using the&nbsp;gpt-4-vision-preview&nbsp;model. This vision capability will be integrated into the production-ready version of&nbsp;GPT-4 Turbo when it&nbsp;comes out of preview later this year.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>You can also integrate&nbsp;<a href="http://url3243.email.openai.com/ls/click?upn=8NGuCp9HhBmIwvt7K-2Bq2nA6Q3C26pwz1tGxOBC2fjDYvJ7-2FoLG2OytnagWlTHJlJdCVV_A-2FAGuqrHqmYgFisMHi0GuusGIJD5O5ewRnrWzZDSvDaPoFPITxSE5ZSYXa1tMPb0XVGBBsBWnPSW7J4B4Px91-2BxmZEc7Jq1HfKQ75ugbFqTssy-2FQywqL5BRnolO85KsvMmBzzQcEXS8f0On17JrK-2BbhKb95YrDcyfcolrgqtBBvBH4uHs3PETnG1UaylGPRlooiLmH5YCygjXF71D3k15CzaccP1D05w3oMXc-2FFVkkj-2BsU-2FmuQ6XRHE3z5vb1NWgdeDfgofBkEWLh4Q-2Fxr-2BVcpZ7ZCJSC6UPikOpBy8JeB-2FGNEmpwMenP3zg7gbzSHGlEzGRK5BrtWqv6KY63DFV8GNFjbYybzWwgb4cAMHyPpfyONj2MU5wm6-2F3-2FzkUQpjmpXkmyzrxyHVRb3HIAA7-2BrG5EPSk8trdX5g7bOGMZ-2FRpDpAWlG5SXcsO9l6zPYAK5uJtDegwUz6Gfkz2kxY7TdRaPJJ24jWIlg4ho5c-2F-2FhVrFo4gtGiAa6At304q0XvbtPIVaGwJ0s26Z4nC72I5K3g89VMJGJWCbJAHG-2BCBXhxcDQy-2FiSP7oIpxUiWVOaEuavjSO-2BDJwZPgxrOD2M6N6D4uUax-2BHWhzj2qsO8fhhpRJXdqMv7D2WZmluJjmiMMzIO0XcZ0jgDtWMZGzDR3LKJR7chijMFGgXWBiQGJUW7ArjRt0eZaiEweUnztVc2GRvf249Ivv7aevqImBNAoXabbXXhDA0qS485HBlXIb6VxlAwtQRlamKukYFbKc237lWxdGnKHrMUry8ot7Fj-2BrWEdMC6RAXvWid4pdMh-2BGXnn2PgrZ-2F52CuosKI5s8Vh4TxlDnCLMSRXNvZNQTKeKrgfxiGi9eOGKhsE0U2SXJ8FzeXns1RlWtRkgHGoYH-2Fu6zs7Bx90wjFo-2BrrJzxneMTC4TPmB4v6ki93bT5KoTQlJnQgBbiRx5WeeZhkXYgRgJTZvRi0wSoypNNMtt-2FbAmkARc4Ysotr4qMJW2xWU-2F-2BatLQvbsvRWu8rKrox2SDuNC-2FCfXJtK2f2E-2BtbeveuXnPORA-3D-3D" target="_blank" rel="noreferrer noopener"><strong>DALL·E 3</strong></a>&nbsp;for image generation into your applications via the&nbsp;<a href="http://url3243.email.openai.com/ls/click?upn=8NGuCp9HhBmIwvt7K-2Bq2nILX-2B5rHUfYyvCd2ZUkBec819gUbMOcpnK5enS3RP52OCyfV8VG52b-2BDVwSf-2FvGCD-2F4y6dUitPb4JUpFoHr53n0-3DkOnw_A-2FAGuqrHqmYgFisMHi0GuusGIJD5O5ewRnrWzZDSvDaPoFPITxSE5ZSYXa1tMPb0XVGBBsBWnPSW7J4B4Px91-2BxmZEc7Jq1HfKQ75ugbFqTssy-2FQywqL5BRnolO85KsvMmBzzQcEXS8f0On17JrK-2BbhKb95YrDcyfcolrgqtBBvBH4uHs3PETnG1UaylGPRlooiLmH5YCygjXF71D3k15CzaccP1D05w3oMXc-2FFVkkj-2BsU-2FmuQ6XRHE3z5vb1NWgdeDfgofBkEWLh4Q-2Fxr-2BVcpZ7ZCJSC6UPikOpBy8JeB-2FGNEmpwMenP3zg7gbzSHGlEzGRK5BrtWqv6KY63DFV8GNFjbYybzWwgb4cAMHyPpfyONj2MU5wm6-2F3-2FzkUQpjmpXkmyzrxyHVRb3HIAA7-2BrG5EPSk8trdX5g7bOGMZ-2FRpDpAWlG5SXcsO9l6zPYAK5uJtDegwUz6Gfkz2kxY7TdRaPJJ24jWIlg4ho5c-2F-2FhVrFo4gtGiAa6At304q0XvbtPIVaGwJ0s26Z4nC72I5K3g89VMJGJWCbJAHG-2BCBXhxcDQy-2FiSP7oIpxUiWVOaEuavjSO-2BDJwZPgxrOD2M6N6D4uUax-2BHWhzj2qsO8fhhpRJXdqMv7D2WZmluJjmiMMzIO0XcZ0jgDtWMZGzDR3LKJR7chijMFGgXWBiQGJUW7ArjRt0eZaiEweUnztVc2GRvf249Ivv7aevqImBNAoXabbXXhDA0qS485HBlXIb6VxlAwtQRlamKukYFbKc237lWxdGnKHrMUry8ot7Fj-2BrWEdMC6RAXvWid4pdMh-2BGXnn2PgrZ-2F52CuosKI5s8Vh4TxpgpKU51npCRgAbkhKoF2FVqQcax-2Bia0AzDQJsRnUuN8-2BARw0M1eJbPWopE3Nw7llr6LJeg0wJp2l5SHyO5WFbH5T9w7kLhxXPwBNdRvVFKmH8tUPfwN6icC45G8cTcpQwEvGWN-2FjcgZN-2BRc8iSg4Q1BE72KY7AHF40WdFtAymfxzCX7r3k-2FTrOYphpw-2BYrLtcJdGGBLI9pmb4h0EDoTXtw-3D-3D" target="_blank" rel="noreferrer noopener">Image generation API</a>.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>We released <a rel="noreferrer noopener" href="http://url3243.email.openai.com/ls/click?upn=8NGuCp9HhBmIwvt7K-2Bq2nILX-2B5rHUfYyvCd2ZUkBec-2BUBYsPWlBIv6BazDIaay-2FxEQ5wfR7GZzu7ZaTQM3smzQ-3D-3D3mql_A-2FAGuqrHqmYgFisMHi0GuusGIJD5O5ewRnrWzZDSvDaPoFPITxSE5ZSYXa1tMPb0XVGBBsBWnPSW7J4B4Px91-2BxmZEc7Jq1HfKQ75ugbFqTssy-2FQywqL5BRnolO85KsvMmBzzQcEXS8f0On17JrK-2BbhKb95YrDcyfcolrgqtBBvBH4uHs3PETnG1UaylGPRlooiLmH5YCygjXF71D3k15CzaccP1D05w3oMXc-2FFVkkj-2BsU-2FmuQ6XRHE3z5vb1NWgdeDfgofBkEWLh4Q-2Fxr-2BVcpZ7ZCJSC6UPikOpBy8JeB-2FGNEmpwMenP3zg7gbzSHGlEzGRK5BrtWqv6KY63DFV8GNFjbYybzWwgb4cAMHyPpfyONj2MU5wm6-2F3-2FzkUQpjmpXkmyzrxyHVRb3HIAA7-2BrG5EPSk8trdX5g7bOGMZ-2FRpDpAWlG5SXcsO9l6zPYAK5uJtDegwUz6Gfkz2kxY7TdRaPJJ24jWIlg4ho5c-2F-2FhVrFo4gtGiAa6At304q0XvbtPIVaGwJ0s26Z4nC72I5K3g89VMJGJWCbJAHG-2BCBXhxcDQy-2FiSP7oIpxUiWVOaEuavjSO-2BDJwZPgxrOD2M6N6D4uUax-2BHWhzj2qsO8fhhpRJXdqMv7D2WZmluJjmiMMzIO0XcZ0jgDtWMZGzDR3LKJR7chijMFGgXWBiQGJUW7ArjRt0eZaiEweUnztVc2GRvf249Ivv7aevqImBNAoXabbXXhDA0qS485HBlXIb6VxlAwtQRlamKukYFbKc237lWxdGnKHrMUry8ot7Fj-2BrWEdMC6RAXvWid4pdMh-2BGXnn2PgrZ-2F52CuosKI5s8Vh4TxQnHUWskHM6HJSBAEwxAJMkI6f1KW-2B5IBwK8bAoJhqVh6qCrUVeCmVoV4SvcaMqg83QhC5EsNX7j3dxexNe3zWIc-2B-2B9xpdRk3vUXM5999D6ZUHv0ATl6x9pxRm4OWu56bVHEl-2FxkNPwOXJcbbl3A2ftXT9P1ZpAwMjepJ7DgjOg1mvp4sPtkUBe1ToXGGu0K90LBN3C9vzoqm1XUYJ3yJtA-3D-3D" target="_blank">text-to-speech capabilities</a> through the newly introduced <strong>TTS model</strong>, which will read text for you using one of six natural sounding voices.</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>こちらはOpenAIサイト提供のユーザーインターフェース上で使用できていた、画像などの読み込み機能がAPIで使えるようになったとのことです。APIでできることが大幅に増えることは間違い無いです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">使用方法</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GPT-4-turboのプレビューを使用するには、gpt-4-1106-previewモデルを指定すると良いようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GPTs機能</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>他にも気になる機能があります。GPTsという機能のようです。</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:paragraph -->
<p><strong>Customizable GPTs in ChatGPT:</strong></p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>We launched a&nbsp;<a href="http://url3243.email.openai.com/ls/click?upn=dJNWJCAMQNw6eUwBBLd8MSx1Ta-2FnxrNpGpfEyn1gpSnaa2VEIHuYTkCkLfIE2IhSJyJITiqmA0dUBGVEe-2B6-2F4g-3D-3Dvwl5_A-2FAGuqrHqmYgFisMHi0GuusGIJD5O5ewRnrWzZDSvDaPoFPITxSE5ZSYXa1tMPb0XVGBBsBWnPSW7J4B4Px91-2BxmZEc7Jq1HfKQ75ugbFqTssy-2FQywqL5BRnolO85KsvMmBzzQcEXS8f0On17JrK-2BbhKb95YrDcyfcolrgqtBBvBH4uHs3PETnG1UaylGPRlooiLmH5YCygjXF71D3k15CzaccP1D05w3oMXc-2FFVkkj-2BsU-2FmuQ6XRHE3z5vb1NWgdeDfgofBkEWLh4Q-2Fxr-2BVcpZ7ZCJSC6UPikOpBy8JeB-2FGNEmpwMenP3zg7gbzSHGlEzGRK5BrtWqv6KY63DFV8GNFjbYybzWwgb4cAMHyPpfyONj2MU5wm6-2F3-2FzkUQpjmpXkmyzrxyHVRb3HIAA7-2BrG5EPSk8trdX5g7bOGMZ-2FRpDpAWlG5SXcsO9l6zPYAK5uJtDegwUz6Gfkz2kxY7TdRaPJJ24jWIlg4ho5c-2F-2FhVrFo4gtGiAa6At304q0XvbtPIVaGwJ0s26Z4nC72I5K3g89VMJGJWCbJAHG-2BCBXhxcDQy-2FiSP7oIpxUiWVOaEuavjSO-2BDJwZPgxrOD2M6N6D4uUax-2BHWhzj2qsO8fhhpRJXdqMv7D2WZmluJjmiMMzIO0XcZ0jgDtWMZGzDR3LKJR7chijMFGgXWBiQGJUW7ArjRt0eZaiEweUnztVc2GRvf249Ivv7aevqImBNAoXabbXXhDA0qS485HBlXIb6VxlAwtQRlamKukYFbKc237lWxdGnKHrMUry8ot7Fj-2BrWEdMC6RAXvWid4pdMh-2BGXnn2PgrZ-2F52CuosKI5s8Vh4TxdvClG4GzoIixfUg21BV-2F4g-2BulNJY8kBwQLQzw6wquVr5yoblvsJmAlVJR7CCxppESx5NCvqqf7iL5aGkw41G5DpezwXRhOeYVI62Ankln4bR7UN7opUruWSqxnmSpKS6KBiB4iiBe-2FDrnfqOKk30Wel-2BlBABmU6XyKlK8XbtkhXbWrtv9s9rTTBNS3TH56cBbHKhpCBAKHVc9Kw7OI7Odg-3D-3D" target="_blank" rel="noreferrer noopener">new feature called GPTs</a>. GPTs combine instructions, data, and capabilities into a customized version of ChatGPT.&nbsp;</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>In addition to the capabilities built by OpenAI such as DALL·E or Advanced Data Analysis, GPTs can call developer-defined actions as well. GPTs let developers control a larger portion of experience. We purposefully architected plugins and actions very similarly, and it takes only a few minutes to turn an existing plugin into an action.&nbsp;<a href="http://url3243.email.openai.com/ls/click?upn=8NGuCp9HhBmIwvt7K-2Bq2nILX-2B5rHUfYyvCd2ZUkBec-2FL9X-2B5nnKJ9dmhjgL6qGfZVhkBCjpm88dkmvi9CQKDQw-3D-3DFxXJ_A-2FAGuqrHqmYgFisMHi0GuusGIJD5O5ewRnrWzZDSvDaPoFPITxSE5ZSYXa1tMPb0XVGBBsBWnPSW7J4B4Px91-2BxmZEc7Jq1HfKQ75ugbFqTssy-2FQywqL5BRnolO85KsvMmBzzQcEXS8f0On17JrK-2BbhKb95YrDcyfcolrgqtBBvBH4uHs3PETnG1UaylGPRlooiLmH5YCygjXF71D3k15CzaccP1D05w3oMXc-2FFVkkj-2BsU-2FmuQ6XRHE3z5vb1NWgdeDfgofBkEWLh4Q-2Fxr-2BVcpZ7ZCJSC6UPikOpBy8JeB-2FGNEmpwMenP3zg7gbzSHGlEzGRK5BrtWqv6KY63DFV8GNFjbYybzWwgb4cAMHyPpfyONj2MU5wm6-2F3-2FzkUQpjmpXkmyzrxyHVRb3HIAA7-2BrG5EPSk8trdX5g7bOGMZ-2FRpDpAWlG5SXcsO9l6zPYAK5uJtDegwUz6Gfkz2kxY7TdRaPJJ24jWIlg4ho5c-2F-2FhVrFo4gtGiAa6At304q0XvbtPIVaGwJ0s26Z4nC72I5K3g89VMJGJWCbJAHG-2BCBXhxcDQy-2FiSP7oIpxUiWVOaEuavjSO-2BDJwZPgxrOD2M6N6D4uUax-2BHWhzj2qsO8fhhpRJXdqMv7D2WZmluJjmiMMzIO0XcZ0jgDtWMZGzDR3LKJR7chijMFGgXWBiQGJUW7ArjRt0eZaiEweUnztVc2GRvf249Ivv7aevqImBNAoXabbXXhDA0qS485HBlXIb6VxlAwtQRlamKukYFbKc237lWxdGnKHrMUry8ot7Fj-2BrWEdMC6RAXvWid4pdMh-2BGXnn2PgrZ-2F52CuosKI5s8Vh4TxbUNdxIchoUTRiWtjAJdh3HMqP4L-2FGRuSAmjs2NzVcBNPFrxE9cuOFckPLgIWScuSXc6o-2FvzhupOYyLWIBnfFtGBcUBwkjLoAagO5bnjtw-2FZK6vN1lp4QuI6RNyduSLjxz3HhvrGKiOMBEa2TLwtYK2Htxr0jcXORURhGupr1Bk-2Fo7nO2lRAhpPOZH0A2xNwTOmNomeF3y93pklVeF9DnPA-3D-3D" target="_blank" rel="noreferrer noopener">Read the docs for details</a>.</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>これによると、開発者が指定したアクションを実行するようです。GPTsという名前をつけているあたり、かなり大きな機能のように思えます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">最後に</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、ひとまず走り書きで新しい情報を紹介させていただきました。ではでは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>310</wp:post_id>
		<wp:post_date><![CDATA[2023-11-07 12:17:36]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-07 03:17:36]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-07 12:17:37]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-07 03:17:37]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90chatgpt%e3%80%91api%e3%81%a7gpt4-turbo%e3%81%8c%e4%bd%bf%e3%81%88%e3%82%8b%e3%82%88%e3%81%86%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%9f%e3%82%89%e3%81%97%e3%81%84]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gpt"><![CDATA[GPT]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【PHP】JSONを圧縮して5割以上データ量を削減]]></title>
		<link>https://www.masaakiota.net/2023/11/13/%e3%80%90php%e3%80%91json%e3%82%92%e5%9c%a7%e7%b8%ae%e3%81%97%e3%81%a65%e5%89%b2%e4%bb%a5%e4%b8%8a%e3%83%87%e3%83%bc%e3%82%bf%e9%87%8f%e3%82%92%e5%89%8a%e6%b8%9b/</link>
		<pubDate>Sun, 12 Nov 2023 20:27:35 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=316</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>PHPからJavaScriptにデータを渡す時にJSONを使用することがほとんどかと思いますが、今回は圧縮してデータを渡すお話です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">JSONデータを圧縮して渡す</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>JSONで渡す際は、以下のように行います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">$json = json_encode($data);
$json = gzcompress($json);
$json = base64_encode($json);

echo "&lt;input type='hidden' class='xxx' value='$json' /&gt;";</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">JavaScriptで圧縮データを受け取る</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>受け取る側は以下のような具合です。es module形式です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">import pako from 'https://cdn.jsdelivr.net/npm/pako@2.1.0/+esm'


const encodedData = document.querySelector('.xxx').value;

// Base64デコード
const binaryString = atob(encodedData);

// バイナリ文字列からUint8Arrayを作成
const charList = binaryString.split('').map(c =&gt; c.charCodeAt(0));
const uintArray = new Uint8Array(charList);

// gzip圧縮を解除（pakoライブラリを使用）
const decompressed = pako.inflate(uintArray, { to: 'string' });</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">結果</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>データによりますが、私の扱っていたデータでは以下のようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">compressed bytes: 267377 -&gt; 12808
compressed bytes: 87199 -&gt; 49464
compressed bytes: 83782 -&gt; 33784
compressed bytes: 89291 -&gt; 37632
compressed bytes: 69597 -&gt; 25804
compressed bytes: 74065 -&gt; 27968
compressed bytes: 34475 -&gt; 9792</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>せっかく圧縮しても、Base64エンコードしてしまったら結果大して変わらないかと思っていましたが、おおむね５割以上削減できています。こんなに効果があるのなら、もっと早くやっておけば良かったと思っている今この頃です。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>316</wp:post_id>
		<wp:post_date><![CDATA[2023-11-13 05:27:35]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-12 20:27:35]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-13 18:36:35]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-13 09:36:35]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90php%e3%80%91json%e3%82%92%e5%9c%a7%e7%b8%ae%e3%81%97%e3%81%a65%e5%89%b2%e4%bb%a5%e4%b8%8a%e3%83%87%e3%83%bc%e3%82%bf%e9%87%8f%e3%82%92%e5%89%8a%e6%b8%9b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="php"><![CDATA[PHP]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeScript】自作ライブラリで.tsファイルにジャンプできるようにする]]></title>
		<link>https://www.masaakiota.net/2023/11/13/%e3%80%90typescript%e3%80%91%e8%87%aa%e4%bd%9c%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%81%a7-ts%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%81%ab%e3%82%b8%e3%83%a3%e3%83%b3%e3%83%97%e3%81%a7/</link>
		<pubDate>Mon, 13 Nov 2023 07:14:01 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=321</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">定義へジャンプ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>私はVSCodeを使っているのですが、大抵のIDEでジャンプ機能があるかと思います。定義元のファイルへ一瞬で飛べるのでとても便利な機能です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">TypeScriptの型定義にジャンプしてしまう問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>定義へジャンプする際に、型定義へジャンプしてしまうことがあります。いやいやそうじゃない、その実装へジャンプして閲覧したり編集したりしたいんだと、こういう話になってきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">実装へジャンプするためにtsconfig.jsonをいじる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そこで以下のようにtsconfig.jsonをいじります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">...

"declaration": true,
"declarationMap": true,
"sourceMap": true,
"inlineSources": true,

...</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ちょっとどれが必要でどれが不要かまだ調べきれていないのですが、ひとまず以上のような構成にすることで実装へ自動でジャンプできるようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>321</wp:post_id>
		<wp:post_date><![CDATA[2023-11-13 16:14:01]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-13 07:14:01]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-13 16:14:51]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-13 07:14:51]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typescript%e3%80%91%e8%87%aa%e4%bd%9c%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%81%a7-ts%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%81%ab%e3%82%b8%e3%83%a3%e3%83%b3%e3%83%97%e3%81%a7]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【CSS】スマホ実機でTable横スクロールが効かない時]]></title>
		<link>https://www.masaakiota.net/2023/11/16/%e3%80%90css%e3%80%91%e3%82%b9%e3%83%9e%e3%83%9b%e5%ae%9f%e6%a9%9f%e3%81%a7table%e6%a8%aa%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%e3%81%8c%e5%8a%b9%e3%81%8b%e3%81%aa%e3%81%84%e6%99%82/</link>
		<pubDate>Thu, 16 Nov 2023 04:18:49 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=326</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">実機でスクロールが効かない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Tableの横が長い場合、それをwrapperで囲ってスクロール可能にしていました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="markup" class="language-markup">&lt;div class="table-wrapper"&gt;
  &lt;table ...</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="css" class="language-css">.table-wrapper {
  overflow-x: auto;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでPCではちゃんと横スクロールできていたのですが、スマホ iPhone8 の実機（あるいはXCodeのシミュレータ）ではなぜかスクロールできない。。。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">スクロールを効かせるために</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにすると、スクロールが効きました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="css" class="language-css">.table-wrapper {
  overflow-x: auto;
  white-space: nowrap;
}

</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そろそろiPhone8のバッテリーの減りが最高潮です。最大容量が73%。そろそろ買い替え時でしょうか。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>326</wp:post_id>
		<wp:post_date><![CDATA[2023-11-16 13:18:49]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-16 04:18:49]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-20 09:42:34]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-20 00:42:34]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90css%e3%80%91%e3%82%b9%e3%83%9e%e3%83%9b%e5%ae%9f%e6%a9%9f%e3%81%a7table%e6%a8%aa%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%e3%81%8c%e5%8a%b9%e3%81%8b%e3%81%aa%e3%81%84%e6%99%82]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="html-css"><![CDATA[HTML/CSS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Strapi】Content-Type作成後にTypeScriptのエラーで起動できなくなる問題]]></title>
		<link>https://www.masaakiota.net/2023/11/18/%e3%80%90strapi%e3%80%91content-type%e4%bd%9c%e6%88%90%e5%be%8c%e3%81%abtypescript%e3%81%ae%e3%82%a8%e3%83%a9%e3%83%bc%e3%81%a7%e8%b5%b7%e5%8b%95%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%8f%e3%81%aa%e3%82%8b/</link>
		<pubDate>Sat, 18 Nov 2023 04:23:27 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=333</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Strapiは活発にメンテナンスが行われている、所謂枯れていないシステムです。そのため予期せぬ振る舞いで頭を悩ませ、色々調べるも解決策が見つからないこともしばしば。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回は解決策がなかなか見つけられなかったものの、なんとか解決した事象です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Content-Type Builderで作成すると起動すらできなくなる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>初めに断っておきますが、これはTypeScriptで開発している時の内容です。また現在のバージョンは4.15.4ですが、今後この問題が解決される可能性もあります。公式を見ていると、TypeScript関連の修正が加わったAlpha版がすでに出ています。これがこの問題に関係するのかどうかはっきりしませんが、おそらくこれで解決するのではないかと思います。希望的観測です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Content-Type Builderで新しいContent-Typeを作成すると、Strapiの再起動が始まります。ところがここでTypeScriptのエラーが出て（内容は忘れました）、起動すらできない状態になります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>公式にありました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://docs.strapi.io/dev-docs/typescript","type":"rich","providerNameSlug":"strapi"} -->
<figure class="wp-block-embed is-type-rich is-provider-strapi wp-block-embed-strapi"><div class="wp-block-embed__wrapper">
https://docs.strapi.io/dev-docs/typescript
</div><figcaption class="wp-element-caption">上記によれば、tsconfig.jsonを以下のようにすればbugが回避されるとのことです。</figcaption></figure>
<!-- /wp:embed -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">"exclude": [
    ... //&lt;=他の指定
    "types/generated/**"
]</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>こんな簡単なことだったとは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>333</wp:post_id>
		<wp:post_date><![CDATA[2023-11-18 13:23:27]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-18 04:23:27]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-18 13:26:46]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-18 04:26:46]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90strapi%e3%80%91content-type%e4%bd%9c%e6%88%90%e5%be%8c%e3%81%abtypescript%e3%81%ae%e3%82%a8%e3%83%a9%e3%83%bc%e3%81%a7%e8%b5%b7%e5%8b%95%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%8f%e3%81%aa%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="strapi"><![CDATA[Strapi]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_25e244a2d689043d60a643cf27786b5b]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://docs.strapi.io/dev-docs/typescript">TypeScript | Strapi Documentation</a></h4><p>Learn how you can use Typescript for your Strapi application.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_25e244a2d689043d60a643cf27786b5b]]></wp:meta_key>
		<wp:meta_value><![CDATA[1700281353]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Strapi】generated後のd.tsファイルをライブラリに再利用する]]></title>
		<link>https://www.masaakiota.net/2023/11/19/%e3%80%90strapi%e3%80%91generated%e5%be%8c%e3%81%aed-ts%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%82%92%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%81%ab%e5%86%8d%e5%88%a9%e7%94%a8%e3%81%99%e3%82%8b/</link>
		<pubDate>Sun, 19 Nov 2023 02:38:28 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=337</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Strapiはいつからかは分かりませんが、自動でContent-Typeの型定義を作成するようになっているようです。数ヶ月前には、このような挙動はなかったと思うのですが、最近Strapiを新たに構築し直しても自動でContent-Typeの型定義が作成されるようになっていました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">自動生成されるファイル</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>2023年11月19日現在、自動生成されるファイルは以下のようになっています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">- types
  - generated
    - components.d.ts
    - contentTypes.d.ts  </code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">自動でコピーする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>さてこの型定義をライブラリに含めて再利用したいわけです。例えばpackage.jsonを以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
  "scripts": {
    "develop": "strapi develop &amp;&amp; cp -r ./types/generated ../lib/src/strapi/",
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>こうすることで、strapiの開発実行ごとに毎回、../lib/src/strapiに自動生成されたd.tsファイルがコピーされます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ですがこれだと、lib側のtscでうまくいきません。具体的には、d.tsファイルはtscでコンパイルされないためです。これはtscの仕様で、新しいd.tsファイルはオプション次第で作成するけども、もともとあるd.tsファイルは無視するようになっているためです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">tscで処理できるように、d.tsから.tsにリネームする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そこで、d.tsから.tsにリネームするようにします。以下のスクリプトを用います。ファイル名は copy-generated-to-lib.jsとします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const fs = require('fs');
const path = require('path');

// ディレクトリパスを設定
const srcPath = path.join(__dirname, './types/generated/');
const distPath = path.join(__dirname, '../lib/src/strapi/generated/');

// 指定ディレクトリ内のファイルを走査
fs.readdir(srcPath, (err, files) =&gt; {
    if (err) {
        return console.error('Unable to scan directory: ' + err);
    }

    files.forEach((file) =&gt; {
        if (file.endsWith('.d.ts')) {
            const oldPath = path.join(srcPath, file);
            const newPath = path.join(distPath, file.replace('.d.ts', '.ts'));

            fs.copyFile(oldPath, newPath, (err) =&gt; {
                if (err) throw err;
                console.log(`${oldPath} was renamed to ${newPath}`);
            });
        }
    });
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを、先ほどのpackage.jsonの記述と置き換えます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
  "scripts": {
    "develop": "strapi develop &amp;&amp; node copy-generated-to-lib.js",
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、tsファイルがlibのsrcディレクトリにコピーされるようになりました。そのため、tscで処理されるようになり、libのdistディレクトリに鎮座するでしょう。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近寒いですね。家の中でジャンパーを羽織り、暖房は省エネで乗り切ってます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>337</wp:post_id>
		<wp:post_date><![CDATA[2023-11-19 11:38:28]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-19 02:38:28]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-19 11:40:35]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-19 02:40:35]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90strapi%e3%80%91generated%e5%be%8c%e3%81%aed-ts%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%82%92%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%81%ab%e5%86%8d%e5%88%a9%e7%94%a8%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="strapi"><![CDATA[Strapi]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Strapi】generateされたtsファイルのAttribute.Integerをnumberに変換する]]></title>
		<link>https://www.masaakiota.net/2023/11/19/%e3%80%90strapi%e3%80%91generate%e3%81%95%e3%82%8c%e3%81%9fts%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%80%81attribute-integer%e3%82%92number%e3%81%ab%e5%a4%89%e6%8f%9b%e3%81%99%e3%82%8b/</link>
		<pubDate>Sun, 19 Nov 2023 05:31:22 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=341</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以前に、strapiでgenerateされた型定義を他ライブラリで使い回す方法を書かせていただきました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="http://35.221.87.155/2023/11/19/%e3%80%90strapi%e3%80%91generated%e5%be%8c%e3%81%aed-ts%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%82%92%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%81%ab%e5%86%8d%e5%88%a9%e7%94%a8%e3%81%99%e3%82%8b/" data-type="post" data-id="337">【Strapi】generated後のd.tsファイルをライブラリに再利用する</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回は、それ以降のお話です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Attribute.Integerなどはそのまま使えない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>generateされた型定義には、以下のような型があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Attribute.Integer</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これをそのままnumberとして使えませんので、numberにする必要があります。順を追って書きます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">numberに変換する</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">ひとまず属性を整理する</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まずは普通に継承してみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export type DbBidData = ApiBidBid["attributes"];</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ところがこれだと、例えばid属性が無かったり、またcreatedAt,updatedAtなどが余分に含まれていたりします。これを間引くために以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export type DbBidData = Omit&lt;ApiBidBid["attributes"], 'createdAt'|'updatedAt'|'createdBy'|'updatedBy'&gt; &amp; {
  id? number,
  createdAt?: any,
  updatedAt?: any,
  createdBy?: any,
  updatedBy?: any,
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、idがある可能性を含め、またcreatedAtなどは存在しない場合もあるとすることができました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これでほぼ終わりなのですが、全てのContentTypesに毎回これを書くのは大変ですので、再利用できるようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">
type Transform&lt;T, K extends keyof T = never&gt; = Omit&lt;T, 'createdAt' | 'createdBy' | 'updatedAt' | 'updatedBy' | K&gt; &amp; {
    id?: number,
    createdAt?: any,
    updatedAt?: any,
    createdBy?: any,
    updatedBy?: any,
};

export type DbBidData = Transform&lt;ApiBidBid["attributes"]&gt;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで再利用できるようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Attribute.Integerをnumberに変える</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>続いてAttribute.Integerをnumberに変換します。以下のように変換用のコードを書きます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type ConvertTypes&lt;T&gt; =
    T extends Attribute.Relation ? Attribute.Relation | number :
    T extends Attribute.Integer ? number :
    T extends Attribute.String ? string :
    T extends Attribute.Float ? number :
    T;

type ConvertProperties&lt;T&gt; = {
    [P in keyof T]: ConvertTypes&lt;T[P]&gt;;
};
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを使用して、以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">
type Transform&lt;T, K extends keyof T = never&gt; = Omit&lt;ConvertProperties&lt;T&gt;, 'createdAt' | 'createdBy' | 'updatedAt' | 'updatedBy' | K&gt; &amp; {
    id?: number,
    createdAt?: any,
    updatedAt?: any,
    createdBy?: any,
    updatedBy?: any,
};

export type DbBidData = Transform&lt;ApiBidBid["attributes"]&gt;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、汎用的に使えるtypeになりました。Strapiが自動でここまでやってくれると有難いのですが、このような使い方はマイナーなのでしょうか。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">いっそ全てをオプショナルにする</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>データ一部更新時には、全てのフィールドを埋める必要はありません。そのような用途を考慮すると、以下のようにすべてをオプショナルにしてしまうてもあります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type ConvertProperties&lt;T&gt; = {
    [P in keyof T]?: ConvertTypes&lt;T[P]&gt;;
};</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>作業中はずっと音楽を聴いているのですが、今でだいたい30時間分くらいのプレイリストになっています。もっと増やしたいのですが、いい音楽どこかに転がってないですかね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>341</wp:post_id>
		<wp:post_date><![CDATA[2023-11-19 14:31:22]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-19 05:31:22]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-20 18:10:12]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-20 09:10:12]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90strapi%e3%80%91generate%e3%81%95%e3%82%8c%e3%81%9fts%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%80%81attribute-integer%e3%82%92number%e3%81%ab%e5%a4%89%e6%8f%9b%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="strapi"><![CDATA[Strapi]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【JavaScript】配列のfilterは空オブジェクトを削除しない]]></title>
		<link>https://www.masaakiota.net/2023/11/22/%e3%80%90javascript%e3%80%91%e9%85%8d%e5%88%97%e3%81%aefilter%e3%81%af%e7%a9%ba%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%82%92%e5%89%8a%e9%99%a4%e3%81%97%e3%81%aa%e3%81%84/</link>
		<pubDate>Wed, 22 Nov 2023 07:00:15 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=352</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">JavaScript 空オブジェクトは真になる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>JavaScriptは以下のような空オブジェクトを、真として扱います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const blank = {};
console.log( blank ? "true" : "false" ); // true

// ちなみに他の場合
console.log( 1 ? "true" : "false" ); // true
console.log( 0 ? "true" : "false" ); // false
console.log( "" ? "true" : "false" ); // false</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">filterをかけても、真なので消えない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>前述のこともあり、filterでそのまましても消えません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const arr = [{}, 1, 0];
console.log(arr.filter(a=&gt;a)); // [{}, 1];</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">キー判定を入れる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そこでキー判定を入れてみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const arr = [{}, 1, 0];
console.log(
  arr.filter(a =&gt; Object.keys(a).length &gt; 0)
); // []</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>全部消えてしまいましたが、これはオブジェクト以外のキーが0個のためです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>何はともあれ、用途によってはこうした方法も使えそうですね。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>家の近くで工事をやっているのですが、家が若干揺れてインターネットが繋がらなくなるということがありました。いやいや、どれだけ弱いねんうちのインターネットは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ではでは。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>352</wp:post_id>
		<wp:post_date><![CDATA[2023-11-22 16:00:15]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-22 07:00:15]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-22 16:00:52]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-22 07:00:52]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90javascript%e3%80%91%e9%85%8d%e5%88%97%e3%81%aefilter%e3%81%af%e7%a9%ba%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%82%92%e5%89%8a%e9%99%a4%e3%81%97%e3%81%aa%e3%81%84]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Strapi】REST APIでリレーションがnullのレコードを取得する]]></title>
		<link>https://www.masaakiota.net/2023/11/22/%e3%80%90strapi%e3%80%91rest-api%e3%81%a7%e3%83%aa%e3%83%ac%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%8cnull%e3%81%ae%e3%83%ac%e3%82%b3%e3%83%bc%e3%83%89%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b/</link>
		<pubDate>Wed, 22 Nov 2023 14:18:12 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=356</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">リレーションがnullのレコードをとる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>さっそくですが、リレーションがnullのレコードを取るには、以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">/api/xxx?filters[yyy][id][$null]=true</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>[id]がミソですね。これがないと、$nullを入れても正常に機能しません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>356</wp:post_id>
		<wp:post_date><![CDATA[2023-11-22 23:18:12]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-22 14:18:12]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-22 23:18:13]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-22 14:18:13]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90strapi%e3%80%91rest-api%e3%81%a7%e3%83%aa%e3%83%ac%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%8cnull%e3%81%ae%e3%83%ac%e3%82%b3%e3%83%bc%e3%83%89%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="strapi"><![CDATA[Strapi]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【NestJS】TwilioModuleでNest can't resolve dependencies of the TwilioService]]></title>
		<link>https://www.masaakiota.net/2023/12/09/%e3%80%90nestjs%e3%80%91twiliomodule%e3%81%a7nest-cant-resolve-dependencies-of-the-twilioservice/</link>
		<pubDate>Sat, 09 Dec 2023 13:26:13 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=361</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、新しい物好きフリーランスエンジニアの太田雅昭です。これまで触っていたStrapiに限界を感じて、今度はNestJSに乗り換えています。出来ることが増えたので、乗り換えた甲斐はあるかと。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">TwilioModuleがインポートできない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにインポートしようとしたのですが、なぜかエラーが出てしまいました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// 注：実際のコードと変えてます

@Module({
    imports: [
        ConfigModule.forRoot(),
        TwilioModule.forRootAsync({
            imports: [ConfigModule],
            inject: [ConfigService],
            useFactory: async (configService: ConfigService) =&gt; ({
                accountSid: configService.get&lt;string&gt;('TWILIO_ACCOUNT_SID'),
                authToken: configService.get&lt;string&gt;('TWILIO_AUTH_TOKEN'),
            }),
        }),
    ],
    providers: [TwilioService],
})
export class ConfirmModule { }


// エラー内容
// Nest can't resolve dependencies of the TwilioService (?). Please make sure that the argument "CONFIGURABLE_MODULE_OPTIONS[4e4b46e2900c3c4b42ed0]" at index [0] is available in the ConfirmModule context.</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>TwilioModuleの公式ページ通りなのに、おかしいなと。でTwilioModuleのGithubにいくつか同様のissueが立っていたのですが、どれも解決策までは行っていませんでした。唯一、isGlobalを使うといった話があったので、それを試してみることに。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">isGlobalで解決できた</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>AppModule内でisGlobalで読み込み、上記のConfirmModuleではインポートしないようにすると、エラーがなくなりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// 注: 実際のコードと変えてます

@Module({
    imports: [
        ConfigModule.forRoot({
            isGlobal: true,
        }),
        TwilioModule.forRootAsync({
            imports: [ConfigModule],
            inject: [ConfigService],
            isGlobal: true,
            useFactory: async (configService: ConfigService) =&gt; ({
                accountSid: configService.get&lt;string&gt;('TWILIO_ACCOUNT_SID'),
                authToken: configService.get&lt;string&gt;('TWILIO_AUTH_TOKEN'),
            }),
        }),
    ],
})
export class AppModule { }

</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>いまだによく分かっていませんが、ひとまず解決できたのでよしとしよう。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">2023/12/13追記</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>この後テストコードでやっぱりまたエラーになりましたので、結局自分でモジュールを作りました。Twilioのライブラリからクライアントを渡すだけなので、思ったより簡単にできてしまいました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そして今回のエラーの原因が判明しました。どうやらCONFIGURABLE_MODULE_OPTIONSがexportされていないためのようです。たぶんこれです。さっそくissueに書き込もうと思ったのですが、書くとなるとちゃんと書かないといけないので二の足を踏んでいます。これを見たどなたか、代わりにissueを書いていただけるといいなと思い、この文章を書いてます。はい。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>たまに行くメガネ屋さんが、よくお客さんのことを覚える方で、今日も久しぶりだったにも関わらず覚えてくださっていました。大型のメガネクリーナースプレーを買ってきましたが、大型だけあってなかなかのお値段。大事に使いたいと思います。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>361</wp:post_id>
		<wp:post_date><![CDATA[2023-12-09 22:26:13]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-12-09 13:26:13]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-12-13 00:15:56]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-12-12 15:15:56]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90nestjs%e3%80%91twiliomodule%e3%81%a7nest-cant-resolve-dependencies-of-the-twilioservice]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="nestjs"><![CDATA[NestJS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Prisma】jest-prismaでテスト終了後に自動ロールバック]]></title>
		<link>https://www.masaakiota.net/2023/12/13/%e3%80%90nestjs%e3%80%91jest-prisma%e3%81%a7%e3%83%86%e3%82%b9%e3%83%88%e7%b5%82%e4%ba%86%e5%be%8c%e3%81%ab%e8%87%aa%e5%8b%95%e3%83%ad%e3%83%bc%e3%83%ab%e3%83%90%e3%83%83%e3%82%af/</link>
		<pubDate>Tue, 12 Dec 2023 17:22:15 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=370</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">jest-prisma</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>jest-prismaは、jestテスト実行後に自動でロールバックしてテストデータを削除してくれます。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://github.com/Quramy/jest-prisma","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/Quramy/jest-prisma
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>ただ実際にこれをNestJSで実行する時にはまりましたので、その時のことを書かせていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">providersで置き換える</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まず以下のようにPrisma用のサービスを作りました。ここが問題で、後ほど修正します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">@Injectable()
export class PrismaService extends PrismaClient {
    async onModuleInit() {
        await this.$connect();
    }

    async onModuleDestroy() {
        await this.$disconnect();
    }
}
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>テストコードは以下のような具合です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">describe('ConfirmService', () =&gt; {
    let prismaService: PrismaService;

    beforeEach(async () =&gt; {
        const module: TestingModule = await Test.createTestingModule({
            providers: [
                {
                    provide: PrismaService,
                    useValue: jestPrisma.client,
                },
            ],
        }).compile();

        prismaService = module.get&lt;PrismaService&gt;(PrismaService);
    });

    it('save token', async () =&gt; {
        const data = { xxx:'a' }

        // 消えない
        await prismaService.confirmation.create({ data });

        // 消える
        await jestPrisma.client.confirmation.create({ data });
    });
});
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、providersでうまい具合にPrismaServiceをjestPrisma.clientで上書きできていると思っていました。でもどうも、うまくいきません。具体的には、テストモジュールから取得したprismaServiceではテスト後にデータが消えなかったのです。対して、jestPrisma.clientを直接使用した場合はちゃんと消えました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">サービスを見直す</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そこで、以下のようにサービスを書き換えました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">@Injectable()
export class PrismaService {
    readonly client: PrismaClient;

    constructor() {
        this.client = process.env.NODE_ENV === 'test' ? jestPrisma.client : new PrismaClient();
    }

    async onModuleInit() {
        await this.client.$connect();
    }

    async onModuleDestroy() {
        await this.client.$disconnect();
    }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>改善の余地はありそうな気がしますが、ひとまずこれで問題なく、意図した動作を得ることができました。clientメンバ変数を足して、そこにアクセスする形になっています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>リカーマウンテンに、味のついた海苔が刻まれたふりかけのようなのが売っているのですが、卵ご飯で食べるとうまいです。ちょっと味塩を振った方がご飯が進みますね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>370</wp:post_id>
		<wp:post_date><![CDATA[2023-12-13 02:22:15]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-12-12 17:22:15]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-26 00:23:57]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-25 15:23:57]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90nestjs%e3%80%91jest-prisma%e3%81%a7%e3%83%86%e3%82%b9%e3%83%88%e7%b5%82%e4%ba%86%e5%be%8c%e3%81%ab%e8%87%aa%e5%8b%95%e3%83%ad%e3%83%bc%e3%83%ab%e3%83%90%e3%83%83%e3%82%af]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="prisma"><![CDATA[Prisma]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_98f060e261ead5ebe156c516b1111c20]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/Quramy/jest-prisma">GitHub - Quramy/jest-prisma: Jest environment for integrated testing with Prisma client</a></h4><p>Jest environment for integrated testing with Prisma client - GitHub - Quramy/jest-prisma: Jest environment for integrated testing with Prisma client</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_98f060e261ead5ebe156c516b1111c20]]></wp:meta_key>
		<wp:meta_value><![CDATA[1702401154]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【NestJS】ConfigModuleは.envを上書きできない]]></title>
		<link>https://www.masaakiota.net/2023/12/14/%e3%80%90nestjs%e3%80%91configmodule%e3%81%af-env%e3%82%92%e4%b8%8a%e6%9b%b8%e3%81%8d%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%84/</link>
		<pubDate>Thu, 14 Dec 2023 14:49:22 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=377</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ConfigModule</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>NestJSのConfigModuleは、環境変数の読み込みに使用されます。以下のように使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">@Module({
    imports: [
        ConfigModule.forRoot({
            isGlobal: true,
            envFilePath: [`.env.${process.env.NODE_ENV}`],
        }),
    ],
})
export class AppModule { }</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここでは.env.xxxを読み込んでいます。xxxはproduction,development,testなどの値を想定しています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">.envはConfigModule関係なく読み込まれてる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>本来やりたかったのは、.envよりも優先して各.env.xxxを読み込みたかったのですが、うまくいきませんでした。どうやら、.envは優先して読み込まれ、その値を上書きできないようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>試しに以下のようにテストしてみました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">async function bootstrap() {
    console.log(process.env.DATABASE_URL)
    const app = await NestFactory.create(AppModule);
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>AppModule初期化前に、.envに設定した環境変数が入っているかどうかをテストしています。見事に出力されました。このことから、nest実行時に自動で.envが読み込まれていることがわかります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>つまり、ConfigModuleで.envを上書きできないことになります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">どうするか</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>仕組みさえわかってしまえば、あとはどうとでもできるかと思います。デフォルト値をConfigModuleで設定するか、共通設定を諦めて各.env.xxxで全ての値を洗い出すか、.env.commonを作成して最後に読み込むか。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>さてどうしようか、ひとまず.env.commonを作成しておこうかと思います。他にいい方法があれば教えていただけると嬉しいです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>久しぶりにマイケルジャクソンを聴きました。いいですね、マイコー。昔に聴き倒したので、もう何度も聞くことはないですが、久しぶりに聞くとやっぱり良いです。あの発声、どういう腹筋してるんでしょうね彼は。ものすごい量の筋トレをしていたそうですが、子供の頃からあのような発声なので、天性のものでしょうか。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>377</wp:post_id>
		<wp:post_date><![CDATA[2023-12-14 23:49:22]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-12-14 14:49:22]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-12-14 23:49:24]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-12-14 14:49:24]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90nestjs%e3%80%91configmodule%e3%81%af-env%e3%82%92%e4%b8%8a%e6%9b%b8%e3%81%8d%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%84]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="nestjs"><![CDATA[NestJS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【aspida】Next.jsのmiddlewareで使えない]]></title>
		<link>https://www.masaakiota.net/2023/12/20/%e3%80%90next-js%e3%80%91middleware%e3%81%a7aspida%e3%81%af%e4%bd%bf%e3%81%88%e3%81%aa%e3%81%84/</link>
		<pubDate>Wed, 20 Dec 2023 13:42:11 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=382</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">2023/12/29追記</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>aspida/fetchなら、middlewareでも使えるようです。ですので、以下の記事は一部誤りがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">aspidaについて</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>aspidaは、Swaggerから情報を取得して、自動でAPIクライアントを実装してくれる優れものです。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://github.com/aspida/aspida","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/aspida/aspida
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>今の所一人でやっている私にとって、自動化できるところはどんどんやっていきたいため、こういうのはとてもありがたいです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">middlewareでは使えない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>でも残念ながら、Next.jsのmiddlewareでは使えません。middlewareで認証を行ないたかったのですが、どうもそううまくはいかないようです。原因は、Next.jsのmiddlewareが、特殊な動き、多分ライブラリを十分に読み込まずに動作しているためのようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>aspidaはaxiosとfetchの両方をサポートしているため、一応両方試してみました。ですが、どうもできないようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">middlewareでは純粋にfetchだけで実装する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>middlewareでのみ、純粋にfetchで実装することにしました。うーむ残念無念。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今日は久しぶりにコーヒーが飲みたかったので、サイゼリアへ行きました。ペペロンチーノ、普通に美味しかったです。でも今、Youtubeでサイゼリアのペペロンチーノは残念という声を聞いて、自分の舌に不信感を抱き、なかやまきんに君ばりに舌を叱責している今日この頃です。ちなみにコーヒーはというと、うーむ。ただただ薄い苦いコーヒーという感じで。やっぱりコーヒーはやはりスタバが私的には一番です。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>382</wp:post_id>
		<wp:post_date><![CDATA[2023-12-20 22:42:11]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-12-20 13:42:11]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-21 05:31:10]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-20 20:31:10]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90next-js%e3%80%91middleware%e3%81%a7aspida%e3%81%af%e4%bd%bf%e3%81%88%e3%81%aa%e3%81%84]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="aspida"><![CDATA[aspida]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_c31d81669278fb2768c013548ab14eca]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/aspida/aspida">GitHub - aspida/aspida: TypeScript friendly HTTP client wrapper for the browser and node.js.</a></h4><p>TypeScript friendly HTTP client wrapper for the browser and node.js. - GitHub - aspida/aspida: TypeScript friendly HTTP client wrapper for the browser and node.js.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_c31d81669278fb2768c013548ab14eca]]></wp:meta_key>
		<wp:meta_value><![CDATA[1703079365]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_old_slug]]></wp:meta_key>
		<wp:meta_value><![CDATA[%e3%80%90nest-js%e3%80%91middleware%e3%81%a7aspida%e3%81%af%e4%bd%bf%e3%81%88%e3%81%aa%e3%81%84]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【aspida】aspidaをNext.jsのキャッシュと使う]]></title>
		<link>https://www.masaakiota.net/2023/12/22/%e3%80%90next-js%e3%80%91aspida%e3%82%92next-js%e3%81%ae%e3%82%ad%e3%83%a3%e3%83%83%e3%82%b7%e3%83%a5%e3%81%a8%e4%bd%bf%e3%81%86/</link>
		<pubDate>Fri, 22 Dec 2023 07:03:32 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=384</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Next.jsのキャッシュ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Next.jsでは、デフォルトでキャッシュ機能があります。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://nextjs.org/docs/app/api-reference/functions/fetch","type":"rich","providerNameSlug":"nextjs"} -->
<figure class="wp-block-embed is-type-rich is-provider-nextjs wp-block-embed-nextjs"><div class="wp-block-embed__wrapper">
https://nextjs.org/docs/app/api-reference/functions/fetch
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>JavaScriptにはfetch関数がありますが、通常はクライアントキャッシュです。ですがNext.jsはこのfetch関数を独自拡張して、サーバーキャッシュが使えるようになっています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">aspidaでNext.jsのキャッシュを使う</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>aspidaはaxiosとfetchのどちらでも初期化できます。Next.jsのキャッシュを使いたいため、fetchで以下のように初期化します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import fetchClient from "@aspida/fetch"
import api from "../api-generated/$api"

export const apiCacheClient = api(fetchClient(
    fetch,
    {
        cache: 'force-cache',
        next: {
            revalidate: 10, // 10秒間キャッシュ
        }
        ...
    } as any
));</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、aspidaを普通に使うだけでキャッシュが効くようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近は、中村屋のレトルトカレーにハマってます。少々お高いですが、旨いです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>384</wp:post_id>
		<wp:post_date><![CDATA[2023-12-22 16:03:32]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-12-22 07:03:32]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-21 05:30:46]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-20 20:30:46]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90next-js%e3%80%91aspida%e3%82%92next-js%e3%81%ae%e3%82%ad%e3%83%a3%e3%83%83%e3%82%b7%e3%83%a5%e3%81%a8%e4%bd%bf%e3%81%86]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="aspida"><![CDATA[aspida]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_0205cdd9142ac65c927e89614de2bf82]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://nextjs.org/docs/app/api-reference/functions/fetch">Functions: fetch | Next.js</a></h4><p>API reference for the extended fetch function.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_0205cdd9142ac65c927e89614de2bf82]]></wp:meta_key>
		<wp:meta_value><![CDATA[1703228141]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_old_slug]]></wp:meta_key>
		<wp:meta_value><![CDATA[%e3%80%90nest-js%e3%80%91aspida%e3%82%92next-js%e3%81%ae%e3%82%ad%e3%83%a3%e3%83%83%e3%82%b7%e3%83%a5%e3%81%a8%e4%bd%bf%e3%81%86]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】aspida/fetchでエラーを投げさせ、レスポンスメッセージも取得する]]></title>
		<link>https://www.masaakiota.net/2023/12/27/%e3%80%90node-js%e3%80%91aspida-fetch%e3%81%a7%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e6%8a%95%e3%81%92%e3%81%95%e3%81%9b%e3%80%81%e3%83%ac%e3%82%b9%e3%83%9d%e3%83%b3%e3%82%b9%e3%83%a1%e3%83%83%e3%82%bb/</link>
		<pubDate>Wed, 27 Dec 2023 07:41:32 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=395</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">aspida/fetch</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>aspidaは、TypeScriptで使えるapiクライアントです。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://github.com/aspida/aspida","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/aspida/aspida
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>axiosとfetchのどちらでも使えます。@aspida/fetch, @aspida/axiosのどちらかをインストールするだけです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">aspida/fetchのエラー動作</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>aspida/fetchは、デフォルトではリクエストに失敗してもエラーを投げません。これはfetchがエラーを投げないことに由来しています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこでエラーを投げさせるには、初期化時に以下のようにパラメータを渡します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import fetchClient from "@aspida/fetch"
import api from "./generated/$api"

export const apiClient = api(fetchClient(
    fetch,
    {
        ...
        throwHttpErrors: true,
    }
));</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでエラー時にthrowされるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ところがaspida/axiosならレスポンスメッセージもエラー内容に含まれるのですが、aspida/fetchだとメッセージは含まれません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">aspida/fetchで、エラー時にレスポンスメッセージを取得する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにすれば、エラーメッセージも取得できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">...

        } catch (e: any) {
            console.error(await e.response.json());
        }</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>エラーオブジェクトから直接responseを取得する形ですね。ここからメッセージも取得できます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>明日の最高気温は14度だそうで、少し暖かくなりそうです。よかったー。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>395</wp:post_id>
		<wp:post_date><![CDATA[2023-12-27 16:41:32]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-12-27 07:41:32]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-21 05:29:38]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-20 20:29:38]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node-js%e3%80%91aspida-fetch%e3%81%a7%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e6%8a%95%e3%81%92%e3%81%95%e3%81%9b%e3%80%81%e3%83%ac%e3%82%b9%e3%83%9d%e3%83%b3%e3%82%b9%e3%83%a1%e3%83%83%e3%82%bb]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="aspida"><![CDATA[aspida]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_c31d81669278fb2768c013548ab14eca]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/aspida/aspida">GitHub - aspida/aspida: TypeScript friendly HTTP client wrapper for the browser and node.js.</a></h4><p>TypeScript friendly HTTP client wrapper for the browser and node.js. - GitHub - aspida/aspida: TypeScript friendly HTTP client wrapper for the browser and node.js.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_c31d81669278fb2768c013548ab14eca]]></wp:meta_key>
		<wp:meta_value><![CDATA[1703662556]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Prisma】typegraphql-prismaでGraphQLスキーマを自動生成]]></title>
		<link>https://www.masaakiota.net/2024/01/02/%e3%80%90nest-js%e3%80%91typegraphql-prisma%e3%81%a7graphql%e3%82%b9%e3%82%ad%e3%83%bc%e3%83%9e%e3%82%92%e8%87%aa%e5%8b%95%e7%94%9f%e6%88%90/</link>
		<pubDate>Tue, 02 Jan 2024 14:33:14 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=401</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これまでRestAPIでやっていたのですが、比較的大きめのプロジェクトではやはりエンドポイントをちまちま作るのが面倒になり、GraphQLを使用することにしました。できるだけ楽したい、今後細かな変更も楽して反映させたい、そんな熱意の話です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">typegraphql-prisma</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>typegraphql-prismaは、prismaスキーマからTypeGraphQLのmodelやresolverを自動生成してくれます。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://prisma.typegraphql.com/","type":"rich","providerNameSlug":"typegraphql"} -->
<figure class="wp-block-embed is-type-rich is-provider-typegraphql wp-block-embed-typegraphql"><div class="wp-block-embed__wrapper">
https://prisma.typegraphql.com/
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>これでほぼ自動でGraphQLを出力できるのですが、ただちょっと色々問題もありまして、以下その解決方法です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">バージョン問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>graphqlライブラリは、2024/01/02現在バージョン16まで上がっていますが、ここで破壊的変更が行われたようです。そのためtype-graphqlはベータ版を使う必要があります。現在、type-graphqlのバージョンは2.0.0-beta.3で動作確認できました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ちょっと必要不必要が整理できていないのですが、package.jsonは以下のような感じで作成しています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">  "dependencies":{
    "graphql": "^16.7.1",
    "graphql-fields": "^2.0.3",
    "graphql-scalars": "^1.22.4",
    "type-graphql": "2.0.0-beta.3",
    "typegraphql-nestjs": "^0.6.0"
  },
  "devDependencies": {
    "prisma": "^5.7.1",
    "typegraphql-prisma": "^0.27.1"
  }</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">生成コード問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>typegraphql-prismaで自動生成されるコードは、以下の部分でエラーが出ます。おそらくほかに回避方法があるかと思いますが、今のところ以下のように修正して対応しています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// helpers.ts

// import graphqlFields from "graphql-fields";
import * as graphqlFields from "graphql-fields";</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">リレーションが解決しない</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">2024/01/03追記</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>これに関しては、どうやらresolverを限定していたことが原因でした。resolversを渡すときに、generatedされたindex.tsにあるresolversを使用することで、リレーションが反映されるようになりました。一応、以前の記事文章は以下に残しておきます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>-- 解決以前の文章 --</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これはまだ原因不明なのですが、prismaスキーマで設定したリレーションが、typegraphql-prismaで自動生成されるコードに反映されません。そのため別でcustomディレクトリを作成してコピーし、手動で変更反映することにしました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">結論</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>楽したいがために色々調べるのですが、どうも解決できそうにないので、ひとまず次善策で進めていこうと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>年明けそうそうに大きな地震で、私のところはゆっくりな揺れがしばらく続きました。いつもはガタガタガタ！と一瞬だけ揺れるのですが。たまたまなのか、地盤が変わったのでしょうか。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>401</wp:post_id>
		<wp:post_date><![CDATA[2024-01-02 23:33:14]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-02 14:33:14]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-26 00:23:30]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-25 15:23:30]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90nest-js%e3%80%91typegraphql-prisma%e3%81%a7graphql%e3%82%b9%e3%82%ad%e3%83%bc%e3%83%9e%e3%82%92%e8%87%aa%e5%8b%95%e7%94%9f%e6%88%90]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="prisma"><![CDATA[Prisma]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_f790df8b2d39eed50e939d78d8ffa98d]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://prisma.typegraphql.com/">Home page | TypeGraphQL Prisma</a></h4><p>Prisma generator to emit TypeGraphQL type classes and CRUD resolvers from your Prisma schema</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_f790df8b2d39eed50e939d78d8ffa98d]]></wp:meta_key>
		<wp:meta_value><![CDATA[1704268657]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MUI】Selectで初期値が表示されない問題]]></title>
		<link>https://www.masaakiota.net/2024/01/05/%e3%80%90react%e3%80%91mui-select%e3%81%a7%e5%88%9d%e6%9c%9f%e5%80%a4%e3%81%8c%e8%a1%a8%e7%a4%ba%e3%81%95%e3%82%8c%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Fri, 05 Jan 2024 04:51:34 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=408</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">MUI Selectで初期値が表示されない問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、このような問題に直面しました。MUIのSelectで初期値がなぜか表示されないというものです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">&lt;Select
    value={details?.currency}
    onChange={e => setDetailsWithKeyValue("currency", e.target.value)}
>
    {CURRENCIES.map(c =>
        &lt;MenuItem key={c} value={c}>{c}&lt;/MenuItem>
    )}
&lt;/Select></code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでdetails?.currencyの初期値が選択状態になるはずなのですが、なぜか何も選択されていない状態で表示されます。クリックして別の何かを選択すると正常に表示されるのですが、再読み込みすると再び何も選択されていない状態に。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">undefined時に文字列が入るようにして解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>結論、以下のようにすれば意図通り表示されるようになました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">value={details?.currency || ''}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>先日友人とコーヒーの話になりまして、手入れでドリップコーヒーを入れてくれるという隠れ家的なお店に行ってきました。Googleで確認すると、営業時間は記載なし。年初めの嵐山、大勢の観光客の中を友人の運転で到着すると、見事に休業中。。。嵐山の風景を見ながら帰路に着きました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>408</wp:post_id>
		<wp:post_date><![CDATA[2024-01-05 13:51:34]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-05 04:51:34]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-13 21:26:14]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-13 12:26:14]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91mui-select%e3%81%a7%e5%88%9d%e6%9c%9f%e5%80%a4%e3%81%8c%e8%a1%a8%e7%a4%ba%e3%81%95%e3%82%8c%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mui"><![CDATA[MUI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeScript】error TS5055: Cannot write file 'xxx.d.ts' because it would overwrite input file.]]></title>
		<link>https://www.masaakiota.net/2024/01/10/%e3%80%90typescript%e3%80%91error-ts5055-cannot-write-file-xxx-d-ts-because-it-would-overwrite-input-file/</link>
		<pubDate>Tue, 09 Jan 2024 16:24:19 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=414</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">tscコマンドのエラー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>tscコマンドでいつも通りTypeScriptからJavaScriptに変換しようとしたのですが、エラーで止まりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">error TS5055: Cannot write file 'xxx.d.ts' because it would overwrite input file.</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これは今までも何度か出たエラーで、大体はtsconfigを以下のようにすると直ります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
    "compilerOptions": {
        ...
        "rootDir": "./src",
        "outDir": "./dist",
        ...
    },
    "include": [
        "src"
    ],
    "exclude": [
        "dist",
    ],
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ところが今回、なぜかこれで直らなかったためChatGPTに聞きました。しかし解決せず。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">distファイルをimportしていた。</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回の原因は、distファイルをインポートしていたことが原因でした。具体的には、同じプロジェクトにあるsrcファイルから、distファイルを参照していました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import {xx} from "@yyy/dist/zzz"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>もちろん他プロジェクトからの参照なら問題ないのですが、おそらく同じプロジェクトで参照していたことで、tsc変換時に不都合があったようです。これを以下のようにすることで解決しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import {xx} from "../zzz"</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近一日の終わりにちょっとだけお酒を飲み始めました。ポテチと一緒に飲む酎ハイ、たまらんです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>414</wp:post_id>
		<wp:post_date><![CDATA[2024-01-10 01:24:19]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-09 16:24:19]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-10 01:25:19]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-09 16:25:19]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typescript%e3%80%91error-ts5055-cannot-write-file-xxx-d-ts-because-it-would-overwrite-input-file]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Hasura】GraphQL簡単実装に加えsocketリアルタイム取得も]]></title>
		<link>https://www.masaakiota.net/2024/01/10/%e3%80%90hasura%e3%80%91graphql%e7%b0%a1%e5%8d%98%e5%ae%9f%e8%a3%85%e3%81%ab%e5%8a%a0%e3%81%88socket%e3%83%aa%e3%82%a2%e3%83%ab%e3%82%bf%e3%82%a4%e3%83%a0%e5%8f%96%e5%be%97%e3%82%82/</link>
		<pubDate>Tue, 09 Jan 2024 16:56:42 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=417</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Hasuraが便利すぎる</h2>
<!-- /wp:heading -->

<!-- wp:embed {"url":"https://hasura.io/","type":"rich","providerNameSlug":"hasura"} -->
<figure class="wp-block-embed is-type-rich is-provider-hasura wp-block-embed-hasura"><div class="wp-block-embed__wrapper">
https://hasura.io/
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>Hasuraが便利すぎてよだれが出っ放しです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下のような点が便利です。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>Postgresデータベースがあれば、GraphQLエンドポイントを自動生成してくれる。（一応、他のデータベースも対応）</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>自動でGraphQLのサブスクリプションを生成してくれるので、リアルタイムUIが簡単に作れる（Postgressのみらしい）</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>テーブルやフィールドごとに認証をつけれる。認証情報はJWTで送信。ロールベース。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Dockerで使える</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>特にサブスクリプションを作ってくれるのが、とても便利です。これまでリアルタイム処理にsocketでゴリゴリ書いていたのですが、これならかなり工数を減らせます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>GraphQL初心者の私ですが、Hasuraのおかげでスラスラと実装が進めれてます。以前Strapiを試した時にもだいぶ衝撃だったのですが、それ以上です。時間的コストをかけてでも導入してよかったです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ちなみに現在、以下のようにして使用しています。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>Prismaスキーマで構造を作成し、データベースにmigrate</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Hasuraでデータベースを読み込んでGraphQLエンドポイントを自動生成</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Hasuraで自動生成されたスキーマとgraphql-codegenを使用して、手打ちでGraphQLクライアントを作成。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Apollo clientでGraphQLエンドポイントにアクセス。</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>うーん、美しい。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近PCの性能が足りなくなってきました。APIサーバー、データベースサーバー、Hasura、フロントエンドサーバーを同時に立ち上げて音楽を聴きながらブラウザ複数タブで調べ物しながらコーディングをしているため、しょっちゅう重くなります。それぞれのアプリを再起動させたりして作業していますが、新しいPCが欲しい。。。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>417</wp:post_id>
		<wp:post_date><![CDATA[2024-01-10 01:56:42]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-09 16:56:42]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-10 02:27:47]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-09 17:27:47]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90hasura%e3%80%91graphql%e7%b0%a1%e5%8d%98%e5%ae%9f%e8%a3%85%e3%81%ab%e5%8a%a0%e3%81%88socket%e3%83%aa%e3%82%a2%e3%83%ab%e3%82%bf%e3%82%a4%e3%83%a0%e5%8f%96%e5%be%97%e3%82%82]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="hasura"><![CDATA[Hasura]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_1376be310001328d1bc278a22b308bfc]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://hasura.io/">Instant GraphQL APIs on your data | Built-in Authz & Caching</a></h4><p>Hasura gives you instant GraphQL and REST APIs on new and existing data sources. Connect Hasura to your data & get APIs in under a minute.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_1376be310001328d1bc278a22b308bfc]]></wp:meta_key>
		<wp:meta_value><![CDATA[1704818047]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【dnd kit】MUIとの組み合わせでドラッグできない問題]]></title>
		<link>https://www.masaakiota.net/2024/01/11/%e3%80%90react%e3%80%91dnd-kit%e3%81%a8mui%e3%82%92%e7%b5%84%e3%81%bf%e5%90%88%e3%82%8f%e3%81%9b%e3%81%a7%e3%83%89%e3%83%a9%e3%83%83%e3%82%b0%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Thu, 11 Jan 2024 04:22:03 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=421</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">dnd kit</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>dnd kitはドラッグ&amp;ドロップを簡単に実装できるライブラリです。ソートもできるようですので、導入しました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://dndkit.com/","type":"rich","providerNameSlug":"dndkit"} -->
<figure class="wp-block-embed is-type-rich is-provider-dndkit wp-block-embed-dndkit"><div class="wp-block-embed__wrapper">
https://dndkit.com/
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2 class="wp-block-heading">MUIと組み合わせた不具合</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>当該githubのissuesにも投稿したのですが、修正がいつになるかわからないためここでも共有させていただきます。解決方法もあります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>具体的には、MUIのGrid containerと一緒に使うとドラッグできなくなるという問題です。以下に検証用コードを載せます。なお切り分けていないため、現在進めているプロジェクトに依存する部分もあるかもしれません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">import React from 'react';
import { DndContext, useDraggable } from '@dnd-kit/core';
import { Box, Grid } from '@mui/material';

const DND_ID = "dndTest";

function Draggable(props: { children: React.ReactNode }) {
    const { attributes, listeners, setNodeRef, transform } = useDraggable({
        id: DND_ID,
    });
    const style = transform ? {
        transform: `translate3d(${transform.x}px, ${transform.y}px, 0)`,
    } : undefined;

    return (
        &lt;button ref={setNodeRef} style={style} {...listeners} {...attributes}&gt;
            {props.children}
        &lt;/button&gt;
    );
}

export function DraggableTest() {
    return &lt;&gt;
        &lt;h1&gt;Drag test&lt;/h1&gt;
        &lt;DndContext&gt;
            &lt;Draggable&gt;Can drag&lt;/Draggable&gt;
        &lt;/DndContext&gt;
        &lt;br /&gt;

        &lt;DndContext&gt;
            &lt;Draggable&gt;Can not drag&lt;/Draggable&gt;
        &lt;/DndContext&gt;
        &lt;br /&gt;

        &lt;Grid container spacing={2}&gt;
            &lt;Grid item xs={12}&gt;This grid may the cause&lt;/Grid&gt;
        &lt;/Grid&gt;

        &lt;DndContext&gt;
            &lt;Draggable&gt;Can not drag&lt;/Draggable&gt;
        &lt;/DndContext&gt;
        &lt;Box&gt;
            &lt;Grid container spacing={2}&gt;
                &lt;Grid item xs={12}&gt;Wrapping with Box does not resolve the problem.&lt;/Grid&gt;
            &lt;/Grid&gt;
        &lt;/Box&gt;

        &lt;DndContext&gt;
            &lt;Draggable&gt;Can drag&lt;/Draggable&gt;
        &lt;/DndContext&gt;
        &lt;br /&gt;&lt;br /&gt;
        &lt;Grid container spacing={2}&gt;
            &lt;Grid item xs={12}&gt;This grid is safe under two line breaks.&lt;/Grid&gt;
        &lt;/Grid&gt;


    &lt;/&gt;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記コードを使用すると、ドラッグできるボタンとできないボタンが生成されます。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":428,"sizeSlug":"full","linkDestination":"none"} -->
<figure class="wp-block-image size-full"><img src="http://35.221.87.155/wp-content/uploads/2024/01/スクリーンショット-2024-01-11-13.40.37.png" alt="" class="wp-image-428"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>できないものは、Grid containerの上に載っている部分です。ただし&lt;br/>&lt;br/>にGrid containerを続けた場合はドラッグできます。おそらくGrid containerの描画とdnd kitと相性が悪いようです。ひとまず&lt;br/>&lt;br/>を使用することで対応できそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近またたまごご飯にハマりだしました。丼ご飯にたまご２つ、それにリカーマウンテンで買ってきた美味しい刻み海苔と、塩を少々振るだけで絶品です。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>421</wp:post_id>
		<wp:post_date><![CDATA[2024-01-11 13:22:03]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-11 04:22:03]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-11 21:59:05]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-11 12:59:05]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91dnd-kit%e3%81%a8mui%e3%82%92%e7%b5%84%e3%81%bf%e5%90%88%e3%82%8f%e3%81%9b%e3%81%a7%e3%83%89%e3%83%a9%e3%83%83%e3%82%b0%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="dnd-kit-react"><![CDATA[dnd kit]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_335c5911d0a602f4a9e19feb30eca647]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://dndkit.com/">dnd kit - a modern drag and drop toolkit for React</a></h4><p>A modular, lightweight, performant, accessible and extensible drag & drop toolkit for React.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_335c5911d0a602f4a9e19feb30eca647]]></wp:meta_key>
		<wp:meta_value><![CDATA[1704977902]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Hasura】constraint "xxx" for table "yyy" does not exist]]></title>
		<link>https://www.masaakiota.net/2024/01/11/%e3%80%90hasura%e3%80%91constraint-xxx-for-table-yyy-does-not-exist/</link>
		<pubDate>Thu, 11 Jan 2024 07:14:20 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=430</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">HasuraでUpsertしたい</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回やりたいことは以下のようなupsertです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="graphql" class="language-graphql">mutation upsertLotImagesLink($objects: [LotImage_insert_input!]!) {
    insert_LotImage(
        objects: $objects
        on_conflict: {
            constraint: LotImage_lotId_imageId_key
            update_columns: [order]
        }
    ) {
        affected_rows
    }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>insertに失敗した場合、constraintに指定した条件に合致すれば、updateするという単純な話です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ですが以下のエラーが出ます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">constraint "LotImage_lotId_imageId_key" for table "LotImage" does not exist</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>今回はこの原因と、考察です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">constraintが作成されていない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回Prismaスキーマを使用してPostgresをmigrateしています。スキーマは以下のようなものです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">model LotImage {
    ...
    lotId   Int
    imageId Int
    @@unique([lotId, imageId])
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでPostgresに作成されるのは、以下のインデックスのみです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">LotImage_lotId_imageId_key UNIQUE BTREE on("lotId", "imageId")</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">githubのissue</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>githubに今回の事象についてのissueが建てられていました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://github.com/hasura/graphql-engine/issues/3981","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/hasura/graphql-engine/issues/3981
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>これによると、ユニークインデックスのみではだめで、constraintを作成しないといけないとのことです。それにも関わらずHasura生成のスキーマによるコード補完では問題として扱われないため、実際に動かした時に引っかかるというのが問題のようです。当然、ユニークインデックスをconstraintsとして扱ってくれないのは不便でもありますが。。。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>prisma側でどうにかできないか調べてみました。同様の事象で困っている方がおられるようで、以下で要望が出ています。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://github.com/prisma/prisma/issues/17096","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/prisma/prisma/issues/17096
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>これで将来的には、prisma側で解決できそうです。ただそれまでは、手動で改めてconstraint作成しないといけないようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>2024/01/12追記</strong>: 以下のようにあとから手動でデータベースをいじると、prismaのmigrateが使えなくなります。そのため、prismaが対応するまでは、graphql以外のrestなどで作成した方がいいかもしれません。あるいは、複合主キーを用いれば、prismaでもconstraintが作成されますので、それも選択肢の一つです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Hasuraで、以下のように新しくconstraintを作成すると、うまくいきました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="sql" class="language-sql">ALTER TABLE "LotImage" ADD CONSTRAINT "LotImage_lotId_imageId_constraint" UNIQUE ("lotId", "imageId" );</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>今後こういったSQL文を複数書いて.txtファイルにでも置いておけば、prismaでmigrateしたあとに実行すればいいですね。あるいはそこも自動化するかですが。ひとまず手動でやっていこうと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>趣味で作曲をしているのですが、新曲の歌詞がなかなか出来上がりません。それなのに時々思い出したようにメロディーだけ歌ったりするものなので、メロディーの改善だけはされていくという。。。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>430</wp:post_id>
		<wp:post_date><![CDATA[2024-01-11 16:14:20]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-11 07:14:20]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-13 00:14:10]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-12 15:14:10]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90hasura%e3%80%91constraint-xxx-for-table-yyy-does-not-exist]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="hasura"><![CDATA[Hasura]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_b648be9275e8247ebba0a07d200c268e]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/hasura/graphql-engine/issues/3981">Unique index constraint appears in studio but fails when used in query, both by admin and user · Issue #3981 · hasura/graphql-engine</a></h4><p>Example query: mutation { insert_table( objects: [{ key: "test", product_id: 1, value: "test", }], on_conflict: { constraint: unique_index_name_as_appear_in_mutation_root, update_columns: value } ) { affected_rows } } Error: { "errors": ...</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_b648be9275e8247ebba0a07d200c268e]]></wp:meta_key>
		<wp:meta_value><![CDATA[1705072395]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_a6ec3779c42821749e8a918962ae3ba5]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/prisma/prisma/issues/17096">Prisma creates a UNIQUE INDEX instead of UNIQUE CONSTRAINT when pushed from prisma to postgres db · Issue #17096 · prisma/prisma</a></h4><p>Bug description when running prisma db push, instead of creating a unique constraint, a unique index is created in postgresql as seen in pgadmin4(Databases -> (DB name) -> (Table name) -> SQL tab). How to reproduce Create a model in Pris...</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_a6ec3779c42821749e8a918962ae3ba5]]></wp:meta_key>
		<wp:meta_value><![CDATA[1705072396]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【dnd kit】ドラッグ時に隠れてしまう問題]]></title>
		<link>https://www.masaakiota.net/2024/01/11/%e3%80%90dnd-kit%e3%80%91%e3%83%89%e3%83%a9%e3%83%83%e3%82%b0%e6%99%82%e3%81%ab%e9%9a%a0%e3%82%8c%e3%81%a6%e3%81%97%e3%81%be%e3%81%86%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Thu, 11 Jan 2024 12:54:58 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=438</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">dnd-kit</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>dnd-kitは、Reactでドラッグ&amp;ドロップを簡単に実装できるようになるライブラリです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ドラッグ要素が隠れてしまう問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ドラッグした対象が、コンテナ外まで持っていこうとすると隠れてしまう問題があります。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://github.com/clauderic/dnd-kit/issues/1098","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/clauderic/dnd-kit/issues/1098
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>上記URLによると、overflow:hiddenを指定したコンテナ内で使用すると、はみでた部分が消える現象が出るとのこと。その場合、別途Overlayを書かないといけないようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Overlayを書くのも面倒だったので、コンテナのoverflow:hiddenを無効にすれば、意図した動作になりました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>解決に至るまで、z-indexを最大にしたり色々試していたのですが、こんな簡単に治ってしまうとは。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>このWordpressは2024/01/11現在、GCPの無料範囲内で運用しています。結構頻繁に落ちていて、その度にコンソールから再起動してDockerも再起動ということを行なっているのですが、なかなか大変です。ゆくゆくは有料サーバーを使って、色々試すまでやりたいと思ってます。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>438</wp:post_id>
		<wp:post_date><![CDATA[2024-01-11 21:54:58]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-11 12:54:58]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-11 21:59:29]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-11 12:59:29]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90dnd-kit%e3%80%91%e3%83%89%e3%83%a9%e3%83%83%e3%82%b0%e6%99%82%e3%81%ab%e9%9a%a0%e3%82%8c%e3%81%a6%e3%81%97%e3%81%be%e3%81%86%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="dnd-kit-react"><![CDATA[dnd kit]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_2b9ec5d809cb4a51daa2db563361e947]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/clauderic/dnd-kit/issues/1098">Can't drag outside of the container · Issue #1098 · clauderic/dnd-kit</a></h4><p>Hi, First of all, thank you for the library, it works great! I'm having an issue when I want to drag an item out of a scrollable list (vertical). If I set the list with overflow-x: hidden, I can't ...</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_2b9ec5d809cb4a51daa2db563361e947]]></wp:meta_key>
		<wp:meta_value><![CDATA[1704977436]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MUI】CircularProgressはパーセント指定すると揺れる]]></title>
		<link>https://www.masaakiota.net/2024/01/13/%e3%80%90mui%e3%80%91circularprogress%e3%81%af%e3%83%91%e3%83%bc%e3%82%bb%e3%83%b3%e3%83%88%e6%8c%87%e5%ae%9a%e3%81%99%e3%82%8b%e3%81%a8%e6%8f%ba%e3%82%8c%e3%82%8b/</link>
		<pubDate>Sat, 13 Jan 2024 12:21:30 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=452</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">CircularProgressに%でsize指定してみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>CircularProgressのsizeにはパーセントでも指定できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">&lt;CircularProgress size="20%" /&gt;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>こうすると確かに、パーセント計算されたサイズで表示されます。ただし、なぜか揺れます。すっごく揺れます。おそらくCircularProgress自体が親コンテナのサイズを変えてしまって、計算がループしているのだと思いますが、詳しいことはわかりません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">%がダメなら計算を入れる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ということですので、計算式を入れて動的にサイズ変更できるようにします。サイズ決定は読み込み時のみとなるため、ループは起こりません。今回は親コンテナの中央に、適切なサイズで表示するということをしたかったため、以下のようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">export function FullsizeLoading() {
    const RATE=0.15;
    const containerRef = useRef&lt;HTMLDivElement&gt;(null);
    const [size, setSize] = useState&lt;number&gt;();

    useEffect(() =&gt; {
        if (!containerRef.current) return;
        const rect = containerRef.current.getBoundingClientRect();
        const minDimension = Math.min(rect.width, rect.height);
        setSize(minDimension *RATE);
    }, [])

    return &lt;div ref={containerRef} style={{
        width: "100%", height: "100%", display: "flex",
        justifyContent: "center",
        alignItems: "center"
    }}&gt;
        {size &amp;&amp; &lt;CircularProgress color="primary" size={size} /&gt;}
    &lt;/div&gt;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>useRefで親コンテナのサイズを取得し、幅か高さのどちらか小さい方にRATEを乗算して、サイズとしています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今日は酒をやめて、温かいBossのミルクティーにしました。それほど値段はしないだろうと思っていたのですが、思ったより高額でヘコんでます。なんなら酒の方が安いという。。。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>452</wp:post_id>
		<wp:post_date><![CDATA[2024-01-13 21:21:30]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-13 12:21:30]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-13 21:24:04]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-13 12:24:04]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90mui%e3%80%91circularprogress%e3%81%af%e3%83%91%e3%83%bc%e3%82%bb%e3%83%b3%e3%83%88%e6%8c%87%e5%ae%9a%e3%81%99%e3%82%8b%e3%81%a8%e6%8f%ba%e3%82%8c%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mui"><![CDATA[MUI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Hasura】__typename not foundを解決]]></title>
		<link>https://www.masaakiota.net/2024/01/13/%e3%80%90hasura%e3%80%91__typename-not-found%e3%82%92%e8%a7%a3%e6%b1%ba/</link>
		<pubDate>Sat, 13 Jan 2024 14:28:38 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=458</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">__typename not found</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>__typename not foundは、HasuraというよりApollo Clientの話なのですが、個人的に今Hasuraが熱いので、Hasuraをタイトルに入れさせていただきました。おそらくこうした方が、Hasura信者のみなさまに見つけてもらいやすくなると思ってのことです。はい。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Apollo Clientでは、キャッシュ機能の中で__typenameを使用しています。具体的には、idと__typenameでキーを作成して、キャッシュを制御しています。そのため__typenameは必要なのですが、オプションで無効にすることもできます。ただし、無効にするのは推奨されていません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>この__typenameが含まれるデータを取得し、それを加工してGraphQLサーバーに投げたりすると、__typenameというフィールドが存在しないと言われ弾かれます。こうした問題を、たとえば以下の方法で解決できます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">取得側で調整する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Apollo Clientの設定で無効にすることがはばかれる場合、他の手段で対応することになります。以下は単純に、__typenameフィールドを再帰的に消してしまうという力技です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export function removeTypenames(data: any): any {
    if (Array.isArray(data)) {
        return data.map((d) =&gt; removeTypenames(d));
    }

    if (!(data instanceof Object)) {
        return data;
    }

    return Object.entries(data).reduce((acc, [key, value]) =&gt; {
        if (key === '__typename') {
            return acc;
        }
        acc[key] = removeTypenames(value);
        return acc;
    }, {} as any);
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>データ取得時にこれをかますことで、問題は解決するはずです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>こうした面倒なロジックは、一昔前なら頭をフル回転させて大変な思いをするものですが、今はChatGPTがあるので比較的楽に作れます。さすがにChatGPTだけではちゃんとしたコードは生成できませんが。少なくとも一人で考え込まず、対話形式で考えを整理できるので、気分的にだいぶ楽ですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>458</wp:post_id>
		<wp:post_date><![CDATA[2024-01-13 23:28:38]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-13 14:28:38]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-13 23:30:36]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-13 14:30:36]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90hasura%e3%80%91__typename-not-found%e3%82%92%e8%a7%a3%e6%b1%ba]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="hasura"><![CDATA[Hasura]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Next.js】NextRouter was not mounted.]]></title>
		<link>https://www.masaakiota.net/2024/01/25/%e3%80%90next-js%e3%80%91nextrouter-was-not-mounted/</link>
		<pubDate>Wed, 24 Jan 2024 15:13:13 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=464</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>時々やってしまうこの問題。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">useRouterはnext/navigationからimportする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今私が使ってるNextはv14なのですが、その場合useRouterはnext/navigationからimportしないと、エラーになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// import { useRouter } from "next/router";
import { useRouter } from "next/navigation";</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>VSCodeなどのIDEで脳死でimportしていると、このようなことが起きます。あれ？と思ってサーバーを再起動したり色々してから気づくこの問題。忘れないように共有させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ポテチは何味が好きですか？やはりコンソメかのり塩です私ははい。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>464</wp:post_id>
		<wp:post_date><![CDATA[2024-01-25 00:13:13]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-24 15:13:13]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-25 00:13:53]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-24 15:13:53]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90next-js%e3%80%91nextrouter-was-not-mounted]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="next-js"><![CDATA[Next.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】PhoneやEmailのばらつきを正規化]]></title>
		<link>https://www.masaakiota.net/2024/01/25/%e3%80%90node-js%e3%80%91phone%e3%82%84email%e3%81%ae%e3%81%b0%e3%82%89%e3%81%a4%e3%81%8d%e3%82%92%e6%ad%a3%e8%a6%8f%e5%8c%96/</link>
		<pubDate>Thu, 25 Jan 2024 05:38:58 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=467</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">正規化の必要性</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>例えば電話番号だと、国際的な場合以下のパターンは同じところに届きます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">+81 90 xxxx xxxx
+81 090 xxxx xxxx</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>メールアドレスなら以下のようなものです。Gmailは特に自由度が高いです。なお実在するアドレスを載せるわけにはいきませんのでドメインは変えていますが、以下はGmailの場合の話です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">xxx@example.com
xx.x@example.com</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>こうしたことから、電話番号やEmailが一意である必要がある場合、正規化が必要になります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ライブラリ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>探してみたところ、以下の二つが良さそうなので使ってみることにしました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">電話番号</h3>
<!-- /wp:heading -->

<!-- wp:embed {"url":"https://github.com/grantila/awesome-phonenumber","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/grantila/awesome-phonenumber
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Email</h3>
<!-- /wp:heading -->

<!-- wp:embed {"url":"https://github.com/johno/normalize-email","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/johno/normalize-email
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>しばらく使ってみます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>早く暖かくならないかなー。と思う今日この頃です。春が待ち遠しいです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>467</wp:post_id>
		<wp:post_date><![CDATA[2024-01-25 14:38:58]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-25 05:38:58]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:20:51]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:20:51]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node-js%e3%80%91phone%e3%82%84email%e3%81%ae%e3%81%b0%e3%82%89%e3%81%a4%e3%81%8d%e3%82%92%e6%ad%a3%e8%a6%8f%e5%8c%96]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_8579997faf50c2300a01eba918649264]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/johno/normalize-email">GitHub - johno/normalize-email: Normalize + and . emails -- ex.ample+foobar@gmail.com => example@gmail.com</a></h4><p>Normalize + and . emails -- ex.ample+foobar@gmail.com => example@gmail.com - GitHub - johno/normalize-email: Normalize + and . emails -- ex.ample+foobar@gmail.com => example@gmail.com</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_8579997faf50c2300a01eba918649264]]></wp:meta_key>
		<wp:meta_value><![CDATA[1706163385]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_561c829b02d285834d01c3ac7d96476c]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/grantila/awesome-phonenumber">GitHub - grantila/awesome-phonenumber: Google's libphonenumber pre-compiled with the closure compiler</a></h4><p>Google's libphonenumber pre-compiled with the closure compiler - GitHub - grantila/awesome-phonenumber: Google's libphonenumber pre-compiled with the closure compiler</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_561c829b02d285834d01c3ac7d96476c]]></wp:meta_key>
		<wp:meta_value><![CDATA[1706163385]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Prisma】PostgresでTimezoneを付与して安心する]]></title>
		<link>https://www.masaakiota.net/2024/01/26/%e3%80%90prisma%e3%80%91postgres%e3%81%a7timezone%e3%82%92%e4%bb%98%e4%b8%8e%e3%81%97%e3%81%a6%e5%ae%89%e5%bf%83%e3%81%99%e3%82%8b/</link>
		<pubDate>Thu, 25 Jan 2024 15:16:36 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=471</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">PrismaのDateTimeのデフォルト挙動</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>PrismaはDateTime型を使用できます。以下のような具合です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">expiresAt DateTime  
createdAt DateTime  @default(now())
updatedAt DateTime? @updatedAt</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これをPostgreSQLにmigrateすると、以下のフィールドになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">timestamp without timezone</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>この状態でPrismaクライアントを使用してデータを挿入すると、タイムゾーンなしのUTCに変換されて保存されます。そのためwhereなどで検索する場合、Timezoneを考慮する必要があります。これはとても面倒で、バグの温床にもなりますし、余計なことに頭を使って疲れてしまいます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Timezoneを付与する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そのためTimezoneを付与できれば、夜も安心して眠れるという話です。以下のようにすればTimezoneが付与されます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">expiresAt DateTime  @db.Timestamptz(3)
createdAt DateTime  @default(now()) @db.Timestamptz(3)
updatedAt DateTime? @updatedAt @db.Timestamptz(3)</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここで(3)となっているのは精度です。指定しない場合は、デフォルトの精度が使用されるようです。このTimestamptzを指定することで、PostgreSQLでは以下のフィールドになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Postgresはμsまで対応していますが、JavaScriptのDateはmsまでとなっています。そのため、DB側もmsで統一しておいた方が予期しない問題の回避につながるかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">timestamp with timezone</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで大丈夫です。なおこれをmigrateすると、dbデータ時刻があらぬ値になり、整合性が失われるため注意が必要です。正確に検証はしていないのですが、どうやらローカル時間に変更した上で、さらにそれをUTCとして扱うような形になっているようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>夜遅くなると薬局が閉まってるので、酒はコンビニで買うしか無いのはお財布が痛いですね。ただコンビニも薬局には無い製品があったりするので、たまにはいいのですが。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>471</wp:post_id>
		<wp:post_date><![CDATA[2024-01-26 00:16:36]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-25 15:16:36]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-12 04:17:16]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-11 19:17:16]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90prisma%e3%80%91postgres%e3%81%a7timezone%e3%82%92%e4%bb%98%e4%b8%8e%e3%81%97%e3%81%a6%e5%ae%89%e5%bf%83%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="prisma"><![CDATA[Prisma]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Apollo】トークンリフレッシュを実装する]]></title>
		<link>https://www.masaakiota.net/2024/01/26/%e3%80%90apollo%e3%80%91%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%83%aa%e3%83%95%e3%83%ac%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b/</link>
		<pubDate>Fri, 26 Jan 2024 08:45:10 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=477</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>2024/01/29追記：もっと簡単に実装できる方法を以下で紹介しています。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"http://35.221.87.155/2024/01/29/%e3%80%90apollo%e3%80%91%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%83%aa%e3%83%95%e3%83%ac%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92%e7%b0%a1%e5%8d%98%e3%81%ab%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b/","type":"wp-embed","providerNameSlug":""} -->
<figure class="wp-block-embed is-type-wp-embed"><div class="wp-block-embed__wrapper">
http://35.221.87.155/2024/01/29/%e3%80%90apollo%e3%80%91%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%83%aa%e3%83%95%e3%83%ac%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92%e7%b0%a1%e5%8d%98%e3%81%ab%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b/
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Hasuraを使っている関係でApollo Clientを使用しているのですが、日本語解説があまり見つけられないこともありなかなか苦戦しました。ChatGPTがあってよかったです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Apollo ClientのLink</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Apollo ClientにはLinkというものがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">new ApolloClient({
    ...
    from([errorLink, authLink, httpLink]),
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このリンクに色々渡すことで、エラーやコンテキストなどのハンドリングを行えます。今回はerrorLink, authLink, httpLinkを作成して入れています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>実際に確認したわけでは無いのですが、ChatGPT先生によると以下のようです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">ChatGPT先生 「リンクは左から順に実行され、リクエストが実行された後また左へ帰っていく」</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>だそうです。これを知っているのと知っていないのとで、だいぶ理解度が変わってきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">errorLink</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>エラーハンドリングはonErrorを用います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const errorLink = onError(({ graphQLErrors, operation, forward }) =&gt; {
    if (graphQLErrors?.some((err) =&gt; err.extensions.code === 'invalid-jwt')) {
        accessTokenCache = '';
        return forward(operation);
    }
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>エラーにはgraphQlErrorsとnetworkErrorの２つがあるのですが、jwt認証エラーはgraphQlErrorsに入っています。Hasuraの場合、networkerrorでは補足できません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">forward</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>forwardにoperationを渡すことで、リトライできるようになります。ただ注意すべき点として、forwardでリトライする場合、linkは右へ戻ります。例えば</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">from([authLink, errorLink, httpLink])</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>となっていた場合、authLink  =&gt; errorLink =&gt; httpLink =&gt; errorLink =&gt; httpLinkという順になります。そのためauthLinkを実行するために、以下のようにする必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">from([errorLink, authLink, httpLink])</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">非同期処理は使えない</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>onErrorでは非同期処理は使えません。Promiseを返すと文法エラーとなります。ですので、非同期処理でトークンを更新する場合、他のリンクを使うことになります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">authLink</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>先ほどのエラーLinkで、認証に失敗した場合に tokenキャッシュをクリアしていました。これはonErrorの中で非同期処理を使えないためです。非同期処理を使用するために、setContextを使います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const authLink = setContext(async (_, { headers }) =&gt; {
    const retryCount = headers?.retryCount || 0;
    if(retryCount &gt; 3) {
        throw new Error('retryCount over 3');
    }
    const token = await accessToken();
    return {
        headers: {
            ...headers,
            authorization: 'Bearer ' + token,
            retryCount: retryCount + 1,
        },
    };
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>キャッシュがなければ更新するといった具合に、以下のように実装します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">async function accessToken() {
    if (accessTokenCache) {
        return accessTokenCache;
    }
    ...
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">httpLink</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最後にhttpLinkです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const httpLink = new HttpLink({
    uri,
    headers: {
        Authorization: 'Bearer ' + await accessToken(),
    },
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このような感じで、トークンのリフレッシュが実装できました。ふぅ。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>松屋が生パスタのお店を出すそうですね。ただお値段は結構するそうです。一度食べてみたい気はするのですが、私の近所には来ないだろうか。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>477</wp:post_id>
		<wp:post_date><![CDATA[2024-01-26 17:45:10]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-26 08:45:10]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-29 16:55:34]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-29 07:55:34]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90apollo%e3%80%91%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%83%aa%e3%83%95%e3%83%ac%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="apollo"><![CDATA[Apollo]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_cabe1e97f7b2fc0dfe27d6c4d37aa0cd]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="wp-embedded-content" data-secret="6cr3Cvu14t"><a href="http://35.221.87.155/2024/01/29/%e3%80%90apollo%e3%80%91%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%83%aa%e3%83%95%e3%83%ac%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92%e7%b0%a1%e5%8d%98%e3%81%ab%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b/">【Apollo】トークンリフレッシュを簡単に実装する</a></blockquote><iframe title="&#8220;【Apollo】トークンリフレッシュを簡単に実装する&#8221; &#8212; 太田雅昭" sandbox="allow-scripts" security="restricted" src="http://35.221.87.155/2024/01/29/%e3%80%90apollo%e3%80%91%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%83%aa%e3%83%95%e3%83%ac%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92%e7%b0%a1%e5%8d%98%e3%81%ab%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b/embed/#?secret=6cr3Cvu14t" width="600" height="338" data-secret="6cr3Cvu14t" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" class="wp-embedded-content"></iframe><script>/*! This file is auto-generated */!function(d,l){"use strict";l.querySelector&&d.addEventListener&&"undefined"!=typeof URL&&(d.wp=d.wp||{},d.wp.receiveEmbedMessage||(d.wp.receiveEmbedMessage=function(e){var t=e.data;if((t||t.secret||t.message||t.value)&&!/[^a-zA-Z0-9]/.test(t.secret)){for(var s,r,n,a=l.querySelectorAll('iframe[data-secret="'+t.secret+'"]'),o=l.querySelectorAll('blockquote[data-secret="'+t.secret+'"]'),c=new RegExp("^https?:$","i"),i=0;i<o.length;i++)o[i].style.display="none";for(i=0;i<a.length;i++)s=a[i],e.source===s.contentWindow&&(s.removeAttribute("style"),"height"===t.message?(1e3<(r=parseInt(t.value,10))?r=1e3:~~r<200&&(r=200),s.height=r):"link"===t.message&&(r=new URL(s.getAttribute("src")),n=new URL(t.value),c.test(n.protocol))&&n.host===r.host&&l.activeElement===s&&(d.top.location.href=t.value))}},d.addEventListener("message",d.wp.receiveEmbedMessage,!1),l.addEventListener("DOMContentLoaded",function(){for(var e,t,s=l.querySelectorAll("iframe.wp-embedded-content"),r=0;r<s.length;r++)(t=(e=s[r]).getAttribute("data-secret"))||(t=Math.random().toString(36).substring(2,12),e.src+="#?secret="+t,e.setAttribute("data-secret",t)),e.contentWindow.postMessage({message:"ready",secret:t},"*")},!1)))}(window,document);</script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_cabe1e97f7b2fc0dfe27d6c4d37aa0cd]]></wp:meta_key>
		<wp:meta_value><![CDATA[1706514934]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_1b06e6e8691477d16f9d2d3fba4594a1]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】期限をクライアントでチェックしてJWTトークンリフレッシュ]]></title>
		<link>https://www.masaakiota.net/2024/01/29/%e3%80%90node-js%e3%80%91%e6%9c%9f%e9%99%90%e3%82%92%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88%e3%81%a7%e3%83%81%e3%82%a7%e3%83%83%e3%82%af%e3%81%97%e3%81%a6jwt%e3%83%88%e3%83%bc%e3%82%af/</link>
		<pubDate>Mon, 29 Jan 2024 02:37:15 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=502</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">トークンリフレッシュ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>アクセストークンとリフレッシュトークンを使用して、認証を実装するのは今の一般的な手法です。このメリットは以下のようなものです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>メリット</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>リフレッシュトークンをアクセストークンよりセキュアに管理することで、セキュリティがアップする。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>リフレッシュトークンIDはサーバーで管理することで、不正使用に対する防御ができる。</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">一般的な更新方法</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>よくインターネットで検索して出てくる更新方法は、以下のものが多いです。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>通常通りAPIにアクセス</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>アクセストークン切れ (401エラー) が発生したら、トークンをリフレッシュし、再トライ</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>ただこれだと、色々困ることも出てきます。たとえば、</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>使用しているライブラリによっては、実装が複雑になったり、あるいは不可能だったりする。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>一度401エラーを発生させるアクセスの分、若干パフォーマンスが落ちる。</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">クライアントで期限をチェックし、リフレッシュする方法</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そういうわけで、場合によってはクライアント側で期限をチェックする方法が有効です。具体的には以下のように、JWTをデコードして期限をチェックし、期限切れ、あるいは切れそうならリフレッシュトークンを更新するというものです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">
export async function checkAndRefreshToken() {
    const ADDITIONAL_MSEC = 60 * 1000;
    const exp = getAccessTokenExp();

    if (!exp || Date.now() &lt; exp - ADDITIONAL_MSEC) {
        return;
    }

    await doRefreshToken();
}

function getAccessTokenExp() {
    const token = getAccessToken();
    const exp = decodeToken(token)?.exp * 1000; // トークンの有効期限を取得
    return exp;
}

function decodeToken(token: string | undefined): Record&lt;string, any> | null {
    if (!token) return null;
    const base64Url = token.split('.')[1]; // JWTのペイロード部分を取得
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(
        atob(base64)
            .split('')
            .map((c) => {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            })
            .join('')
    );

    const result = JSON.parse(jsonPayload);
    return result;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、簡単にトークンリフレッシュが実装できました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>昔流行っていた頃はあまり興味がなかったのですが、今シェリル・クロウをよく聞いてます。メロディーも歌声もいいですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>502</wp:post_id>
		<wp:post_date><![CDATA[2024-01-29 11:37:15]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-29 02:37:15]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:20:51]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:20:51]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node-js%e3%80%91%e6%9c%9f%e9%99%90%e3%82%92%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88%e3%81%a7%e3%83%81%e3%82%a7%e3%83%83%e3%82%af%e3%81%97%e3%81%a6jwt%e3%83%88%e3%83%bc%e3%82%af]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Apollo】トークンリフレッシュをもっと簡単に実装する]]></title>
		<link>https://www.masaakiota.net/2024/01/29/%e3%80%90apollo%e3%80%91%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%83%aa%e3%83%95%e3%83%ac%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92%e7%b0%a1%e5%8d%98%e3%81%ab%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b/</link>
		<pubDate>Mon, 29 Jan 2024 07:52:07 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=506</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以前、Apolloクライアントでトークンリフレッシュを実装する話を書かせていただきました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"http://35.221.87.155/2024/01/26/%e3%80%90apollo%e3%80%91%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%83%aa%e3%83%95%e3%83%ac%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b/","type":"wp-embed","providerNameSlug":""} -->
<figure class="wp-block-embed is-type-wp-embed"><div class="wp-block-embed__wrapper">
http://35.221.87.155/2024/01/26/%e3%80%90apollo%e3%80%91%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%83%aa%e3%83%95%e3%83%ac%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b/
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>上記はエラー処理で実装していましたが、もっと簡単にできる方法が見つかりましたので、共有させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">簡単に実装するためにJWTをクライアントでデコードする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>JWTをクライアントでデコードすれば、実装はかなり簡単になります。なおデコードするだけなので、SECRET値は必要ありません。そのためセキュリティも安全です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下はJWTをデコードし、期限を見て切れそうならリフレッシュするチェック関数です。なお足りない関数は、適時状況に合わせて足してください。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export async function checkAndRefreshToken() {
    const ADDITIONAL_MSEC = 60 * 1000;
    const exp = getAccessTokenExp();

    if (!exp || Date.now() &lt; exp - ADDITIONAL_MSEC) {
        return;
    }

    await doRefreshToken();
}

function getAccessTokenExp() {
    const token = getAccessToken();
    const exp = decodeToken(token)?.exp * 1000; // トークンの有効期限を取得
    return exp;
}

function decodeToken(token: string | undefined): Record&lt;string, any&gt; | null {
    if (!token) return null;
    const base64Url = token.split('.')[1]; // JWTのペイロード部分を取得
    const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
    const jsonPayload = decodeURIComponent(
        atob(base64)
            .split('')
            .map((c) =&gt; {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            })
            .join('')
    );

    const result = JSON.parse(jsonPayload);
    return result;
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Apolloリクエスト前にリフレッシュチェックをいれる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>続いて、上記のチェック関数をApolloに組み込みます。チェック関数はrefreshLinkとして、また通信はhttpLinkとwsLinkを使用しています。httpLinkとwsLinkはsplitLinkで場合分けが行われています。なおwsLinkは再接続のたびにリフレッシュを動作させるために、connectionParamsに関数を渡しています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">    const refreshLink = setContext(async (_, { headers }) => {
        await checkAndRefreshToken();
        return {
            headers: { ...headers, ...(await generateHeaders()) },
        };
    });

    const httpLink = new HttpLink({
        uri,
    });

    const wsLink = new WebSocketLink({
        uri: wsUri,
        options: {
            reconnect: true,
            connectionParams: async () => {
                await checkAndRefreshToken();
                return { headers: await generateHeaders() };
            },
        },
    });

    const splitLink = split(
        ({ query }) => {
            const definition = getMainDefinition(query);
            return (
                definition.kind === 'OperationDefinition' &amp;&amp;
                definition.operation === 'subscription'
            );
        },
        wsLink,
        httpLink
    );

    return from([refreshLink, splitLink]);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、だいぶ簡単にApolloでトークンリフレッシュが実装できました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading"> 小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>このまえ久しぶりにリカーマウンテンに行きました。お酒の種類が多くていいですね。ちょうど安売りしていた何かのフルーツの酎ハイが美味しかったです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>506</wp:post_id>
		<wp:post_date><![CDATA[2024-01-29 16:52:07]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-29 07:52:07]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-29 17:34:50]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-29 08:34:50]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90apollo%e3%80%91%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%83%aa%e3%83%95%e3%83%ac%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92%e7%b0%a1%e5%8d%98%e3%81%ab%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="apollo"><![CDATA[Apollo]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_e7a10f8d77102609c71aeee33cd59df8]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="wp-embedded-content" data-secret="sZIaTWxayw"><a href="http://35.221.87.155/2024/01/26/%e3%80%90apollo%e3%80%91%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%83%aa%e3%83%95%e3%83%ac%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b/">【Apollo】トークンリフレッシュを実装する</a></blockquote><iframe title="&#8220;【Apollo】トークンリフレッシュを実装する&#8221; &#8212; 太田雅昭" sandbox="allow-scripts" security="restricted" src="http://35.221.87.155/2024/01/26/%e3%80%90apollo%e3%80%91%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%83%aa%e3%83%95%e3%83%ac%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b/embed/#?secret=sZIaTWxayw" width="600" height="338" data-secret="sZIaTWxayw" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" class="wp-embedded-content"></iframe><script>/*! This file is auto-generated */!function(d,l){"use strict";l.querySelector&&d.addEventListener&&"undefined"!=typeof URL&&(d.wp=d.wp||{},d.wp.receiveEmbedMessage||(d.wp.receiveEmbedMessage=function(e){var t=e.data;if((t||t.secret||t.message||t.value)&&!/[^a-zA-Z0-9]/.test(t.secret)){for(var s,r,n,a=l.querySelectorAll('iframe[data-secret="'+t.secret+'"]'),o=l.querySelectorAll('blockquote[data-secret="'+t.secret+'"]'),c=new RegExp("^https?:$","i"),i=0;i<o.length;i++)o[i].style.display="none";for(i=0;i<a.length;i++)s=a[i],e.source===s.contentWindow&&(s.removeAttribute("style"),"height"===t.message?(1e3<(r=parseInt(t.value,10))?r=1e3:~~r<200&&(r=200),s.height=r):"link"===t.message&&(r=new URL(s.getAttribute("src")),n=new URL(t.value),c.test(n.protocol))&&n.host===r.host&&l.activeElement===s&&(d.top.location.href=t.value))}},d.addEventListener("message",d.wp.receiveEmbedMessage,!1),l.addEventListener("DOMContentLoaded",function(){for(var e,t,s=l.querySelectorAll("iframe.wp-embedded-content"),r=0;r<s.length;r++)(t=(e=s[r]).getAttribute("data-secret"))||(t=Math.random().toString(36).substring(2,12),e.src+="#?secret="+t,e.setAttribute("data-secret",t)),e.contentWindow.postMessage({message:"ready",secret:t},"*")},!1)))}(window,document);</script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_e7a10f8d77102609c71aeee33cd59df8]]></wp:meta_key>
		<wp:meta_value><![CDATA[1706517159]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_b9ec9e702662c432ad31ea090e495b30]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【dnd-kit】DndContextを入れ子にすると、親には伝わらない]]></title>
		<link>https://www.masaakiota.net/2024/01/30/%e3%80%90dnd-kit%e3%80%91dndcontext%e3%82%92%e5%85%a5%e3%82%8c%e5%ad%90%e3%81%ab%e3%81%99%e3%82%8b%e3%81%a8%e3%80%81%e8%a6%aa%e3%81%ab%e3%81%af%e4%bc%9d%e3%82%8f%e3%82%89%e3%81%aa%e3%81%84/</link>
		<pubDate>Mon, 29 Jan 2024 17:15:04 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=519</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">dnd-kit</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>dnd-kitは、ドラッグ&amp;ドロップを簡単に実装できるライブラリです。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://docs.dndkit.com/","type":"rich","providerNameSlug":"dndkit"} -->
<figure class="wp-block-embed is-type-rich is-provider-dndkit wp-block-embed-dndkit"><div class="wp-block-embed__wrapper">
https://docs.dndkit.com/
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Contextを入れ子にすると、親には伝わらない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>公式でも入れ子にする事ができると紹介されているのですが、実は親にはイベントが伝わりません。以下は公式コードを少しだけ変更したものです。Contextを入れ子にしています。handleStart2は発火するのですが、handleStart1は発火しません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">"use client"

import React from 'react';
import { DndContext } from '@dnd-kit/core';
import { useDraggable } from '@dnd-kit/core';
import { useDroppable } from '@dnd-kit/core';


export default function DndTest() {
    function handleStart1() {
        console.log('drag start 1'); // 発火しない
    }
    function handleStart2() {
        console.log('drag start 2'); // 発火する
    }
    return (
        &lt;DndContext onDragStart={handleStart1}&gt;
            &lt;DndContext onDragStart={handleStart2}&gt;
                &lt;Draggable &gt;draggable&lt;/Draggable&gt;
            &lt;/DndContext&gt;
        &lt;/DndContext&gt;
    )
}

function Draggable(props: any) {
    const { attributes, listeners, setNodeRef, transform } = useDraggable({
        id: 'draggable',
    });
    const style = transform ? {
        transform: `translate3d(${transform.x}px, ${transform.y}px, 0)`,
    } : undefined;


    return (
        &lt;button ref={setNodeRef} style={style} {...listeners} {...attributes}&gt;
            {props.children}
        &lt;/button&gt;
    );
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これはより厳密な設計を想定したものと思われますが、これを知らないと逆に痛い目を見ます。。。つまり何かの用途でcontextで囲ったコンテナは、それを超えて他コンテナへのドラッグができないということです。そのため、基本は１つのcontextで賄い、完全に独立している場合はそれぞれでcontextを１つずつ使うといった運用になるかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>というわけで、dnd-kitの挙動についてのお話でした。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>クラフトビールっていうのを一度飲んでみたいです。クラフトボスは好きでよく買うのですが、クラフトビールは未経験です。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>519</wp:post_id>
		<wp:post_date><![CDATA[2024-01-30 02:15:04]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-29 17:15:04]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-30 02:43:58]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-29 17:43:58]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90dnd-kit%e3%80%91dndcontext%e3%82%92%e5%85%a5%e3%82%8c%e5%ad%90%e3%81%ab%e3%81%99%e3%82%8b%e3%81%a8%e3%80%81%e8%a6%aa%e3%81%ab%e3%81%af%e4%bc%9d%e3%82%8f%e3%82%89%e3%81%aa%e3%81%84]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="dnd-kit-react"><![CDATA[dnd kit]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_6514c5f015f2b027e81731a74d922824]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://docs.dndkit.com/">Overview</a></h4><p>@dnd-kit - A lightweight, modular, performant, accessible and extensible drag & drop toolkit for React.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_6514c5f015f2b027e81731a74d922824]]></wp:meta_key>
		<wp:meta_value><![CDATA[1706550239]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】PostgreSQLデータベースの更新をリッスンする]]></title>
		<link>https://www.masaakiota.net/2024/02/05/%e3%80%90postgresql%e3%80%91node-js%e3%81%a7%e3%83%87%e3%83%bc%e3%82%bf%e3%83%99%e3%83%bc%e3%82%b9%e3%81%ae%e6%9b%b4%e6%96%b0%e3%82%92%e3%83%aa%e3%83%83%e3%82%b9%e3%83%b3%e3%81%99%e3%82%8b/</link>
		<pubDate>Sun, 04 Feb 2024 23:48:34 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=526</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">PostgreSQLをリッスンするのに必要なこと</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下の手順が必要です。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>DBにFunctionを登録</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>DBにTriggerを登録</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Subscriberにリスナーを登録、接続、リッスン</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>順を追ってみていきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Functionを登録</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まずPostgreSQLにFunctionを登録する必要があります。以下はプレーンなsqlです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="sql" class="language-sql">CREATE OR REPLACE FUNCTION my_function_name()
RETURNS TRIGGER AS $$
BEGIN
    PERFORM pg_notify('my_channel_name', row_to_json(NEW)::text);
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>Prismaだと以下になります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">await this.prisma.$executeRaw(Prisma.sql`
    CREATE OR REPLACE FUNCTION ${Prisma.raw(functionName)}()
    RETURNS TRIGGER AS $$
    BEGIN
        PERFORM pg_notify('${Prisma.raw(
            channelName,
        )}', row_to_json(NEW)::text);
        RETURN NEW;
    END;
    $$ LANGUAGE plpgsql;
`);</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Triggerを登録</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まずはsql文です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="sql" class="language-sql">CREATE OR REPLACE TRIGGER my_trigger_name
AFTER UPDATE ON "my_table_name"
FOR EACH ROW EXECUTE FUNCTION my_function_name();</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>prismaだと以下です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">await this.prisma.$executeRaw(Prisma.sql`
    CREATE OR REPLACE TRIGGER ${Prisma.raw(triggerName)}
    AFTER UPDATE ON "${Prisma.raw(tableName)}"
    FOR EACH ROW EXECUTE FUNCTION ${Prisma.raw(functionName)}();
`);</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Subscriberを作成</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>pg-listenを使って、Subscriberを作っていきます。長く更新されていないライブラリですが、TypeScriptでばっちり使えるのはありがたいですね。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">yarn add pg-listen pg</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>まずは初期化します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import createSubscriber from 'pg-listen';
const subscriber = createAubscriber({
    connectionString: process.env['DATABASE_URI'], // postgres://postgres:postgrespassword@localhost:5432/xxx みたいなやつ。
})</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>続いてイベントを登録していきます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">subscriber.events.on('error', (error) =&gt; {
    console.error('Fatal database connection error:', error);
});

subscriber.notifications.on(channelName, (payload)=&gt;{
    console.log('notification event', payload);
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>つづいてコネクトしてリッスンして終了です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">subscriber.connect();
subscriber.listenTo(channelName);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、無事イベントを補足することができました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近よくコーヒーを飲んでます。ラテ系の方が濃くて美味しいですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>526</wp:post_id>
		<wp:post_date><![CDATA[2024-02-05 08:48:34]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-02-04 23:48:34]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:20:51]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:20:51]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90postgresql%e3%80%91node-js%e3%81%a7%e3%83%87%e3%83%bc%e3%82%bf%e3%83%99%e3%83%bc%e3%82%b9%e3%81%ae%e6%9b%b4%e6%96%b0%e3%82%92%e3%83%aa%e3%83%83%e3%82%b9%e3%83%b3%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】NTPで時刻オフセットを計算してみた]]></title>
		<link>https://www.masaakiota.net/2024/02/06/%e3%80%90node-js%e3%80%91ntp%e3%81%a7%e6%99%82%e5%88%bb%e3%82%aa%e3%83%95%e3%82%bb%e3%83%83%e3%83%88%e3%82%92%e8%a8%88%e7%ae%97%e3%81%97%e3%81%a6%e3%81%bf%e3%81%9f/</link>
		<pubDate>Mon, 05 Feb 2024 23:54:58 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=536</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">時刻関連</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>昨今のコンピュータはどれもこれも自動で時刻補正がなされています。それはNTPサーバーを介して行われるのですが、ネットワーク遅延などを考慮する必要があります。そのための計算があります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ただその計算が、どうもややこしい。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">計算してみた</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ほとんどChatGPT大先生によるコードですが、以下のようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { Client as NTP } from 'ntp-time';

async function getOffset(server: string) {
    const ntp = new NTP(server, 123, { timeout: 1000 });
    const clientSendTime = Date.now(); // クライアントがリクエストを送信した時刻（ミリ秒単位）

    const ntpPacket = await ntp.syncTime();
    const clientReceiveTime = Date.now(); // クライアントが応答を受信した時刻（ミリ秒単位）

    // NTPパケットからタイムスタンプを抽出（秒単位）
    const serverReceiveTime = (ntpPacket as any).rxTimestamp;
    const serverTransmitTime = (ntpPacket as any).txTimestamp;

    // NTPのタイムスタンプは1900年からの秒数なので、1970年基準のミリ秒に変換
    const NTP_TIMESTAMP_BASE = 2208988800000; // 1900年から1970年までのミリ秒
    const serverReceiveTimeMs = serverReceiveTime * 1000 - NTP_TIMESTAMP_BASE;
    const serverTransmitTimeMs = serverTransmitTime * 1000 - NTP_TIMESTAMP_BASE;

    // ネットワーク遅延の推定値を計算
    const roundTripDelay =
        clientReceiveTime -
        clientSendTime -
        (serverTransmitTimeMs - serverReceiveTimeMs);

    // オフセットを計算（クライアントとサーバーの時刻差）
    const localClockOffset =
        (serverReceiveTimeMs -
            clientSendTime +
            (serverTransmitTimeMs - clientReceiveTime)) /
        2;

    console.log({
        server,
        clientSendTime,
        clientReceiveTime,
        serverReceiveTimeMs,
        serverTransmitTimeMs,
        roundTripDelay,
        localClockOffset,
    });

    return localClockOffset;
}


const SERVERS = [
    'a.st1.ntp.br',
    'ntp.jst.mfeed.ad.jp',
    'ntp.nict.jp',
    'time.google.com',
    'time.aws.com',
    'time.cloudflare.com',
];

for (const server of SERVERS){
    const offset = getOffset(server);
    ...
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで時刻のずれを計算できるのですが、何がややこしいって。ntp-timeを使ったのですが、このライブラリの型定義と実際に吐き出されるオブジェクトとフィールドが違うし、タイムスタンプの起点もフィールドによって違うしで、もう何が何だかわからずです。今でも良くわかっていません。とにかくChatGPT大先生には感謝です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">追記：2024/02/06</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>計算まで行ってくれるライブラリがありました。。。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.npmjs.com/package/ntp-time-sync","type":"rich","providerNameSlug":"npm"} -->
<figure class="wp-block-embed is-type-rich is-provider-npm wp-block-embed-npm"><div class="wp-block-embed__wrapper">
https://www.npmjs.com/package/ntp-time-sync
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>複数サーバーから計算を行ってくれるようです。これを使いたいと思います。なおデフォルトで設定されているサーバーは、他NTPサーバーからランダムに情報を取ってくるもののようです。本番では選定したサーバーを使用した方が良さそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今日は朝から久しぶりにココアを飲みました。コンビニのペットボトルです。ただ、やっぱり自分で入れた方が美味しいですね。。。なんなんでしょうこれは。やはり牛乳の新鮮さなどの関係でしょうか。喫茶店をやっていた頃は、無調整の牛乳と、あとは何か美味しい砂糖を特別に使ったりしていました。ペルーシェとかいう名前だったと思います。ココアととても良くあって、美味しかったです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>536</wp:post_id>
		<wp:post_date><![CDATA[2024-02-06 08:54:58]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-02-05 23:54:58]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:20:51]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:20:51]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node-js%e3%80%91ntp%e3%81%a7%e6%99%82%e5%88%bb%e3%82%aa%e3%83%95%e3%82%bb%e3%83%83%e3%83%88%e3%82%92%e8%a8%88%e7%ae%97%e3%81%97%e3%81%a6%e3%81%bf%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_a99aeedeb11a50f87e5d57f0798bb237]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://www.npmjs.com/package/ntp-time-sync">ntp-time-sync</a></h4><p>Fetches the current time from NTP servers and returns offset information. Latest version: 0.4.1, last published: 12 days ago. Start using ntp-time-sync in your project by running `npm i ntp-time-sync`. There are 2 other projects in the npm registry using ntp-time-sync.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_a99aeedeb11a50f87e5d57f0798bb237]]></wp:meta_key>
		<wp:meta_value><![CDATA[1707208211]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeScript】指定型から新規型を生成する機能をまとめてみた。Pick, Omit など。]]></title>
		<link>https://www.masaakiota.net/2024/02/06/%e3%80%90typescript%e3%80%91%e6%8c%87%e5%ae%9a%e5%9e%8b%e3%81%8b%e3%82%89%e6%96%b0%e8%a6%8f%e5%9e%8b%e3%82%92%e7%94%9f%e6%88%90%e3%81%99%e3%82%8b%e6%a9%9f%e8%83%bd%e3%82%92%e3%81%be%e3%81%a8%e3%82%81/</link>
		<pubDate>Tue, 06 Feb 2024 11:28:57 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=547</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニア太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">TypeScriptの型定義</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>TypeScriptはJavaScriptに型定義を追加したもので、ビルド前のコーディング時の型安全性を担保できます。僕は型安全性大好き人間なので、TypeScriptを見るだけで涎が出てきます。ただ複雑なのも事実で、割と長く触ってるにも関わらず、いまだに調べながらコーディングしています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこで、今回はTypeScriptで指定型から新規型を生成する機能をまとめてみました。自分で書けば覚えれる。レッツゴー。といった感じです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">指定型から新規型生成</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のような具合です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type T = {
    a: number;
    b: string;
    c: boolean;
};

// プロパティ選択
type Picked = Pick&lt;T, 'a' | 'c'>; // { a: number; c: boolean; }

// プロパティ除外
type Omitted = Omit&lt;T, 'b'>; // { a: number; c: boolean; }

// すべてのプロパティをオプショナルに
type PartialT = Partial&lt;T>; // { a?: number; b?: string; }

// すべてのプロパティを必須に
type RequiredT = Required&lt;T>; // { a: number; b: string; }

// すべてのプロパティを読み取り専用に
type ReadonlyT = Readonly&lt;T>; // { readonly a: number; readonly b: string; }

// 特定の値を除外
type Excluded = Exclude&lt;T, boolean | number>; // string

// 特定の値を抽出
type Extracted = Extract&lt;T, string | boolean>; // string | boolean

// nullまたはundefinedを除外
type NonNullableT = NonNullable&lt;T>; // string
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>いやぁ、TypeScript便利ですね。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>やはりコーヒーはブラックです。ただコーヒーだけだと飲みにくいので、ちょっとしたお菓子と一緒に楽しんでます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>547</wp:post_id>
		<wp:post_date><![CDATA[2024-02-06 20:28:57]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-02-06 11:28:57]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-04-26 15:12:46]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-04-26 06:12:46]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typescript%e3%80%91%e6%8c%87%e5%ae%9a%e5%9e%8b%e3%81%8b%e3%82%89%e6%96%b0%e8%a6%8f%e5%9e%8b%e3%82%92%e7%94%9f%e6%88%90%e3%81%99%e3%82%8b%e6%a9%9f%e8%83%bd%e3%82%92%e3%81%be%e3%81%a8%e3%82%81]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeScript】知っていると便利な型定義]]></title>
		<link>https://www.masaakiota.net/2024/02/08/%e3%80%90typescript%e3%80%91%e3%81%97%e3%81%a3%e3%81%a6%e3%82%8b%e3%81%a8%e4%be%bf%e5%88%a9%e3%81%aa%e5%9e%8b%e5%ae%9a%e7%be%a9/</link>
		<pubDate>Thu, 08 Feb 2024 14:02:40 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=552</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>TypeScriptは型定義で出来ることがたくさんあり覚え切れないので、知っていると役立ちそうなものをピックアップしていこうと思います。このページは随時更新しています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">オブジェクトから作成する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>通常は先にTypeを作りますが、オブジェクトからTypeを生成することもできます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const obj = { a: 1, b: 2, c: 3 };
type Type = typeof obj;
const a: Type = { a: 1, b: 2, c: 3 }; // ok
const b: Type = { a: 1 }; // error
const c: Type = { d: 1 }; // error</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>キーを抽出もできます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const obj = { a: 1, b: 2, c: 3 };
type Type = keyof typeof obj;
const a: Type = 'a'; // ok
const b: Type = 'd'; // error</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>バリューは以下のように抽出できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const obj = { a: 1, b: 2, c: 3 } as const;
type Type = typeof obj[keyof typeof obj];
const a: Type = 1; // ok
const b: Type = 4; // error</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">配列から作成する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにすれば、配列から型も生成できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const keys = ['a', 'b', 'c'] as const;
type Type = (typeof keys)[number]; // 'a' | 'b' | 'c'
const a: Type = 'a'; // ok
const d: Type = 'd'; // error</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>リストをコンパイル後に参照したい時に便利ですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下では、配列を使用した使用を理解するために、順番に書いてみました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">function returnGivenArg&lt;T>(arg: T): T {
    return arg;
}

function returnGivenArray&lt;T extends any[]>(arr: T): T {
    return arr;
}

function returnGivenArrayReadOnly&lt;T extends readonly any[]>(arr: T): T {
    return arr;
}

function returnOneOfGivenArrayReadOnly&lt;T extends readonly string[]>(arr: T): T[number] {
    return arr[0];
}

// "aaa"
const arg = returnGivenArg('aaa');

// string[]
const array = returnGivenArray(['a', 'b', 'c']);

// ["a", "b", "c"]
const arrayReadOnly = returnGivenArrayReadOnly(['a', 'b', 'c'] as const);

// "a" | "b" | "c"
const oneOfArrayReadOnly = returnOneOfGivenArrayReadOnly(['a', 'b', 'c'] as const);

const abcReadOnly = ['a', 'b', 'c'] as const;

// "a" | "b" | "c"
const oneOfArrayReadOnlyWithGeneric = returnOneOfGivenArrayReadOnly&lt;typeof abcReadOnly>([] as any);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>as constを使用してreadonlyにすることで、使い道は広がりますね。readonlyにした配列を、ジェネリックに渡せるのも良いです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下のようにすれば、キーを渡すだけで型が確定します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const obj = {key1: 'a', key2: 'b'} as const;

function returnValueOfObjByKey&lt;K extends keyof typeof obj>(key: K): (typeof obj)[K] {
    return obj[key];
}

// "a"
const d = returnValueOfObjByKey('key1');</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近コーヒーにハマってます。子供の頃は嫌いだったのですが。今は酒もコーヒーも美味しくて、大人になるってのは、どういうことなんでしょうね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>552</wp:post_id>
		<wp:post_date><![CDATA[2024-02-08 23:02:40]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-02-08 14:02:40]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-02-17 22:05:26]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-02-17 13:05:26]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typescript%e3%80%91%e3%81%97%e3%81%a3%e3%81%a6%e3%82%8b%e3%81%a8%e4%be%bf%e5%88%a9%e3%81%aa%e5%9e%8b%e5%ae%9a%e7%be%a9]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】テスト用に安全に使用できる電話番号生成]]></title>
		<link>https://www.masaakiota.net/2024/02/14/%e3%80%90node-js%e3%80%91%e3%83%86%e3%82%b9%e3%83%88%e7%94%a8%e3%81%ab%e5%ae%89%e5%85%a8%e3%81%ab%e4%bd%bf%e7%94%a8%e3%81%a7%e3%81%8d%e3%82%8b%e9%9b%bb%e8%a9%b1%e7%95%aa%e5%8f%b7%e7%94%9f%e6%88%90/</link>
		<pubDate>Tue, 13 Feb 2024 17:26:23 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=558</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">安全に使用できる電話番号</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>世の中には、ドラマなどで安全に使用できる電話番号といったものが提供されています。例えばアメリカの555が検索ですぐにヒットしますが、イギリスでもそうした電話番号が提供されています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">アメリカの555</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>こちらは割と有名な話のようです。アメリカの555-0100から555-0199までがドラマなどで安全に使用できる番号として提供されています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Node.jsで自動生成するには以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">function generate555SafePhone() {
    let phone = '+1-555-0';
    const rand = random(100, 199);
    return phone + rand;
}

function random(min: number, max: number) {
    const result = min + Math.random() * (max - min);
    return Math.floor(result);
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">イギリスの安全な電話番号</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>イギリスでもそうした安全に使用できる電話番号が提供されています。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.ofcom.org.uk/phones-telecoms-and-internet/information-for-industry/numbering/numbers-for-drama"} -->
<figure class="wp-block-embed"><div class="wp-block-embed__wrapper">
https://www.ofcom.org.uk/phones-telecoms-and-internet/information-for-industry/numbering/numbers-for-drama
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>Node.jsで書くと以下のようになります。なお最新情報などご自身で十分検証を行った上でご使用ください。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// [area code, min, max][]
const UK_CODES = [
    ['0113', 4960000, 4960999],
    ['0114', 4960000, 4960999],
    ['0115', 4960000, 4960999],
    ['0116', 4960000, 4960999],
    ['0117', 4960000, 4960999],
    ['0118', 4960000, 4960999],
    ['0121', 4960000, 4960999],
    ['0131', 4960000, 4960999],
    ['0141', 4960000, 4960999],
    ['0151', 4960000, 4960999],
    ['0161', 4960000, 4960999],
    ['020', 79460000, 79460999],
    ['0191', 4980000, 4980999],
    ['028', 96496000, 96496999],
    ['029', 20180000, 20180999],
    ['01632', 960000, 960999],
    ['07700', 900000, 900999],
    ['08081', 570000, 570999],
    ['0909', 8790000, 8790999],
    ['03069', 990000, 990999],
] as const;


export function generateUkSafePhone(){
    const [area, min, max] = UK_CODES[random(0, UK_CODES.length)];
    const number = random(min, max);
    return `+44-${area}-${number}`;

}

function random(min: number, max: number) {
    const result = min + Math.random() * (max - min);
    return Math.floor(result);
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近、ゴールデンカムイの漫画を読み終わりました。面白かったです。最後の方はかなり画力も高くなっていましたね。ストーリーも練られていて、ゆっくり読み進めていきました。満足です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>558</wp:post_id>
		<wp:post_date><![CDATA[2024-02-14 02:26:23]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-02-13 17:26:23]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:20:51]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:20:51]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node-js%e3%80%91%e3%83%86%e3%82%b9%e3%83%88%e7%94%a8%e3%81%ab%e5%ae%89%e5%85%a8%e3%81%ab%e4%bd%bf%e7%94%a8%e3%81%a7%e3%81%8d%e3%82%8b%e9%9b%bb%e8%a9%b1%e7%95%aa%e5%8f%b7%e7%94%9f%e6%88%90]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_828ed70594098b4a3c0c87ee7d5e8ea9]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://www.ofcom.org.uk/phones-telecoms-and-internet/information-for-industry/numbering/numbers-for-drama">Telephone numbers for use in TV and radio drama programmes</a></h4><p>Ofcom continues to receive requests for Geographic Numbers to be used for drama purposes. In light of this, Ofcom has set out below a range of Geographic Telephone Numbers recommended for drama purposes (1000 numbers within each Geographic Area Code).</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_828ed70594098b4a3c0c87ee7d5e8ea9]]></wp:meta_key>
		<wp:meta_value><![CDATA[1707844992]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】turbo prune後はリンクが消えてmodule not found]]></title>
		<link>https://www.masaakiota.net/2024/02/15/%e3%80%90node-js%e3%80%91turbo-prune%e5%be%8c%e3%81%af%e3%83%aa%e3%83%b3%e3%82%af%e3%81%8c%e6%b6%88%e3%81%88%e3%81%a6module-not-found/</link>
		<pubDate>Wed, 14 Feb 2024 21:41:50 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=560</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">turbo prune</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>turboはモノレポ用のツールです。依存関係をルートにまとめてくれたり、ビルドプロセスを同時実行で効率化してくれたりします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そんなturboのpruneは、依存関係にあるプロジェクトを抽出してくれます。本番環境への移行時などに使うことを想定しているものと思われます。私もdockerイメージ作成時に使っています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">pruneあとはリンクが消える</h2>
<!-- /wp:heading -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">turbo prune --scope=xxx</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>でoutディレクトリにコピーされたファイル群が入ります。これを、例えばdockerのCOPYコマンドで使用したとします。ところがmodule not foundになり、ただでさえ状況を把握しづらいdockerコンテナ内での出来事にヤキモキしてコーヒーをがぶ飲みすること間違いなしです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>module not foundになる原因は、workspaceのリンクが切れているためです。そのため、以下のコマンドで治ります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">yarn install</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>久しぶりにチョコが食べたいです。そんな時、ありますよね？ちょっと買ってこようと思います。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>560</wp:post_id>
		<wp:post_date><![CDATA[2024-02-15 06:41:50]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-02-14 21:41:50]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:20:51]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:20:51]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node-js%e3%80%91turbo-prune%e5%be%8c%e3%81%af%e3%83%aa%e3%83%b3%e3%82%af%e3%81%8c%e6%b6%88%e3%81%88%e3%81%a6module-not-found]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【WordPress】GCEでヘルスチェックと起動スクリプトを試してみた]]></title>
		<link>https://www.masaakiota.net/2024/02/16/%e3%80%90wordpress%e3%80%91gce%e3%81%a7%e3%83%98%e3%83%ab%e3%82%b9%e3%83%81%e3%82%a7%e3%83%83%e3%82%af%e3%81%a8%e8%87%aa%e5%8b%95%e5%86%8d%e8%b5%b7%e5%8b%95%e3%82%92%e8%a9%a6%e3%81%97%e3%81%a6/</link>
		<pubDate>Fri, 16 Feb 2024 01:16:54 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=566</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ヘルスチェック</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GCEでは、ヘルスチェック機能を用いて、サーバーが生きているかどうかの確認を自動で行えます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>特定のURLを指定するhttpsタイプを用いました。以下のURLに対してヘルスチェックを行います。　</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">/wp-json/wp-site-health/v1</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>なおこのエンドポイントは、特にこういった用途というわけではありません。ヘルスチェックの用途が違うようです。WordPressならこうした、サーバーが生きているかどうかの判定を行うエンドポイントがあるだろうと探してみたのですが、無いようです。仕方なく、代わりに使えそうなエンドポイントを使用しています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">起動スクリプト</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>起動スクリプトを指定することで、自動実行スクリプトを埋め込みます。dockerを使用しているので、以下のようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">cd /home/wp1
sh reup.prod.sh</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>shellファイルの中身は以下のようになってます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">docker compose down
docker compose up -d</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで安心です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">2024/05/06追記。自動再起動されるわけではない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>本来欲しかったのは、サーバーの自動再起動機能でした。欲しかった情報を見つけられなかったため試しで上記方法を行っていたのですが、自動再起動されるわけではないようです。GCEで自動再起動させるには、他に監視用のサーバーを用意するなりしないといけないのかもしれません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>睡眠時間を削りたいのですが、なかなか難しいです。睡眠不足だと、全然仕事が捗りません。。。悲しい。何かいい方法はないでしょうか。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>566</wp:post_id>
		<wp:post_date><![CDATA[2024-02-16 10:16:54]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-02-16 01:16:54]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-05-06 16:54:40]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-05-06 07:54:40]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90wordpress%e3%80%91gce%e3%81%a7%e3%83%98%e3%83%ab%e3%82%b9%e3%83%81%e3%82%a7%e3%83%83%e3%82%af%e3%81%a8%e8%87%aa%e5%8b%95%e5%86%8d%e8%b5%b7%e5%8b%95%e3%82%92%e8%a9%a6%e3%81%97%e3%81%a6]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="wordpress"><![CDATA[WordPress]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Hasura】CloudBuildでMetadataを反映させてみた]]></title>
		<link>https://www.masaakiota.net/2024/02/19/%e3%80%90hasura%e3%80%91cloudbuild%e3%81%a7metadata%e3%82%92%e5%8f%8d%e6%98%a0%e3%81%95%e3%81%9b%e3%81%a6%e3%81%bf%e3%81%9f/</link>
		<pubDate>Sun, 18 Feb 2024 21:46:10 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=577</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">HasuraのMetadata</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>みんな大好きHasuraですが、Metadataの移行で色々つまづいたので書かせていただきます。Metadataは、DBと直接関係のないHasura特有の情報で、パーミッションなどが含まれています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なお大まかな手順は以下になります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>ローカル環境でMetadataをダウンロード</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>MetadataをGithubにアップロード</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>CloudBuildで対象のHasuraに反映</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>一つ一つ見ていきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Metadataをダウンロード</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Metadataをダウンロードするには、まずcliを入れます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">yarn global add hasura-cli</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>初期化します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">hasura init</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>続いてMetadataをダウンロードします。exportを使います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">unset NODE_OPTIONS
hasura metadata export</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここでunset NODE_OPTIONSとしているのは、エラー回避のためです。実行環境によるのかもしれませんが、少なくとも私の環境ではこのようにしないと、エラーで動きませんでした。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>上記を実行すると複数のファイルが作成されるので、Githubにアップロードします。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Cloud Buildで反映させる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>続いてCloud Buildで反映させます。今回は以下のようにしました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="yaml" class="language-yaml"># _HASURA_ENDPOINT: Endpoint of Hasura

steps:
  - name: 'node'
    entrypoint: 'bash'
    args:
      - '-c'
      - |
        npm install -g hasura-cli &amp;&amp; \
        cd ./packages/hasura/cli &amp;&amp; \
        hasura metadata apply --endpoint $_HASURA_ENDPOINT --admin-secret $$HASURA_ADMIN_SECRET
    secretEnv: ['HASURA_ADMIN_SECRET']
availableSecrets:
  secretManager:
  - versionName: projects/$PROJECT_ID/secrets/HASURA_ADMIN_SECRET/versions/latest
    env: 'HASURA_ADMIN_SECRET'
options:
    logging: CLOUD_LOGGING_ONLY</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>node環境でhasura-cliをインストールし、先ほどmetadataを作成したディレクトリまで移動。その後applyコマンドで実行しています。なおHASURA_ADMIN_SECRETはGCPのシークレットマネージャーを利用しています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">注意：DATABASE_URLについて</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>HasuraのMetadataには、接続先のデータベース情報も含まれています。そのため以下の場合、泣きをみることになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>--- コンソールで直接DATABASE_URLを指定している ---</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>この場合、そのURLがそのまま反映されてしまうため、ローカルで使用していたDBを参照しようとして接続できなくなります。そのため、ちゃんと環境変数から参照するように設定する必要があります。今回はこれで泣かされました。以上です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近少し体調が良くなりました。少し睡眠時間を削っていけそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>577</wp:post_id>
		<wp:post_date><![CDATA[2024-02-19 06:46:10]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-02-18 21:46:10]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-02-19 06:46:10]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-02-18 21:46:10]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90hasura%e3%80%91cloudbuild%e3%81%a7metadata%e3%82%92%e5%8f%8d%e6%98%a0%e3%81%95%e3%81%9b%e3%81%a6%e3%81%bf%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="hasura"><![CDATA[Hasura]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Hasura】原因不明なエラー。例えばinvalid input syntax for type integer]]></title>
		<link>https://www.masaakiota.net/2024/02/20/%e3%80%90hasura%e3%80%91%e5%8e%9f%e5%9b%a0%e4%b8%8d%e6%98%8e%e3%81%aa%e3%82%a8%e3%83%a9%e3%83%bc%e3%80%82%e4%be%8b%e3%81%88%e3%81%b0invalid-input-syntax-for-type-integer/</link>
		<pubDate>Mon, 19 Feb 2024 23:45:16 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=582</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは。フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Hasuraで原因不明のエラー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回は、invalid input syntax for type integerといったエラーでしたが、まったく原因が不明でした。String型のカラムにString型を指定してインサートしようとしたら、いやIntegerだよと言われても、いやいやいや、といった具合です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ChatGPT先生にお伺いしても、結局分からずじまい。ネットをあさっているとふと、ヒントになるものを見つけました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">原因はパーミッションだった</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Hasuraのパーミッション設定は、Hasuraの代名詞といってもいいほどの強力な機能です。ただエラー内容が分かりにくく、今回のようなことが起きてしまいました。Hasuraのパーミッション周りで毎回時間が溶けていきます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Hasuraではパーミッションによるエラーは、それ以外のメッセージが出力されたりします。例えば今回なら、全く関係のない型相違のエラーが出ていました。またSelectの場合は、そもそもそのようなデータはないといった風に扱われます。これは便利な時もあるのですが、何が起こっているのかが分かりづらいため、開発中は難儀することも多いです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">結論</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Hasuraのエラーが出た時は、真っ先にパーミッションを疑う癖をつけたいです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近なか卯の親子丼が美味しくなった気がします。気のせいでしょうか？あるいは、店長が変わったのかもしれません。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>582</wp:post_id>
		<wp:post_date><![CDATA[2024-02-20 08:45:16]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-02-19 23:45:16]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-02-20 08:45:17]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-02-19 23:45:17]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90hasura%e3%80%91%e5%8e%9f%e5%9b%a0%e4%b8%8d%e6%98%8e%e3%81%aa%e3%82%a8%e3%83%a9%e3%83%bc%e3%80%82%e4%be%8b%e3%81%88%e3%81%b0invalid-input-syntax-for-type-integer]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="hasura"><![CDATA[Hasura]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Prisma】Cloud BuildでMigrateしてみた]]></title>
		<link>https://www.masaakiota.net/2024/02/26/%e3%80%90prisma%e3%80%91cloud-build%e3%81%a7migrate%e3%81%97%e3%81%a6%e3%81%bf%e3%81%9f/</link>
		<pubDate>Mon, 26 Feb 2024 08:47:47 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=585</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Cloud BuildでMigrate</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>いくつか方法を試してみたのですが、どうもうまくいかなかったため、次善策を採用しました。試したのは以下です。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>Cloud Build内でMigrateを実行</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Cloud FunctionsでMigrate</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Cloud RunでMigrate</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Cloud Build内でMigrate =&gt; うまくいかなかった</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>本来はCloud Build内で完結できるのが理想かと思います。色々調べると、exe-wrapperを使えばいいとは分かりました。これは、Cloud SQLへの接続を簡単にしてくれるもののようです。ただしdockerを使う必要があるため、少し面倒です。それを踏まえて以下のようにしてみました。Dockerコンテナ内に、必要なprisma実行環境と、migrationファイルがある状態です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="yaml" class="language-yaml"># _SQL_INSTANCE:  Cloud SQL instance name

steps:
    # Build the container image
    - name: 'gcr.io/cloud-builders/docker'
      args:
          [
              'build',
              '-t',
              'asia-northeast1-docker.pkg.dev/$PROJECT_ID/default-docker/prisma-migrate:$COMMIT_SHA',
              '-f',
              'Dockerfile.prisma',
              '.',
          ]
    # Push the container image to Container Registry
    - name: 'gcr.io/cloud-builders/docker'
      args:
          [
              'push',
              'asia-northeast1-docker.pkg.dev/$PROJECT_ID/default-docker/prisma-migrate:$COMMIT_SHA',
          ]
    # Migrate
    - name: "gcr.io/google-appengine/exec-wrapper"
      entrypoint: "bash"
      args:
      - -c
      - |
        /buildstep/execute.sh \
          -i asia-northeast1-docker.pkg.dev/$PROJECT_ID/default-docker/prisma-migrate:$COMMIT_SHA \
          -s $_SQL_INSTANCE \
          -e DATABASE_URL=$$DATABASE_URL \
          -- npx prisma migrate deploy
      secretEnv: ['DATABASE_URL']
availableSecrets:
  secretManager:
  - versionName: projects/$PROJECT_ID/secrets/DATABASE_URL/versions/latest
    env: 'DATABASE_URL'
options:
    logging: CLOUD_LOGGING_ONLY</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ところが上記コードでは、データベースに接続できないといったエラーが出てしまいます。どうやっても無理でした。。。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Cloud FunctionsでMigrate =&gt; 見送り</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Cloud Functionsだと、Cloud Buildと連携させるには少し面倒なようです。他のパッケージがCloud Buildで扱っているため、統一したい。そのため、これは却下しました。。。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Cloud RunでMigrate</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最後に、次善策でCloud Runで実行することにしました。ちょっと不適切な感じもしますが、ひとまずこれでよしとします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Dockerfile</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="docker" class="language-docker">FROM node:20.11-alpine3.18 as base

ENV NODE_ENV=production

WORKDIR /app

RUN apk add --no-cache python3 make g++ &amp;&amp; \
    ln -sf python3 /usr/bin/python

RUN yarn global add prisma


COPY /packages/api/prisma /app/prisma

# エラーを出さないように、migrateした後に形だけリッスンする
CMD npx prisma migrate deploy &amp;&amp; \
    echo "Prisma migration completed, starting dummy server..." &amp;&amp; \
    npx http-server -p $PORT</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記Dockerfileを、Cloud Runで読み込むだけです。Cloud Runでは、VPCネットワークの設定、およびCloud SQL接続設定も済ませます。これで、無事Migrateできました。トリガーも自動生成されるので、便利ですね。なおトリガーはいつも手動設定にしていますが、これは個人の好みかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>クラフトボスが好きなんですよ。コンビニに売ってるのですが、よく買っています。ただ、クラフト。。。？</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>585</wp:post_id>
		<wp:post_date><![CDATA[2024-02-26 17:47:47]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-02-26 08:47:47]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-02-26 18:05:37]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-02-26 09:05:37]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90prisma%e3%80%91cloud-build%e3%81%a7migrate%e3%81%97%e3%81%a6%e3%81%bf%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="prisma"><![CDATA[Prisma]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Hasura】Cloud RunでSubscriptionは使えるのか検証してみた]]></title>
		<link>https://www.masaakiota.net/2024/02/28/%e3%80%90hasura%e3%80%91cloud-run%e3%81%a7subscription%e3%81%af%e4%bd%bf%e3%81%88%e3%82%8b%e3%81%ae%e3%81%8b%e6%a4%9c%e8%a8%bc%e3%81%97%e3%81%a6%e3%81%bf%e3%81%9f/</link>
		<pubDate>Tue, 27 Feb 2024 23:22:12 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=589</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">HasuraのSubscription</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Hasuraの目玉機能の一つにSubscriptionがあります。これはデータベースの変更を検知して、通知してくれるというすぐれものです。自前でsocketを書く必要もないので、とても便利です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>しかしこれをCloudRunで使えるのかどうかがはっきり分かりません。CloudRunではアイドル状態のインスタンスは一定時間が経つと破棄されてしまいます。それがリクエストの有無なのか、あるいはHasuraのようなリッスンではどうなのか、などわからなかったため、検証してみました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">検証方法</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>検証には以下のコードを用いました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const Uri = `wss://example.com/v1/graphql`;
const OutputPath = 'output.txt';
const UpdateSql = 'UPDATE "xxx" SET "updatedAt"=NOW() WHERE id=1';
const SubscribeQuery = SubscribeTestToAuction;
const SubscribeVariables = { id: 1 };

const DbHost = '127.0.0.1';
const DbPort = 1234;
const DbUser = process.env.DATABASE_USER;
const DbPass = process.env.DATABASE_PASS;
const DbName = process.env.DATABASE_NAME;

let pg: Client;
let apollo: ApolloClient&lt;any&gt;;
let cnt = 0;

async function main() {
    await initPg();
    await initApollo();
    await update();
}

async function initPg() {
    pg = new Client({
        host: DbHost,
        port: DbPort,
        user: DbUser,
        password: DbPass,
        database: DbName,
    });
    await pg.connect();
}

async function initApollo() {
    const wsLink = new WebSocketLink({
        webSocketImpl: ws,
        uri: Uri,
        options: {
            reconnect: true,
        },
    });

    apollo = new ApolloClient({
        cache: new InMemoryCache(),
        link: from([wsLink]),
    });

    apollo
        .subscribe({ query: SubscribeQuery, variables: SubscribeVariables })
        .subscribe({
            next: (data) =&gt; {
                const updatedAt = data.data?.xxx_by_pk?.updatedAt;
                output(++cnt + ' ' + dayjs(updatedAt).format('HH:mm:ss'));
                setTimeout(update, 1000);
            },
            error: (error) =&gt; {
                output(error);
            },
        });
}

async function update() {
    const res = await pg.query(UpdateSql);
}

function output(str: string) {
    console.log(str);
    fs.appendFileSync(OutputPath, str + '\n');
}

main();</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>内容は、CloudRun上のHasuraからSubscribeして、通知を受け取ったら１秒後にデータベースを更新、また通知を受け取るということを繰り返しています。その時刻をファイルとコンソールに出力しています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">結果</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>１５分と少し回し続けた結果、以下のようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:html -->
<div style="height:30em;overflow:scroll">
<pre>
1 07:48:54
2 07:48:55
3 07:48:57
4 07:48:59
5 07:49:01
6 07:49:03
7 07:49:05
8 07:49:07
9 07:49:09
10 07:49:11
11 07:49:14
12 07:49:15
13 07:49:17
14 07:49:19
15 07:49:21
16 07:49:23
17 07:49:25
18 07:49:27
19 07:49:29
20 07:49:31
21 07:49:33
22 07:49:35
23 07:49:37
24 07:49:39
25 07:49:41
26 07:49:43
27 07:49:45
28 07:49:47
29 07:49:49
30 07:49:51
31 07:49:53
32 07:49:55
33 07:49:57
34 07:49:59
35 07:50:01
36 07:50:03
37 07:50:05
38 07:50:07
39 07:50:10
40 07:50:11
41 07:50:14
42 07:50:15
43 07:50:18
44 07:50:20
45 07:50:22
46 07:50:23
47 07:50:25
48 07:50:27
49 07:50:29
50 07:50:31
51 07:50:34
52 07:50:35
53 07:50:37
54 07:50:40
55 07:50:42
56 07:50:44
57 07:50:46
58 07:50:48
59 07:50:50
60 07:50:52
61 07:50:54
62 07:50:56
63 07:50:58
64 07:51:00
65 07:51:02
66 07:51:04
67 07:51:06
68 07:51:08
69 07:51:10
70 07:51:12
71 07:51:14
72 07:51:16
73 07:51:18
74 07:51:20
75 07:51:22
76 07:51:24
77 07:51:26
78 07:51:28
79 07:51:30
80 07:51:32
81 07:51:34
82 07:51:36
83 07:51:38
84 07:51:40
85 07:51:42
86 07:51:44
87 07:51:46
88 07:51:48
89 07:51:50
90 07:51:52
91 07:51:54
92 07:51:56
93 07:51:58
94 07:52:00
95 07:52:02
96 07:52:04
97 07:52:06
98 07:52:08
99 07:52:10
100 07:52:12
101 07:52:14
102 07:52:16
103 07:52:18
104 07:52:20
105 07:52:22
106 07:52:24
107 07:52:26
108 07:52:28
109 07:52:30
110 07:52:32
111 07:52:34
112 07:52:36
113 07:52:38
114 07:52:40
115 07:52:42
116 07:52:44
117 07:52:46
118 07:52:48
119 07:52:50
120 07:52:52
121 07:52:54
122 07:52:56
123 07:52:58
124 07:53:00
125 07:53:02
126 07:53:04
127 07:53:06
128 07:53:08
129 07:53:10
130 07:53:12
131 07:53:14
132 07:53:16
133 07:53:18
134 07:53:20
135 07:53:22
136 07:53:24
137 07:53:26
138 07:53:28
139 07:53:30
140 07:53:32
141 07:53:34
142 07:53:36
143 07:53:38
144 07:53:40
145 07:53:42
146 07:53:44
147 07:53:46
148 07:53:48
149 07:53:50
150 07:53:52
151 07:53:54
152 07:53:54
153 07:53:56
154 07:53:57
155 07:53:58
156 07:53:59
157 07:54:00
158 07:54:01
159 07:54:02
160 07:54:03
161 07:54:04
162 07:54:05
163 07:54:06
164 07:54:07
165 07:54:08
166 07:54:09
167 07:54:10
168 07:54:11
169 07:54:12
170 07:54:13
171 07:54:14
172 07:54:15
173 07:54:16
174 07:54:17
175 07:54:18
176 07:54:19
177 07:54:20
178 07:54:21
179 07:54:22
180 07:54:23
181 07:54:24
182 07:54:25
183 07:54:26
184 07:54:27
185 07:54:28
186 07:54:29
187 07:54:30
188 07:54:31
189 07:54:32
190 07:54:33
191 07:54:34
192 07:54:35
193 07:54:36
194 07:54:37
195 07:54:38
196 07:54:39
197 07:54:40
198 07:54:41
199 07:54:42
200 07:54:43
201 07:54:44
202 07:54:45
203 07:54:46
204 07:54:47
205 07:54:48
206 07:54:49
207 07:54:50
208 07:54:51
209 07:54:52
210 07:54:53
211 07:54:54
212 07:54:55
213 07:54:56
214 07:54:57
215 07:54:58
216 07:54:59
217 07:55:00
218 07:55:01
219 07:55:02
220 07:55:03
221 07:55:04
222 07:55:05
223 07:55:06
224 07:55:07
225 07:55:08
226 07:55:09
227 07:55:10
228 07:55:11
229 07:55:12
230 07:55:13
231 07:55:14
232 07:55:15
233 07:55:16
234 07:55:17
235 07:55:18
236 07:55:19
237 07:55:20
238 07:55:21
239 07:55:22
240 07:55:23
241 07:55:24
242 07:55:25
243 07:55:26
244 07:55:27
245 07:55:28
246 07:55:29
247 07:55:30
248 07:55:31
249 07:55:32
250 07:55:33
251 07:55:34
252 07:55:35
253 07:55:36
254 07:55:37
255 07:55:38
256 07:55:39
257 07:55:40
258 07:55:41
259 07:55:42
260 07:55:43
261 07:55:44
262 07:55:45
263 07:55:46
264 07:55:47
265 07:55:48
266 07:55:49
267 07:55:50
268 07:55:51
269 07:55:52
270 07:55:53
271 07:55:54
272 07:55:55
273 07:55:56
274 07:55:57
275 07:55:58
276 07:55:59
277 07:56:00
278 07:56:01
279 07:56:02
280 07:56:03
281 07:56:04
282 07:56:05
283 07:56:06
284 07:56:07
285 07:56:08
286 07:56:09
287 07:56:10
288 07:56:11
289 07:56:12
290 07:56:13
291 07:56:14
292 07:56:15
293 07:56:16
294 07:56:17
295 07:56:18
296 07:56:19
297 07:56:20
298 07:56:21
299 07:56:22
300 07:56:23
301 07:56:24
302 07:56:25
303 07:56:26
304 07:56:27
305 07:56:28
306 07:56:29
307 07:56:30
308 07:56:31
309 07:56:32
310 07:56:33
311 07:56:34
312 07:56:35
313 07:56:36
314 07:56:37
315 07:56:38
316 07:56:39
317 07:56:40
318 07:56:41
319 07:56:42
320 07:56:43
321 07:56:44
322 07:56:45
323 07:56:46
324 07:56:47
325 07:56:48
326 07:56:49
327 07:56:50
328 07:56:51
329 07:56:52
330 07:56:53
331 07:56:54
332 07:56:55
333 07:56:56
334 07:56:57
335 07:56:58
336 07:56:59
337 07:57:00
338 07:57:01
339 07:57:02
340 07:57:03
341 07:57:04
342 07:57:05
343 07:57:06
344 07:57:07
345 07:57:08
346 07:57:09
347 07:57:10
348 07:57:11
349 07:57:12
350 07:57:13
351 07:57:14
352 07:57:15
353 07:57:16
354 07:57:17
355 07:57:18
356 07:57:19
357 07:57:20
358 07:57:21
359 07:57:22
360 07:57:23
361 07:57:24
362 07:57:25
363 07:57:26
364 07:57:27
365 07:57:28
366 07:57:29
367 07:57:30
368 07:57:31
369 07:57:32
370 07:57:33
371 07:57:34
372 07:57:35
373 07:57:36
374 07:57:37
375 07:57:38
376 07:57:39
377 07:57:40
378 07:57:41
379 07:57:42
380 07:57:43
381 07:57:44
382 07:57:45
383 07:57:46
384 07:57:47
385 07:57:48
386 07:57:49
387 07:57:50
388 07:57:51
389 07:57:52
390 07:57:53
391 07:57:54
392 07:57:55
393 07:57:56
394 07:57:57
395 07:57:58
396 07:57:59
397 07:58:00
398 07:58:01
399 07:58:02
400 07:58:03
401 07:58:04
402 07:58:05
403 07:58:06
404 07:58:07
405 07:58:08
406 07:58:09
407 07:58:10
408 07:58:11
409 07:58:12
410 07:58:13
411 07:58:14
412 07:58:15
413 07:58:16
414 07:58:17
415 07:58:18
416 07:58:19
417 07:58:20
418 07:58:21
419 07:58:22
420 07:58:23
421 07:58:24
422 07:58:25
423 07:58:26
424 07:58:27
425 07:58:28
426 07:58:29
427 07:58:30
428 07:58:31
429 07:58:32
430 07:58:33
431 07:58:34
432 07:58:35
433 07:58:36
434 07:58:37
435 07:58:38
436 07:58:39
437 07:58:40
438 07:58:41
439 07:58:42
440 07:58:43
441 07:58:44
442 07:58:45
443 07:58:46
444 07:58:47
445 07:58:48
446 07:58:49
447 07:58:50
448 07:58:51
449 07:58:52
450 07:58:53
451 07:58:54
452 07:58:55
453 07:58:56
454 07:58:57
455 07:58:58
456 07:58:59
457 07:59:00
458 07:59:01
459 07:59:02
460 07:59:03
461 07:59:04
462 07:59:05
463 07:59:06
464 07:59:07
465 07:59:08
466 07:59:09
467 07:59:10
468 07:59:11
469 07:59:12
470 07:59:13
471 07:59:14
472 07:59:15
473 07:59:16
474 07:59:17
475 07:59:18
476 07:59:19
477 07:59:20
478 07:59:21
479 07:59:22
480 07:59:23
481 07:59:24
482 07:59:25
483 07:59:26
484 07:59:27
485 07:59:28
486 07:59:29
487 07:59:30
488 07:59:31
489 07:59:32
490 07:59:33
491 07:59:34
492 07:59:35
493 07:59:36
494 07:59:37
495 07:59:38
496 07:59:39
497 07:59:40
498 07:59:41
499 07:59:42
500 07:59:43
501 07:59:44
502 07:59:45
503 07:59:46
504 07:59:47
505 07:59:48
506 07:59:49
507 07:59:50
508 07:59:51
509 07:59:52
510 07:59:53
511 07:59:54
512 07:59:55
513 07:59:56
514 07:59:57
515 07:59:58
516 07:59:59
517 08:00:00
518 08:00:01
519 08:00:02
520 08:00:03
521 08:00:04
522 08:00:05
523 08:00:06
524 08:00:07
525 08:00:08
526 08:00:09
527 08:00:10
528 08:00:11
529 08:00:12
530 08:00:13
531 08:00:14
532 08:00:15
533 08:00:16
534 08:00:17
535 08:00:18
536 08:00:19
537 08:00:20
538 08:00:21
539 08:00:22
540 08:00:23
541 08:00:24
542 08:00:25
543 08:00:26
544 08:00:27
545 08:00:28
546 08:00:29
547 08:00:30
548 08:00:31
549 08:00:32
550 08:00:33
551 08:00:34
552 08:00:35
553 08:00:36
554 08:00:37
555 08:00:38
556 08:00:39
557 08:00:40
558 08:00:41
559 08:00:42
560 08:00:43
561 08:00:44
562 08:00:45
563 08:00:46
564 08:00:47
565 08:00:48
566 08:00:49
567 08:00:50
568 08:00:51
569 08:00:52
570 08:00:53
571 08:00:54
572 08:00:55
573 08:00:56
574 08:00:57
575 08:00:58
576 08:00:59
577 08:01:00
578 08:01:01
579 08:01:02
580 08:01:03
581 08:01:04
582 08:01:05
583 08:01:06
584 08:01:07
585 08:01:08
586 08:01:09
587 08:01:10
588 08:01:11
589 08:01:12
590 08:01:13
591 08:01:14
592 08:01:15
593 08:01:16
594 08:01:17
595 08:01:18
596 08:01:19
597 08:01:20
598 08:01:21
599 08:01:22
600 08:01:23
601 08:01:24
602 08:01:25
603 08:01:26
604 08:01:27
605 08:01:28
606 08:01:29
607 08:01:30
608 08:01:31
609 08:01:32
610 08:01:33
611 08:01:34
612 08:01:35
613 08:01:36
614 08:01:37
615 08:01:38
616 08:01:39
617 08:01:40
618 08:01:41
619 08:01:42
620 08:01:43
621 08:01:44
622 08:01:45
623 08:01:46
624 08:01:47
625 08:01:48
626 08:01:49
627 08:01:50
628 08:01:51
629 08:01:52
630 08:01:53
631 08:01:54
632 08:01:55
633 08:01:56
634 08:01:57
635 08:01:58
636 08:01:59
637 08:02:00
638 08:02:01
639 08:02:02
640 08:02:03
641 08:02:04
642 08:02:05
643 08:02:06
644 08:02:07
645 08:02:08
646 08:02:09
647 08:02:10
648 08:02:11
649 08:02:12
650 08:02:13
651 08:02:14
652 08:02:15
653 08:02:16
654 08:02:17
655 08:02:18
656 08:02:19
657 08:02:20
658 08:02:21
659 08:02:22
660 08:02:23
661 08:02:24
662 08:02:25
663 08:02:26
664 08:02:27
665 08:02:28
666 08:02:29
667 08:02:30
668 08:02:31
669 08:02:32
670 08:02:33
671 08:02:34
672 08:02:35
673 08:02:36
674 08:02:37
675 08:02:38
676 08:02:39
677 08:02:40
678 08:02:41
679 08:02:42
680 08:02:43
681 08:02:44
682 08:02:45
683 08:02:46
684 08:02:47
685 08:02:48
686 08:02:49
687 08:02:50
688 08:02:51
689 08:02:52
690 08:02:53
691 08:02:54
692 08:02:55
693 08:02:56
694 08:02:57
695 08:02:58
696 08:02:59
697 08:03:00
698 08:03:01
699 08:03:02
700 08:03:03
701 08:03:04
702 08:03:05
703 08:03:06
704 08:03:08
705 08:03:10
706 08:03:12
707 08:03:14
708 08:03:16
709 08:03:18
710 08:03:20
711 08:03:22
712 08:03:24
713 08:03:26
714 08:03:28
715 08:03:30
716 08:03:32
717 08:03:34
718 08:03:36
719 08:03:38
720 08:03:40
721 08:03:42
722 08:03:44
723 08:03:46
724 08:03:48
725 08:03:50
726 08:03:52
727 08:03:54
728 08:03:56
729 08:03:58
730 08:03:59
731 08:04:01
732 08:04:03
733 08:04:05
734 08:04:07
735 08:04:09
736 08:04:11
737 08:04:13
738 08:04:15
739 08:04:17
740 08:04:19
741 08:04:21
742 08:04:23
743 08:04:25
744 08:04:27
745 08:04:29
746 08:04:31
747 08:04:33
748 08:04:35
749 08:04:37
750 08:04:39
751 08:04:41
752 08:04:43
753 08:04:45
754 08:04:47
755 08:04:49
756 08:04:51
757 08:04:53
758 08:04:55
759 08:04:57
760 08:04:59
761 08:05:01
762 08:05:03
763 08:05:05
764 08:05:07
765 08:05:09
766 08:05:11
767 08:05:13
768 08:05:15
769 08:05:17
770 08:05:19
771 08:05:22
772 08:05:23
773 08:05:25
774 08:05:27
775 08:05:29
776 08:05:32
777 08:05:33
778 08:05:35
779 08:05:37
780 08:05:40
781 08:05:41
782 08:05:44
783 08:05:45
784 08:05:47
785 08:05:50
786 08:05:51
787 08:05:53
788 08:05:55
789 08:05:58
790 08:05:59
791 08:06:02
792 08:06:04
793 08:06:05
794 08:06:07
795 08:06:09
796 08:06:11
797 08:06:14
798 08:06:15
799 08:06:18
800 08:06:19
801 08:06:22
802 08:06:23
803 08:06:25
804 08:06:27
805 08:06:30
806 08:06:32
807 08:06:34
808 08:06:36
809 08:06:38
810 08:06:40
811 08:06:42
812 08:06:44
813 08:06:46
814 08:06:48
815 08:06:50
816 08:06:52
</pre>
</div>
<!-- /wp:html -->

<!-- wp:paragraph -->
<p>間隔にばらつきがありますが、CloudSQLに共用のものを使っているためと思われます。軽い時は１秒間隔、重い時でも３秒とかですね。おおむね、問題ないかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なお最小インスタンス数は0に設定していました。また、この検証中のインスタンス数はつねに１で、思惑通りとなっています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>CloudRunでHasuraのサブスクリプションを使うのは、問題なさそうですね。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">小話</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>昔はよくわからず、味の素はダメだと思ってましたが、原材料はただのサトウキビだそうですね。私は美味しいものが好きなので、味の素大好きです。なおお店をしていた頃は、味の素の代わりに昆布茶粉末を使っていましたが、まぁそちらの方がクリーンなイメージがありますね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>589</wp:post_id>
		<wp:post_date><![CDATA[2024-02-28 08:22:12]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-02-27 23:22:12]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-02-28 08:24:23]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-02-27 23:24:23]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90hasura%e3%80%91cloud-run%e3%81%a7subscription%e3%81%af%e4%bd%bf%e3%81%88%e3%82%8b%e3%81%ae%e3%81%8b%e6%a4%9c%e8%a8%bc%e3%81%97%e3%81%a6%e3%81%bf%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="hasura"><![CDATA[Hasura]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【NestJS】nest startが遅いため、別の方法でスタートする]]></title>
		<link>https://www.masaakiota.net/2024/02/28/%e3%80%90nestjs%e3%80%91nest-start%e3%81%8c%e9%81%85%e3%81%84%e3%81%9f%e3%82%81%e3%80%81%e5%88%a5%e3%81%ae%e6%96%b9%e6%b3%95%e3%81%a7%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e3%81%99%e3%82%8b/</link>
		<pubDate>Wed, 28 Feb 2024 02:26:32 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=594</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">NestJSのスタートが遅い</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>NestJSを起動するには、以下のコマンドを用いるものと思っていました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npx nest start</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでも起動はするのですが、遅いです。HasuraやNextだと数秒で起動するのに対して、NestJSは十秒以上かかっていました。CloudRunで実行しているため、これは死活問題です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これではいけない。何気なくローカルでnest startを繰り返していると、あることに気づきました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>。。。あれ？distフォルダが再生成されてる？</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そうです。nest startはbuildから始まるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">直接起動する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そのため、以下のようにすれば起動を早くできます。まずあらかじめビルドします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">nest build</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>続いて、distフォルダにあるmain.jsを直接実行します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">node dist/src/main.js</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、起動が十以上秒早くなりました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>コーヒーが飲みたいです。コンビニで買ってこようと思います。いつものクラフト系で攻めようかと。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>594</wp:post_id>
		<wp:post_date><![CDATA[2024-02-28 11:26:32]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-02-28 02:26:32]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-02-28 11:30:34]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-02-28 02:30:34]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90nestjs%e3%80%91nest-start%e3%81%8c%e9%81%85%e3%81%84%e3%81%9f%e3%82%81%e3%80%81%e5%88%a5%e3%81%ae%e6%96%b9%e6%b3%95%e3%81%a7%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="nestjs"><![CDATA[NestJS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MUI】DataGridをlimit, offsetで使用する]]></title>
		<link>https://www.masaakiota.net/2024/03/23/%e3%80%90mui%e3%80%91datagrid%e3%82%92limit-offset%e3%81%a7%e4%bd%bf%e7%94%a8%e3%81%99%e3%82%8b%e6%99%82%e3%81%ae%e5%9f%ba%e6%9c%ac/</link>
		<pubDate>Fri, 22 Mar 2024 22:44:24 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=601</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">MUI DataGridのpagination</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>DataGridのpaginationは、0から始まる値が採用されており、プログラマーに親和性のある仕様となっています。余談ですが、同じMUIのPagenationでは、1から始まる仕様になっているため、混乱は避けられません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ただ0から始まるとはいえ、DataGridはpage, pageSizeが使用されています。データベース操作は基本的にはlimit, offsetですので、少し頭を回さないといけません。１度や２度ならいいのですが、何度もDataGridを使用する機会があると、paginationのためだけにここで無駄な時間を割くのは得策ではありません。そこで、ここにメモを残すことにしました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">DataGridをlimit, offsetで使用する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>具体的には、以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">"use client"

import { DataGrid, GridColDef, GridPaginationModel } from '@mui/x-data-grid';
import { useEffect, useState } from 'react';

type RowType = {
    id: number,
}

const ALL_ROWS: RowType[] = [...Array(1000)].map((_, index) => ({ id: index }))
const DEFAULT_LIMIT = 10;

const columns: GridColDef&lt;RowType>[] = [
    { field: 'id', headerName: 'ID', width: 200 },
]

export default function TestPage() {
    const [limit, setLimit] = useState(DEFAULT_LIMIT)
    const [offset, setOffset] = useState(0)
    const [rows, setRows] = useState&lt;RowType[]>([])

    useEffect(() => {
        const newRows = ALL_ROWS.slice(offset, offset + limit)
        setRows(newRows)
    }, [limit, offset]);

    return &lt;DataGrid
        rows={rows}
        columns={columns}
        paginationMode='server'
        onPaginationModelChange={({ page, pageSize }) => {
            setLimit(pageSize)
            setOffset(page * pageSize)
        }}
        paginationModel={{
            pageSize: limit,
            page: offset / limit
        }}
        rowCount={ALL_ROWS.length}
        pageSizeOptions={[5, 10, 50, 100]} // デフォルトリミットを含める必要がある
    />
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これが、limit, offsetでDataGridを運用する最低限のコードとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今はAIが発展してきていますが、プログラマーはいつ仕事を奪われるでしょう。まだしばらくは大丈夫でしょうか。GPT5が出てくると、ちょっとしたアプリなら知識がなくても作れるようになるかもしれませんね。ただ、音楽に関してはまだまだですね。はい（ドヤ）</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>601</wp:post_id>
		<wp:post_date><![CDATA[2024-03-23 07:44:24]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-03-22 22:44:24]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-03-23 07:52:44]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-03-22 22:52:44]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90mui%e3%80%91datagrid%e3%82%92limit-offset%e3%81%a7%e4%bd%bf%e7%94%a8%e3%81%99%e3%82%8b%e6%99%82%e3%81%ae%e5%9f%ba%e6%9c%ac]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mui"><![CDATA[MUI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Hasura】導入に際して気をつけること。DB設計など]]></title>
		<link>https://www.masaakiota.net/2024/03/24/%e3%80%90hasura%e3%80%91%e5%b0%8e%e5%85%a5%e3%81%ab%e9%9a%9b%e3%81%97%e3%81%a6%e6%b0%97%e3%82%92%e3%81%a4%e3%81%91%e3%82%8b%e3%81%93%e3%81%a8%e3%80%82db%e8%a8%ad%e8%a8%88%e3%81%aa%e3%81%a9/</link>
		<pubDate>Sat, 23 Mar 2024 16:18:02 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=606</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Hasura</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>HasuraはGraphQLを用いたエンドポイントを簡単に作成してくれます。具体的には以下の点で、優れていると考えられます。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>SubscriptionでDBの変更をリアルタイムで検知できる</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Permissionでロールベースなど細かい制御が可能</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>他にもいろいろあるかと思いますが、しばらく使ってみての所感では、特に上記の点で優れていると感じます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">導入に際して気をつけること</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Hasuraでは、特に以下の点に気をつける必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">ポリモーフィックは避ける</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ポリモーフィックはDB設計で、同じテーブル構造を使い回す手法です。例えばエンティティーAに関する翻訳と、エンティティーBに関する翻訳があったとします。翻訳テーブルは locale, key, textといった定番のフィールドがあるため、A, B共通で１つのテーブルを使いまわそうとするものです。以下のような具合です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">model PolyTranslation {
  id Int
  entityType String
  entityId Int
  locale String
  key String
  text String
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このようなテーブルを１つ作るだけで、entityTypeとentityIdの組み合わせで、A, B両方に対応できます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ただしこうしたポリモーフィックは、Hasuraでは向いていません。なぜならHasuraのPermissionはリレーションによって行います。そのため、リレーションがなければPermission機能を十分に発揮できないことになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ポリモーフィックに限らず、できるだけリレーションを繋げたDB設計にするのが望ましいです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">とにかくidフィールドをつける</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>idフィールドはテーブルに不要な場合があります。しかしHasuraでは大体は、Apollo Clientを使用することになるかと思います。Apollo Clientでは、idフィールドを使用して、キャッシュの調整を自動で行なってくれます。そのため、idがないとキャッシュ機能がうまくいかず、エラーメッセージが流れ続けることになります。idとするフィールド名を指定する方法もあるかもしれませんが、面倒なので最初から全てのテーブルにidフィールドをつけるのがいいかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以上、Hasura導入に際して気をつけるべき事象をまとめてみました。また気づいたことがありましたら、更新します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Youtubeで見たのですが、スターバックスはグァテマラブレンドだそうですね。私も店をやっていた頃は、最高級のグァテマラを少し混ぜていました。業者さんがだいぶ安くしてくれていたので助かりました。ただグァテマラだけだと、ちょっと物足りないんですよね。なのでブレンドが良い感じです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>606</wp:post_id>
		<wp:post_date><![CDATA[2024-03-24 01:18:02]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-03-23 16:18:02]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-03-24 01:19:33]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-03-23 16:19:33]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90hasura%e3%80%91%e5%b0%8e%e5%85%a5%e3%81%ab%e9%9a%9b%e3%81%97%e3%81%a6%e6%b0%97%e3%82%92%e3%81%a4%e3%81%91%e3%82%8b%e3%81%93%e3%81%a8%e3%80%82db%e8%a8%ad%e8%a8%88%e3%81%aa%e3%81%a9]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="hasura"><![CDATA[Hasura]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【NestJS】string-widthでERRO_REQUIRE_ESM]]></title>
		<link>https://www.masaakiota.net/2024/03/30/%e3%80%90nestjs%e3%80%91string-width%e3%81%a7erro_require_esm/</link>
		<pubDate>Sat, 30 Mar 2024 04:02:12 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=610</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">string-widthでエラー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>string-widthは、日本語を長さ２として数えてくれるパッケージです。これをNestJSで使おうとすると以下のエラーになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Error [ERR_REQUIRE_ESM]: require() of ES Module /xxx/node_modules/string-width/index.js from /xxx/node_modules/wrap-ansi/index.js not supported.
Instead change the require of /xxx/node_modules/string-width/index.js in /xxx/node_modules/wrap-ansi/index.js to a dynamic import() which is available in all CommonJS modules.</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>メッセージを見る限りでは、いじれない部分でエラーになっているようです。GPT4に聞いてもさっぱり解決せず、ネットサーフィンするとすぐに解決策が出てきました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下のissueが建てられています。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://github.com/yarnpkg/yarn/issues/8994#issuecomment-1926209717","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/yarnpkg/yarn/issues/8994#issuecomment-1926209717
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>これによると、以下のようにすればいいとのことでした。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">"dependencies": {
    "string-width": "4.2.3",
},
"resolutions": {
    "string-width": "4.2.3"
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>GPT4に聞いてみたところ、依存関係にあるパッケージに、強制的にver4.2.3を使うように指定しているそうです。これで解決しました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>たまにはゆっくりお菓子作りとかしてみたいです。最近は料理もまったくしなくなりました。カモン、時間。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>610</wp:post_id>
		<wp:post_date><![CDATA[2024-03-30 13:02:12]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-03-30 04:02:12]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-03-30 13:02:12]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-03-30 04:02:12]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90nestjs%e3%80%91string-width%e3%81%a7erro_require_esm]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="nestjs"><![CDATA[NestJS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_ba1f52b48da3b59e15a47297cb11f810]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/yarnpkg/yarn/issues/8994#issuecomment-1926209717">[Bug?]: Error [ERR_REQUIRE_ESM]: require() of ES Module string-width/index.js · Issue #8994 · yarnpkg/yarn</a></h4><p>Self-service I'd be willing to implement a fix Describe the bug Everything was working with string-width v3.2.3, until v5.0.1 was added to yarn.lock, after then I get: Error [ERR_REQUIRE_ESM]: require() of ES Module /node_modules/s...</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_ba1f52b48da3b59e15a47297cb11f810]]></wp:meta_key>
		<wp:meta_value><![CDATA[1711771135]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Git】よく使うGitコマンド（随時更新）]]></title>
		<link>https://www.masaakiota.net/2024/04/01/%e3%80%90git%e3%80%91%e3%82%88%e3%81%8f%e4%bd%bf%e3%81%86git%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89/</link>
		<pubDate>Mon, 01 Apr 2024 01:46:13 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=614</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Gitコマンド</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Gitは多人数で作業する方は多くのコマンドを使用することと思います。ただ私は基本的に一人で開発しているため、それほどGitに詳しくありません。せいぜいCursorのUIでプッシュする程度です。それでも必要なときにはGitコマンドを打つことがあり、GPT4に聞いています。ただ毎回聞いて確認してコマンドを打つのも非効率ですので、ここにメモも兼ねて書かせていただきます。このページは随時更新する予定です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">リセット</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>.gitignoreを途中で書き換えたりした場合、コミットするときに以前のファイルを参照しようとして警告が出てきます。放っておいてもいいのですが、以下のコマンドを使用することでリセットすることができます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">git rm -r --cached dist
git commit -m "distディレクトリをGitの追跡対象から削除"
git push</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>全てをリセットするだけなら、以下の様にもできます。.gitignoreを編集した後などに実行します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">git rm -r --cached .
git add .</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">シェルスクリプト</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下は、gitコマンドに関連するシェルスクリプトです。ほとんど自分の備忘用ですが、お役に立つこともあるかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">ビルドとプッシュ</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下はビルドにturboを使用した例です。コメントメッセージを渡して使用します。ビルドが成功すれば、そのままプッシュします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">if [ $# -eq 0 ]; then
    echo "コミットメッセージを入力してください"
    exit 1
fi

commit_message="$1"

if turbo run build; then # ビルドコマンド
    git add .
    git commit -m "$commit_message"
    git push
else
    echo "Build failed"
fi</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">タグ付け</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最新のタグを表示した後、新しくつけるタグを入力すれば、それをプッシュします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class=""># 最新のタグを取得
latest_tag=$(git describe --tags `git rev-list --tags --max-count=1`)

echo "最新のタグ: $latest_tag"

# 新しいタグを入力
read -p "新しいタグを入力してください: " new_tag

if [ -z "$new_tag" ]; then
    echo "タグを入力してください"
    exit 1
fi

# 新しいタグを作成してプッシュ
git tag "$new_tag"
git push origin "$new_tag"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>アイアンマンから見はじめて、エンドゲームで終わった感のあるマーベルですが、ジャービスが実現したらどうなるでしょう。プログラミングはもっと楽になり、一般の人が手軽にコンピュータに命令を打ち込む日もくるのでしょうか。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>614</wp:post_id>
		<wp:post_date><![CDATA[2024-04-01 10:46:13]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-04-01 01:46:13]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-06-24 09:33:09]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-06-24 00:33:09]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90git%e3%80%91%e3%82%88%e3%81%8f%e4%bd%bf%e3%81%86git%e3%82%b3%e3%83%9e%e3%83%b3%e3%83%89]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="git"><![CDATA[Git]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Hasura】hasura consoleでmigrationファイルが更新されない件]]></title>
		<link>https://www.masaakiota.net/2024/04/02/%e3%80%90hasura%e3%80%91hasura-console%e3%81%a7migration%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%81%8c%e6%9b%b4%e6%96%b0%e3%81%95%e3%82%8c%e3%81%aa%e3%81%84%e4%bb%b6/</link>
		<pubDate>Mon, 01 Apr 2024 15:59:41 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=616</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">hasura console</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>hasura cliを用いて以下のコマンドを実行すると、http://localhost:9695/consoleが立ち上がります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">hasura console</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここでテーブルなどを更新すると、migrationファイルが更新されるとのことです。なるほどそうかそうかと何度やっても更新されないので、途方に暮れていました。この原因が分かりましたので、共有させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">dokcer-compose.ymlと同じディレクトリで実行する必要がある</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>公式サイトを何度読んでもわからなかったのですが、ふとたどり着いたサイトでこのような記述を見つけました。つまり、以下の構成になります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">-- hasura
   -- docker-compose.yaml
   -- config.yaml</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここでhasura consoleを実行すると、無事テーブル変更がmigrationファイルに反映されるようになりました。なおdockerで起動している場合です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>お腹が空いて仕方がないので、何か食べようと思います。こどおじの私は、母の作ってくれるカレーが命綱です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>616</wp:post_id>
		<wp:post_date><![CDATA[2024-04-02 00:59:41]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-04-01 15:59:41]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-04-02 01:00:38]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-04-01 16:00:38]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90hasura%e3%80%91hasura-console%e3%81%a7migration%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%81%8c%e6%9b%b4%e6%96%b0%e3%81%95%e3%82%8c%e3%81%aa%e3%81%84%e4%bb%b6]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="hasura"><![CDATA[Hasura]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【SQL】便利なSQL命令文（随時更新）]]></title>
		<link>https://www.masaakiota.net/2024/04/02/%e3%80%90sql%e3%80%91%e4%be%bf%e5%88%a9%e3%81%aasql%e5%91%bd%e4%bb%a4%e6%96%87%ef%bc%88%e9%9a%8f%e6%99%82%e6%9b%b4%e6%96%b0%ef%bc%89/</link>
		<pubDate>Mon, 01 Apr 2024 17:39:45 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=621</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">SQL</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>SQLは普段使いません。普段はPrismaといったORMや、Hasuraなどを使っています。そのためSQLを使う必要が出てきたときに、毎回調べるというのがとても手間です。ChatGPTに聞けばいいのですが、それでもやはり備忘録として残してあとで参照したいなと。そういう思いで、このページは作成しています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">データベースをリセット</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>開発段階ではどうしても、データベースをリセットすることがあります。これまでPrismaが自動でリセットしてくれていたのですが、Hasuraに乗り換えたことでその恩恵を受けれなくなりました。ですのでSQLでデータベースをリセットしました。その時のコマンドです。ChatGPTに教えてもらいました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">DROP SCHEMA public CASCADE;
CREATE SCHEMA public;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これはpublicスキーマを落として、再生成しています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ベーシックインカムはまだでしょうか。早くロボットに全ての仕事を奪って欲しいです。いや、全てはダメですね。人にしかできない仕事が残るはずですので、そこで気張りたいです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>621</wp:post_id>
		<wp:post_date><![CDATA[2024-04-02 02:39:45]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-04-01 17:39:45]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-20 09:43:46]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-20 00:43:46]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90sql%e3%80%91%e4%be%bf%e5%88%a9%e3%81%aasql%e5%91%bd%e4%bb%a4%e6%96%87%ef%bc%88%e9%9a%8f%e6%99%82%e6%9b%b4%e6%96%b0%ef%bc%89]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="database"><![CDATA[Database]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【WordPress】プラグインContent Viewsのfilterフック一覧]]></title>
		<link>https://www.masaakiota.net/2024/04/25/%e3%80%90wordpress%e3%80%91%e3%83%97%e3%83%a9%e3%82%b0%e3%82%a4%e3%83%b3content-views%e3%81%aefilter%e3%83%95%e3%83%83%e3%82%af%e4%b8%80%e8%a6%a7/</link>
		<pubDate>Thu, 25 Apr 2024 03:13:57 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=626</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Content Viewsのfilterフック</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>必要があり、Content Viewsのfilterフックを抽出してみました。本当は色々なプラグインに対応可能な抽出スクリプトを書きたかったのですが、どうも時間がかかりそうでしたので、適当にスクリプトを組んで修正してといった方法で行いました。Content Views 3.7.1です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なお、すべてにPrefixである「pt_cv_」がつきます。例えば</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>2col_nowrap_fields  =&gt;  pt_cv_2col_nowrap_fields</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>といった具合です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">2col_nowrap_fields<br>advanced_settings_panel<br>after_limit_option<br>after_trim_words<br>all_display_settings<br>allowable_tags<br>assets_files<br>author_avatar_size<br>author_settings<br>before_generate_excerpt<br>before_output_html<br>before_trim_words<br>block_attributes<br>block_attrs<br>block_editor_output<br>block_fields<br>block_generated_css<br>block_img_size<br>block_localize_data<br>block_settings<br>btn_more_html<br>check_duplicate<br>collapsible_filters<br>collapsible_open_all<br>comments_count<br>content_item_class<br>content_item_filter_value<br>content_items<br>content_items_wrap<br>content_no_post_found_class<br>content_no_post_found_text<br>content_settings<br>contenttype_setting<br>current_postid<br>custom_filters<br>damaged_style<br>dargs_hybrid<br>dargs_others<br>default_enqueue_assets<br>default_image<br>defined_in_class<br>disable_child_shortcode<br>disable_responsive_image<br>display_settings<br>display_what<br>excerpt_extra_settings<br>excerpt_html<br>excerpt_strip_all_shortcodes<br>excerpt_strip_shortcode<br>exclude_block_show_field<br>exclude_extra_settings<br>field_comment_html<br>field_content_class<br>field_content_excerpt<br>field_content_final<br>field_content_full<br>field_content_readmore_class<br>field_content_readmore_enable<br>field_content_readmore_seperated<br>field_content_setting_values<br>field_content_tag<br>field_display<br>field_display_settings<br>field_excerpt_dots<br>field_href<br>field_href_attrs<br>field_href_class<br>field_item_html<br>field_meta_author_html<br>field_meta_class<br>field_meta_date_final<br>field_meta_date_format<br>field_meta_fields_class<br>field_meta_fields_setting_values<br>field_meta_fields_tag<br>field_meta_merge_fields<br>field_meta_prefix_text<br>field_meta_seperator<br>field_settings<br>field_term_html<br>field_thumbnail_class<br>field_thumbnail_dimension_output<br>field_thumbnail_image<br>field_thumbnail_image_html<br>field_thumbnail_nolink<br>field_thumbnail_not_found<br>field_thumbnail_setting_values<br>field_thumbnail_settings<br>field_thumbnail_sizes<br>field_title_class<br>field_title_final<br>field_title_result<br>field_title_setting_values<br>field_title_tag<br>fields_html<br>filter_title_tag<br>force_replace_thumbnail<br>format_settings<br>found_posts<br>frontend_assets_fields<br>full_content_notice<br>heading_settings<br>hide_empty_result<br>hierarchical_post_type<br>hybrid_layouts<br>ignore_sticky_posts<br>include_children<br>include_extra_settings<br>inline_view_style<br>is_mobile<br>item_<br>item_col_class<br>item_final_html<br>item_per_row<br>layout_extra_settings<br>layout_format<br>layout_format_depend<br>link_html<br>loading_image<br>loading_image_url<br>mapping_settings<br>mapping_value<br>maybe_translate<br>meta_field_html<br>metafield_extra_settings<br>metafield_extra_settings_2<br>metafield_hybrid<br>modify_post_url<br>more_responsive_settings<br>open_in<br>options_description<br>order_setting<br>orderby<br>orders<br>other_settings<br>output_view_style<br>overlay_exclude<br>page_attr<br>page_class<br>pages_to_show<br>pagination_class<br>pagination_data<br>pagination_label<br>pagination_link_format<br>pagination_output<br>pagination_params_removed<br>pagination_settings<br>pagination_styles<br>pagination_text<br>pagination_types<br>post__not_in<br>post_parent_id<br>post_parent_settings<br>post_status<br>post_term<br>post_term_html<br>post_terms_output<br>post_type<br>post_types<br>post_types_list<br>post_types_taxonomies<br>ppp_settings<br>pre_save_view_data<br>prevent_broken_excerpt<br>preview_settings<br>public_localize_script_extra<br>query_parameters<br>query_params<br>readmore_extra_settings<br>regular_orderby<br>reset_query<br>responsive_columns<br>row_wrap<br>script_in_footer<br>scripts_priority<br>scrollable_caption_class<br>scrollable_class<br>scrollable_content_class<br>scrollable_fields_enable<br>scrollable_interval<br>scrollable_slide_class<br>scrollable_toggle_icon<br>search_settings<br>searchby_keyword_desc<br>select_term_class<br>selected_terms<br>set_atts_from_view<br>set_atts_to_view<br>set_current_page<br>set_view_settings<br>setting_parent_page<br>setting_post_in<br>setting_post_not_in<br>settings_args_limit<br>settings_args_offset<br>settings_other<br>settings_page_field_sanitize<br>settings_page_section_one<br>settings_page_section_two<br>settings_pagination<br>settings_sort<br>settings_sort_single<br>settings_sort_text<br>settings_taxonomies_display<br>settings_title_display<br>shortcode_params<br>shortcode_to_strip<br>show_pagination<br>show_this_post<br>span_class<br>sticky_posts_setting<br>strip_tags<br>tag_to_remove<br>tax_list<br>taxonomies_custom_settings<br>taxonomies_to_show<br>taxonomy_query_args<br>taxonomy_setting<br>taxonomy_settings<br>terms_args<br>terms_include_this<br>thumbnail_position<br>thumbnail_position_depend<br>thumbnail_position_extra<br>topmeta_settings<br>topmeta_show<br>total_posts<br>trim_excerpt<br>trim_words_number<br>user_list<br>validate_settings<br>view_actions<br>view_all_output<br>view_class<br>view_content<br>view_executed<br>view_html<br>view_layout<br>view_link_args<br>view_post_id<br>view_row_actions<br>view_settings<br>view_shortcode_output<br>view_type<br>view_type_asset<br>view_type_custom_output<br>view_type_dir<br>view_type_dir_special<br>view_type_file<br>view_type_settings<br>view_type_settings_collapsible_184<br>view_type_settings_grid<br>view_type_settings_scrollable<br>view_version<br>viewtype_setting<br>wpautop<br>wrap_in_page<br>wrapper_class<br>wrapper_collapsible_class</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ローソンの、ボスコーヒーファームのラテが好きで毎日飲んでいたのですが、さすがに飲みすぎました。コーヒーファームのラテは、かなり甘いのですが、その分味がはっきりわかって好みだったんですけどね。ちょっと甘いものばかりだと体もしんどくなってしまうということで。ただブラックも飲み過ぎるとしんどいので、何かいい飲み物はないかと考えています。ミネラルウォーターは。。。買うくらいなら水道水を飲むかなと。。。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>626</wp:post_id>
		<wp:post_date><![CDATA[2024-04-25 12:13:57]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-04-25 03:13:57]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-04-25 12:19:47]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-04-25 03:19:47]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90wordpress%e3%80%91%e3%83%97%e3%83%a9%e3%82%b0%e3%82%a4%e3%83%b3content-views%e3%81%aefilter%e3%83%95%e3%83%83%e3%82%af%e4%b8%80%e8%a6%a7]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="wordpress"><![CDATA[WordPress]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】bcryptのラウンド数による処理時間の計測]]></title>
		<link>https://www.masaakiota.net/2024/04/28/%e3%80%90node-js%e3%80%91bcrypt%e3%81%ae%e3%83%a9%e3%82%a6%e3%83%b3%e3%83%89%e6%95%b0%e3%81%ab%e3%82%88%e3%82%8b%e5%87%a6%e7%90%86%e6%99%82%e9%96%93%e3%81%ae%e8%a8%88%e6%b8%ac/</link>
		<pubDate>Sun, 28 Apr 2024 06:51:26 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=629</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">bcryptでのラウンド数</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ユーザーのパスワードをDBに保存する場合に、一度ハッシュ化する必要があります。その際のセキュリティを向上させるために、ソルトを用いるのですが、bcryptライブラリでは、ラウンド数を指定するだけで勝手に良いようにやってくれるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ラウンド数が増えるほどセキュリティは向上しますが、その分処理時間が増えます。というより、処理時間がかかるからこそのセキュリティの向上ですが。生成に時間がかかると、悪意ある攻撃者に万が一ハッシュ値が漏れてしまった場合に、攻撃者がパスワードを検証する時間が増えるためです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">計測してみた</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>bcryptでのラウンド数ごとに計測してみました。なお現実的に使用する可能性のある範囲のみで行なっています。GPT4が生成したコードそのままです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>*使用プラグインのバグか、正常に表示されないため、言語指定を外しています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>コード</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="" class="">const bcrypt = require('bcrypt');<br>const password = 'examplePassword';<br><br>async function hashPassword(rounds) {<br>    const start = Date.now();<br>    const hash = await bcrypt.hash(password, rounds);<br>    const end = Date.now();<br>    return end - start; // 処理時間をミリ秒で返す<br>}<br><br>async function compareRounds() {<br>    const times = [];<br>    for (let rounds = 1; rounds &lt;= 15; rounds++) {<br>        const time = await hashPassword(rounds);<br>        times.push({ rounds, time });<br>    }<br>    return times;<br>}<br><br>compareRounds().then((times) => {<br>    console.log('各ラウンド数の処理時間:', times);<br>});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>結果（Mac M2）</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="" class="">各ラウンド数の処理時間: [<br>  { rounds: 1, time: 1 },<br>  { rounds: 2, time: 1 },<br>  { rounds: 3, time: 1 },<br>  { rounds: 4, time: 1 },<br>  { rounds: 5, time: 2 },<br>  { rounds: 6, time: 3 },<br>  { rounds: 7, time: 6 },<br>  { rounds: 8, time: 13 },<br>  { rounds: 9, time: 26 },<br>  { rounds: 10, time: 50 },<br>  { rounds: 11, time: 101 },<br>  { rounds: 12, time: 202 },<br>  { rounds: 13, time: 403 },<br>  { rounds: 14, time: 807 },<br>  { rounds: 15, time: 1631 }<br>]</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>一般的には10が使用されるようですが、CPUも進歩していっているので、12あたりを使用しようと考えています。サーバースペックにもよりますが、これくらいなら12でも良さそうかなと思っています。15はさすがに厳しいですね。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>一時期チューハイにハマったのですが、今はウィスキーにハマっています。チューハイはやっぱり糖分が気になりますね。その点、ウィスキーなら糖分なしでちびちび行けるので、いいなと。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>629</wp:post_id>
		<wp:post_date><![CDATA[2024-04-28 15:51:26]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-04-28 06:51:26]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:19:53]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:19:53]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node-js%e3%80%91bcrypt%e3%81%ae%e3%83%a9%e3%82%a6%e3%83%b3%e3%83%89%e6%95%b0%e3%81%ab%e3%82%88%e3%82%8b%e5%87%a6%e7%90%86%e6%99%82%e9%96%93%e3%81%ae%e8%a8%88%e6%b8%ac]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GAS】TypeScriptソースをjsに含める]]></title>
		<link>https://www.masaakiota.net/2024/05/25/%e3%80%90gas%e3%80%91typescript%e3%82%bd%e3%83%bc%e3%82%b9%e3%82%92js%e3%81%ab%e5%90%ab%e3%82%81%e3%82%8b/</link>
		<pubDate>Sat, 25 May 2024 13:04:20 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=649</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GASでTypeScriptを使う</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GASは基本的には、ウェブ上でJavaScriptを書く仕様となっています。しかしclaspというツールを使えば、ローカルで開発することが可能です。さらにTypeScriptでJSに変換し、pushすることもできるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">問題点</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>claspでGAS開発を行う場合、いろいろと問題点があります。そのうちの一つが、TypeScriptのソースが実行環境で失われると言う点です。コンパイル後のJSのみをpushするため当然なのですが。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そのため過去に開発した、あるいは誰かによって開発されたGASをいじるときに、JSしかないため苦労することになります。JSのまま開発を進めるか、TypeScriptに書き直して進めるかの選択を迫られることになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>それを回避するため、TypeScriptのソースをJSに含める方法を考えてみました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">TypeScriptソースをコメントとしてJSに含める</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>TypeScriptコンパイル時に、元のソースをコメントとして出力するようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>必要なのはGAS開発に必要な最低限のパッケージに加え、ttscが必要です。package.jsonは以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre title="package.json" class="wp-block-code"><code lang="" class="">{<br>  "dependencies": {},<br>  "devDependencies": {<br>    "@types/google-apps-script": "^1.0.83",<br>    "ts-node": "^10.9.2",<br>    "ttsc": "^0.3.1",<br>    "typescript": "^5.4.5"<br>  }<br>}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>transformer.tsを作成します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">import * as ts from 'typescript';<br><br>const PRE = '\n\n\n// *** typescript *** //\n\n';<br><br>function addSourceCodeAsComment(context: ts.TransformationContext) {<br>    return (sourceFile: ts.SourceFile) => {<br>        const sourceText = sourceFile.text;<br>        const commentText =<br>            PRE +<br>            sourceText<br>                .split('\n')<br>                .map((line) => `// ${line}`)<br>                .join('\n');<br>        const comment = ts.addSyntheticTrailingComment(<br>            sourceFile.statements[sourceFile.statements.length - 1],<br>            ts.SyntaxKind.SingleLineCommentTrivia,<br>            `\n${commentText}\n`,<br>            true<br>        );<br>        const visitor: ts.Visitor = (node) => {<br>            return ts.visitEachChild(node, visitor, context);<br>        };<br>        return ts.visitNode(sourceFile, visitor);<br>    };<br>}<br><br>export default function transformer(program: ts.Program) {<br>    return (context: ts.TransformationContext) => {<br>        return addSourceCodeAsComment(context);<br>    };<br>}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>tsconfig.jsonを以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">{<br>    "compilerOptions": {<br>        "target": "ES2020",<br>        "module": "commonjs",<br>        "rootDir": "./src",<br>        "outDir": "./dist",<br>        "esModuleInterop": true,<br>        "forceConsistentCasingInFileNames": true,<br>        "strict": true,<br>        "skipLibCheck": true,<br>        "plugins": [<br>            {<br>                "transform": "./transformer.ts",<br>            }<br>        ]<br>    },<br>    "include": [<br>        "src/**/*.ts"<br>    ],<br>}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、以下のコマンドを実行すれば、TypeScriptのコンパイルと同時にソースコードがコメントとして含まれるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npx ttsc</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>紅茶花伝のロイヤルミルクティーにハマってます。ドラッグストアで安く売ってるので重宝していたのですが、最近売り切れが続いていて、代わりにレモンティーを買っています。寂しいです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>649</wp:post_id>
		<wp:post_date><![CDATA[2024-05-25 22:04:20]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-05-25 13:04:20]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-05-25 22:04:21]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-05-25 13:04:21]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gas%e3%80%91typescript%e3%82%bd%e3%83%bc%e3%82%b9%e3%82%92js%e3%81%ab%e5%90%ab%e3%82%81%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Hasura】Apollo+ReactでRoleを変更する]]></title>
		<link>https://www.masaakiota.net/2024/06/01/%e3%80%90hasura%e3%80%91apolloreact%e3%81%a7role%e3%82%92%e5%a4%89%e6%9b%b4%e3%81%99%e3%82%8b/</link>
		<pubDate>Sat, 01 Jun 2024 12:33:31 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=653</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">HasuraでのApollo</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ApolloはHasuraで使用できるクライアントライブラリの一つです。Reactのフックなども使用できて、大変便利です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ApolloでのRole設定</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ApolloをReactで使用する場合、通常はProviderを通します。ルートでクライアントを初期化して使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const client = useMemo(() =&gt; {
    // ここでApolloClientを作成する
}, [])

return &lt;ApolloProvider client={client}&gt;
        {children}
&lt;/ApolloProvider&gt;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>Roleも通常、ここで定義します。この後でRoleを変更する場合、QueryとSubscriptionとでやり方が異なってきますので、それを書かせていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">QueryでのRole変更</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Queryの場合、Contextを用いてRoleを変更します。具体的には以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const { data, refetch } = useQuery(xxx, {
    variables: {},
    context: {role: UserRole.Manager },
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記のように設定したコンテキストは、Apolloのリンクで処理します。そのリンクは以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const authLink = setContext(async (operation, previousContext) =&gt; {
    const headers = previousContext.headers;
    const ctx = previousContext;

    // ここでコンテキストからroleを取得できる
    let role = ctx.role || UserRole.Anonymous;

    return {
        headers: {
            ...headers,
            'x-hasura-role': role,
        },
    };
});</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">SubscriptionでのRole変更</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>一方Subscriptionだとコンテキストが使用できません。そのため新しくクライアントを作成して対応します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const client = useMemo(() =&gt; {
    // ここで、新しくRoleを設定したクライアントを作成する
}, []);

const { data } = useSubscription(xxx, {
    variables: {},
    client,
})</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以上、QueryとSubscriptionでのRole変更の違いについてでした。これに気づくまでSubscriptionでのRole変更方法がわからず、Queryと併用したりしていました。ですがこの方法なら、Subscriptionだけで楽に書けそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>少し前まで紅茶花伝のロイヤルミルクティーにハマっていました。ただ飲みやすさを優先しているのか、ちょっとミルクが多くてシャバシャバしてる気がします。今はドトールの直火焙煎カフェオレにハマってます。美味しいです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>653</wp:post_id>
		<wp:post_date><![CDATA[2024-06-01 21:33:31]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-06-01 12:33:31]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-06-01 21:37:34]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-06-01 12:37:34]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90hasura%e3%80%91apolloreact%e3%81%a7role%e3%82%92%e5%a4%89%e6%9b%b4%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="hasura"><![CDATA[Hasura]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[yarn turboをバージョンアップしたら、.envを読み込まなくなったから。。。]]></title>
		<link>https://www.masaakiota.net/2024/06/05/yarn-turbo%e3%82%92%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e3%82%a2%e3%83%83%e3%83%97%e3%81%97%e3%81%9f%e3%82%89%e3%80%81-env%e3%82%92%e8%aa%ad%e3%81%bf%e8%be%bc%e3%81%be%e3%81%aa%e3%81%8f/</link>
		<pubDate>Tue, 04 Jun 2024 21:47:13 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=660</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">yarn turbo</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>turboはyarnでモノレポ環境を構築する時に役立ちます。具体的には、ルートディレクトリでturboを実行すれば、それに属するパッケージの複数のコマンドを実行できます。そのためバックエンドやフロントエンド、ライブラリなどを全て一度にビルドや実行できたりします。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://classic.yarnpkg.com/en/package/turbo","type":"rich","providerNameSlug":"yarn"} -->
<figure class="wp-block-embed is-type-rich is-provider-yarn wp-block-embed-yarn"><div class="wp-block-embed__wrapper">
https://classic.yarnpkg.com/en/package/turbo
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2 class="wp-block-heading">バージョンアップしたら.envを読めなくなった</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>面倒くさがりですので、.envはルートに置いて、全てのパッケージからそれを読み込む構造にしていました。本番環境はCloud Runですので、環境変数はWeb UIでポチポチと入力するスタイルです。そのため、それで特に問題もないです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>turbo@1.11.2の時には、以下のようにしていました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">export $(cat .env | xargs)
turbo run dev</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>無理矢理な方法なのか実行するたびにワーニングは出ていましたが、動くには動いていました。ターミナルで環境変数を展開して、コマンドを実行すると言った形ですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ところがturbo@2.0.1にした途端、動かなくなりました。とにかく以下のようにしてエラーを解消していきました。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>turbo.jsonの何かのキーをtasksに変更した</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>パッケージ内のそれぞれのyarn.lockファイルを消して、それぞれのディレクトリでyarn installした。yarn.lockはそこでは生成されなかったがおそらくルートでまとめられている</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>上記のようにしてエラーを解消していったのですが、最後に残ったのが環境変数問題です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>どうやら新しいバージョンでは、turbo run前にターミナルで展開した環境変数が無視されるようです。packageそれぞれで環境変数を読み込むロジックをつけないといけないようでした。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこで、以下のようにしました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">package.jsonの中身

{
  "scripts":[
    "dev": "dotenv -e ../../.env -- next dev -p 3001",
  ]
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これは、next実行前にdotenvで環境変数を読み込んでいます。turbo実行前に読み込んだ環境変数は無視されますが、packageそれぞれで読み込んだ環境変数は正常に使用することができます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これで、turbo問題が解決しました。なお公式の説明では、.envファイルが更新された時にハッシュ値を更新するために、turbo.jsonに.envの場所を書くように勧められています。今回のことに関係あるのかないのかは定かではありませんが、備忘録として残させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>なか卯の親子丼が生命線です。最近は鶏の照り焼き丼が美味しいので、マヨネーズをつけるかどうか、あるいは親子丼か、いつも迷っています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>660</wp:post_id>
		<wp:post_date><![CDATA[2024-06-05 06:47:13]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-06-04 21:47:13]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-06-05 06:53:46]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-06-04 21:53:46]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[yarn-turbo%e3%82%92%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e3%82%a2%e3%83%83%e3%83%97%e3%81%97%e3%81%9f%e3%82%89%e3%80%81-env%e3%82%92%e8%aa%ad%e3%81%bf%e8%be%bc%e3%81%be%e3%81%aa%e3%81%8f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="uncategorized"><![CDATA[未分類]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_c30df982f509646f237ac6762a703dfb]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://classic.yarnpkg.com/en/package/turbo">turbo</a></h4><p>Turborepo is a high-performance build system for JavaScript and TypeScript codebases.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_c30df982f509646f237ac6762a703dfb]]></wp:meta_key>
		<wp:meta_value><![CDATA[1717538027]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Quill】&lt;p>&lt;br>&lt;/p>を抑制する]]></title>
		<link>https://www.masaakiota.net/2024/06/13/%e3%80%90quill%e3%80%91pbr-p%e3%82%92%e6%8a%91%e5%88%b6%e3%81%99%e3%82%8b/</link>
		<pubDate>Wed, 12 Jun 2024 22:31:34 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=666</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Quill</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>QuillはNodeで使用できるWSYSIGエディタです。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://quilljs.com","type":"rich","providerNameSlug":"quill"} -->
<figure class="wp-block-embed is-type-rich is-provider-quill wp-block-embed-quill"><div class="wp-block-embed__wrapper">
https://quilljs.com
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2 class="wp-block-heading">問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>編集時に返ってくるHTMLに、なぜか不要な&lt;p&gt;&lt;br&gt;&lt;/p&gt;が入ってきます。エディタで編集した以上の数が入ってきます。そのためHTMLをサーバーに保存した後、再度表示すると、余計な&lt;p&gt;&lt;br&gt;&lt;/p&gt;のために空行が増えているという現象が起きていました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下の様にすることで、余分な&lt;p&gt;&lt;br&gt;&lt;/p&gt;が入らない様になりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">import ReactQuill from 'react-quill';

&lt;ReactQuill
  modules={{
    clipboard: {
      matchVisual: false
    }
  }}
  ... // 他のプロパティ
/></code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>朝コンビニから帰ってくると、家の前に猫がいました。私が見ても逃げ出さず、憎たらしい目でこちらを見てました。猫を飼う気はないんですよねー。うーむ。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>666</wp:post_id>
		<wp:post_date><![CDATA[2024-06-13 07:31:34]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-06-12 22:31:34]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:16:31]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:16:31]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90quill%e3%80%91pbr-p%e3%82%92%e6%8a%91%e5%88%b6%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_722a3b9226727efe148d95fe70485f19]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://quilljs.com">Quill - Your powerful rich text editor</a></h4><p>Quill is a free, open source WYSIWYG editor built for the modern web. Completely customize it for any need with its modular architecture and expressive API.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_722a3b9226727efe148d95fe70485f19]]></wp:meta_key>
		<wp:meta_value><![CDATA[1718231174]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GAS】doPostで受け取れる最大文字数を調べてみた]]></title>
		<link>https://www.masaakiota.net/2024/06/18/%e3%80%90gas%e3%80%91dopost%e3%81%a7%e5%8f%97%e3%81%91%e5%8f%96%e3%82%8c%e3%82%8b%e6%9c%80%e5%a4%a7%e6%96%87%e5%ad%97%e6%95%b0%e3%82%92%e8%aa%bf%e3%81%b9%e3%81%a6%e3%81%bf%e3%81%9f/</link>
		<pubDate>Tue, 18 Jun 2024 02:49:42 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=671</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GASのdoPost</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GASではウェブアプリ化してデータを受け取り、色々と処理できる様になる機能があります。ところが画像を受け取ることができない様で、画像を受け取るにはBase64エンコードしないといけない様です。しかしそうするとデータ量が膨大になりますので、はたしてどこまでできるのかを知るべく検証しました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">検証コード</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のコードを用いました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>GAS</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">function doPost(e) {
  addLog(JSON.stringify({
    length: e.postData.length,
  }))
}

function addLog(str) {
  const sheet = SpreadsheetApp.getActiveSpreadsheet().getSheetByName('ログ');
  sheet.appendRow([str]);
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>送信側</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">const url = ''; // デプロイしたURL
const length = 0; // 検証サイズ

fetch(url, {
  method: 'post',
  mode: 'no-cors',
  body: 'a'.repeat(length),
});</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">結果</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>1000*1000*10までは送信できることが確認できました。1000*1000*100だと413エラーでした。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>このことから、10M文字数までは送信できる様です。Base64エンコードすると133%になるそうですので、画像だと7.5MBほどでしょうか。思ったより少ないですね。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近は暑いので、ペットボトルは質より量です。コーヒーも、なるべく大きいのを買ってます。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>671</wp:post_id>
		<wp:post_date><![CDATA[2024-06-18 11:49:42]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-06-18 02:49:42]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-06-18 11:49:43]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-06-18 02:49:43]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gas%e3%80%91dopost%e3%81%a7%e5%8f%97%e3%81%91%e5%8f%96%e3%82%8c%e3%82%8b%e6%9c%80%e5%a4%a7%e6%96%87%e5%ad%97%e6%95%b0%e3%82%92%e8%aa%bf%e3%81%b9%e3%81%a6%e3%81%bf%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Prisma】Prismaで気をつけること]]></title>
		<link>https://www.masaakiota.net/2024/06/24/%e3%80%90prisma%e3%80%91prisma%e3%81%a7%e6%b0%97%e3%82%92%e3%81%a4%e3%81%91%e3%82%8b%e3%81%93%e3%81%a8/</link>
		<pubDate>Mon, 24 Jun 2024 02:16:31 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=677</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Prisma</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Prismaは、TypeScriptで使えるORMです。スキーマ設計からマイグレーション、また簡単な関数でデータアクセスや更新が行えます。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.prisma.io","type":"rich","providerNameSlug":"prisma"} -->
<figure class="wp-block-embed is-type-rich is-provider-prisma wp-block-embed-prisma"><div class="wp-block-embed__wrapper">
https://www.prisma.io
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2 class="wp-block-heading">気をつけること</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回は、そんなPrismaを使用していて気になった点を書いてみます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">v5.15.1時点で、JOINは内部で行われない</h3>
<!-- /wp:heading -->

<!-- wp:heading {"level":4} -->
<h4 class="wp-block-heading">内部的JOINはv5.8.0でPreview版</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>先に申し上げると、v5.8.0からはPreview版で、PostgreSQLで内部的にJOINを用いたクエリを投げることはできます。5.10.0からはMySQLにも対応している様です。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.prisma.io/docs/orm/prisma-client/queries/relation-queries","type":"rich","providerNameSlug":"prisma"} -->
<figure class="wp-block-embed is-type-rich is-provider-prisma wp-block-embed-prisma"><div class="wp-block-embed__wrapper">
https://www.prisma.io/docs/orm/prisma-client/queries/relation-queries
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading {"level":4} -->
<h4 class="wp-block-heading">基本的には内部でJOINは使われない</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>上記はあくまでPreview版なので、本番では使わない方がいいかもしれません。このPreview版機能を使用せずに、JOINのような機能を使うと以下の様になります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">const users = await prisma.user.findMany({
  include: {
    posts: true,
  },
})</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを実行すると、まるでJOINしたかのような結果が返ってきます。しかし実際にはJOINは使われておらず、複数のSQL文が発行されます。そのためパフォーマンスは落ちることになります。速度重視の部分ではRawクエリで対応するとこになります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Transactionは必要最低限にする</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Prismaでは、以下の様にTransaction内で実行することができます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">await prisma.$transaction(async (tx) =&gt; {
    // Code running in a transaction...
})</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>整合性が担保されるため非常に良いのですが、中で時間がかかると複数アクセスですぐにエラーが発生します。トランザクションを持てる数が制限されているためです。この数は設定で変えれるのですが、トランザクションは本当に必要最低限にした方が良さそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ずいぶん暑くなってきました。エアコンは冷えすぎるので使いたくないのですが、そうも言ってられない時が近づいてきています。。。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>677</wp:post_id>
		<wp:post_date><![CDATA[2024-06-24 11:16:31]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-06-24 02:16:31]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-06-24 12:32:26]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-06-24 03:32:26]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90prisma%e3%80%91prisma%e3%81%a7%e6%b0%97%e3%82%92%e3%81%a4%e3%81%91%e3%82%8b%e3%81%93%e3%81%a8]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="prisma"><![CDATA[Prisma]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_26b77e093558b08e084e7a833d48fe26]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://www.prisma.io/">Prisma | Simplify working and interacting with databases</a></h4><p>Build, fortify, and grow your application easily with an intuitive data model, type-safety, automated migrations, connection pooling, caching, and real-time database subscriptions.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_26b77e093558b08e084e7a833d48fe26]]></wp:meta_key>
		<wp:meta_value><![CDATA[1719194622]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_e1a0ccf3cd6212c92f34d579b51d5246]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://www.prisma.io/docs/orm/prisma-client/queries/relation-queries">Relation queries (Concepts) | Prisma Documentation</a></h4><p>Prisma Client provides convenient queries for working with relations, such as a fluent API, nested writes (transactions), nested reads and relation filters.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_e1a0ccf3cd6212c92f34d579b51d5246]]></wp:meta_key>
		<wp:meta_value><![CDATA[1719194863]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_eb8cb92b47250889967e89a56957ed61]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://www.prisma.io">Prisma | Simplify working and interacting with databases</a></h4><p>Build, fortify, and grow your application easily with an intuitive data model, type-safety, automated migrations, connection pooling, caching, and real-time database subscriptions.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_eb8cb92b47250889967e89a56957ed61]]></wp:meta_key>
		<wp:meta_value><![CDATA[1719195426]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【WordPress】credentialsだけではrestを叩けなかった話]]></title>
		<link>https://www.masaakiota.net/2024/06/26/%e3%80%90wordpress%e3%80%91credentials%e3%81%a0%e3%81%91%e3%81%a7%e3%81%afrest%e3%82%92%e5%8f%a9%e3%81%91%e3%81%aa%e3%81%8b%e3%81%a3%e3%81%9f%e8%a9%b1/</link>
		<pubDate>Tue, 25 Jun 2024 23:33:04 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=682</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">WordPressのRest API</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>WordPressではRest APIが用意されており、また自分で作成することもできます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回、以下の様に作成しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">class SimpleApi
{
    public function __construct($key, $useGroup)
    {
        add_action('rest_api_init', array($this, 'register_routes'));
    }

    public function register_routes()
    {
        register_rest_route("xxx", "/yyy",  array(
            'methods' =&gt; 'POST',
            'callback' =&gt; array($this, 'post_action'),
            'permission_callback' =&gt; function ($request) {
                return current_user_can('edit_posts');
            },
        ));
    }

    ...</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>パーミッションで、編集権限のあるユーザーのみ可能としています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">fetchで弾かれる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>これで、以下の様にすればいけるはずです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">fetch(url, {
    method: 'post',
    credentials: 'same-origin'
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>Chromeの開発コンソールで確認すると、確かにクッキーが送信されています。でもなぜか、認証されてないと言われてしまいました。試しにapiの中でユーザー情報を取得してみると、ログインしてないようです。。。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">nonceを入れてみた</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>gpt4先生も当てにならないもので、結構時間がかかってしまいました。httpsじゃないといけないのか、apiパスを?rest_route=形式でやっているのがまずいのか、いまいちわかりません。httpsを試すのは結構手間だし、パスはパーマリンク設定関連で本番で面倒なことになるかもしれないし。原因調査は諦めて、とりあえず何か認証情報を入れたらいけるだろうとやってみたら、いけました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下の様に、nonceを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">wp_create_nonce('wp_rest')</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これをJavaScriptに渡して、以下の様にfetchします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">fetch(url, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'X-WP-Nonce': nonce
    },
    body: JSON.stringify(items),
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでいけました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>消費税、いまさらだけども、高くないですか？高すぎませんか。。。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>682</wp:post_id>
		<wp:post_date><![CDATA[2024-06-26 08:33:04]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-06-25 23:33:04]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-06-28 01:21:02]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-06-27 16:21:02]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90wordpress%e3%80%91credentials%e3%81%a0%e3%81%91%e3%81%a7%e3%81%afrest%e3%82%92%e5%8f%a9%e3%81%91%e3%81%aa%e3%81%8b%e3%81%a3%e3%81%9f%e8%a9%b1]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="wordpress"><![CDATA[WordPress]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【PHP】array_filter後は連想配列になったりならなかったり]]></title>
		<link>https://www.masaakiota.net/2024/06/26/%e3%80%90php%e3%80%91array_filter%e5%be%8c%e3%81%af%e9%80%a3%e6%83%b3%e9%85%8d%e5%88%97%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%9f%e3%82%8a%e3%81%aa%e3%82%89%e3%81%aa%e3%81%8b%e3%81%a3%e3%81%9f%e3%82%8a/</link>
		<pubDate>Wed, 26 Jun 2024 03:46:34 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=686</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">PHPのarray_filter</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>PHPでは、配列のフィルターを以下の様にします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">$newArray = array_filter($array, function($item){
    return $item-&gt;isEnabled;
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここで気をつけなければいけないのが、PHPは連続した配列と連想配列とが区別がつきません。そしてarray_filterを使った後、キーの連続性が失われなければ連続した配列のままですが、連続性が失われれば勝手に連想配列にされます。発狂しそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこで以下の様にします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">$newArray = array_filter($array, function($item){
    return $item-&gt;isEnabled;
});
$newArray = array_values($newArray);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでとりえあず、連続した配列が担保されます。もうPHP触りたくないです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>一時期ウィスキーにハマっていたのですが、いつのまにか飲まなくなってました。デスクの上に、いつまでも使われないおしゃれグラスが鎮座しています。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>686</wp:post_id>
		<wp:post_date><![CDATA[2024-06-26 12:46:34]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-06-26 03:46:34]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-06-26 12:47:54]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-06-26 03:47:54]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90php%e3%80%91array_filter%e5%be%8c%e3%81%af%e9%80%a3%e6%83%b3%e9%85%8d%e5%88%97%e3%81%ab%e3%81%aa%e3%81%a3%e3%81%9f%e3%82%8a%e3%81%aa%e3%82%89%e3%81%aa%e3%81%8b%e3%81%a3%e3%81%9f%e3%82%8a]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="php"><![CDATA[PHP]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【PHP】Undefined type 'Google_Service_Calendar']]></title>
		<link>https://www.masaakiota.net/2024/06/29/%e3%80%90php%e3%80%91undefined-type-google_service_calendar/</link>
		<pubDate>Sat, 29 Jun 2024 08:00:39 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=696</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">実行できるのに。。。</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、実行はできるのにシンタックスでエラーになる現象がありました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>具体的には、以下のコードです。インターネッツを参照して作成したコードです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">&lt;?php

require __DIR__ . "/vendor/autoload.php";

use Google_Service_Calendar

var_dump(Google_Service_Calendar::CALENDAR_READONLY);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>GPT先生も当てにならない。と思いきや、何度か聴いてると答えを出してくれました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下の様に書かないといけない様です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">&lt;?php

require __DIR__ . "/vendor/autoload.php";

use Google\Service\Calendar;

var_dump(Calendar::CALENDAR_READONLY);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ライブラリのバージョンアップに伴って、書き方が変わっていた様です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>好きな音楽を聞いてる時が幸せです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>696</wp:post_id>
		<wp:post_date><![CDATA[2024-06-29 17:00:39]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-06-29 08:00:39]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-06-29 17:01:07]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-06-29 08:01:07]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90php%e3%80%91undefined-type-google_service_calendar]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="php"><![CDATA[PHP]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Docker】PHP FastCGI環境を構築する]]></title>
		<link>https://www.masaakiota.net/2024/07/09/%e3%80%90docker%e3%80%91php-fastcgi%e7%92%b0%e5%a2%83%e3%82%92%e6%a7%8b%e7%af%89%e3%81%99%e3%82%8b/</link>
		<pubDate>Tue, 09 Jul 2024 13:44:23 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=702</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">PHP FastCGI</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>PHPは割と昔からある言語で、私は大学時代にお世話になっていました。Perlから移行したこともあり、その使いやすさに嬉しかったのを覚えています。そんなPHPも、今やだいぶレガシーな言語となりました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そんなPHPでは、FastCGIというものがあります。通常はサーバーリクエストがあった時に逐一コード解釈から走るのですが、FastCGIだとそうではなく、もにょもにょして早さを実現している、と言うものだったと思います（うろ覚え）</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Dockerで構築する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下は、PHP + FastCGI + Apache構成です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="docker" class="language-docker">version: '3.8'

services:
  web:
    image: php:8.1-fpm
    volumes:
      - ../public_html:/var/www/html/wp_dev_blog
    networks:
      - xs_network

  apache:
    image: httpd:2.4
    ports:
      - "80:80"
    volumes:
      - ../public_html:/var/www/html/wp_dev_blog
      - ./apache-config.conf:/usr/local/apache2/conf/httpd.conf
    networks:
      - xs_network

networks:
  xs_network:
    driver: bridge</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ポイントは、phpとapacheとでpublic_htmlディレクトリのフルパスを合わせると言うところですね。ここを合わせないと、phpにアクセスした時にFile not foundになってしまいます。これはphp-fpmに処理を渡したものの、フルパスが違うためにphp-fpmがFilen not foundを返してしまうためです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下はapache-config.confの中身です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="apacheconf" class="language-apacheconf">ServerRoot "/usr/local/apache2"
Listen 80
LoadModule mpm_event_module modules/mod_mpm_event.so
LoadModule authn_core_module modules/mod_authn_core.so
LoadModule authz_core_module modules/mod_authz_core.so
LoadModule unixd_module modules/mod_unixd.so
LoadModule dir_module modules/mod_dir.so
LoadModule mime_module modules/mod_mime.so
LoadModule proxy_module modules/mod_proxy.so
LoadModule proxy_fcgi_module modules/mod_proxy_fcgi.so

ServerName localhost

DocumentRoot "/var/www/html/wp_dev_blog"
&lt;Directory "/var/www/html/wp_dev_blog">
    AllowOverride None
    Require all granted
&lt;/Directory>

&lt;FilesMatch \.php$>
    SetHandler "proxy:fcgi://xserver_php_fpm:9000"
&lt;/FilesMatch>

DirectoryIndex index.php index.html</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近、なか卯のカレーにハマってます。カツも何も入れずに、ただただ大盛りで頼んでます。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>702</wp:post_id>
		<wp:post_date><![CDATA[2024-07-09 22:44:23]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-07-09 13:44:23]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-07-09 22:44:24]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-07-09 13:44:24]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90docker%e3%80%91php-fastcgi%e7%92%b0%e5%a2%83%e3%82%92%e6%a7%8b%e7%af%89%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="docker"><![CDATA[Docker]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Yarn】Could not load the "sharp" module using the darwin-arm64 runtime]]></title>
		<link>https://www.masaakiota.net/2024/07/10/%e3%80%90yarn%e3%80%91could-not-load-the-sharp-module-using-the-darwin-arm64-runtime/</link>
		<pubDate>Wed, 10 Jul 2024 10:16:06 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=704</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Mac M2でsharpが使えない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>sharpはnode.jsで使える画像ライブラリです。yarnでインストールしようとしたところ、以下のエラーが出ました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Could not load the "sharp" module using the darwin-arm64 runtime</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下の様にすることで解決しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">yarn add sharp --ignore-engines</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下を参考にしています。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://sharp.pixelplumbing.com/install","type":"rich","providerNameSlug":"pixelplumbing"} -->
<figure class="wp-block-embed is-type-rich is-provider-pixelplumbing wp-block-embed-pixelplumbing"><div class="wp-block-embed__wrapper">
https://sharp.pixelplumbing.com/install
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>ちなみにこれ以外に、brewでvipsを削除すると言う方法もありましたが、私のマシンではそもそもvipsが入っていませんでした。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Mac Siliconは、色々と問題がありますね。AIチップが流通したら、さらにややこしいことになってきそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>暑いですが、時々雨が降ってくれるのはありがたいですね。といっても、すでに完全防御モードで、エアコン部屋にこもりっきりですが。。。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>704</wp:post_id>
		<wp:post_date><![CDATA[2024-07-10 19:16:06]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-07-10 10:16:06]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-07-10 19:16:08]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-07-10 10:16:08]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90yarn%e3%80%91could-not-load-the-sharp-module-using-the-darwin-arm64-runtime]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="uncategorized"><![CDATA[未分類]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_fdc28cae23b8420306dd01b51b393e0e]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://sharp.pixelplumbing.com/install">sharp - High performance Node.js image processing</a></h4><p>Resize large images in common formats to smaller, web-friendly JPEG, PNG, WebP, GIF and AVIF images of varying dimensions</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_fdc28cae23b8420306dd01b51b393e0e]]></wp:meta_key>
		<wp:meta_value><![CDATA[1720606416]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【asdf】no such file or directory: /xxx/.asdf/asdf.sh]]></title>
		<link>https://www.masaakiota.net/2024/07/13/%e3%80%90asdf%e3%80%91no-such-file-or-directory-xxx-asdf-asdf-sh/</link>
		<pubDate>Fri, 12 Jul 2024 15:22:17 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=706</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">asdf</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>asdfは、node, php, などのバージョン管理ツールです。Macだとnodeなどはbrewでインストールするかと思いますが、これだとバージョンが固定されてしまいます。そのため、asdfなどを使用します。ちなみにasdf以外だと、Dockerでもプロジェクトごとにバージョンを変えれますね。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">.asdf/asdf.shが見つからない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>前のMacでFlutter開発をしていたのですが、少し前にPCを買い替えた時に環境は引き継がなかったので、今回Flutterをインストールしようとしました。Rubyのバージョンが低いと言われたので、asdfでRubyをバージョンアップしたのですが、globalで最新バージョンが適用されない。そこでasdf公式サイトに記載のあった、以下のラインを.zshrcに追記しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">. "$HOME/.asdf/asdf.sh"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>すると以下のエラーになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">no such file or directory: /xxx/.asdf/asdf.sh</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>確認すると確かにこのファイルは存在しません。なぜだろうと。公式サイトに記載のあるこのパスが存在しないのはなぜだろうと、GPT先生に聞いても解決しなかったのですが、原因はbrewでした。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回asdfをbrewでインストールしていたのですが、そうするとパスがgitでインストールする場合と異なる様です。そして、公式サイトで紹介されていたのは、gitでインストールした場合のパスだったようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>brewでasdfをインストールした場合の、正しいパスは以下になります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">. /opt/homebrew/opt/asdf/libexec/asdf.sh</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで動く様になりました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ドラッグストアってペットボトル安いのは、なぜなんでしょう。コンビニに比べてかなり安いですよね。収益を得る部分が違うのでしょうか。そういえば、コンビニコーヒーが安いのは、コーヒー以外で儲けているためだと聞いた様な。。。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>706</wp:post_id>
		<wp:post_date><![CDATA[2024-07-13 00:22:17]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-07-12 15:22:17]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-07-13 00:22:17]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-07-12 15:22:17]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90asdf%e3%80%91no-such-file-or-directory-xxx-asdf-asdf-sh]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="uncategorized"><![CDATA[未分類]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GCP】Quota 'SSL_CERTIFICATES' exceeded. Limit: 10.0 globally.]]></title>
		<link>https://www.masaakiota.net/2024/07/22/%e3%80%90gcp%e3%80%91quota-ssl_certificates-exceeded-limit-10-0-globally/</link>
		<pubDate>Sun, 21 Jul 2024 22:18:08 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=709</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GCPでSSLの割り当て上限</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回Cloud Runでドメインを割り当てていました。Cloud Runの画面で、カスタムドメインを管理から、簡単に行えます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>簡単に行えるがために、何度も割り当てを変更したりしていたら、タイトルの通り上限に引っかかってしまったというお話です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>というのも、思いつきでサブドメインの順番を変えてみたところ、いやこれだとクッキーのドメイン指定で詰まるなと戻してみたところ、あれそもそもその部分は対策済みだよね、やっぱり最初の思いつき通り変更しよう =&gt; 上限</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>といった具合でした。すると無駄なSSLが残ってしまった様です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>リソースの検索で「SSL」と入力すると、不採用にしたSSLが残っており、削除しようとしても使用中とのことでできませんでした。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">原因</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>いまだに原因ははっきりしませんが、おそらく何度も変更を繰り返すうち、デッドロック的な状態になったのではないかと思います。私のプロジェクトではSSL証明書の上限は10なのですが、そのうち8を使用しています。さらにその中で4つを前述の通り何度もいじったものだから、生成中のSSLと新規SSLとでデッドロック的になり、進めなくなったのではないかと。イメージです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>解決としましては、とりあえず一旦カスタムドメインのいくつかを削除しました。すると残ってしまっていたSSLも消えてくれましたので、無事回復することができました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近はミルクティーにはまってます。一気に飲むとちょっと牛乳ぽさが際立ってしまいますので、ちびちび行っています。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>709</wp:post_id>
		<wp:post_date><![CDATA[2024-07-22 07:18:08]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-07-21 22:18:08]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-07-22 07:19:45]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-07-21 22:19:45]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gcp%e3%80%91quota-ssl_certificates-exceeded-limit-10-0-globally]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gcp"><![CDATA[Google Cloud]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】APIでのValidateエラー時に302になる問題]]></title>
		<link>https://www.masaakiota.net/2024/07/30/%e3%80%90laravel%e3%80%91api%e3%81%a7%e3%81%aevalidate%e3%82%a8%e3%83%a9%e3%83%bc%e6%99%82%e3%81%ab302%e3%81%ab%e3%81%aa%e3%82%8b%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Mon, 29 Jul 2024 18:30:59 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=716</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは！フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Laravel API Validateで302になる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>LaravelではValidate機能があり、リクエストデータを簡単に検証できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">$data = $request->validate([
  'name' => 'required|string|max:255',
  ...
]);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>大変便利なのですが、エラー時になぜか302が返ってしまいます。そうするとエラーメッセージも捕捉できなくなってしまいます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下の様にすると302にならず、直接エラーメッセージを返すことができます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">try{
  $data = $request->validate([
    'name' => 'required|string|max:255',
    ...
  ]);
}catch(\Exception $e){
  return response()->json([
    'message' => $e->getMessage(),
    'error' => 'valiidation error',
  ],Response::HTTP_BAD_REQUEST);
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Middlewareで行う</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ただ上記と毎回書くのが面倒なので、Middlewareに入れてしまいます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">class HandleApiErrors
{
    public function handle(Request $request, Closure $next): Response
    {
        try {
            return $next($request);
        } catch (\Illuminate\Validation\ValidationException $e) {
            return response()->json([
                'message' => $e->getMessage(),
                'error' => 'Bad Request'
            ], Response::HTTP_BAD_REQUEST);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>しかしこれだけでは、また302が返ってしまいます。どうやらapiとしてアクセスしているかどうかの判定があるようで、apiではないと判定されると302になってしまうようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこで以下の行を追加します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">$request->headers->set('Accept', 'application/json');</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでapiとして認識され、302にならなくなります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>眠いです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>716</wp:post_id>
		<wp:post_date><![CDATA[2024-07-30 03:30:59]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-07-29 18:30:59]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-07-30 03:32:59]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-07-29 18:32:59]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91api%e3%81%a7%e3%81%aevalidate%e3%82%a8%e3%83%a9%e3%83%bc%e6%99%82%e3%81%ab302%e3%81%ab%e3%81%aa%e3%82%8b%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】Undefined type 'Intervention\Image\Facades\Image']]></title>
		<link>https://www.masaakiota.net/2024/07/30/%e3%80%90laravel%e3%80%91undefined-type-interventionimagefacadesimage/</link>
		<pubDate>Tue, 30 Jul 2024 00:36:48 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=719</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは！フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Laravelで画像リサイズをしたい</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GPTさんにお伺いしたところ、Intervention/Imageを使用すると良いよとのことでした。さっそくcomposerして使用したのですが、下記のエラーが出ます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">【Laravel】Undefined type 'Intervention\Image\Facades\Image'</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>どないせいちゅうねん。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ライブラリアップデートのため、Laravel用にインストールする必要がある</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記に記載されていました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://image.intervention.io/v3/introduction/frameworks","type":"rich","providerNameSlug":"intervention"} -->
<figure class="wp-block-embed is-type-rich is-provider-intervention wp-block-embed-intervention"><div class="wp-block-embed__wrapper">
https://image.intervention.io/v3/introduction/frameworks
</div><figcaption class="wp-element-caption">具体的には以下の様になります。</figcaption></figure>
<!-- /wp:embed -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">composer require intervention/image-laravel
php artisan vendor:publish --provider="Intervention\Image\Laravel\ServiceProvider"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>使用方法は以下です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">use Intervention\Image\Laravel\Facades\Image;

Route::get('/', function () {
    $image = Image::read('images/example.jpg');
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>IT業界は日々変化しますねー。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最近なか卯の朝食の味噌汁が薄い気がします。材料をケチっているのか、あるいは単なるミスなのか。もうちょっと濃いのが個人的には好みなので、なか卯さんには是非とももう少し濃くしていただけると嬉しいなと。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>719</wp:post_id>
		<wp:post_date><![CDATA[2024-07-30 09:36:48]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-07-30 00:36:48]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-07-30 09:37:34]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-07-30 00:37:34]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91undefined-type-interventionimagefacadesimage]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_def10a0f779b6601c6f2ad1b6b62f534]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://image.intervention.io/v3/introduction/frameworks">Framework Integration | Intervention Image v3 | intervention.io</a></h4><p>Intervention Image provides an easy way to manipulate images with PHP using the GD or Imagick library.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_def10a0f779b6601c6f2ad1b6b62f534]]></wp:meta_key>
		<wp:meta_value><![CDATA[1722299427]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】lazy導入で画面遷移しなくなった話]]></title>
		<link>https://www.masaakiota.net/2024/08/15/%e3%80%90react%e3%80%91lazy%e5%b0%8e%e5%85%a5%e3%81%a7%e7%94%bb%e9%9d%a2%e9%81%b7%e7%a7%bb%e3%81%97%e3%81%aa%e3%81%8f%e3%81%aa%e3%81%a3%e3%81%9f%e8%a9%b1/</link>
		<pubDate>Thu, 15 Aug 2024 14:23:58 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=725</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">lazyローディング</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Reactで開発すると、通常はすべてのページがバンドルされ、ファイルサイズが膨大になります。それを防ぐため、逐一必要な部分だけロードするのがlazyです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">const MyComponent = React.lazy(() => import('./MyComponent.tsx'));</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このようにすることで、必要な時だけロードされるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Routerで画面遷移しなくなった</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにすると、画面遷移しなくなりました。再読み込みしないと画面が表示されないといった状態です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">const SuperAdminIndex = React.lazy(() => import('./pages/superadmin'));
const TenantAdminIndex = React.lazy(() => import('./pages/admin'));
const AuthIndex = React.lazy(() => import('./pages/auth'));
const TicketsIndex = React.lazy(() => import('./pages/tickets'));

const container = document.getElementById('app');
const root = createRoot(container!);

root.render(
&lt;BrowserRouter>
    &lt;Routes>
        &lt;Route path="/" Component={TopPage} />
        &lt;Route path="/auth/*" Component={AuthIndex} />
        &lt;Route path="/super_admin" Component={SuperAdminIndex} />
        &lt;Route path="/admin/:tenantId/*" Component={TenantAdminIndex} />
        &lt;Route path="/tickets/:ticketCode/*" Component={TicketsIndex} />
    &lt;/Routes>
&lt;/BrowserRouter></code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Suspenseを入れると解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>原因はよくわかってないのですが、とりあえずChatGPT先生に聞いたところ、Suspense入れたら？とのことでしたので以下のようにSuspenseを入れました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">const SuperAdminIndex = React.lazy(() => import('./pages/superadmin'));
const TenantAdminIndex = React.lazy(() => import('./pages/admin'));
const AuthIndex = React.lazy(() => import('./pages/auth'));
const TicketsIndex = React.lazy(() => import('./pages/tickets'));

const container = document.getElementById('app');
const root = createRoot(container!);

root.render(
&lt;BrowserRouter>
    &lt;Suspense fallback={&lt;div>Loading...&lt;/div>}>
        &lt;Routes>
            &lt;Route path="/" Component={TopPage} />
            &lt;Route path="/auth/*" Component={AuthIndex} />
            &lt;Route path="/super_admin" Component={SuperAdminIndex} />
            &lt;Route path="/admin/:tenantId/*" Component={TenantAdminIndex} />
            &lt;Route path="/tickets/:ticketCode/*" Component={TicketsIndex} />
        &lt;/ROutes>
    &lt;/Suspense>
&lt;/BrowserRouter></code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>とりあえずこれで、画面遷移するようになりました。ChatGPT先生もたまには役に立ちますね。いやかなりお世話になってます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">余談</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ChatGPTは、見当違いの回答をしてきたりすることもあり結構しんどいこともあるのですが、基本的にはかなり助かってます。GPT5が早く出ないかなと待ち望んでます。そうするとエンジニアの仕事はかなり減ってしまいそうですが。。。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>725</wp:post_id>
		<wp:post_date><![CDATA[2024-08-15 23:23:58]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-08-15 14:23:58]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-08-15 23:23:59]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-08-15 14:23:59]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91lazy%e5%b0%8e%e5%85%a5%e3%81%a7%e7%94%bb%e9%9d%a2%e9%81%b7%e7%a7%bb%e3%81%97%e3%81%aa%e3%81%8f%e3%81%aa%e3%81%a3%e3%81%9f%e8%a9%b1]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】テーブルリストを取得する]]></title>
		<link>https://www.masaakiota.net/2024/10/04/%e3%80%90laravel%e3%80%91%e3%83%86%e3%83%bc%e3%83%96%e3%83%ab%e3%83%aa%e3%82%b9%e3%83%88%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b/</link>
		<pubDate>Fri, 04 Oct 2024 04:02:43 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=728</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Laravelでテーブル一覧を取得する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>テーブル一覧取得は、以下のSQLコマンドで行えます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">SHOW TABLES</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これをLaravelで書くと、</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">use Illuminate\Support\Facades\DB;

$tables = DB::select('SHOW TABLES');</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>となります。返り値にDB名が含まれているため、欲しいDBのテーブルを抽出します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">$tables = array_map(function ($table) {
    $key = 'Tables_in_' . env('DB_DATABASE');
    return $table-&gt;$key ?? null;
}, $tables);
$tables = array_filter($tables);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでテーブル一覧を取得できました。特定のカラムを持つものを抽出する場合は、さらに以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">use Illuminate\Support\Facades\Schema;

$tables = array_filter($tables, function ($table) {
    return Schema::hasColumn($table, 'user_id');
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このあたり、ChatGPT様だけに頼ってると痛い目を見ますね。結局自分で検索した方が、正しい情報に辿り着けることも多いです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>728</wp:post_id>
		<wp:post_date><![CDATA[2024-10-04 13:02:43]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-10-04 04:02:43]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-10-04 13:03:37]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-10-04 04:03:37]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91%e3%83%86%e3%83%bc%e3%83%96%e3%83%ab%e3%83%aa%e3%82%b9%e3%83%88%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】InertiaとAPIとを共存させる]]></title>
		<link>https://www.masaakiota.net/2024/10/09/%e3%80%90laravel%e3%80%91inertia%e3%81%a8api%e3%81%a8%e3%82%92%e5%85%b1%e5%ad%98%e3%81%95%e3%81%9b%e3%82%8b/</link>
		<pubDate>Wed, 09 Oct 2024 09:41:17 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=732</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Inertia</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>InertiaはLaravelで使える機能で、サーバーサイドとクライアントサイドとの結合を密にすることができます。具体的には、データを直接Reactなどのコンポーネントに渡せます。フックも使えるため、かなり便利ではあります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ただデメリットもあります。APIとして使おうとした時に、標準でHTMLが出力されてしまうために、APIルートを別途用意しなければいけません。これがどうも受け入れられなかったため、すったもんだした挙句下記の方法を思いつきました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">APIと共存させる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>APIとして使用する場合は、ヘッダーでJSONをリクエストするように設定します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">headers:{accept:'application/json'}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>axiosなど使用するクライアントでの初期設定に、上記ヘッダーを指定します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>次にLaravelではコントローラーで以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php"> public function index(Request $request)
    {
        $data = ...
        return $request->expectsJson()
            ? $data
            : Inertia::render(
                'Xxx/Yyy',
                $data,
            );
    }</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>InertiaとAPIでエンドポイントを共有化できました。こうすることで、コードの大幅な削減が実現できます。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>732</wp:post_id>
		<wp:post_date><![CDATA[2024-10-09 18:41:17]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-10-09 09:41:17]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-10-13 15:22:55]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-10-13 06:22:55]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91inertia%e3%81%a8api%e3%81%a8%e3%82%92%e5%85%b1%e5%ad%98%e3%81%95%e3%81%9b%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="inertia"><![CDATA[Inertia]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Inertia】ブラウザバックでrouterでの自動更新を行う]]></title>
		<link>https://www.masaakiota.net/2024/10/13/%e3%80%90inertia%e3%80%91%e3%83%96%e3%83%a9%e3%82%a6%e3%82%b6%e3%83%90%e3%83%83%e3%82%af%e3%81%a7router%e3%81%a7%e3%81%ae%e8%87%aa%e5%8b%95%e6%9b%b4%e6%96%b0%e3%82%92%e8%a1%8c%e3%81%86/</link>
		<pubDate>Sun, 13 Oct 2024 06:20:08 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=734</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Inertiaでのデータ更新周り</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Inertiaでは、主にusePageでデータを処理します。これはレンダリング時にサーバーから直接データをもらえるので、便利です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ところが色々な問題もあります。今回はブラウザバック周りの問題をあげます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">サーバーでリダイレクトしてみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>アイテムリストを表示しているページから、新しくデータを作成する時に、サーバーサイドで以下のようにリダイレクトしたとします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">public function store(Request $request)
{
    ...
    return to_route('xxx.show', $xxx);
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>無事新しいデータのページにリダイレクトされるのですが、ここからブラウザバックで戻ると、データが更新されず、古い状態の表示がされてしまいます。せっかくデータを追加したのに、追加されていないかのようになってしまいます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">リダイレクトをなくしてみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>それを防ぐため、リダイレクトをなくしてみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">public function store(Request $request)
{
    ...
    return back();
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、新しくデータを追加したことがアイテムリストに反映されます。場合によってはこれで良いのですが、paginationを使っていると、例えば２ページ目を表示している時にアイテムを追加すると、追加されたアイテムが表示されないといった事象が発生します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">リダイレクトした上で、ブラウザバック時にリロードしてみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そこで以下のように、ブラウザバック時に自動で更新するようにしてみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">window.addEventListener('popstate', ()=>{
    window.location.reload();
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、新しく追加したデータのページに移動した上で、ブラウザバックした時には自動更新されるようになりました。ユーザー体験にはだいぶ向上したかと思います。ですが更新表示がスムーズではないため、inertiaの機能でリロードしてみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">window.addEventListener('popstate', ()=>{
    router.reload();
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで良いはず。。。と思ったのも束の間、正常にブラウザバックできません。これは困りました。これまでにあげてきた方法のどれかを選ばないといけないのか、しばらく頭を悩ませていたのですが、以下のようにすることで解決しました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">リダイレクトした上でブラウザバック時にsetTimeoutでInertiaリロードする</h2>
<!-- /wp:heading -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">window.addEventListener('popstate', ()=>{
    setTimeout(()=>{
        router.reload();
    }, 10);
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>setTimeoutでスレッドを変更することで、routerでも正常にリロードできるようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>734</wp:post_id>
		<wp:post_date><![CDATA[2024-10-13 15:20:08]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-10-13 06:20:08]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-10-13 15:20:09]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-10-13 06:20:09]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90inertia%e3%80%91%e3%83%96%e3%83%a9%e3%82%a6%e3%82%b6%e3%83%90%e3%83%83%e3%82%af%e3%81%a7router%e3%81%a7%e3%81%ae%e8%87%aa%e5%8b%95%e6%9b%b4%e6%96%b0%e3%82%92%e8%a1%8c%e3%81%86]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="inertia"><![CDATA[Inertia]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】コンポーネントをそのまま表も含めてPDFに変換する]]></title>
		<link>https://www.masaakiota.net/2024/10/14/%e3%80%90react%e3%80%91%e8%a1%a8%e7%a4%ba%e3%82%92%e3%81%9d%e3%81%ae%e3%81%be%e3%81%bepdf%e3%81%ab%e5%a4%89%e6%8f%9b%e3%81%99%e3%82%8b/</link>
		<pubDate>Sun, 13 Oct 2024 18:16:47 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=737</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">jsPDF</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>jsPDFは、クライアントサイドでPDFを作成できるライブラリです。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://github.com/parallax/jsPDF","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/parallax/jsPDF
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>htmlからも作成できるため、表などが簡単に作れます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">参考サイト</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のサイトを参考にさせていただきました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://qiita.com/niyu1103/items/ed4941ddc7689df771dd","type":"rich","providerNameSlug":"qiita"} -->
<figure class="wp-block-embed is-type-rich is-provider-qiita wp-block-embed-qiita"><div class="wp-block-embed__wrapper">
https://qiita.com/niyu1103/items/ed4941ddc7689df771dd
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2 class="wp-block-heading">手順</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">フォントをセットアップする</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下より、フォントをjsに変換します。今回はNoto Sans JPを使用しました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://rawgit.com/MrRio/jsPDF/master/fontconverter/fontconverter.html","type":"rich","providerNameSlug":"rawgit"} -->
<figure class="wp-block-embed is-type-rich is-provider-rawgit wp-block-embed-rawgit"><div class="wp-block-embed__wrapper">
https://rawgit.com/MrRio/jsPDF/master/fontconverter/fontconverter.html
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>変換したjsを下記のようにインポートします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">import "./NotoSansJP-Regular-normal";</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでフォントセットアップ完了です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">コンポーネントを作る</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>再利用を考慮して、子要素全てをPDFにする形としました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">import PictureAsPdfIcon from '@mui/icons-material/PictureAsPdf';
import { Box, Button } from "@mui/material";
import { jsPDF } from "jspdf";
import { useRef } from "react";
import "./NotoSansJP-Regular-normal";

const FONT = "NotoSansJP-Regular";

type Props = {
    children: React.ReactNode;
}

export function PdfContainer(props: Props) {
    const { children } = props;
    const targetRef = useRef&lt;HTMLDivElement&gt;(null);
    const pdfRef = useRef(new jsPDF());

    function getFileName() {
        const timestamp = new Date().getTime();
        return `download_${timestamp}.pdf`;
    };

    function savePdf() {
        if (!targetRef.current) return;
        pdfRef.current.html(targetRef.current, {
            callback(doc) {
                const fileName = getFileName();
                doc.setFont(FONT, "normal");
                doc.setFontSize(12);
                doc.save(fileName);
            },
            x: 15,
            y: 15,
            width: 170,
            windowWidth: 775,
        });
    };

    return &lt;Box sx={{ border: "1px solid #aaa", padding: 2 }}&gt;
        &lt;Button variant="contained" onClick={savePdf}&gt;
            &lt;PictureAsPdfIcon fontSize='small' /&gt;
            PDFを保存
        &lt;/Button&gt;
        &lt;Box sx={{ '&amp; *': { fontFamily: FONT } }} ref={targetRef}&gt;
            {children}
        &lt;/Box&gt;
    &lt;/Box&gt;
};</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">試してみる</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のコードで試してみます。ChatGPT出力をそのまま使っているため、重複が半端ないです。実際にはMuiのstyledなどを使ってスリムにできます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">export function PdfContainerSample() {
    return &lt;PdfContainer&gt;
        &lt;h1&gt;PDF Container Sample&lt;/h1&gt;
        &lt;p&gt;これはPDFコンテナのサンプルです。&lt;/p&gt;
        &lt;table style={{ borderCollapse: 'collapse', width: '100%' }}&gt;
            &lt;thead&gt;
                &lt;tr&gt;
                    &lt;th style={{ border: '1px solid black', padding: '8px' }}&gt;項目&lt;/th&gt;
                    &lt;th style={{ border: '1px solid black', padding: '8px' }}&gt;説明&lt;/th&gt;
                    &lt;th style={{ border: '1px solid black', padding: '8px' }}&gt;値&lt;/th&gt;
                &lt;/tr&gt;
            &lt;/thead&gt;
            &lt;tbody&gt;
                &lt;tr&gt;
                    &lt;td style={{ border: '1px solid black', padding: '8px' }}&gt;サンプル1&lt;/td&gt;
                    &lt;td style={{ border: '1px solid black', padding: '8px' }}&gt;これはサンプル1の説明です。&lt;/td&gt;
                    &lt;td style={{ border: '1px solid black', padding: '8px' }}&gt;100&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td style={{ border: '1px solid black', padding: '8px' }}&gt;サンプル2&lt;/td&gt;
                    &lt;td style={{ border: '1px solid black', padding: '8px' }}&gt;これはサンプル2の説明です。&lt;/td&gt;
                    &lt;td style={{ border: '1px solid black', padding: '8px' }}&gt;200&lt;/td&gt;
                &lt;/tr&gt;
                &lt;tr&gt;
                    &lt;td style={{ border: '1px solid black', padding: '8px' }}&gt;サンプル3&lt;/td&gt;
                    &lt;td style={{ border: '1px solid black', padding: '8px' }}&gt;これはサンプル3の説明です。&lt;/td&gt;
                    &lt;td style={{ border: '1px solid black', padding: '8px' }}&gt;300&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/tbody&gt;
        &lt;/table&gt;
    &lt;/PdfContainer&gt;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>結果以下のようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4 class="wp-block-heading">ブラウザ表示</h4>
<!-- /wp:heading -->

<!-- wp:image {"id":738,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="http://35.221.87.155/wp-content/uploads/2024/10/スクリーンショット-2024-10-14-3.07.46-1024x354.png" alt="" class="wp-image-738"/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":4} -->
<h4 class="wp-block-heading">PDF表示</h4>
<!-- /wp:heading -->

<!-- wp:image {"id":739,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="http://35.221.87.155/wp-content/uploads/2024/10/スクリーンショット-2024-10-14-3.08.22-1024x319.png" alt="" class="wp-image-739"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>ちょっとずれてますね。本番では細かな修正が必要そうです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>737</wp:post_id>
		<wp:post_date><![CDATA[2024-10-14 03:16:47]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-10-13 18:16:47]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-10-14 03:23:32]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-10-13 18:23:32]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91%e8%a1%a8%e7%a4%ba%e3%82%92%e3%81%9d%e3%81%ae%e3%81%be%e3%81%bepdf%e3%81%ab%e5%a4%89%e6%8f%9b%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_9196aa6719f3bc75d1c6dd1b68db9226]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/parallax/jsPDF">GitHub - parallax/jsPDF: Client-side JavaScript PDF generation for everyone.</a></h4><p>Client-side JavaScript PDF generation for everyone. - parallax/jsPDF</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_9196aa6719f3bc75d1c6dd1b68db9226]]></wp:meta_key>
		<wp:meta_value><![CDATA[1728843813]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_898dd4c7edc186d64ee677a0fcd78af3]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://qiita.com/niyu1103/items/ed4941ddc7689df771dd">jsPDFで日本語対応したPDFを作成する方法（テーブルもあり） - Qiita</a></h4><p>やりたいこと・ReactプロジェクトでDOM描画したものをそのままPDF化したい・画像PDFではなく、テキストのPDFにしたい参考にしたサイトhttps://blog.capilano-fw...</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_898dd4c7edc186d64ee677a0fcd78af3]]></wp:meta_key>
		<wp:meta_value><![CDATA[1728843813]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_189dd86e4d2da8579e5c9dba914c732c]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://rawgit.com/MrRio/jsPDF/master/fontconverter/fontconverter.html">No Title</a></h4><p>No Description</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_189dd86e4d2da8579e5c9dba914c732c]]></wp:meta_key>
		<wp:meta_value><![CDATA[1728843813]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】User IDをULIDに変更すると、419 PAGE EXPIREDが出るようになった]]></title>
		<link>https://www.masaakiota.net/2024/10/16/%e3%80%90laravel%e3%80%91user-id%e3%82%92ulid%e3%81%ab%e5%a4%89%e6%9b%b4%e3%81%99%e3%82%8b%e3%81%a8%e3%80%81419-page-expired%e3%81%8c%e5%87%ba%e3%82%8b%e3%82%88%e3%81%86%e3%81%ab%e3%81%aa%e3%81%a3/</link>
		<pubDate>Tue, 15 Oct 2024 18:36:28 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=746</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ULID</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ULIDは時間に応じたランダムな文字列で、バッティングがない（理論的に極めて確率が低い）とされています。そのため例えば、クライアントサイドでULIDを生成して、それをレコードのIDとして使用するといったことも可能となります。今後の拡張を考えて、もう全部ULIDにしてしまおうかなと。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なおクライアントサイドで作成するなら、ULIDよりもCUID2の方が適しているそうです。これはブラウザによる乱数生成の偏りのためのようです。ただしCUIDはLaravelが標準でサポートしていないこともあり、ULIDで行こうかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">419</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>全てのテーブルでULIDに変更すると、419が出るようになりました。原因はすぐにわかりました。User操作はBreezeに頼っているため、ここでエラーになると面倒だなとここだけ変更を後回しにしていました。原因はUserのULID変更によるものでした。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>本来リレーションでintegerとulidとで違いが出ると、migrationでエラーが出てすぐにわかります。ところが以下の部分で、リレーションが貼られていないために、migrationでエラーが出ませんでした。sessionテーブルの部分です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php"> public function up(): void
    {
        Schema::create('users', function (Blueprint $table) {
            $table-&gt;ulid('id')-&gt;primary();
            $table-&gt;json('roles')-&gt;nullable();
            $table-&gt;string('name');
            $table-&gt;string('email')-&gt;unique();
            $table-&gt;timestamp('email_verified_at')-&gt;nullable();
            $table-&gt;string('password');
            $table-&gt;rememberToken();
            $table-&gt;timestamps();
        });

        Schema::create('password_reset_tokens', function (Blueprint $table) {
            $table-&gt;string('email')-&gt;primary();
            $table-&gt;string('token');
            $table-&gt;timestamp('created_at')-&gt;nullable();
        });

        Schema::create('sessions', function (Blueprint $table) {
            $table-&gt;string('id')-&gt;primary();
            $table-&gt;foreignId('user_id')-&gt;nullable()-&gt;index(); // &lt;= ここ！foreignUlidに変更すると解決
            $table-&gt;string('ip_address', 45)-&gt;nullable();
            $table-&gt;text('user_agent')-&gt;nullable();
            $table-&gt;longText('payload');
            $table-&gt;integer('last_activity')-&gt;index();
        });
    }</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>コメントにあるように、foreignUlidに変更することで、419が出なくなりました。ちなみにほとんど、自動生成されたものです。emailをプライマリーキーにしているのは、パフォーマンスを目指しているのでしょうか。別でidを振って、emailにユニーク制約を当てる方法もあるかと思いますが、厳密には今の方がパフォーマンスが出るのかもしれません。本当に僅かで、誤差にも満たないほどだと思いますけども。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>746</wp:post_id>
		<wp:post_date><![CDATA[2024-10-16 03:36:28]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-10-15 18:36:28]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-11-02 20:11:19]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-11-02 11:11:19]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91user-id%e3%82%92ulid%e3%81%ab%e5%a4%89%e6%9b%b4%e3%81%99%e3%82%8b%e3%81%a8%e3%80%81419-page-expired%e3%81%8c%e5%87%ba%e3%82%8b%e3%82%88%e3%81%86%e3%81%ab%e3%81%aa%e3%81%a3]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MUI】@toolpad/coreのDialogsProviderが便利すぎる【TypeScript】]]></title>
		<link>https://www.masaakiota.net/2024/10/17/%e3%80%90mui%e3%80%91dialogsprovider%e3%81%8c%e4%be%bf%e5%88%a9%e3%81%99%e3%81%8e%e3%82%8b%e3%80%90typescript%e3%80%91/</link>
		<pubDate>Thu, 17 Oct 2024 02:53:54 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=750</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">MUI</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>MUIはGoogleの開発するReactライブラリで、簡単にマテリアルデザインを実装できます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">DialogsProvider</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>DialogsProviderは、MUI Toolpadにある、Dialogを簡単に使えるようにするためのツールです。2024年10月17日時点で情報があまりないので、今回まとめることにした次第です。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://mui.com/toolpad/core/api/dialogs-provider","type":"rich","providerNameSlug":"mui"} -->
<figure class="wp-block-embed is-type-rich is-provider-mui wp-block-embed-mui"><div class="wp-block-embed__wrapper">
https://mui.com/toolpad/core/api/dialogs-provider
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2 class="wp-block-heading">事前準備</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まずはインストール</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npm i @toolpad/core</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>Providerなので、ルートを囲みます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">import { DialogsProvider } from '@toolpad/core/useDialogs';

function App({ children }) {
  return &lt;DialogsProvider&gt;{children}&lt;/DialogsProvider&gt;;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで使用準備はOKです</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">アラートなどを表示する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>通常、Dialogを使ってalertを表示する場合、その都度Dialogを書くか、自分でProviderを作って実装する必要がありました。しかしDialogsProviderを使えば、以下のように簡単に書けます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">import { useDialogs } from "@toolpad/core"
export default function Test() {
    const dlgs = useDialogs();
    return &lt;Button onClick={() =&gt; dlgs.alert('Hello World!')}&gt;Open&lt;/Button&gt;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>コンファームも実装されています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">import { useDialogs } from "@toolpad/core"

export default function Test() {
    const dlgs = useDialogs();
    async function handleOpen() {
        const result = await dlgs.confirm('OK?');
        dlgs.alert('result: ' + result);
    }
    return &lt;Button onClick={handleOpen}&gt;Open&lt;/Button&gt;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記のように、結果を取得したりする場合は非同期処理となります。async, awaitを通常は使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">カスタムダイアログを使用する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>独自ダイアログを作成することで、簡単に結果を取得したりできます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">型を宣言する</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>DialogsProviderを使用する場合、DialogPropsはtoolpadのものを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">import { DialogProps } from "@toolpad/core"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下のように、InputとOutputを指定します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type InputProps = {
    name: string;
}

type ResultProps = {
    age: number;
}

type CustomDialogProps = DialogProps&lt;InputProps, ResultProps&gt; </code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">カスタムダイアログを作成する</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、名前を渡して年齢を返すダイアログを作成しました。受け取ったデータは、payloadに格納されています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">function CustomDialog(props: CustomDialogProps) {
    const [age, setAge] = useState(0);

    return &lt;Dialog open={props.open} onClose={props.onClose}&gt;
        &lt;DialogTitle&gt;Custom Dialog&lt;/DialogTitle&gt;
        &lt;DialogContent&gt;
            &lt;Box&gt;
                &lt;Box&gt;
                    name: {props.payload.name} // payloadで受け取る
                &lt;/Box&gt;
                &lt;Box&gt;
                    &lt;TextField type="number" value={age} onChange={(e) =&gt; setAge(Number(e.target.value))} /&gt;
                &lt;/Box&gt;
            &lt;/Box&gt;
            &lt;Box&gt;
                &lt;Button onClick={() =&gt; props.onClose({ age })}&gt;OK&lt;/Button&gt; // onCloseで結果を返す
            &lt;/Box&gt;
        &lt;/DialogContent&gt;
    &lt;/Dialog&gt;
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">カスタムダイアログを使用する</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のように、インプットを渡して結果を受け取れます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">export function Test() {
    const dlgs = useDialogs();

    async function handleOpen() {
        const result = await dlgs.open(CustomDialog, { name: 'John' });
        dlgs.alert('result: ' + JSON.stringify(result)); // age
    }

    return &lt;div&gt;
        &lt;Button onClick={handleOpen}&gt;Open&lt;/Button&gt;
    &lt;/div&gt;
}
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>いやあ、便利ですね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>750</wp:post_id>
		<wp:post_date><![CDATA[2024-10-17 11:53:54]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-10-17 02:53:54]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-17 06:33:20]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-16 21:33:20]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90mui%e3%80%91dialogsprovider%e3%81%8c%e4%be%bf%e5%88%a9%e3%81%99%e3%81%8e%e3%82%8b%e3%80%90typescript%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mui"><![CDATA[MUI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_55b81af1ded3a3a7f587b1b28e3db2a9]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://mui.com/toolpad/core/api/dialogs-provider/">DialogsProvider API - Toolpad Core</a></h4><p>API reference docs for the React DialogsProvider component. Learn about the props, CSS, and other APIs of this exported module.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_55b81af1ded3a3a7f587b1b28e3db2a9]]></wp:meta_key>
		<wp:meta_value><![CDATA[1732314936]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_7f101059e67ab67e902cc1f782835d39]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】ComponentType&lt;T>で汎用コンポーネントを作成する【Typescript】]]></title>
		<link>https://www.masaakiota.net/2024/10/17/%e3%80%90react%e3%80%91componenttypet%e3%81%a7%e6%b1%8e%e7%94%a8%e3%82%b3%e3%83%b3%e3%83%9d%e3%83%bc%e3%83%8d%e3%83%b3%e3%83%88%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b%e3%80%90typescript/</link>
		<pubDate>Thu, 17 Oct 2024 06:16:57 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=755</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">React.ComponentType&lt;T></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>React.ComponentType&lt;T>は、T型のPropsを受け取るコンポーネントを表します。例えば、以下のPersonComponentと、PersonComponent2は同じ働きになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">type Person = {
    name: string;
    age: number;
}

const PersonComponent = (props: Person) => {
    return &lt;>{props.name} {props.age}&lt;/>
}

const PersonComponent2: React.ComponentType&lt;Person> = (props) => {
    return &lt;>{props.name} {props.age}&lt;/>
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">汎用的なComponentを作る</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにして、Person,Book両方のコンポーネントに対応した、汎用的なものを作ることができます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">
type Person = {
    name: string;
    age: number;
}

type Book = {
    title: string;
    author: string;
}

type ComponentProps&lt;T> = {
    item: T;
}

const PersonComponent = (props: ComponentProps&lt;Person>) => {
    return &lt;div>{props.item.name} {props.item.age}&lt;/div>
}

const BookComponent = (props: ComponentProps&lt;Book>) => {
    return &lt;div>{props.item.title} {props.item.author}&lt;/div>
}

const FlexibleComponent = &lt;T,>(props: {
    Component: React.ComponentType&lt;ComponentProps&lt;T>>;
    item: T;
    description: string;
}) => {
    return &lt;>
        &lt;props.Component item={props.item} />
        {props.description}
    &lt;/>
}

export default function Test() {
    return &lt;div>
        &lt;FlexibleComponent Component={PersonComponent} item={{ name: "太郎", age: 20 }} description="人" />
        &lt;FlexibleComponent Component={BookComponent} item={{ title: "吾輩は猫である", author: "夏目漱石" }} description="本" />
    &lt;/div>
}</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>755</wp:post_id>
		<wp:post_date><![CDATA[2024-10-17 15:16:57]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-10-17 06:16:57]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-10-17 15:16:59]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-10-17 06:16:59]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91componenttypet%e3%81%a7%e6%b1%8e%e7%94%a8%e3%82%b3%e3%83%b3%e3%83%9d%e3%83%bc%e3%83%8d%e3%83%b3%e3%83%88%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b%e3%80%90typescript]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】Intervention Image v3で画像をresponseする]]></title>
		<link>https://www.masaakiota.net/2024/10/28/%e3%80%90laravel%e3%80%91intervention-image-v3%e3%81%a7%e7%94%bb%e5%83%8f%e3%82%92response%e3%81%99%e3%82%8b/</link>
		<pubDate>Mon, 28 Oct 2024 01:52:37 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=761</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Intervention Image v3</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Intervention Image v3は割と最近v2からアップデートされた関係で、情報が少ないです。そのためChatGPTでは解決しにくい問題も多々あります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">responseで返す</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>公式サイトでは、以下のコードが紹介されています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">use Intervention\Image\Laravel\Facades\Image;

Route::get('/', function () {
    $image = Image::read('images/example.jpg');
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを見ると、特にreturnされたものはありません。そうかPHPはreturnしなくても最後の値を返す仕様だったかな？などという妄想を招くような記述は控えていただきたいです。おそらく単に、呼び出し部分だけ参考として提示されているものと思われます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>試しに$imageをreturnすると以下のエラーとなります。middlewareで発生しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Symfony\Component\HttpFoundation\Response::setContent(): Argument #1 ($content) must be of type ?string, Intervention\Image\Image given</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>つまり、Imageオブジェクトをそのまま返してもresponseにならないということが分かりました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下のようにする必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">return Response::make($image-&gt;toWebp(), 200, [
    'Content-Type' =&gt; 'image/webp',
]);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>都度コンバートを呼び出して返す必要があるようです。本当にそれしかないのか、色々探してみましたが結局分からずじまいです。せっかくLaravelと統合されているのだから、resopnse用の関数も欲しいところですね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>761</wp:post_id>
		<wp:post_date><![CDATA[2024-10-28 10:52:37]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-10-28 01:52:37]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-10-28 10:54:39]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-10-28 01:54:39]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91intervention-image-v3%e3%81%a7%e7%94%bb%e5%83%8f%e3%82%92response%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【HTML】表示サイズより大きめの画像を使うのがいいらしい]]></title>
		<link>https://www.masaakiota.net/2024/10/28/%e3%80%90html%e3%80%91%e8%a1%a8%e7%a4%ba%e3%82%b5%e3%82%a4%e3%82%ba%e3%82%88%e3%82%8a%e5%a4%a7%e3%81%8d%e3%82%81%e3%81%ae%e7%94%bb%e5%83%8f%e3%82%92%e4%bd%bf%e3%81%86%e3%81%ae%e3%81%8c%e3%81%84/</link>
		<pubDate>Mon, 28 Oct 2024 04:38:38 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=765</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">表示サイズと実際の画像サイズ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>表示サイズは、imgタグで設定します。直接指定する場合やstyleでする場合があります。しかしこれで、表示サイズと実際の画像サイズを合わせると、画質が悪く見えてしまいます。実際に実験してみました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">やってみた</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のコードで試してみました。Reactです。表示サイズからどれだけ大きい画像ファイルを使用するかを、scaleで指定しています。画像はサーバーでリサイズしています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">const URL = 'http://xxx.example.com/yyy';

export default function Test() {
    return &lt;div style={{ display: "flex" }}>
        &lt;TestMedia scale={1.0} />
        &lt;TestMedia scale={1.5} />
        &lt;TestMedia scale={2.0} />
    &lt;/div>
}


function TestMedia({ scale }: { scale: number }) {
    const [width, height] = [300, 200];
    const srcWidth = width * scale;
    const srcHeight = height * scale;

    const src = `${URL}?width=${srcWidth}&amp;height=${srcHeight}`;

    return &lt;div style={{ display: "flex", flexDirection: "column", alignItems: "center" }}>
        &lt;img
            src={src}
            style={{ width, height, objectFit: "contain", background: "#ddd" }}
        />
        scale: {scale}
    &lt;/div>;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>結果、以下のようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":766,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="http://35.221.87.155/wp-content/uploads/2024/10/スクリーンショット-2024-10-28-13.31.07-1024x259.png" alt="" class="wp-image-766"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>お分かりいただけるでしょうか。明らかに、scale:2、つまりwidth,heightそれぞれ2倍、解像度で言えば4倍の方が綺麗に見えます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">なぜ大きい画像を使う方が綺麗に見えるのか</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>これはディスプレイによるものです。HTMLで指定するピクセルは、実際のディスプレイのピクセルではありません。実際のディスプレイはもっと細かく表示がされているため、HTMLで指定するピクセルの間を補完しているのです。そのため、結果このようなことになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>昔に聞いたような気がする話だったのですが、なぜ今の今まで忘れていたのかという、個人的な感想を抱きました。とにもかくにも、今回実験して改めて差があることに驚愕しました。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>765</wp:post_id>
		<wp:post_date><![CDATA[2024-10-28 13:38:38]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-10-28 04:38:38]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-10-28 13:41:50]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-10-28 04:41:50]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90html%e3%80%91%e8%a1%a8%e7%a4%ba%e3%82%b5%e3%82%a4%e3%82%ba%e3%82%88%e3%82%8a%e5%a4%a7%e3%81%8d%e3%82%81%e3%81%ae%e7%94%bb%e5%83%8f%e3%82%92%e4%bd%bf%e3%81%86%e3%81%ae%e3%81%8c%e3%81%84]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="html-css"><![CDATA[HTML/CSS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel + Inertia】419がどうしても治らなくてChromeキャッシュを全て削除した話]]></title>
		<link>https://www.masaakiota.net/2024/11/11/%e3%80%90laravel-inertia%e3%80%91419%e3%81%8c%e3%81%a9%e3%81%86%e3%81%97%e3%81%a6%e3%82%82%e6%b2%bb%e3%82%89%e3%81%aa%e3%81%8f%e3%81%a6chrome%e3%82%ad%e3%83%a3%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92/</link>
		<pubDate>Mon, 11 Nov 2024 04:22:54 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=775</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Laravel 419エラー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Laravelで419エラーが出る事象は、検索すればたくさん出てきます。CSRFトークンにまつわる話ばかりなのですが、どうも修正がうまくいかず結局Chromeのキャッシュを全て削除することで解決したというお話です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">現象</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>突然、ローカルテスト環境でログインできなくなりました。どうもおかしいなとコードの修正履歴を確認するも、怪しいところはありません。昨日まではログインできていたのにというのは、よくある話かと思いますが、変更箇所も怪しくないとすると、どういうことなのか。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>普段はChromeを使用しているのですが、試しにSafariで試してみると、なぜかログインできました。それならとChromeのシークレットモードで試すと、こちらもログインできました。どうやらLaravelというよりは、ブラウザによるもののようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">リクエストヘッダー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Chromeのシークレットモードでの通信では、リクエストヘッダーにX-XSRF-TOKENが送信されていました。これが、おそらくInertiaでのCSRF認証のやり方なのだろうと思います。しかしChromeの通常モードでは、X-XSRF-TOKENが送信されていません。なぜなのか。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Chromeのキャッシュを削除</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>とりあえず開発ツールでクッキーやセッションストレージなどを削除しても治りませんでした。結局、Chromeの設定から、すべての期間のすべてのデータを削除することで、正常にログインできるようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>原因が気になるところですが、ひとまず治ったのでよしとしようと思います。それにしても原因は一体。。。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">2024年11月13日追記</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>こちら、ひとまずの原因がわかりました。どうも本番環境のクッキーが影響していたようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>本番環境のドメインがxxx.example.comとすると、開発環境がlocal.xxx.example.comでした。このxxx.example.comでのクッキーを削除すると、local.xxx.example.comでの問題が解消しました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なるほど、それではそこをなんとかすればすべて解決かと思いきや、どうもそうではなさそうです。ステージング環境でstaging.xxx.example.comがあるのですが、こちらは特に問題は発生していません。local環境のみhttpですので、もしかするとhttp,https関連も絡んでいるかもしれません。とりあえず、動かすには問題なさそうです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>775</wp:post_id>
		<wp:post_date><![CDATA[2024-11-11 13:22:54]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-11-11 04:22:54]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-11-13 14:11:21]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-11-13 05:11:21]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel-inertia%e3%80%91419%e3%81%8c%e3%81%a9%e3%81%86%e3%81%97%e3%81%a6%e3%82%82%e6%b2%bb%e3%82%89%e3%81%aa%e3%81%8f%e3%81%a6chrome%e3%82%ad%e3%83%a3%e3%83%83%e3%82%b7%e3%83%a5%e3%82%92]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="inertia"><![CDATA[Inertia]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】さくらレンタルサーバーでプロジェクト毎にアップロードサイズを設定する]]></title>
		<link>https://www.masaakiota.net/2024/11/15/%e3%80%90laravel%e3%80%91%e3%81%95%e3%81%8f%e3%82%89%e3%83%ac%e3%83%b3%e3%82%bf%e3%83%ab%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e3%81%a7%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e6%af%8e/</link>
		<pubDate>Fri, 15 Nov 2024 11:12:48 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=780</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">さくらレンタルサーバー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>さくらレンタルサーバーは、昔からある老舗レンタルサーバーです。現在進行中のプロジェクトでは、以下のような構成になっています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">/home/{username}
  - www
    - site1
    - site2</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このような構成のため、仮にphp.iniを編集すると、すべてのサイトに影響してしまいます。そこでサイト毎に設定する方法を色々調べて実現した結果を書きます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">チェック用のエンドポイント</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにして、実際に反映されたかどうかをチェックするためのエンドポイントを作成します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre title="/routes/web.php" class="wp-block-code"><code lang="php" class="language-php">Route::get('/phpinfo', function () {
    return [
        'upload_max_filesize' => ini_get('upload_max_filesize'),
        'post_max_size' => ini_get('post_max_size'),
        'memory_limit' => ini_get('memory_limit'),
        'max_execution_time' => ini_get('max_execution_time'),
        'max_input_time' => ini_get('max_input_time'),
    ];
});</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">.user.iniでやってみたけど。。。</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>php.iniと同じ書き方で、サブディレクトリに.user.iniを設置すればいいとのことで、やってみました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre title="/public/.user.ini" class="wp-block-code"><code lang="vim" class="language-vim">upload_max_filesize = 50M
post_max_size = 50M</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>しかし実際には、反映されません。通常であれば、最大５分（設定による）待てば更新処理が動いて、正常に反映されるようです。しかしさくらレンタルサーバーはPHPモジュールモードのためか、待てど暮らせど反映されませんでした。悲しい。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">.htaccessで設定できた</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のように、.htaccessで設定できました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre title="/public/.htaccess" class="wp-block-code"><code lang="apacheconf" class="language-apacheconf">&lt;IfModule mod_rewrite.c>
    ...デフォルトのリライト設定
&lt;/IfModule>

php_value upload_max_filesize 50M
php_value post_max_size 50M</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>780</wp:post_id>
		<wp:post_date><![CDATA[2024-11-15 20:12:48]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-11-15 11:12:48]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-11-15 20:15:00]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-11-15 11:15:00]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91%e3%81%95%e3%81%8f%e3%82%89%e3%83%ac%e3%83%b3%e3%82%bf%e3%83%ab%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e3%81%a7%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e6%af%8e]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】Cannot find module 'swiper/css'【Vite】]]></title>
		<link>https://www.masaakiota.net/2024/11/18/%e3%80%90react%e3%80%91cannot-find-module-swiper-css%e3%80%90vite%e3%80%91/</link>
		<pubDate>Mon, 18 Nov 2024 03:30:45 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=788</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Swiper</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Swiperはスライドショーを簡単に作れるライブラリです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">エラー内容</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Viteでbuildしようとした際、以下のエラーが出ました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">error TS2307: Cannot find module 'swiper/css' or its corresponding type declarations.

import 'swiper/css';</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>vite-env.d.tsに以下の行を追加することで解決しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">declare module 'swiper/css';</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>viteは便利ですが、ちょくちょく問題が起きますね。しかし便利です。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>788</wp:post_id>
		<wp:post_date><![CDATA[2024-11-18 12:30:45]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-11-18 03:30:45]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-11-18 12:30:46]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-11-18 03:30:46]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91cannot-find-module-swiper-css%e3%80%90vite%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【JavaScript】ESM, CommonJSの互換性を考えてみる]]></title>
		<link>https://www.masaakiota.net/2024/11/20/%e3%80%90javascript%e3%80%91esm-commonjs%e3%81%ae%e4%ba%92%e6%8f%9b%e6%80%a7%e3%82%92%e8%80%83%e3%81%88%e3%81%a6%e3%81%bf%e3%82%8b/</link>
		<pubDate>Wed, 20 Nov 2024 12:36:44 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=791</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>まだまだ分かっていませんが、NPMライブラリを公開するようになって色々いじっていることから、ESM, CommonJSの関係について考えてみたいと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ESM, CommonJS概要</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ざっくりいえば、以下のような具合です。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>ESM: 新しい</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>CommonJS: 古い</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>上記から、できれば新しい技術を使った方が良いといった観点から、ESMを選択したくなります。たとえばESMはトップレベルでのawait実行ができたり便利です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">互換性</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>しかし互換性の問題があります。読み込む際は、以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>ESMからCommonJSを読み込む =&gt; OK</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>CommonJSからESMを読み込む =&gt; NG</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>このことから、ESM俺強いといった具合に、とにかくESMを選択していれば問題はなさそうに思えます。しかしライブラリとして公開するなら、互換性を考慮してできるだけCommonJSにしたいという葛藤もあります。腰の低い人は多くの人に慕われたりしますよね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そのためできるだけCommonJSで開発し、使用するライブラリにESMが現れたら、自分もESMにするといった方向性がいいのではないかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">フロント開発との関係</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>フロント開発では、ほとんどがESMのようです。そのため、フロント開発はESMでないと使用ライブラリがかなり限定されそうです。そのため、フロントはESMが妥当かと思います。逆に、バックエンドはできるだけCommonJSで開発すると、将来的な互換性のあるライブラリ開発などを考慮した際に良さそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">MUI</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ちなみにMUI Iconsでは、以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">// moduleだと使えない
import EditIcon from "@mui/icons-material/Edit";

// moduleの場合、以下のようにする必要がある
import { EditIcon } from "@mui/icons-material";</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このことから、moduleの場合、バンドルサイズが大きくなる懸念がありました。しかし今試してみると、moduleで名前付きexportを利用しても、バンドルサイズは特に大きくなることはありませんでした。どうやら最新のMUIでは、バンドルサイズ肥大の問題は解決されているようです。知らなかった。。。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>どうやらフロントの場合、安心してmoduleで開発して良さそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">moduleResolution</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>tsconfig.jsonでは、moduleタイプと、moduleResolutionを選択できます。こちら２つありますが、実際はパターンがあるため１つの設定を２箇所に書くといった感じかと思います。以下は例です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">// ESNextペア
"module": "ESNext",
"moduleResolution": "bundler",

// NodeNextペア
"module": "NodeNext",
"moduleResolution": "nodenext",

// CommonJSペア
"module": "CommonJS",
"moduleResolution": "node",</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ESMの場合、ESNextペアか、NodeNextペアかどちらかになるかと。この違いは以下になります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>ESNextペア: ESMのみ。フロントならとりあえずこれを選択しておけば良さそう。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>NodeNextペア: ESMあるいはCommonJS。package.jsonのtype設定によって変わる。import時に.jsを付与しないといけないなど多少面倒。</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>といった具合です。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>791</wp:post_id>
		<wp:post_date><![CDATA[2024-11-20 21:36:44]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-11-20 12:36:44]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-11-20 21:55:08]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-11-20 12:55:08]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90javascript%e3%80%91esm-commonjs%e3%81%ae%e4%ba%92%e6%8f%9b%e6%80%a7%e3%82%92%e8%80%83%e3%81%88%e3%81%a6%e3%81%bf%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Next.js】モノレポでのパス解決の問題]]></title>
		<link>https://www.masaakiota.net/2024/11/20/%e3%80%90next-js%e3%80%91%e3%83%a2%e3%83%8e%e3%83%ac%e3%83%9d%e3%81%a7%e3%81%ae%e3%83%91%e3%82%b9%e8%a7%a3%e6%b1%ba%e3%81%ae%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Wed, 20 Nov 2024 13:50:46 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=804</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>モノレポ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>モノレポは関心の分離などの観点からも、とても便利です。ただ色々問題に直面することも多いかと思います。今回はNext.jsでのパス解決の問題に関してです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>パスエイリアスが効かない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>多くの場合、tsconfig.jsonでパスエイリアスを設定します。たとえばpackage1で以下のようにするとします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">"compilerOptions": {
    "paths": {
        "@/*": [
            "./src/*"
        ]
    }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ところがNext.jsはこの解決ができません。package1から見た@/は、Next.jsから見た@/とみなされてしまいます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">// nextでエラーになる。Can't resolve '@/Test2'
// import { Test2 } from "@/Test2";

// nextでもエラーにならない
import { Test2 } from "../Test2";

export function Test1() {
    return &lt;Test2 />
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このように、相対パスで実装しないと、Next.jsでは使えません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>804</wp:post_id>
		<wp:post_date><![CDATA[2024-11-20 22:50:46]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-11-20 13:50:46]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-11-20 22:50:49]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-11-20 13:50:49]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90next-js%e3%80%91%e3%83%a2%e3%83%8e%e3%83%ac%e3%83%9d%e3%81%a7%e3%81%ae%e3%83%91%e3%82%b9%e8%a7%a3%e6%b1%ba%e3%81%ae%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="next-js"><![CDATA[Next.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Mac】file table overflowを解決する]]></title>
		<link>https://www.masaakiota.net/2024/11/25/%e3%80%90mac%e3%80%91file-table-overflow%e3%82%92%e8%a7%a3%e6%b1%ba%e3%81%99%e3%82%8b/</link>
		<pubDate>Mon, 25 Nov 2024 01:26:48 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=809</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">file table overflow</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Nestjsの開発中に、以下のエラーが発生しました。Mac再起動時にエラーメッセージを紛失してしまいましたので、エラーの一部のみです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">... file table overflow ...</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>原因はNodeではなく、Mac OSのもののようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">確認</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のコマンドで、現在のfile descriptorsの設定値を確認できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">ulimit -a</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>私の場合、以下の結果でした。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">masaaki@Mac-mini ~ % ulimit -a
-t: cpu time (seconds)              unlimited
-f: file size (blocks)              unlimited
-d: data seg size (kbytes)          unlimited
-s: stack size (kbytes)             8176
-c: core file size (blocks)         0
-v: address space (kbytes)          unlimited
-l: locked-in-memory size (kbytes)  unlimited
-u: processes                       4000
-n: file descriptors                256</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>この-nの部分、file descriptorsの値を上げればいいようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決策</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">/etc/sysctl.confをいじるといいらしい</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ChatGPT大先生によれば、/etc/sysctl.confをいじるといいとのことでしたので、早速ファイルを探しに行きました。ですが私のMacOS Sonomaでは、該当ファイルを見つけることができませんでした。/etc/sysctl.dディレクトリも存在しません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そもそもそうした重要なファイルをいじると、下手すればMacが起動しなくなってしまう恐れもあります。そのためできれば他の方法が望ましいです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">.zshrcをいじった</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>.zshrcに以下の行を追加しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class=""># avoid file table overflow
ulimit -n 512</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>再度確認してみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">masaaki@Mac-mini ~ % ulimit -a
-t: cpu time (seconds)              unlimited
-f: file size (blocks)              unlimited
-d: data seg size (kbytes)          unlimited
-s: stack size (kbytes)             8176
-c: core file size (blocks)         0
-v: address space (kbytes)          unlimited
-l: locked-in-memory size (kbytes)  unlimited
-u: processes                       4000
-n: file descriptors                512</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>512に上がっているのを確認できました。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>809</wp:post_id>
		<wp:post_date><![CDATA[2024-11-25 10:26:48]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-11-25 01:26:48]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-11-25 10:28:06]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-11-25 01:28:06]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90mac%e3%80%91file-table-overflow%e3%82%92%e8%a7%a3%e6%b1%ba%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mac"><![CDATA[Mac]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MP4】古い端末で再生できない動画を修正する]]></title>
		<link>https://www.masaakiota.net/2024/11/25/%e3%80%90mp4%e3%80%91%e5%8f%a4%e3%81%84%e7%ab%af%e6%9c%ab%e3%81%a7%e5%86%8d%e7%94%9f%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%84%e5%8b%95%e7%94%bb%e3%82%92%e4%bf%ae%e6%ad%a3%e3%81%99%e3%82%8b/</link>
		<pubDate>Mon, 25 Nov 2024 03:59:03 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=813</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">動画がiPad mini 4 シミュレータで再生できない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ある動画が、iPad mini 4 シミュレータでのSafariで再生できない問題がありました。拾い物のフリー動画でテスト用なのですが、サイト内で形式が統一されていなかったらしく、再生できるものとできないものとがありました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">確認する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回ffmpegを使用します。Macでは以下のようにしてインストールできます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">brew install ffmpeg</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>続いて、ファイル情報を確認してみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">ffprobe video.mp4</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>すると動画情報が表示されます。今回問題だったのは以下の部分でした。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Video: h264 (High) (avc1 / 0x31637661)</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ChatGPT大先生によると、以下のようです。なおこの時はMP4Boxでの結果を使っているため、ffmpegとは若干形式が違います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">AVC/H.264 プロファイルとレベル

再生不可能ファイル：Profile High @ Level 4.1
再生可能ファイル：Profile Main @ Level 4.2
影響: Highプロファイルは一部のデバイスでサポートされていない場合があるため、Mainプロファイルの方が互換性が高い場合があります。</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>よくわかりませんが、MP4にはプロファイルというものがあり、それが互換性に影響しているようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">修正する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ChatGPT大先生の言に従って、HighプロファイルをMainプロファイルに変更します。以下のコードで可能です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">ffmpeg -i video.mp4 -c:v libx264 -profile:v main -level 4.2 -preset fast -crf 23 new_video.mp4 </code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>わけわからないですが、とにかく確認してみます。先ほどと同様にffprobeを実行します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Video: h264 (Main) (avc1 / 0x31637661)</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>無事Mainプロファイルに変更できました。iPad mini 4シミュレータのSafariでも再生が確認できました。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>813</wp:post_id>
		<wp:post_date><![CDATA[2024-11-25 12:59:03]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-11-25 03:59:03]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-11-25 13:13:07]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-11-25 04:13:07]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90mp4%e3%80%91%e5%8f%a4%e3%81%84%e7%ab%af%e6%9c%ab%e3%81%a7%e5%86%8d%e7%94%9f%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%84%e5%8b%95%e7%94%bb%e3%82%92%e4%bf%ae%e6%ad%a3%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mp4"><![CDATA[MP4]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】setIntervalは古いStateを参照する]]></title>
		<link>https://www.masaakiota.net/2024/11/25/%e3%80%90react%e3%80%91setinterval%e3%81%af%e5%8f%a4%e3%81%84state%e3%82%92%e5%8f%82%e7%85%a7%e3%81%99%e3%82%8b/</link>
		<pubDate>Mon, 25 Nov 2024 08:16:57 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=821</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">setIntervalは古いStateを参照する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>setIntervalは、定期実行を行う関数です。感覚的には、これを使用すると、常に新しいStateを得られると思いがちです。ですがReactでは、useEffect内で起動したIntervalは、その時のStateを参照します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下のコードを試してみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">function App() {
    const [count, setCount] = useState(0)

    useEffect(() =&gt; {
        const output = () =&gt; console.log(count);
        const timer = setInterval(output, 1000);
        return () =&gt; clearInterval(timer);
    }, []);

    return &lt;button onClick={() =&gt; setCount(prev =&gt; prev + 1)}&gt;Count: {count}&lt;/button&gt;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>buttonをクリックすると、countが増えます。さらに初期化時に起動したintervalが、そのcountを参照しています。一見、interlvalは常に新しいcountを得るように見えますが、実際は常に古いcountを参照するため、コンソールには延々と0が出力されます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">依存配列に追加する必要がある</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>これを解決するには、依存配列にcountを追加する必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">function App() {
    const [count, setCount] = useState(0)

    useEffect(() =&gt; {
        const output = () =&gt; console.log(count);
        const timer = setInterval(output, 1000);
        return () =&gt; clearInterval(timer);
    }, [count]); // &lt;= これ！

    return &lt;button onClick={() =&gt; setCount(prev =&gt; prev + 1)}&gt;Count: {count}&lt;/button&gt;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、countが更新されるたびに、古いIntervalが破棄されるとともに新しいIntervalが起動し、予期した動作になります。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>821</wp:post_id>
		<wp:post_date><![CDATA[2024-11-25 17:16:57]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-11-25 08:16:57]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-11-25 17:17:55]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-11-25 08:17:55]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91setinterval%e3%81%af%e5%8f%a4%e3%81%84state%e3%82%92%e5%8f%82%e7%85%a7%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Apollo】useMutation後、自動でデータ更新する]]></title>
		<link>https://www.masaakiota.net/2024/11/28/%e3%80%90apollo%e3%80%91usemutation%e5%be%8c%e3%80%81%e8%87%aa%e5%8b%95%e3%81%a7%e3%83%87%e3%83%bc%e3%82%bf%e6%9b%b4%e6%96%b0%e3%81%99%e3%82%8b/</link>
		<pubDate>Thu, 28 Nov 2024 07:20:53 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=827</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Apollo client</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Apollo clientはReactでも便利に使えるclientです。全体でキャッシュを持っており、一部の更新が全体に反映されたりと、データ帯域の節約にもつながります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">useMutation後、データ更新もセットで行う</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のように行います。UpdateUserDocument, およびGetUserDocumentは、graphql-codegenで生成しています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">const [updateUser] = useMutation(UpdateUserDocument, {
    context,
    refetchQueries: [{
        query: GetUserDocument,
        variables: { id: user.id },
        context
    }]
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>onUpdatedなどコンポーネントに渡す引数が減るのは、ありがたいですね。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">本当は、キャッシュをいじる方が帯域節約</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>refetchQueriesを指定すると、ネットワークを使用してデータ更新が行われます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>一方キャッシュを直接指定する方法もあります。ただキャッシュをどうこうする場合、かなり複雑でコードも見にくくなります。精神衛生上は、refetchQuerirsを使うのが良さそうです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>827</wp:post_id>
		<wp:post_date><![CDATA[2024-11-28 16:20:53]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-11-28 07:20:53]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-11-28 16:26:10]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-11-28 07:26:10]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90apollo%e3%80%91usemutation%e5%be%8c%e3%80%81%e8%87%aa%e5%8b%95%e3%81%a7%e3%83%87%e3%83%bc%e3%82%bf%e6%9b%b4%e6%96%b0%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="apollo"><![CDATA[Apollo]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Next.js】Server Actionでbcryptエラー。Can't resolve 'mock-aws-s3', 'aws-sdk','nock']]></title>
		<link>https://www.masaakiota.net/2024/11/29/%e3%80%90next-js%e3%80%91server-action%e3%81%a7bcrypt%e3%82%a8%e3%83%a9%e3%83%bc%e3%80%82cant-resolve-mock-aws-s3-aws-sdknock/</link>
		<pubDate>Fri, 29 Nov 2024 08:34:00 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=832</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">bcrypt</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>bcryptは暗号化に用いるライブラリです。ハッシュ化したり、検証したりできます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Server Actionで使えなかった</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Server ActionはNext.jsのサーバー上で実行するコードです。これがどうも、クライアントサイドでも読み込まれてしまっていたのが原因のようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">試してみたこと</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のことを試してみました。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>Server Actionファイルの先頭に"use server"をつける</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>関数呼び出し後に遅延importする</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>どれもうまくいきませんでした。原因がどこにあるのか、turbo monorepoが原因なのか、いまいちはっきりわかりません。ただ、同じ症状で悩んでいる方もおられました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決策１：bcryptjsを使う</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>bcryptではなく、bcryptjsを使うことで、Server Actionでも使用することができました。どうやら、bcryptjsはedge環境でも動かすことができるようです。ひとまずこれで、解決しました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決策２：routes.tsで書く</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>もう一つは、ChatGPT大先生に教えていただいた、クライアントと完全に分離するためにAPIとして運用するということです。bcryptの検証機能のみを使用するAPIエンドポイントを作成し、それをServer Actionから利用するといった具合ですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>こうした手法はmiddlewareなどでも使用されたりします。ただ、面倒です。なぜこれだけのためにAPIエンドポイントを作成し、管理しないといけないのか。はなはだ理不尽です。ともかく今回は、bcryptjsを使うことで解決しましたので、ほっと胸を撫で下ろしています。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>832</wp:post_id>
		<wp:post_date><![CDATA[2024-11-29 17:34:00]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-11-29 08:34:00]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-11-29 17:34:01]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-11-29 08:34:01]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90next-js%e3%80%91server-action%e3%81%a7bcrypt%e3%82%a8%e3%83%a9%e3%83%bc%e3%80%82cant-resolve-mock-aws-s3-aws-sdknock]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="next-js"><![CDATA[Next.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【.env】環境に応じて読み込む.envを変更する]]></title>
		<link>https://www.masaakiota.net/2024/12/02/%e3%80%90-env%e3%80%91%e7%92%b0%e5%a2%83%e3%81%ab%e5%bf%9c%e3%81%98%e3%81%a6%e8%aa%ad%e3%81%bf%e8%be%bc%e3%82%80-env%e3%82%92%e5%a4%89%e6%9b%b4%e3%81%99%e3%82%8b/</link>
		<pubDate>Mon, 02 Dec 2024 13:19:56 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=838</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">.envの読み込み</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>.envは環境に応じて値を変更する際などに使用します。Next.jsでは自動でやってくれたりもしますが、development,,test,productionにしか対応しておらず、stagingには使えなかったりします。このあたりどういう議論がされているのか、まだ読めていないのですが、ともかくそういう方向性だそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこでNext.jsのみならず何にでも使える、.envの読み分けを実装したいと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">仕様</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のような感じで使えるのを目指します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">APP_ENV=staging sh ../../load-env.sh pnpm run dev</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記の場合、../../.env.stagingと../../.envを読み込みます。もちろん、.env.staging優先です。このように、別ディレクトリにあるスクリプトを読み込めば、好きな環境での.envを読み込めるようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">コード</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようになりました。ChatGPT大先生は、枯れた技術にはとても心強いです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>load-env.sh</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre title="" class="wp-block-code"><code lang="" class=""># 許可された環境のリスト
ALLOWED_ENVS=("development" "staging" "production")

# スクリプトのディレクトリを取得
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &amp;&amp; pwd )"

# APP_ENVのセキュリティチェック
if [[ -z "${APP_ENV}" ]]; then
  echo "Error: APP_ENV is not set."
  exit 1
fi

# APP_ENVが許可された値かどうかを確認
if [[ ! " ${ALLOWED_ENVS[@]} " =~ " ${APP_ENV} " ]]; then
  echo "Error: APP_ENV '${APP_ENV}' is not allowed."
  exit 1
fi

# .env.${APP_ENV}から環境変数を読み込む
set -a  # 自動エクスポートを有効化
source "${SCRIPT_DIR}/.env"
source "${SCRIPT_DIR}/.env.${APP_ENV}"
set +a  # 自動エクスポートを無効化

# 渡されたコマンドを実行
exec "$@" </code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>838</wp:post_id>
		<wp:post_date><![CDATA[2024-12-02 22:19:56]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-12-02 13:19:56]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:15:54]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:15:54]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90-env%e3%80%91%e7%92%b0%e5%a2%83%e3%81%ab%e5%bf%9c%e3%81%98%e3%81%a6%e8%aa%ad%e3%81%bf%e8%be%bc%e3%82%80-env%e3%82%92%e5%a4%89%e6%9b%b4%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="shell"><![CDATA[Shell]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【JavaScript】古い端末での自動再生ポリシーの挙動と対策]]></title>
		<link>https://www.masaakiota.net/2024/12/08/%e3%80%90javascript%e3%80%91%e5%8f%a4%e3%81%84%e7%ab%af%e6%9c%ab%e3%81%a7%e3%81%ae%e8%87%aa%e5%8b%95%e5%86%8d%e7%94%9f%e3%83%9d%e3%83%aa%e3%82%b7%e3%83%bc%e3%81%ae%e6%8c%99%e5%8b%95%e3%81%a8%e5%af%be/</link>
		<pubDate>Sun, 08 Dec 2024 10:33:51 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=844</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">自動再生ポリシー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>自動再生ポリシーは、近年のブラウザに搭載されている機能です。ユーザーのクリックを確認できないと、動画の音声を自動再生できないといったものになります。ユーザーの利便性向上につながるものですが、開発者泣かせの機能でもあります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">古い端末で挙動が違う</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>古い端末では、自動再生ポリシーの挙動が変わるようです。具体的には、iPad4 simulatorで確認しました。以下はReactで検証しています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">直接再生</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>直接再生する分には、古い端末でも問題ありません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">// 古い端末でも動作する
function DirectPlay() {
    const ref = useRef&lt;HTMLVideoElement&gt;(null);

    return &lt;&gt;
        &lt;button onClick={() =&gt; ref.current?.play()}&gt;Play&lt;/button&gt;
        &lt;video src={SRC} ref={ref} /&gt;
    &lt;/&gt;
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">タイムアウトを使用</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>タイムアウトを使用すると、Chrome131では動作しますが、古い端末（iPad4 simulator）では動作しません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">// 古い端末では動作しない
function TimeoutPlay() {
    const ref = useRef&lt;HTMLVideoElement&gt;(null);

    return &lt;&gt;
        &lt;button onClick={() =&gt; setTimeout(() =&gt; ref.current?.play(), 1000)}&gt;Set timeout&lt;/button&gt;
        &lt;video src={SRC} ref={ref} /&gt;
    &lt;/&gt;
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">クリック時一旦再生させて、その後タイムアウト</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>クリック時に一旦別動画を再生させます。その後目的の動画を再生させると、古い端末でも動作します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これを実現するために、ダミー動画を作成します。黒画面、2x2ピクセル、0.1秒、無音トラックを持つ動画は以下のように作成できます。ffmpegを使用しています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">ffmpeg -f lavfi -i color=c=black:s=2x2:d=0.1 -f lavfi -i anullsrc=r=44100:cl=mono:d=0.1 -c:v libx264 -c:a aac -shortest interaction_dummy.mp4</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これをbase64エンコードすると、以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">export const interactionDummyVideo =  'data:video/mp4;base64,AAAAIGZ0eXBpc29tAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAAAwJtZGF03gIATGF2YzYxLjE5LjEwMAACMEAOAAACrgYF//+q3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE2NCByMzEwOCAzMWUxOWY5IC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAyMyAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTMgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MzoweDExMyBtZT1oZXggc3VibWU9NyBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0xIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MSA4eDhkY3Q9MSBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0tMiB0aHJlYWRzPTEgbG9va2FoZWFkX3RocmVhZHM9MSBzbGljZWRfdGhyZWFkcz0wIG5yPTAgZGVjaW1hdGU9MSBpbnRlcmxhY2VkPTAgYmx1cmF5X2NvbXBhdD0wIGNvbnN0cmFpbmVkX2ludHJhPTAgYmZyYW1lcz0zIGJfcHlyYW1pZD0yIGJfYWRhcHQ9MSBiX2JpYXM9MCBkaXJlY3Q9MSB3ZWlnaHRiPTEgb3Blbl9nb3A9MCB3ZWlnaHRwPTIga2V5aW50PTI1MCBrZXlpbnRfbWluPTI1IHNjZW5lY3V0PTQwIGludHJhX3JlZnJlc2g9MCByY19sb29rYWhlYWQ9NDAgcmM9Y3JmIG1idHJlZT0xIGNyZj0yMy4wIHFjb21wPTAuNjAgcXBtaW49MCBxcG1heD02OSBxcHN0ZXA9NCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAD2WIhAAv//72rvzLK3R/gQEYIAcBGCAHAAAACEGaIWxCv/7AARggBwEYIAcBGCAHAAAFp21vb3YAAABsbXZoZAAAAAAAAAAAAAAAAAAAA+gAAABkAAEAAAEAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAJhdHJhawAAAFx0a2hkAAAAAwAAAAAAAAAAAAAAAQAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAACAAAAAgAAAAAAJGVkdHMAAAAcZWxzdAAAAAAAAAABAAAAUAAAAAAAAQAAAAAB2W1kaWEAAAAgbWRoZAAAAAAAAAAAAAAAAAAAMgAAAAQAVcQAAAAAAC1oZGxyAAAAAAAAAAB2aWRlAAAAAAAAAAAAAAAAVmlkZW9IYW5kbGVyAAAAAYRtaW5mAAAAFHZtaGQAAAABAAAAAAAAAAAAAAAkZGluZgAAABxkcmVmAAAAAAAAAAEAAAAMdXJsIAAAAAEAAAFEc3RibAAAAMBzdHNkAAAAAAAAAAEAAACwYXZjMQAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAACAAIASAAAAEgAAAAAAAAAARVMYXZjNjEuMTkuMTAwIGxpYngyNjQAAAAAAAAAAAAAABj//wAAADZhdmNDAWQACv/hABlnZAAKrNlfiIjARAAAAwAEAAADAMg8SJZYAQAGaOvjyyLA/fj4AAAAABBwYXNwAAAAAQAAAAEAAAAUYnRydAAAAAAAARmkAAEZpAAAABhzdHRzAAAAAAAAAAEAAAACAAACAAAAABRzdHNzAAAAAAAAAAEAAAABAAAAHHN0c2MAAAAAAAAAAQAAAAEAAAABAAAAAQAAABxzdHN6AAAAAAAAAAAAAAACAAACxQAAAAwAAAAYc3RjbwAAAAAAAAACAAAARQAAAxIAAAJxdHJhawAAAFx0a2hkAAAAAwAAAAAAAAAAAAAAAgAAAAAAAABkAAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAJGVkdHMAAAAcZWxzdAAAAAAAAAABAAAAZAAABAAAAQAAAAAB6W1kaWEAAAAgbWRoZAAAAAAAAAAAAAAAAAAArEQAABU6VcQAAAAAAC1oZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU291bmRIYW5kbGVyAAAAAZRtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAVhzdGJsAAAAfnN0c2QAAAAAAAAAAQAAAG5tcDRhAAAAAAAAAAEAAAAAAAAAAAABABAAAAAArEQAAAAAADZlc2RzAAAAAAOAgIAlAAIABICAgBdAFQAAAAABDYgAAAplBYCAgAUSCFblAAaAgIABAgAAABRidHJ0AAAAAAABDYgAAAplAAAAIHN0dHMAAAAAAAAAAgAAAAUAAAQAAAAAAQAAAToAAAA0c3RzYwAAAAAAAAADAAAAAQAAAAEAAAABAAAAAgAAAAIAAAABAAAAAwAAAAMAAAABAAAALHN0c3oAAAAAAAAAAAAAAAYAAAAVAAAABAAAAAQAAAAEAAAABAAAAAQAAAAcc3RjbwAAAAAAAAADAAAAMAAAAwoAAAMeAAAAGnNncGQBAAAAcm9sbAAAAAIAAAAB//8AAAAcc2JncAAAAAByb2xsAAAAAQAAAAYAAAABAAAAYXVkdGEAAABZbWV0YQAAAAAAAAAhaGRscgAAAAAAAAAAbWRpcmFwcGwAAAAAAAAAAAAAAAAsaWxzdAAAACSpdG9vAAAAHGRhdGEAAAABAAAAAExhdmY2MS43LjEwMA==';</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記ダミー動画を使用したコードが、以下になります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">// 古い端末でも動作する
function DirectAndTimeoutPlay() {
    const ref = useRef&lt;HTMLVideoElement>(null);

    function firstStep() {
        ref.current?.play().then(secondStep);
    }

    function secondStep() {
        setTimeout(() => {
            if (!ref.current) return;
            ref.current.src = SRC;
            ref.current.play();
        }, 1000);
    }

    return &lt;>
        &lt;button onClick={firstStep}>First step&lt;/button>
        &lt;video src={interactionDummyVideo} ref={ref} />
    &lt;/>
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>844</wp:post_id>
		<wp:post_date><![CDATA[2024-12-08 19:33:51]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-12-08 10:33:51]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-12-08 19:49:31]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-12-08 10:49:31]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90javascript%e3%80%91%e5%8f%a4%e3%81%84%e7%ab%af%e6%9c%ab%e3%81%a7%e3%81%ae%e8%87%aa%e5%8b%95%e5%86%8d%e7%94%9f%e3%83%9d%e3%83%aa%e3%82%b7%e3%83%bc%e3%81%ae%e6%8c%99%e5%8b%95%e3%81%a8%e5%af%be]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MP4】moov atomの配置を最適化してweb対応させる]]></title>
		<link>https://www.masaakiota.net/2024/12/12/%e3%80%90mp4%e3%80%91moov-atom%e3%81%ae%e9%85%8d%e7%bd%ae%e3%82%92%e6%9c%80%e9%81%a9%e5%8c%96%e3%81%97%e3%81%a6web%e5%af%be%e5%bf%9c%e3%81%95%e3%81%9b%e3%82%8b/</link>
		<pubDate>Thu, 12 Dec 2024 04:03:23 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=853</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>moov atom</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>moove atomには、mp4に含まれるヘッダ情報で、再生に必要なものが含まれています。これが先に読み込まれないと、web上での動画再生に問題が発生する恐れがあります。そのため、これをファイルの早い段階に配置する必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>現在の位置を確認する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにして確認できます。ffmpegを使用しています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">ffprobe -v trace -i input.mp4 2&gt;&amp;1 | grep "moov"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>問題となるファイルでは、以下の結果となりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">[mov,mp4,m4a,3gp,3g2,mj2 @ 0x13ae11b10] type:'moov' parent:'root' sz: 59094 7550069 7609155
[mov,mp4,m4a,3gp,3g2,mj2 @ 0x13ae11b10] type:'mvhd' parent:'moov' sz: 108 8 59086
[mov,mp4,m4a,3gp,3g2,mj2 @ 0x13ae11b10] type:'trak' parent:'moov' sz: 25926 116 59086
[mov,mp4,m4a,3gp,3g2,mj2 @ 0x13ae11b10] type:'trak' parent:'moov' sz: 32954 26042 59086
[mov,mp4,m4a,3gp,3g2,mj2 @ 0x13ae11b10] type:'udta' parent:'moov' sz: 98 58996 59086</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>一行目の部分が、moov atomです。この場合、サイズが59KB, 開始位置が7.5MB, ファイルサイズが7.6MBとなっています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>つまり、moov atomがファイルの後方に来てしまっており、このままではwebでの再生に問題が生じる可能性が高いです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>位置を修正する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ffmpegでも修正できると思いますが、今回はGUIツールを使用します。Sublerを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://subler.org/","type":"rich","providerNameSlug":"subler"} -->
<figure class="wp-block-embed is-type-rich is-provider-subler wp-block-embed-subler"><div class="wp-block-embed__wrapper">
https://subler.org/
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>Sublerで動画ファイルを読み込み、FileメニューからOptimizeを選択すると、一瞬で最適化が終了します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>もう一度確認してみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">[mov,mp4,m4a,3gp,3g2,mj2 @ 0x121005fa0] type:'moov' parent:'root' sz: 59133 40 7609186
[mov,mp4,m4a,3gp,3g2,mj2 @ 0x121005fa0] type:'mvhd' parent:'moov' sz: 108 8 59125
[mov,mp4,m4a,3gp,3g2,mj2 @ 0x121005fa0] type:'trak' parent:'moov' sz: 25922 116 59125
[mov,mp4,m4a,3gp,3g2,mj2 @ 0x121005fa0] type:'trak' parent:'moov' sz: 32997 26038 59125
[mov,mp4,m4a,3gp,3g2,mj2 @ 0x121005fa0] type:'udta' parent:'moov' sz: 98 59035 59125</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>今度は開始位置が40Bとなり、moovを先頭に持ってくることができました。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>853</wp:post_id>
		<wp:post_date><![CDATA[2024-12-12 13:03:23]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-12-12 04:03:23]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-12-12 13:30:06]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-12-12 04:30:06]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90mp4%e3%80%91moov-atom%e3%81%ae%e9%85%8d%e7%bd%ae%e3%82%92%e6%9c%80%e9%81%a9%e5%8c%96%e3%81%97%e3%81%a6web%e5%af%be%e5%bf%9c%e3%81%95%e3%81%9b%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mp4"><![CDATA[MP4]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_b875640eca576020e945d6bc84cda6de]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://subler.org/">Subler</a></h4><p>Subler is an macOS application created to mux and tag mp4 files. The main features includes: Creation of TX3G and WebVTT subtitles tracks, compatible with all Apple's devices (iPhone, iPad, AppleTV, iPod, QuickTime). Muxing of video, audio, chapters, subtitles, and closed captions tracks from mov, mp4, and mkv files to mp4.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_b875640eca576020e945d6bc84cda6de]]></wp:meta_key>
		<wp:meta_value><![CDATA[1733976092]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【JavaScript】Playwrightのevaluateはクロージャ諸々使えない]]></title>
		<link>https://www.masaakiota.net/2024/12/16/%e3%80%90javascript%e3%80%91playwright%e3%81%aeevaluate%e3%81%af%e3%82%af%e3%83%ad%e3%83%bc%e3%82%b8%e3%83%a3%e8%ab%b8%e3%80%85%e4%bd%bf%e3%81%88%e3%81%aa%e3%81%84/</link>
		<pubDate>Mon, 16 Dec 2024 12:41:42 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=867</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Playwright</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>PlaywrightはChromiumを使えるJavaScriptライブラリです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>evaluate</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ブラウザ内でJavaScriptを実行する場合に、evaluateを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const href = await page.evaluate(() =&gt; document.location.href);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>公式サイトによれば、asyncも使えるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const status = await page.evaluate(async () =&gt; {
  const response = await fetch(location.href);
  return response.status;
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>中でconsole.logを使っても、外には反映されません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const href = await page.evaluate(() => console.log('abc'));</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>また、クロージャは動きません。悲しい。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const data = 'some data';
const result = await page.evaluate(() =&gt; {
  // WRONG: there is no "data" in the web page.
  window.myApp.use(data);
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>データを中に渡すには、以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const data = 'some data';
// Pass |data| as a parameter.
const result = await page.evaluate(data =&gt; {
  window.myApp.use(data);
}, data);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>外に色々なデータを出したいときは、構造体を使うとよさそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const result = await page.evaluate(() => {
  return {
    data: 'aaa',
    logs: ['log1', 'log2'],
  }
});</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>867</wp:post_id>
		<wp:post_date><![CDATA[2024-12-16 21:41:42]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-12-16 12:41:42]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-12-16 21:45:39]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-12-16 12:45:39]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90javascript%e3%80%91playwright%e3%81%aeevaluate%e3%81%af%e3%82%af%e3%83%ad%e3%83%bc%e3%82%b8%e3%83%a3%e8%ab%b8%e3%80%85%e4%bd%bf%e3%81%88%e3%81%aa%e3%81%84]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】videoフレームをキャプチャして表示する]]></title>
		<link>https://www.masaakiota.net/2024/12/17/%e3%80%90react%e3%80%91video%e3%83%95%e3%83%ac%e3%83%bc%e3%83%a0%e3%82%92%e3%82%ad%e3%83%a3%e3%83%97%e3%83%81%e3%83%a3%e3%81%97%e3%81%a6%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b/</link>
		<pubDate>Tue, 17 Dec 2024 12:45:10 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=873</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>videoフレームのキャプチャ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>videoフレームは、canvasを使用してキャプチャできます。以下のような具合です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">import { useRef } from "react";

export default function App() {
    const videoRef = useRef&lt;HTMLVideoElement&gt;(null);
    const canvasRef = useRef&lt;HTMLCanvasElement&gt;(null);

    function captureFrame() {
        const video = videoRef.current;
        const canvas = canvasRef.current;

        if (!video || !canvas) {
            throw new Error('video or canvas is null');
        }

        const context = canvas.getContext("2d");
        if (!context) {
            throw new Error('context is null');
        }

        context.drawImage(video, 0, 0, canvas.width, canvas.height);
    }

    return &lt;&gt;
        &lt;button onClick={captureFrame}&gt;キャプチャ&lt;/button&gt;

        &lt;video
            ref={videoRef}
            controls
            src="https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4"
        /&gt;

        &lt;canvas ref={canvasRef} /&gt;
    &lt;/&gt;
};</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2>リアルタイムで描画する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>リアルタイムで描画するには、requestAnimationFrameを用います。以下のような具合です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">const drawFrame = () => {
    const video = videoRef.current;
    const canvas = canvasRef.current;

    if (!video || !canvas) {
        throw new Error('video or canvas is null');
    }

    const context = canvas.getContext("2d");
    if (!context) {
        throw new Error('context is null');
    }

    // Canvasに現在の動画フレームを描画
    context.drawImage(video, 0, 0, canvas.width, canvas.height);

    // 次のフレームをリクエストして、アニメーションを続ける
    requestAnimationFrame(drawFrame);
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2>再利用はCORSに注意</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>canvasをtoDataURLでimg srcに入れようとすると、CORSエラーになります。またtoBlobも使えないそうです（ChatGPT大先生言）。自サーバーの動画のみなら問題ありませんが、他サーバーの動画も扱う可能性がある場合は、canvasをそのまま使用するのがよさそうです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>873</wp:post_id>
		<wp:post_date><![CDATA[2024-12-17 21:45:10]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-12-17 12:45:10]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-12-17 21:53:08]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-12-17 12:53:08]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91video%e3%83%95%e3%83%ac%e3%83%bc%e3%83%a0%e3%82%92%e3%82%ad%e3%83%a3%e3%83%97%e3%83%81%e3%83%a3%e3%81%97%e3%81%a6%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[enclosure]]></wp:meta_key>
		<wp:meta_value><![CDATA[https://interactive-examples.mdn.mozilla.net/media/cc0-videos/flower.mp4
1128375
video/mp4
]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【HTML】Safariはvideoをキャッシュしない]]></title>
		<link>https://www.masaakiota.net/2024/12/19/%e3%80%90html%e3%80%91safari%e3%81%afvideo%e3%82%92%e3%82%ad%e3%83%a3%e3%83%83%e3%82%b7%e3%83%a5%e3%81%97%e3%81%aa%e3%81%84/</link>
		<pubDate>Thu, 19 Dec 2024 12:26:56 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=878</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>ブラウザのキャッシュ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>通常、ブラウザは一度表示したコンテンツをキャッシュし、次回表示時に再利用します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>その動作をコントロールするために、以下のようなヘッダーが使用されます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Cache-Control: max-age=604800, public</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2>Chromeでの動作</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>上記ヘッダーを付与したmp4ファイルに対して、Chormeはキャッシュを使用し、次回表示はスムーズに行われました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Safariでの動作</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Chrome同様のヘッダーで同じファイルを読み込みましたが、読み込むたびにSafariはネットワークからダウンロードを行いました。さらにダウンロードが終わるまでビデオは動かず、現在何が起こっているのかさっぱりわからない状態です。インスペクタでかろうじて、読み込み中のバイト数を眺めて、ダウンロードが行われているのを知ることができるといった状態です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>対策</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3>fetchする</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>JavaScriptでfetchして、メモリ上に保持する方法です。以下で解説されています。ただしファイルサイズの小さな動画に限られます。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://stackoverflow.com/questions/55923054/safari-not-retrieving-mp4-video-from-cache-and-sometimes-timeout-when-downloadi","type":"rich","providerNameSlug":"stack-overflow"} -->
<figure class="wp-block-embed is-type-rich is-provider-stack-overflow wp-block-embed-stack-overflow"><div class="wp-block-embed__wrapper">
https://stackoverflow.com/questions/55923054/safari-not-retrieving-mp4-video-from-cache-and-sometimes-timeout-when-downloadi
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3>IndexedDBに保存する</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>IndexedDBに保存して、再利用することもできます。IndexedDBを利用するには、Dexieなどのライブラリが便利です。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>878</wp:post_id>
		<wp:post_date><![CDATA[2024-12-19 21:26:56]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-12-19 12:26:56]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-12-20 18:25:43]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-12-20 09:25:43]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90html%e3%80%91safari%e3%81%afvideo%e3%82%92%e3%82%ad%e3%83%a3%e3%83%83%e3%82%b7%e3%83%a5%e3%81%97%e3%81%aa%e3%81%84]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="html-css"><![CDATA[HTML/CSS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_1f1945d373d6f486a0ab18d57c135674]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://stackoverflow.com/questions/55923054/safari-not-retrieving-mp4-video-from-cache-and-sometimes-timeout-when-downloadi">Safari not retrieving mp4 video from cache, and sometimes timeout when downloading the same resource</a></h4><p>I'm running a VueJS application that displays a full screen story of videos. I don't create as many tag as number of media in my story : I'm just changing component video sources each time I play ...</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_1f1945d373d6f486a0ab18d57c135674]]></wp:meta_key>
		<wp:meta_value><![CDATA[1734611100]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeScript】Dexieで型安全にIndexedDBを操作する]]></title>
		<link>https://www.masaakiota.net/2024/12/19/%e3%80%90typescript%e3%80%91dexie%e3%81%a7%e5%9e%8b%e5%ae%89%e5%85%a8%e3%81%abindexeddb%e3%82%92%e6%93%8d%e4%bd%9c%e3%81%99%e3%82%8b/</link>
		<pubDate>Thu, 19 Dec 2024 14:00:28 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=881</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>IndexedDB</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>IndexedDBは、現在のすべてのブラウザでサポートされているストレージ機能です。cookie,localStrageなどで収まらない大きなサイズのデータを扱う場合に使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ただ最近の書き方にはあまり対応していません。標準ではawaitも使えませんし、自分でラッパーを描く羽目になったりします。またオブジェクト型の安全性もありません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Dexie</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Dexieを使えば、オブジェクト型の安全性も確保されます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import Dexie, { type EntityTable } from 'dexie';

interface Friend {
    id: number;
    name: string;
    age: number;
}


export class Database extends Dexie {
    friends!: Table&lt;Friend>;

    constructor() {
        super('FriendsDatabase');
        this.version(1).stores({
            friends: '++id, age',
        });
    }
}

const db = new Database();

db.friends.add({
    name:'John',
    age:20,
});
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これは便利ですね。sotresに指定したフィールド全てにインデックスが貼られるようです。先頭がプライマリーになります。</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table><tbody><tr><td>++</td><td>オートインクリメントな主キー</td></tr><tr><td>&amp;</td><td>ユニークキー</td></tr><tr><td>*</td><td>複数可(array)</td></tr><tr><td>[A+B]</td><td>複合index</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>インデックスを貼りたくない場合は、storesに含めずに使用すれば良いようです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>881</wp:post_id>
		<wp:post_date><![CDATA[2024-12-19 23:00:28]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-12-19 14:00:28]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-12-22 04:25:05]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-12-21 19:25:05]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typescript%e3%80%91dexie%e3%81%a7%e5%9e%8b%e5%ae%89%e5%85%a8%e3%81%abindexeddb%e3%82%92%e6%93%8d%e4%bd%9c%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】SQLiteのW00をCarbonでパースする]]></title>
		<link>https://www.masaakiota.net/2024/12/26/%e3%80%90laravel%e3%80%91sqlite%e3%81%aew00%e3%82%92carbon%e3%81%a7%e3%83%91%e3%83%bc%e3%82%b9%e3%81%99%e3%82%8b/</link>
		<pubDate>Wed, 25 Dec 2024 17:17:18 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=893</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>SQLiteのWeek</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>SQLiteでは、週番号を取得するのに以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">%Y-W%W</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>例えば2024年の第一週だと、2024-W01となります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これが、ISOの規格と挙動が違うようで、ISOではW01からなのですが、SQLiteではW00から生成してしまいます。W00は、前年の最終週となるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Carbonでの問題と解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Carbonでは、W01はパースできるのですが、W00はパースできません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこで、以下のようにします。一度インクリメントして、1week引いています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">static function parseWeekFormat(string $period): Carbon
{
    if (str_contains($period, 'W00')) {
        $period = str_replace('W00', 'W01', $period);
        return Carbon::parse($period)->subWeek();
    }
    return Carbon::parse($period);
}</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>893</wp:post_id>
		<wp:post_date><![CDATA[2024-12-26 02:17:18]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-12-25 17:17:18]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-12-26 02:42:53]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-12-25 17:42:53]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91sqlite%e3%81%aew00%e3%82%92carbon%e3%81%a7%e3%83%91%e3%83%bc%e3%82%b9%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel11】環境に応じて.envを切り替える【さくら、XServer】]]></title>
		<link>https://www.masaakiota.net/2024/12/26/%e3%80%90laravel%e3%80%91%e7%92%b0%e5%a2%83%e3%81%ab%e5%bf%9c%e3%81%98%e3%81%a6-env%e3%82%92%e5%88%87%e3%82%8a%e6%9b%bf%e3%81%88%e3%82%8b/</link>
		<pubDate>Thu, 26 Dec 2024 11:23:29 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=897</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Laravelの.env</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Laravelでは、デフォルトでルートの.envを読み込みます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回は、それを環境で切り替える方法です。Laravel11では、bootstrap/app.phpファイルがあります。これをいじります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Web表示だけでいいなら$_SERVER</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>php artisanを想定していなければ、$_SERVERで大丈夫です。下記はbootstrap/app.phpファイルに追記する部分です。さくらレンタルサーバーとXServerに対応しています。なお環境によってはキーや値が違ったりしますので、適時変更してください。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">function loadCustomEnv()
{
  $isSakura = str_ends_with($_SERVER["HOST"] ?? '', ".sakura.ne.jp");
  $isXServer = isset($_SERVER['HTTP_X_SERVER_ADDRESS']);
  $isProduction = $isSakura || $isXServer;
  if ($isProduction) {
    Dotenv::createImmutable(dirname(__DIR__), '.env.production')-&gt;load();
  }
  Dotenv::createImmutable(dirname(__DIR__), '.env')-&gt;load();
}

loadCustomEnv();</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>.env.productionは以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">APP_ENV=production
APP_DEBUG=false
APP_URL=http://sakura.example.com

// 残りは.envから読み込まれる。</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">artisanにも対応する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>artisanにも対応するには、ベストプラクティスは思いつきませんでした。次善の策として、プロジェクトディレクトリ名を使用する方法があります。ローカルではwebディレクトリ、サーバー上ではstaging.xxx.comやxxx.comなどといったディレクトリに格納するといった前提なら、下記のように行えます。bootstrap/app.phpです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">function loadEnvs()
{
  // プロジェクトディレクトリ名毎の.envファイルを指定する
  $envFiles = [
    'web' =&gt; '.env.local',
    'staging.xxx.com' =&gt; '.env.staging',
    'xxx.com' =&gt; '.env.production',
  ];

  $projectDir = basename(dirname(__DIR__));
  $envFile = $envFiles[$projectDir] ?? null;
  if (!$envFile) {
    throw new Exception('Invalid project directory ' . $projectDir);
  }
  $dotenv = Dotenv::createImmutable(dirname(__DIR__), $envFile);
  $dotenv-&gt;load();
  $dotenv = Dotenv::createImmutable(dirname(__DIR__), '.env');
  $dotenv-&gt;load();
}

loadEnvs();
</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">結局.env１つが最強？</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>こうした.envの環境による使い分けを色々考えました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>しかし結局１つの.envを使う方が、下記の点で優れているかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>複数人開発でも混乱しない（.envはgit管理しないため）</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>サーバーで編集して、ローカルからアップロードしないようにするだけでOK</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>サーバーによっては環境変数を設定できたりするのですが、PHP + レンタルサーバーの需要も多いのでなかなか。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>結論、.envは面倒だというお話でした。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>897</wp:post_id>
		<wp:post_date><![CDATA[2024-12-26 20:23:29]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-12-26 11:23:29]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-28 19:48:11]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-28 10:48:11]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91%e7%92%b0%e5%a2%83%e3%81%ab%e5%bf%9c%e3%81%98%e3%81%a6-env%e3%82%92%e5%88%87%e3%82%8a%e6%9b%bf%e3%81%88%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】StreamでLeague\Csv\WriterのsetOutputBOMは効かない]]></title>
		<link>https://www.masaakiota.net/2024/12/27/%e3%80%90laravel%e3%80%91stream%e3%81%a7leaguecsvwriter%e3%81%aesetoutputbom%e3%81%af%e5%8a%b9%e3%81%8b%e3%81%aa%e3%81%84/</link>
		<pubDate>Fri, 27 Dec 2024 05:35:02 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=900</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>LaravelのStream</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>LaravelではStreamを以下のように書けます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">response()->stream(
    function () {
        echo 'Hello World!';
    },
    200,
    [
        'Content-Type' => 'text/plain; charset=UTF-8',
        'Content-Disposition' => 'attachment; filename="' . $fileName . '"',
    ]
);
</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2>CSVをBOMと共に出力する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>BOMを指定しないと、Microsoft Excelなどの一部のソフトで文字化けします。League WriterはBOMを出力する関数を持っていますが、LaravelのStreamと併用する場合は、なぜか正常に動きません。ヘッダー処理が競合しているためと思われます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そのため、以下のように直接echoします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">response()->stream(
    function () {
        $csv = Writer::createFromPath('php://output', 'w');

        // 直接BOMを出力する
        echo chr(0xEF) . chr(0xBB) . chr(0xBF);

        // 以下は効かない
        // $csv->setOutputBOM(Writer::BOM_UTF8);

        $csv->insertOne(['a','b','c']);
    },
    200,
    [
        'Content-Type' => 'text/csv; charset=UTF-8',
        'Content-Disposition' => 'attachment; filename="' . $fileName . '"',
    ]
);
</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>900</wp:post_id>
		<wp:post_date><![CDATA[2024-12-27 14:35:02]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-12-27 05:35:02]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-12-27 14:35:04]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-12-27 05:35:04]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91stream%e3%81%a7leaguecsvwriter%e3%81%aesetoutputbom%e3%81%af%e5%8a%b9%e3%81%8b%e3%81%aa%e3%81%84]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel11】AdminerでSQLiteを操作する]]></title>
		<link>https://www.masaakiota.net/2024/12/28/%e3%80%90laravel11%e3%80%91adminer%e3%81%a7sqlite%e3%82%92gui%e6%93%8d%e4%bd%9c%e3%81%99%e3%82%8b/</link>
		<pubDate>Fri, 27 Dec 2024 16:23:31 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=902</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>LaravelのAdminer</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>LaravelでAdminerを使うには、以下のライブラリを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://github.com/senaranya/laravel-adminer","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/senaranya/laravel-adminer
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2>問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>SQLiteは、普通に使うことができません。Adminerは現在、すべてのdbでパスワードを要求します。しかしSQLiteはパスワードレスのため、エラーになって使えません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そのためAdminerの提供するプラグイン（後述）を、laravel-adminerに統合する必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>手順</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>composerではインストールしません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>リポジトリから直接ファイルをダウンロードし、適切な場所に設置します。今回は、ルートに設置しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">/aranyasen/laravel-adminer</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下のファイルを保存します。Adminerのサイトで紹介されているプラグインです。パスワードは要求するが、dbには渡さないようにするそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a rel="noreferrer noopener" href="https://raw.githubusercontent.com/vrana/adminer/master/plugins/login-password-less.php" target="_blank">https://raw.githubusercontent.com/vrana/adminer/master/plugins/login-password-less.php</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>保存先は以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">/aranyasen/laravel-adminer/src/plugins/AdminerLoginPasswordLess.php</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>プラグインを追加します。/aranyasen/laravel-adminer/src/plugins/adminer-with-plugins.phpに追記します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">$plugins = [
    ... // 他のプラグイン
    new AdminerLoginPasswordLess(password_hash('password', PASSWORD_DEFAULT)),
];</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>あとはroutes/web.phpを以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">use Illuminate\Support\Facades\Config;

Route::any('/adminer', function () {
    if (! isset($_GET['db'])) {
        $databaseConnection = Config::get('database.default');

        $databaseDriver = Config::get("database.connections.$databaseConnection.driver");
        if ($databaseDriver === "mysql") {
            $databaseDriver = "server";
        }

        $_POST['auth']['driver'] = $databaseDriver;
        $_POST['auth']['server'] = Config::get("database.connections.$databaseConnection.host") . ':' .
            Config::get("database.connections.$databaseConnection.port");
        $_POST['auth']['db'] = Config::get("database.connections.$databaseConnection.database");
        $_POST['auth']['username'] = Config::get("database.connections.$databaseConnection.username");
        $_POST['auth']['password'] = Config::get("database.connections.$databaseConnection.password");
    }
    require base_path('aranyasen/laravel-adminer/src/adminer-with-plugins.php');
})-&gt;withoutMiddleware(VerifyCsrfToken::class);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、/adminerにアクセスすれば使えるようになります。パスワードには「password」を入力してください。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なおセキュリティのため、上記ルートは適切なアクセス制限をかけることをお勧めします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>902</wp:post_id>
		<wp:post_date><![CDATA[2024-12-28 01:23:31]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-12-27 16:23:31]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-12-28 01:46:51]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-12-27 16:46:51]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel11%e3%80%91adminer%e3%81%a7sqlite%e3%82%92gui%e6%93%8d%e4%bd%9c%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_4eff1a79378299e697834118b9ad6752]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/senaranya/laravel-adminer?tab=readme-ov-file">GitHub - senaranya/laravel-adminer: Adminer for Laravel 5.5+</a></h4><p>Adminer for Laravel 5.5+. Contribute to senaranya/laravel-adminer development by creating an account on GitHub.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_4eff1a79378299e697834118b9ad6752]]></wp:meta_key>
		<wp:meta_value><![CDATA[1735315823]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_1fe60e3dea10e68b2da4ffe4dcdf9aef]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/senaranya/laravel-adminer">GitHub - senaranya/laravel-adminer: Adminer for Laravel 5.5+</a></h4><p>Adminer for Laravel 5.5+. Contribute to senaranya/laravel-adminer development by creating an account on GitHub.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_1fe60e3dea10e68b2da4ffe4dcdf9aef]]></wp:meta_key>
		<wp:meta_value><![CDATA[1735315888]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_5902aaa7642231a29034d572a22d7f2a]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://raw.githubusercontent.com/vrana/adminer/master/plugins/login-password-less.php">No Title</a></h4><p>No Description</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_5902aaa7642231a29034d572a22d7f2a]]></wp:meta_key>
		<wp:meta_value><![CDATA[1735316063]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Electron】Cannot find module '.prisma/client/default']]></title>
		<link>https://www.masaakiota.net/2025/01/01/%e3%80%90electron%e3%80%91cannot-find-module-prisma-client-default/</link>
		<pubDate>Tue, 31 Dec 2024 23:16:05 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=910</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Electron</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Electronは、JavaScriptでデスクトップアプリを作れるツールです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Prismaでエラーになる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>devモードなら問題なかったのですが、buildすると以下のエラーになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Cannot find module '.prisma/client/default'</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">対策</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">成果物にprismaを含める</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のように、package.jsonに追記します。npmの場合です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">"build": {
  "extraResources": [
    "prisma/**/*",
    "node_modules/.prisma/**/*",
    "node_modules/@prisma/client/**/*"
  ]
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">パッケージマネージャーに気をつける</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>これは単にケースバイケースです。node_modules内の構成が変わるのですが、ネットで紹介されていた解決策との整合性がとれず、四苦八苦しました。パッケージマネージャーには気をつけましょう。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">prismaをやめる</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>2025/01/05追記： 頑張ってPrismaでクロスプラットフォームをやってみました。下記で公開しています。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.masaakiota.net/2025/01/05/%e3%80%90electron%e3%80%91prisma-sqlite%e3%82%92%e3%82%af%e3%83%ad%e3%82%b9%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%a0%e3%81%a7%e3%83%93%e3%83%ab%e3%83%89%e3%81%99","type":"wp-embed","providerNameSlug":""} -->
<figure class="wp-block-embed is-type-wp-embed"><div class="wp-block-embed__wrapper">
https://www.masaakiota.net/2025/01/05/%e3%80%90electron%e3%80%91prisma-sqlite%e3%82%92%e3%82%af%e3%83%ad%e3%82%b9%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%a0%e3%81%a7%e3%83%93%e3%83%ab%e3%83%89%e3%81%99
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>そもそも、prismaはクロスプラットフォームに弱いようです。バイナリを含むためだそうです。成果物に無理やりPrismaを含めても、対応バイナリがなければ意味がありません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ただprismaのバイナリは、prisma.schemaでbinaryTargetsを指定すれば、意図したプラットフォームのものを作成できるようです。windows（たぶんintel）, mac intel, mac armなどがあります。ただ、おそらくwindows armがありません。mac arm上で動作するvmware fusionはwindows armなので、これは困りものです。。。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ChatGPTによれば、better-sqlite3なら、Electronでのクロスプラットフォームに対応しているためお勧めだとのことでした。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>910</wp:post_id>
		<wp:post_date><![CDATA[2025-01-01 08:16:05]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-12-31 23:16:05]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-16 05:31:56]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-15 20:31:56]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90electron%e3%80%91cannot-find-module-prisma-client-default]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="electron"><![CDATA[Electron]]></category>
		<category domain="category" nicename="prisma"><![CDATA[Prisma]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_280b2a77e3bcef3908456a8ae3c02295]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="wp-embedded-content" data-secret="49gKI4Co0F"><a href="http://35.221.87.155/2025/01/05/%e3%80%90electron%e3%80%91prisma-sqlite%e3%82%92%e3%82%af%e3%83%ad%e3%82%b9%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%a0%e3%81%a7%e3%83%93%e3%83%ab%e3%83%89%e3%81%99/">【Electron】Prisma + SQLiteをクロスプラットフォームでビルドする</a></blockquote><iframe title="&#8220;【Electron】Prisma + SQLiteをクロスプラットフォームでビルドする&#8221; &#8212; 太田雅昭" sandbox="allow-scripts" security="restricted" src="http://35.221.87.155/2025/01/05/%e3%80%90electron%e3%80%91prisma-sqlite%e3%82%92%e3%82%af%e3%83%ad%e3%82%b9%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%a0%e3%81%a7%e3%83%93%e3%83%ab%e3%83%89%e3%81%99/embed/#?secret=49gKI4Co0F" width="600" height="338" data-secret="49gKI4Co0F" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" class="wp-embedded-content"></iframe><script>/*! This file is auto-generated */!function(c,d){"use strict";var e=!1,o=!1;if(d.querySelector)if(c.addEventListener)e=!0;if(c.wp=c.wp||{},c.wp.receiveEmbedMessage);else if(c.wp.receiveEmbedMessage=function(e){var t=e.data;if(!t);else if(!(t.secret||t.message||t.value));else if(/[^a-zA-Z0-9]/.test(t.secret));else{for(var r,s,a,i=d.querySelectorAll('iframe[data-secret="'+t.secret+'"]'),n=d.querySelectorAll('blockquote[data-secret="'+t.secret+'"]'),o=new RegExp("^https?:$","i"),l=0;l<n.length;l++)n[l].style.display="none";for(l=0;l<i.length;l++)if(r=i[l],e.source!==r.contentWindow);else{if(r.removeAttribute("style"),"height"===t.message){if(1e3<(s=parseInt(t.value,10)))s=1e3;else if(~~s<200)s=200;r.height=s}if("link"===t.message)if(s=d.createElement("a"),a=d.createElement("a"),s.href=r.getAttribute("src"),a.href=t.value,!o.test(a.protocol));else if(a.host===s.host)if(d.activeElement===r)c.top.location.href=t.value}}},e)c.addEventListener("message",c.wp.receiveEmbedMessage,!1),d.addEventListener("DOMContentLoaded",t,!1),c.addEventListener("load",t,!1);function t(){if(o);else{o=!0;for(var e,t,r,s=-1!==navigator.appVersion.indexOf("MSIE 10"),a=!!navigator.userAgent.match(/Trident.*rv:11./),i=d.querySelectorAll("iframe.wp-embedded-content"),n=0;n<i.length;n++){if(!(r=(t=i[n]).getAttribute("data-secret")))r=Math.random().toString(36).substr(2,10),t.src+="#?secret="+r,t.setAttribute("data-secret",r);if(s||a)(e=t.cloneNode(!0)).removeAttribute("security"),t.parentNode.replaceChild(e,t);t.contentWindow.postMessage({message:"ready",secret:r},"*")}}}}(window,document);</script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_280b2a77e3bcef3908456a8ae3c02295]]></wp:meta_key>
		<wp:meta_value><![CDATA[1736081816]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_ba0099d7ad06d06a525e3201c627f688]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_8d42a3d32de219d04f4a13fa61900d31]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="wp-embedded-content" data-secret="X7uP50J8sf"><a href="https://www.masaakiota.net/2025/01/05/%e3%80%90electron%e3%80%91prisma-sqlite%e3%82%92%e3%82%af%e3%83%ad%e3%82%b9%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%a0%e3%81%a7%e3%83%93%e3%83%ab%e3%83%89%e3%81%99/">【Electron】Prisma + SQLiteをクロスプラットフォームでビルドする</a></blockquote><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" style="position: absolute; visibility: hidden;" title="&#8220;【Electron】Prisma + SQLiteをクロスプラットフォームでビルドする&#8221; &#8212; 太田雅昭" src="https://www.masaakiota.net/2025/01/05/%e3%80%90electron%e3%80%91prisma-sqlite%e3%82%92%e3%82%af%e3%83%ad%e3%82%b9%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%a0%e3%81%a7%e3%83%93%e3%83%ab%e3%83%89%e3%81%99/embed/#?secret=CkLWrB3WpY#?secret=X7uP50J8sf" data-secret="X7uP50J8sf" width="600" height="338" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_8d42a3d32de219d04f4a13fa61900d31]]></wp:meta_key>
		<wp:meta_value><![CDATA[1736973116]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【JavaScript】Fuse.jsで曖昧検索を実装する]]></title>
		<link>https://www.masaakiota.net/2025/01/04/%e3%80%90javascript%e3%80%91%e6%9b%96%e6%98%a7%e6%a4%9c%e7%b4%a2%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b/</link>
		<pubDate>Sat, 04 Jan 2025 11:40:02 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=934</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>曖昧検索事情</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>昨今のAIの発達により、ユーザーは曖昧検索が当たり前という意識にシフトしつつあると思います。曖昧検索は、今後のデフォルトになるかもしれません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>JavaScriptで実装</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今のところ、簡単に実装するにはFuse.jsを使用すると良さそうです。少ない件数なら、必要なデータをフロントに持ってきて、そこで処理できそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npm i fuse.js</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">import Fuse from 'fuse.js';

const data = [
    { name: 'ディー・エヌ・エー' },
    { name: 'ディーエヌアエー' },
    { name: 'ディーエヌエー' },
    { name: 'DNA' },
];
const fuse = new Fuse(data, { keys: ['name'], threshold: 1.0 });
console.log(fuse.search('ディーエヌエー')); // 曖昧一致した結果を返す

// 結果
// [
//   { item: { name: 'ディーエヌエー' }, refIndex: 2 },
//   { item: { name: 'ディーエヌアエー' }, refIndex: 1 },
//   { item: { name: 'ディー・エヌ・エー' }, refIndex: 0 }
// ]</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>データが膨大だと、もっとしっかりしたのを組まないといけなくなるかと思いますが、ひとまずといった使い方ですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>934</wp:post_id>
		<wp:post_date><![CDATA[2025-01-04 20:40:02]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-04 11:40:02]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-04 20:42:02]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-04 11:42:02]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90javascript%e3%80%91%e6%9b%96%e6%98%a7%e6%a4%9c%e7%b4%a2%e3%82%92%e5%ae%9f%e8%a3%85%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GitHub Actions】Windows Flutterをビルドする]]></title>
		<link>https://www.masaakiota.net/2025/01/04/%e3%80%90github-actions%e3%80%91windows-flutter%e3%82%92%e3%83%93%e3%83%ab%e3%83%89%e3%81%99%e3%82%8b/</link>
		<pubDate>Sat, 04 Jan 2025 13:12:35 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=937</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Flutterのクロスプラットフォーム</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Flutterは、デスクトップやモバイルに対応した、クロスプラットフォーム開発フレームワークです。ただビルドは対応した環境で行わないといけません。Electronといった、どこでもビルドできるようなものとは違うため、方法を考える必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>GitHub ActionsでWindowsビルドする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、以下のディレクトリ構成になっています。image_converterにflutterプロジェクトが格納されています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">/
  - apps
    - image_converter</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下のようにして、GitHub Actionsでビルドできます。手動での起動となっています。ビルド後の成果物は、アーティファクトからダウンロードできます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="yaml" class="language-yaml">name: Windows Build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: windows-latest
    defaults:
      run:
        working-directory: apps/image_converter
    steps:
    - uses: actions/checkout@v4
    - uses: subosito/flutter-action@v2
      with:
        channel: 'stable'
        architecture: x64
    - run: flutter config --enable-windows-desktop
    - run: flutter build windows --release
    - run: dir build/windows/x64/runner/Release
    - uses: actions/upload-artifact@v4
      with:
        name: windows-build
        path: ${{ github.workspace }}/apps/image_converter/build/windows/x64/runner/Release</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>937</wp:post_id>
		<wp:post_date><![CDATA[2025-01-04 22:12:35]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-04 13:12:35]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-20 09:38:21]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-20 00:38:21]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90github-actions%e3%80%91windows-flutter%e3%82%92%e3%83%93%e3%83%ab%e3%83%89%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="flutter"><![CDATA[Flutter]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Prisma】Migrationスクリプトを書いてみた]]></title>
		<link>https://www.masaakiota.net/2025/01/05/%e3%80%90prisma%e3%80%91migration%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e6%9b%b8%e3%81%84%e3%81%a6%e3%81%bf%e3%81%9f/</link>
		<pubDate>Sun, 05 Jan 2025 06:35:08 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=942</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>PrismaのMigrate</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Prismaでは、通常CLIでMigrationを行います。しかしアプリ実行時に行いたくなる時もあります。今回、アプリ内で実行できるスクリプトを書いてみました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Migrateするコード</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにして使用できるコードを作成しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const migrationsPath = 'xxx'; // migrationsディレクトリのパス
const prisma = new PrismaClient()
await migrate({ prisma, migrationsPath })</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>なお、prisma.schemaで指定したdbは、prisma migrate devで最新になるため、そもそもコードで追う必要がありません。そのため、prisma.schemaで指定したのとは違うdbを指定することを前提にしています。ユーザー個別のdbといった場合ですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下がコードです。Prisma6.1.0で動作確認しています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なお厳密な実装ではないので、あしからずご了承くださいますと幸いです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { PrismaClient } from '@prisma/client'
import fs from 'fs-extra'
import path from 'path'

interface Migration {
  id: string
  checksum: string
  finished_at: Date
  migration_name: string
  logs: string | null
  rolled_back_at: Date | null
  started_at: Date
  applied_steps_count: bigint
}

type Params = {
  prisma: PrismaClient
  migrationsPath: string
}

export async function migrate(params: Params) {
  const { prisma, migrationsPath } = params

  console.log('Migrating...')
  await createMigrationsTable(prisma)
  const appliedNames = await getAppliedNames(prisma)
  const pendingMigrations = getMigrations(migrationsPath).filter(
    (m) =&gt; !appliedNames.includes(m.name)
  )
  for (const { name, script } of pendingMigrations) {
    await applyMigration(prisma, name, script)
  }
  console.log('Migration done')
}

async function applyMigration(prisma: PrismaClient, name: string, script: string) {
  await prisma.$transaction(async (tx) =&gt; {
    for (const sql of parseScript(script)) {
      await tx.$executeRawUnsafe(sql)
    }
    await tx.$executeRaw`
      insert into _prisma_migrations(id, migration_name, checksum, started_at, finished_at, applied_steps_count) 
      values (${crypto.randomUUID()}, ${name}, '', ${new Date()}, ${new Date()}, 1)
    `
    console.log(`Applied: ${name}`)
  })
}

function getMigrations(migrationsPath: string) {
  const dirs = fs
    .readdirSync(migrationsPath, { withFileTypes: true })
    .filter((dirent) =&gt; dirent.isDirectory())
    .map((dirent) =&gt; dirent.name)
    .sort((a, b) =&gt; a.localeCompare(b))
  return dirs.map((dir) =&gt; ({
    name: dir,
    script: fs.readFileSync(path.join(migrationsPath, dir, 'migration.sql'), 'utf-8')
  }))
}

function parseScript(script: string): string[] {
  return script.split(';').filter((q) =&gt; q.trim() !== '')
}

async function createMigrationsTable(prisma: PrismaClient) {
  await prisma.$executeRaw`
    CREATE TABLE IF NOT EXISTS "_prisma_migrations" (
      "id"                    TEXT PRIMARY KEY NOT NULL,
      "checksum"              TEXT NOT NULL,
      "finished_at"           DATETIME,
      "migration_name"        TEXT NOT NULL,
      "logs"                  TEXT,
      "rolled_back_at"        DATETIME,
      "started_at"            DATETIME NOT NULL DEFAULT current_timestamp,
      "applied_steps_count"   INTEGER UNSIGNED NOT NULL DEFAULT 0
  )`
}

async function getAppliedNames(prisma: PrismaClient) {
  const appliedMigrations = (await prisma.$queryRaw`
    select * from _prisma_migrations order by id
  `) as Migration[]
  return appliedMigrations.map((m) =&gt; m.migration_name)
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>942</wp:post_id>
		<wp:post_date><![CDATA[2025-01-05 15:35:08]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-05 06:35:08]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-05 16:07:24]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-05 07:07:24]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90prisma%e3%80%91migration%e3%82%b9%e3%82%af%e3%83%aa%e3%83%97%e3%83%88%e3%82%92%e6%9b%b8%e3%81%84%e3%81%a6%e3%81%bf%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="prisma"><![CDATA[Prisma]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Electron】Prisma + SQLiteをクロスプラットフォームでビルドする]]></title>
		<link>https://www.masaakiota.net/2025/01/05/%e3%80%90electron%e3%80%91prisma-sqlite%e3%82%92%e3%82%af%e3%83%ad%e3%82%b9%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%a0%e3%81%a7%e3%83%93%e3%83%ab%e3%83%89%e3%81%99/</link>
		<pubDate>Sun, 05 Jan 2025 12:48:37 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=949</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>ElectronでのPrisma</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Prismaは通常のライブラリと違い、独特なディレクトリ構成を持っています。そのためElectronでビルドするには、工夫が必要になります。今回、Mac,Windowsの両方でビルドできるようにできたので、ご紹介させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>前提</h2>
<!-- /wp:heading -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>対応プラットフォーム: Win x64, Mac x64</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>パッケージマネージャー: npm</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>確認したPrismaバージョン: 6.1.0</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>prismaのディレクトリ: &lt;project root&gt;/prisma</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2>バイナリを指定する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回Windows, Macに対応するため、以下のようにバイナリを指定します。prisma.schemaです。他のプラットフォームも、試してはいませんが、追加すれば大丈夫だと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">generator client {
    provider      = "prisma-client-js"
    binaryTargets = ["darwin", "windows"]
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2>リソースを指定する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>マイグレーションに使用するファイルと、node_modulesのprisma関連のファイルを、ビルド成果物に含めるように設定します。package.jsonを以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
  "build": {
    "extraResources": [
      "./prisma/migrations/**/*",
      "./node_modules/.prisma/**/*",
      "./node_modules/@prisma/**/*"
    ]
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2>マイグレーション処理を追加する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>PrismaでSQLiteを使用する場合、通常は１つのファイルを対象にします。マイグレーションも、通常はCLIで開発時に行います。しかし実際のアプリではユーザーごとに個別のdbを使用することも多いかと思います。そのため、アプリ起動時にマイグレーションする必要があるのですが、CLIだと権限周りが不安です。そのため、コードで処理を書きます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ユーザーディレクトリにdb.sqliteを作成し、マイグレーションするコードです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { PrismaClient } from '@prisma/client'
import { app } from 'electron'
import { migrate } from './migrate.ts'
import path from 'path'

const userPath = app.getPath('userData')
const dbPath = 'file:' + path.join(userPath, 'db.sqlite')

// ビルド後はリソースディレクトリ、ビルド前はプロジェクトディレクトリを参照
const migrationsPath = app.isPackaged
  ? path.join(process.resourcesPath, 'prisma', 'migrations')
  : path.join(app.getAppPath(), 'prisma', 'migrations')

const prisma = new PrismaClient({ datasources: { db: { url: dbPath } } })
await migrate({ prisma, migrationsPath })</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>使用しているmigrate関数は以下となります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import fs from 'fs-extra';
import path from 'path';
import { PrismaClient } from '@prisma/client/extension';

interface Migration {
    id: string;
    checksum: string;
    finished_at: Date;
    migration_name: string;
    logs: string | null;
    rolled_back_at: Date | null;
    started_at: Date;
    applied_steps_count: bigint;
}

interface Params {
    prisma: PrismaClient;
    migrationsPath: string;
}

export async function migrate(params: Params) {
    const { prisma, migrationsPath } = params;

    console.log('Migrating...');
    await createMigrationsTable(prisma);
    const appliedNames = await getAppliedNames(prisma);
    const pendingMigrations = getMigrations(migrationsPath).filter(
        (m) =&gt; !appliedNames.includes(m.name)
    );
    for (const { name, script } of pendingMigrations) {
        await applyMigration(prisma, name, script);
    }
    console.log('Migration done');
}

async function applyMigration(
    prisma: PrismaClient,
    name: string,
    script: string
) {
    await prisma.$transaction(async (tx: PrismaClient) =&gt; {
        for (const sql of parseScript(script)) {
            await tx.$executeRawUnsafe(sql);
        }
        await tx.$executeRaw`
      insert into _prisma_migrations(id, migration_name, checksum, started_at, finished_at, applied_steps_count) 
      values (${crypto.randomUUID()}, ${name}, '', ${new Date()}, ${new Date()}, 1)
    `;
        console.log(`Applied: ${name}`);
    });
}

function getMigrations(migrationsPath: string) {
    const dirs = fs
        .readdirSync(migrationsPath, { withFileTypes: true })
        .filter((dirent) =&gt; dirent.isDirectory())
        .map((dirent) =&gt; dirent.name)
        .sort((a, b) =&gt; a.localeCompare(b));
    return dirs.map((dir) =&gt; ({
        name: dir,
        script: fs.readFileSync(
            path.join(migrationsPath, dir, 'migration.sql'),
            'utf-8'
        ),
    }));
}

function parseScript(script: string): string[] {
    return script.split(';').filter((q) =&gt; q.trim() !== '');
}

async function createMigrationsTable(prisma: PrismaClient) {
    await prisma.$executeRaw`
    CREATE TABLE IF NOT EXISTS "_prisma_migrations" (
      "id"                    TEXT PRIMARY KEY NOT NULL,
      "checksum"              TEXT NOT NULL,
      "finished_at"           DATETIME,
      "migration_name"        TEXT NOT NULL,
      "logs"                  TEXT,
      "rolled_back_at"        DATETIME,
      "started_at"            DATETIME NOT NULL DEFAULT current_timestamp,
      "applied_steps_count"   INTEGER UNSIGNED NOT NULL DEFAULT 0
  )`;
}

async function getAppliedNames(prisma: PrismaClient) {
    const appliedMigrations = (await prisma.$queryRaw`
    select * from _prisma_migrations order by id
  `) as Migration[];
    return appliedMigrations.map((m) =&gt; m.migration_name);
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>なおmigrate関数は、下記で公開しています。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.npmjs.com/package/@masa-dev/prisma-migrate","type":"rich","providerNameSlug":"npm"} -->
<figure class="wp-block-embed is-type-rich is-provider-npm wp-block-embed-npm"><div class="wp-block-embed__wrapper">
https://www.npmjs.com/package/@masa-dev/prisma-migrate
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2>ビルド</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>armマシンだと自動でarmビルドされたりするため、x64を指定します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">"scripts":{
  "build:win": "npm run build &amp;&amp; electron-builder --win --x64",
  "build:mac": "npm run build &amp;&amp; electron-builder --mac --x64",
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>949</wp:post_id>
		<wp:post_date><![CDATA[2025-01-05 21:48:37]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-05 12:48:37]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-05 22:11:14]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-05 13:11:14]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90electron%e3%80%91prisma-sqlite%e3%82%92%e3%82%af%e3%83%ad%e3%82%b9%e3%83%97%e3%83%a9%e3%83%83%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%83%a0%e3%81%a7%e3%83%93%e3%83%ab%e3%83%89%e3%81%99]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="prisma"><![CDATA[Prisma]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_2c302a3b0f63871f80593c8d1b93b17c]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://www.npmjs.com/package/@masa-dev/prisma-migrate">@masa-dev/prisma-migrate</a></h4><p>A lightweight utility for managing database migrations with Prisma.. Latest version: 0.1.0, last published: 2 hours ago. Start using @masa-dev/prisma-migrate in your project by running `npm i @masa-dev/prisma-migrate`. There are no other projects in the npm registry using @masa-dev/prisma-migrate.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_2c302a3b0f63871f80593c8d1b93b17c]]></wp:meta_key>
		<wp:meta_value><![CDATA[1736082675]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GAS】指定アカウントのGmail OAuth2トークンを取得する]]></title>
		<link>https://www.masaakiota.net/2025/01/06/%e3%80%90gas%e3%80%91%e6%8c%87%e5%ae%9a%e3%82%a2%e3%82%ab%e3%82%a6%e3%83%b3%e3%83%88%e3%81%aegmail-oauth2%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b/</link>
		<pubDate>Mon, 06 Jan 2025 06:23:36 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=962</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>GASのOAuth2</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GASでOAuth2を使用するには、以下のライブラリを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://github.com/googleworkspace/apps-script-oauth2","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/googleworkspace/apps-script-oauth2
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2>指定アカウントのGmail OAuth2トークンを取得する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>createServiceの引数でemail自体を指定することで、キーが分離されます。それにより、複数アカウントの情報がuserPropertyに保存されるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>下記のようにして実現できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">function main() {
  const email = 'xxx@example.com'; // 任意のGmailアカウント
  const token = getMailToken(email);
  if (token) {
    SpreadsheetApp.getUi().alert(`認証済みです。token: ${token}`);
  }
}

function getMailToken(email) {
  const service = getMailService_(email);
  if (!service.hasAccess()) {
    const authorizationUrl = service.getAuthorizationUrl();
    showAuthDialog(authorizationUrl);
    return undefined;
  }
  return service.getAccessToken();
}

function showAuthDialog(authorizationUrl) {
  const template = HtmlService.createTemplate(`
      &lt;button onclick="window.open('${authorizationUrl}');google.script.host.close()">
        認証
      &lt;/button>
      をクリックして、処理を完了してください。
    `);
  template.authorizationUrl = authorizationUrl;
  const page = template.evaluate();
  SpreadsheetApp.getUi().showModalDialog(page, '認証');
}

function getMailService_(email) {
  return OAuth2.createService(email) // emailを指定することで、個別にデータが保存される
    .setAuthorizationBaseUrl('https://accounts.google.com/o/oauth2/auth')
    .setTokenUrl('https://accounts.google.com/o/oauth2/token')
    .setClientId(PropertiesService.getScriptProperties().getProperty('CLIENT_ID'))
    .setClientSecret(PropertiesService.getScriptProperties().getProperty('CLIENT_SECRET'))
    .setCallbackFunction('authCallback')
    .setPropertyStore(PropertiesService.getUserProperties())
    .setScope('https://www.googleapis.com/auth/gmail.readonly')
    .setParam('login_hint', email)
    .setParam('access_type', 'offline')
    .setParam('prompt', 'consent');
}

function authCallback(request) {
  const email = request.parameter.serviceName;
  const service = getMailService_(email);
  const isAuthorized = service.handleCallback(request);
  if (isAuthorized) {
    return HtmlService.createHtmlOutput('Success! You can close this tab.');
  } else {
    return HtmlService.createHtmlOutput('Denied. You can close this tab');
  }
}
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>962</wp:post_id>
		<wp:post_date><![CDATA[2025-01-06 15:23:36]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-06 06:23:36]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-06 15:26:57]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-06 06:26:57]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gas%e3%80%91%e6%8c%87%e5%ae%9a%e3%82%a2%e3%82%ab%e3%82%a6%e3%83%b3%e3%83%88%e3%81%aegmail-oauth2%e3%83%88%e3%83%bc%e3%82%af%e3%83%b3%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_eb0f87da2f0de1bc9f198b471166989c]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/googleworkspace/apps-script-oauth2">GitHub - googleworkspace/apps-script-oauth2: An OAuth2 library for Google Apps Script.</a></h4><p>An OAuth2 library for Google Apps Script. Contribute to googleworkspace/apps-script-oauth2 development by creating an account on GitHub.</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_eb0f87da2f0de1bc9f198b471166989c]]></wp:meta_key>
		<wp:meta_value><![CDATA[1736144748]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Flutter】オブジェクトを便利にするfreezed, json_serializable]]></title>
		<link>https://www.masaakiota.net/2025/01/06/%e3%80%90flutter%e3%80%91%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%82%92%e4%be%bf%e5%88%a9%e3%81%ab%e3%81%99%e3%82%8bfreezed-json_serializable/</link>
		<pubDate>Mon, 06 Jan 2025 11:49:53 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=969</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Flutter</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Flutterはクロスプラットフォーム開発環境です。普段JavaScriptに慣れていると、面倒だと感じることも多いのですが、今回はそれを解決していきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>build_runner</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まずはbuild_runnerをインストールします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">flutter pub add dev:build_runner</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下のようにして、自動生成します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">dart run build_runner build</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>監視を続けるには、watchを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">dart run build_runner watch</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2>freezed</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>freezedは、クラスをまるでJavaScriptオブジェクトのように（語弊）扱えるようにします。以下のように使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">flutter pub add freezed_annotation dev:freezed</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="dart" class="language-dart">import 'package:freezed_annotation/freezed_annotation.dart';

part 'user.freezed.dart';

@freezed
class User with _$User {
  const factory User({
    required String name,
    required int age,
  }) = _User;
}</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="dart" class="language-dart">const taro = User(name: 'Taro', age: 10);
print(taro); // 自動でtoString()が呼ばれる
print(taro.copyWith(age: 11)); // 年齢だけ変える
print(taro == User(name: 'Taro', age: 10)); // true</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2>json関連</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>jsonへのencode,decodeは、別ライブラリを追加します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">flutter pub add json_annotation dev:json_serializable</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>freezedをすでに使っているため、２行追加するだけです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="dart" class="language-dart">import 'package:freezed_annotation/freezed_annotation.dart';

part 'user.freezed.dart';

// 追加
part 'user.g.dart';

@freezed
class User with _$User {
  const factory User({
    required String name,
    required int age,
  }) = _User;

  // 追加
  factory User.fromJson(Map&lt;String, dynamic> json) => _$UserFromJson(json);
}</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="dart" class="language-dart">print(taro.toJson()); // {name: Taro, age: 10}
print(User.fromJson(jsonDecode('{"name": "Taro", "age": 10}'))); // User(name: Taro, age: 10)</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>969</wp:post_id>
		<wp:post_date><![CDATA[2025-01-06 20:49:53]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-06 11:49:53]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-06 20:51:13]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-06 11:51:13]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90flutter%e3%80%91%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%82%92%e4%be%bf%e5%88%a9%e3%81%ab%e3%81%99%e3%82%8bfreezed-json_serializable]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="flutter"><![CDATA[Flutter]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Flutter】配置を視覚的に確認する]]></title>
		<link>https://www.masaakiota.net/2025/01/06/%e3%80%90flutter%e3%80%91%e9%85%8d%e7%bd%ae%e3%82%92%e8%a6%96%e8%a6%9a%e7%9a%84%e3%81%ab%e7%a2%ba%e8%aa%8d%e3%81%99%e3%82%8b/</link>
		<pubDate>Mon, 06 Jan 2025 14:02:27 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=976</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>配置</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>HTMLだと、要素の配置はborderなどで視覚的に判断できますが、Flutterだと手軽に行えません。しかし今回ご紹介する方法で、簡単に確認することができます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>debugPaintSizeEnabledを用いる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにして、簡単に配置を確認できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="dart" class="language-dart">import 'package:flutter/rendering.dart';

void main() {
  debugPaintSizeEnabled = true;
  ...
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このdebugPaintSizeEnabledはグローバルなため、どこでも設定できます。ちょっと見たくなった時に、ささっとtrueにすれば、簡単に配置を確認できます。便利ですね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>976</wp:post_id>
		<wp:post_date><![CDATA[2025-01-06 23:02:27]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-06 14:02:27]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-06 23:02:29]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-06 14:02:29]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90flutter%e3%80%91%e9%85%8d%e7%bd%ae%e3%82%92%e8%a6%96%e8%a6%9a%e7%9a%84%e3%81%ab%e7%a2%ba%e8%aa%8d%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="flutter"><![CDATA[Flutter]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Flutter】怠け者のためのおすすめライブラリ]]></title>
		<link>https://www.masaakiota.net/2025/01/08/%e3%80%90flutter%e3%80%91%e6%80%a0%e3%81%91%e8%80%85%e3%81%ae%e3%81%9f%e3%82%81%e3%81%ae%e3%81%8a%e3%81%99%e3%81%99%e3%82%81%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa/</link>
		<pubDate>Wed, 08 Jan 2025 06:32:30 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=979</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Flutterのライブラリ事情</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Flutterは、ライブラリがそれほど充実していない印象があります。Nodeならこんなライブラリあるのに。Reactならもっと楽にできるのに。そんな怠け者の私が、定番も含めて、ChatGPT先生に愚痴りながら見つけたライブラリを紹介していきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">おすすめライブラリ</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">freezed</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>定番かと思います。クラスに便利な関数を追加します。詳細は以下で解説しています。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"http://www.masaakiota.net/2025/01/06/%e3%80%90flutter%e3%80%91%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%82%92%e4%be%bf%e5%88%a9%e3%81%ab%e3%81%99%e3%82%8bfreezed-json_serializable","type":"wp-embed","providerNameSlug":""} -->
<figure class="wp-block-embed is-type-wp-embed"><div class="wp-block-embed__wrapper">
http://www.masaakiota.net/2025/01/06/%e3%80%90flutter%e3%80%91%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%82%92%e4%be%bf%e5%88%a9%e3%81%ab%e3%81%99%e3%82%8bfreezed-json_serializable
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">shared_preferences</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>こちらもおそらく定番です。情報をストレージに保存します。キーバリュー型です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下のように使用します。String以外にもいろいろあります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="dart" class="language-dart">final prefs = await SharedPreferences.getInstance();
await prefs.setString('data', 'test');
final data = prefs.getString('data');
print(data);</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">adaptive_dialog</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ダイアログ周りが素敵です。以下の機能が使えます。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>showOkAlertDialog</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>showOkCancelAlertDialog</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>showConfirmationDialog</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>showModalActionSheet</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>showTextInputDialog</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>showTextAnswerDialog</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>なお親でmaterial3テーマを適用していたのですが、見た目を合わせるためにstyle: AdaptiveStyle.material を指定する必要がありました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">gap</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>間隔を開けます。以下のように使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="dart" class="language-dart">Column(
  children:[
    const Text('aaa'),
    Gap(10),
    const Text('bbb'),
  ]
)</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">flex_color_picker</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>色選択UIです。似たものにflutter_colorpickerもあるのですが、ウィンドウサイズが変わると残念なことになります。一方flex_color_pickerは、かなり柔軟に対応してくれます。デザインも秀逸です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>979</wp:post_id>
		<wp:post_date><![CDATA[2025-01-08 15:32:30]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-08 06:32:30]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-17 19:45:47]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-17 10:45:47]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90flutter%e3%80%91%e6%80%a0%e3%81%91%e8%80%85%e3%81%ae%e3%81%9f%e3%82%81%e3%81%ae%e3%81%8a%e3%81%99%e3%81%99%e3%82%81%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="flutter"><![CDATA[Flutter]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_9a2bf72b61c88dbd8af50a24b7b10cfc]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="wp-embedded-content" data-secret="GClMKNFji9"><a href="http://35.221.87.155/2025/01/06/%e3%80%90flutter%e3%80%91%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%82%92%e4%be%bf%e5%88%a9%e3%81%ab%e3%81%99%e3%82%8bfreezed-json_serializable/">【Flutter】オブジェクトを便利にするfreezed, json_serializable</a></blockquote><iframe title="&#8220;【Flutter】オブジェクトを便利にするfreezed, json_serializable&#8221; &#8212; 太田雅昭" sandbox="allow-scripts" security="restricted" src="http://35.221.87.155/2025/01/06/%e3%80%90flutter%e3%80%91%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%82%92%e4%be%bf%e5%88%a9%e3%81%ab%e3%81%99%e3%82%8bfreezed-json_serializable/embed/#?secret=GClMKNFji9" width="600" height="338" data-secret="GClMKNFji9" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" class="wp-embedded-content"></iframe><script>/*! This file is auto-generated */!function(c,d){"use strict";var e=!1,o=!1;if(d.querySelector)if(c.addEventListener)e=!0;if(c.wp=c.wp||{},c.wp.receiveEmbedMessage);else if(c.wp.receiveEmbedMessage=function(e){var t=e.data;if(!t);else if(!(t.secret||t.message||t.value));else if(/[^a-zA-Z0-9]/.test(t.secret));else{for(var r,s,a,i=d.querySelectorAll('iframe[data-secret="'+t.secret+'"]'),n=d.querySelectorAll('blockquote[data-secret="'+t.secret+'"]'),o=new RegExp("^https?:$","i"),l=0;l<n.length;l++)n[l].style.display="none";for(l=0;l<i.length;l++)if(r=i[l],e.source!==r.contentWindow);else{if(r.removeAttribute("style"),"height"===t.message){if(1e3<(s=parseInt(t.value,10)))s=1e3;else if(~~s<200)s=200;r.height=s}if("link"===t.message)if(s=d.createElement("a"),a=d.createElement("a"),s.href=r.getAttribute("src"),a.href=t.value,!o.test(a.protocol));else if(a.host===s.host)if(d.activeElement===r)c.top.location.href=t.value}}},e)c.addEventListener("message",c.wp.receiveEmbedMessage,!1),d.addEventListener("DOMContentLoaded",t,!1),c.addEventListener("load",t,!1);function t(){if(o);else{o=!0;for(var e,t,r,s=-1!==navigator.appVersion.indexOf("MSIE 10"),a=!!navigator.userAgent.match(/Trident.*rv:11./),i=d.querySelectorAll("iframe.wp-embedded-content"),n=0;n<i.length;n++){if(!(r=(t=i[n]).getAttribute("data-secret")))r=Math.random().toString(36).substr(2,10),t.src+="#?secret="+r,t.setAttribute("data-secret",r);if(s||a)(e=t.cloneNode(!0)).removeAttribute("security"),t.parentNode.replaceChild(e,t);t.contentWindow.postMessage({message:"ready",secret:r},"*")}}}}(window,document);</script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_9a2bf72b61c88dbd8af50a24b7b10cfc]]></wp:meta_key>
		<wp:meta_value><![CDATA[1736318055]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_17e7b69f3391acff20e9eb0c17fc1eae]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_3a59a8ec4588b8c23b19c0f654831606]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="wp-embedded-content" data-secret="TJReVp3HvQ"><a href="https://www.masaakiota.net/2025/01/06/%e3%80%90flutter%e3%80%91%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%82%92%e4%be%bf%e5%88%a9%e3%81%ab%e3%81%99%e3%82%8bfreezed-json_serializable/">【Flutter】オブジェクトを便利にするfreezed, json_serializable</a></blockquote><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" style="position: absolute; visibility: hidden;" title="&#8220;【Flutter】オブジェクトを便利にするfreezed, json_serializable&#8221; &#8212; 太田雅昭" src="https://www.masaakiota.net/2025/01/06/%e3%80%90flutter%e3%80%91%e3%82%aa%e3%83%96%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%82%92%e4%be%bf%e5%88%a9%e3%81%ab%e3%81%99%e3%82%8bfreezed-json_serializable/embed/#?secret=jSgpBMzr1V#?secret=TJReVp3HvQ" data-secret="TJReVp3HvQ" width="600" height="338" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_3a59a8ec4588b8c23b19c0f654831606]]></wp:meta_key>
		<wp:meta_value><![CDATA[1737108869]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】React + TypeScript環境を手軽に構築する]]></title>
		<link>https://www.masaakiota.net/2025/01/08/%e3%80%90laravel%e3%80%91react-typescript%e7%92%b0%e5%a2%83%e3%82%92%e6%89%8b%e8%bb%bd%e3%81%ab%e6%a7%8b%e7%af%89%e3%81%99%e3%82%8b/</link>
		<pubDate>Wed, 08 Jan 2025 09:50:08 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=992</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>環境構築</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>環境構築は、とても面倒なものです。どこをどう設定してと、いろいろなサイトを参考にしながら入力していったりします。しかし便利なツールもあったりするもので、今回はサクッと構築する方法のご紹介です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>Laravel + React + TypeScript構築</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のように行います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">composer create-project laravel/laravel example-app
cd example-app

# Breezeのインストール
composer require laravel/breeze --dev
php artisan breeze:install</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>すると、以下の選択肢が出てくるので、React with Inertiaを選択します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">
 ┌ Which Breeze stack would you like to install? ───────────────┐
 │ › ● Blade with Alpine                                        │
 │   ○ Livewire (Volt Class API) with Alpine                    │
 │   ○ Livewire (Volt Functional API) with Alpine               │
 │   ○ React with Inertia                                       │
 │   ○ Vue with Inertia                                         │
 │   ○ API only                                                 │
 └──────────────────────────────────────────────────────────────┘</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>続いてTypeScriptを選択。他も好みに応じて選択してください。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">
 ┌ Would you like any optional features? ───────────────────────┐
 │ › ◻ Dark mode                                                │
 │   ◻ Inertia SSR                                              │
 │   ◻ TypeScript                                               │
 │   ◻ ESLint with Prettier                                     │
 └──────────────────────────────────────────────────────────────┘</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下はお好みで。Pestの方がモダンのようです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class=""> ┌ Which testing framework do you prefer? ──────────────────────┐
 │ › ● Pest                                                     │
 │   ○ PHPUnit                                                  │
 └──────────────────────────────────────────────────────────────┘</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>992</wp:post_id>
		<wp:post_date><![CDATA[2025-01-08 18:50:08]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-08 09:50:08]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-08 18:50:08]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-08 09:50:08]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91react-typescript%e7%92%b0%e5%a2%83%e3%82%92%e6%89%8b%e8%bb%bd%e3%81%ab%e6%a7%8b%e7%af%89%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="inertia"><![CDATA[Inertia]]></category>
		<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】XServerでPHPとComposerのバージョンを上げる]]></title>
		<link>https://www.masaakiota.net/2025/01/09/%e3%80%90laravel%e3%80%91xserver%e3%81%a7php%e3%81%a8composer%e3%81%ae%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e3%82%92%e4%b8%8a%e3%81%92%e3%82%8b/</link>
		<pubDate>Thu, 09 Jan 2025 13:38:45 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=999</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>XServer</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>XServerで、PHPが7系、Composerも古く、Laravelが11が使えませんでした。そこでPHPとComposerのバージョンを上げたお話です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>PHPのバージョンを上げる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにして、シンボリックリンクを作成します。$HOME/bin/phpが存在してリンクを作成できない場合は、削除してから実行します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">ln -s /usr/bin/php8.3 $HOME/bin/php</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2>Composerのバージョンを上げる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>composer self-updateが使えなかったため、公式サイトに従ってインストールしました。最後のcomposer.pharは、$HOME/bin/composerに入れました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://getcomposer.org/download/","type":"rich","providerNameSlug":"getcomposer"} -->
<figure class="wp-block-embed is-type-rich is-provider-getcomposer wp-block-embed-getcomposer"><div class="wp-block-embed__wrapper">
https://getcomposer.org/download/
</div></figure>
<!-- /wp:embed -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>999</wp:post_id>
		<wp:post_date><![CDATA[2025-01-09 22:38:45]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-09 13:38:45]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-09 22:38:46]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-09 13:38:46]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91xserver%e3%81%a7php%e3%81%a8composer%e3%81%ae%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e3%82%92%e4%b8%8a%e3%81%92%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_5630906e62c4d0ae7d7c6d85acd4d155]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://getcomposer.org/download/">Composer</a></h4><p>A Dependency Manager for PHP</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_5630906e62c4d0ae7d7c6d85acd4d155]]></wp:meta_key>
		<wp:meta_value><![CDATA[1736429916]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】XServerでのCronが動かない問題]]></title>
		<link>https://www.masaakiota.net/2025/01/09/%e3%80%90laravel%e3%80%91xserver%e3%81%a7%e3%81%aecron%e3%81%8c%e5%8b%95%e3%81%8b%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Thu, 09 Jan 2025 14:51:23 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1001</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">XServer</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>XServerでは、CLIのPHPバージョンが古かったり、Composerが古かったりする問題がありました。それに関しては、以下で解説しています。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.masaakiota.net/2025/01/09/%e3%80%90laravel%e3%80%91xserver%e3%81%a7php%e3%81%a8composer%e3%81%ae%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e3%82%92%e4%b8%8a%e3%81%92%e3%82%8b/","type":"wp-embed","providerNameSlug":""} -->
<figure class="wp-block-embed is-type-wp-embed"><div class="wp-block-embed__wrapper">
https://www.masaakiota.net/2025/01/09/%e3%80%90laravel%e3%80%91xserver%e3%81%a7php%e3%81%a8composer%e3%81%ae%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e3%82%92%e4%b8%8a%e3%81%92%e3%82%8b/
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Cron動かない問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>サーバーパネルからGUIで以下のように設定しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">cd /home/xxx/yyy/public_html &amp;&amp; php artisan schedule:run &gt;&gt; /dev/null 2&gt;&amp;1 </code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>確認します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">ps aux | grep artisan</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>動いてません。一体どうしてなのか。色々調べてもわからなかったのですが、ふと思いつきました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>あれ、PHPのバージョンどうなってるんやろう。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下のように、PHPのパスを指定してみました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">cd /home/xxx/yyy/public_html &amp;&amp; /usr/bin/php8.3 artisan schedule:run &gt;&gt; /dev/null 2&gt;&amp;1 </code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>動きました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">原因</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、phpのバージョン上げにはシンボリックリンクを~/bin/phpに指定するという方法をとっていました。しかしcronからの実行は、ユーザー関係ないのでしょうか。そのままデフォルトのphpを使用していたのだと思われます。ともあれひとまず安心です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1001</wp:post_id>
		<wp:post_date><![CDATA[2025-01-09 23:51:23]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-09 14:51:23]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-14 18:14:48]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-14 09:14:48]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91xserver%e3%81%a7%e3%81%aecron%e3%81%8c%e5%8b%95%e3%81%8b%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_786d85c87f4673fa5c6961c74c2b7366]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="wp-embedded-content" data-secret="6wU78NxHPx"><a href="http://35.221.87.155/2025/01/09/%e3%80%90laravel%e3%80%91xserver%e3%81%a7php%e3%81%a8composer%e3%81%ae%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e3%82%92%e4%b8%8a%e3%81%92%e3%82%8b/">【Laravel】XServerでPHPとComposerのバージョンを上げる</a></blockquote><iframe title="&#8220;【Laravel】XServerでPHPとComposerのバージョンを上げる&#8221; &#8212; 太田雅昭" sandbox="allow-scripts" security="restricted" src="http://35.221.87.155/2025/01/09/%e3%80%90laravel%e3%80%91xserver%e3%81%a7php%e3%81%a8composer%e3%81%ae%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e3%82%92%e4%b8%8a%e3%81%92%e3%82%8b/embed/#?secret=6wU78NxHPx" width="600" height="338" data-secret="6wU78NxHPx" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" class="wp-embedded-content"></iframe><script>/*! This file is auto-generated */!function(c,d){"use strict";var e=!1,o=!1;if(d.querySelector)if(c.addEventListener)e=!0;if(c.wp=c.wp||{},c.wp.receiveEmbedMessage);else if(c.wp.receiveEmbedMessage=function(e){var t=e.data;if(!t);else if(!(t.secret||t.message||t.value));else if(/[^a-zA-Z0-9]/.test(t.secret));else{for(var r,s,a,i=d.querySelectorAll('iframe[data-secret="'+t.secret+'"]'),n=d.querySelectorAll('blockquote[data-secret="'+t.secret+'"]'),o=new RegExp("^https?:$","i"),l=0;l<n.length;l++)n[l].style.display="none";for(l=0;l<i.length;l++)if(r=i[l],e.source!==r.contentWindow);else{if(r.removeAttribute("style"),"height"===t.message){if(1e3<(s=parseInt(t.value,10)))s=1e3;else if(~~s<200)s=200;r.height=s}if("link"===t.message)if(s=d.createElement("a"),a=d.createElement("a"),s.href=r.getAttribute("src"),a.href=t.value,!o.test(a.protocol));else if(a.host===s.host)if(d.activeElement===r)c.top.location.href=t.value}}},e)c.addEventListener("message",c.wp.receiveEmbedMessage,!1),d.addEventListener("DOMContentLoaded",t,!1),c.addEventListener("load",t,!1);function t(){if(o);else{o=!0;for(var e,t,r,s=-1!==navigator.appVersion.indexOf("MSIE 10"),a=!!navigator.userAgent.match(/Trident.*rv:11./),i=d.querySelectorAll("iframe.wp-embedded-content"),n=0;n<i.length;n++){if(!(r=(t=i[n]).getAttribute("data-secret")))r=Math.random().toString(36).substr(2,10),t.src+="#?secret="+r,t.setAttribute("data-secret",r);if(s||a)(e=t.cloneNode(!0)).removeAttribute("security"),t.parentNode.replaceChild(e,t);t.contentWindow.postMessage({message:"ready",secret:r},"*")}}}}(window,document);</script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_786d85c87f4673fa5c6961c74c2b7366]]></wp:meta_key>
		<wp:meta_value><![CDATA[1736435266]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_98734f212eb5c4219e1119bc8a22468e]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Flutter】TextPainterで斜体の端切れを解消する]]></title>
		<link>https://www.masaakiota.net/2025/01/10/%e3%80%90flutter%e3%80%91textpainter%e3%81%a7%e6%96%9c%e4%bd%93%e3%81%ae%e7%ab%af%e5%88%87%e3%82%8c%e3%82%92%e8%a7%a3%e6%b6%88%e3%81%99%e3%82%8b/</link>
		<pubDate>Thu, 09 Jan 2025 16:12:33 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1006</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>TextPainter</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>TextPainterは、Flutterでテキストを描画する時に使用します。画像に重ねたりもできます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ただ斜体だと、幅の計算がうまくいきません。そのため、端が切れてしまったりします。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2>解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>斜体での端切れ問題を解決するために、以下のようにします。大きめのキャンバスに書いて、trimしています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="dart" class="language-dart">import 'package:image/image.dart' as img;

final textPainter = TextPainter(
    text: TextSpan(
      text: 'Test',
      style: TextStyle(
        fontSize: 500,
        fontStyle: FontStyle.italic,
        fontFamily: 'Sans Serif',
      ),
    ),
  );

// テキストのサイズを計算
textPainter.layout();

// テキストのキャンバスサイズを設定
final textWidth = textPainter.width.ceil() * 1.5; // 大きめにする
final textHeight = textPainter.height.ceil();

// テキストを描画
final recorder = ui.PictureRecorder();
final canvas = Canvas(recorder);
textPainter.paint(canvas, Offset.zero);

// テキストの画像を生成
final textImage = await recorder
    .endRecording()
    .toImage(textWidth.toInt(), textHeight);
final textBytes =
    await textImage.toByteData(format: ui.ImageByteFormat.png);
var resultImage = img.decodeImage(textBytes!.buffer.asUint8List());

// trimする
resultImage = img.trim(resultImage!);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>この他にも、計算方法を変えたり色々やってみたのですが、どうも斜体だと正確な計算はできないようです。そのため、今回のようにtrim手法を使いました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1006</wp:post_id>
		<wp:post_date><![CDATA[2025-01-10 01:12:33]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-09 16:12:33]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-10 01:13:10]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-09 16:13:10]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90flutter%e3%80%91textpainter%e3%81%a7%e6%96%9c%e4%bd%93%e3%81%ae%e7%ab%af%e5%88%87%e3%82%8c%e3%82%92%e8%a7%a3%e6%b6%88%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="flutter"><![CDATA[Flutter]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Docker】なにー！？docker.appを開くとコンピュータが破損しますだってー！？？]]></title>
		<link>https://www.masaakiota.net/2025/01/10/%e3%80%90docker%e3%80%91%e3%81%aa%e3%81%ab%e3%83%bc%ef%bc%81%ef%bc%9fdocker-app%e3%82%92%e9%96%8b%e3%81%8f%e3%81%a8%e3%82%b3%e3%83%b3%e3%83%94%e3%83%a5%e3%83%bc%e3%82%bf%e3%81%8c%e7%a0%b4%e6%90%8d/</link>
		<pubDate>Fri, 10 Jan 2025 03:19:50 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1009</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">新年早々。。。</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今朝こんなメッセージが出ました。macos m2です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">docker.appを開くとコンピュータが破損します</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ほほう、これは珍しい。ん？いやいや、一体何が起こってるの？</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>どうやら一部のファイルの署名が正しくなく、マルウェアとして認識されているそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下の手順に従います。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://github.com/docker/for-mac/issues/7527","type":"rich","providerNameSlug":"github"} -->
<figure class="wp-block-embed is-type-rich is-provider-github wp-block-embed-github"><div class="wp-block-embed__wrapper">
https://github.com/docker/for-mac/issues/7527
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>私の場合、以下の手順でした。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>マルウェア扱いされる</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>とりあえず検索。例のコードを実行</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Dockerをゴミ箱に入れる</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>最新バージョンをダウンロードしてインストール</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>マルウェア扱いされる</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ここからが本番</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>はちまきをして杵と臼を用意する</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>紹介されているコードを実行</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Dockerを削除</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Dockバーのショートカットを削除</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ゴミ箱を空にする</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>再起動する</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>紹介されているコードを実行</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>インストール</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>紹介されているコードを実行</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>正常起動</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>詳細に書いておいて、順番は間違えてるかもしれないです。そもそもそれほど覚えていないです。あしからずご了承いただけますと幸いです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1009</wp:post_id>
		<wp:post_date><![CDATA[2025-01-10 12:19:50]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-10 03:19:50]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-10 12:40:55]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-10 03:40:55]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90docker%e3%80%91%e3%81%aa%e3%81%ab%e3%83%bc%ef%bc%81%ef%bc%9fdocker-app%e3%82%92%e9%96%8b%e3%81%8f%e3%81%a8%e3%82%b3%e3%83%b3%e3%83%94%e3%83%a5%e3%83%bc%e3%82%bf%e3%81%8c%e7%a0%b4%e6%90%8d]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="docker"><![CDATA[Docker]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_a2d133f7b7d7ef111f5df73efedcc83b]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="embedly-card" data-card-controls="1" data-card-align="center" data-card-theme="light"><h4><a href="https://github.com/docker/for-mac/issues/7527">Malware detection prevents Docker Desktop to start · Issue #7527 · docker/for-mac</a></h4><p>Description Some versions of Docker Desktop might fail to start or function with the following error message: Malware Blocked. "com.docker.vmnetd" was not opened because it contains malware. This action did not harm your Mac. ImportantTh...</p></blockquote><script async src="//cdn.embedly.com/widgets/platform.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_a2d133f7b7d7ef111f5df73efedcc83b]]></wp:meta_key>
		<wp:meta_value><![CDATA[1736478664]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Vite】本番でテストと勘違いされる問題]]></title>
		<link>https://www.masaakiota.net/2025/01/10/%e3%80%90laravel%e3%80%91vite%e3%81%ab%e3%83%86%e3%82%b9%e3%83%88%e3%81%a8%e5%8b%98%e9%81%95%e3%81%84%e3%81%95%e3%82%8c%e3%82%8b%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Fri, 10 Jan 2025 09:31:39 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1013</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Vite</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Viteは、本番モードと開発モードがあります。通常、buildすれば本番モードで使用できるのですが、なぜか開発モードで動いてしまい、正常動作しない問題がありました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>具体的には、今回使用していたのはLaravelでした。phpの出力するHTMLソースが、JavaScriptを参照しているのですが、参照先がhttp://127.0.0.1:5173になっていました。ヘルプミー</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">hotファイルがある</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>publicフォルダに、hotファイルがあることが原因でした。viteは、hotファイルの有無で、本番か開発かを判断し、Laravelのblade.php内で出力を変更しているようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>本番環境でhotファイルを削除することで、またViteと仲良くなれました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1013</wp:post_id>
		<wp:post_date><![CDATA[2025-01-10 18:31:39]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-10 09:31:39]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-10 18:38:00]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-10 09:38:00]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91vite%e3%81%ab%e3%83%86%e3%82%b9%e3%83%88%e3%81%a8%e5%8b%98%e9%81%95%e3%81%84%e3%81%95%e3%82%8c%e3%82%8b%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="vite"><![CDATA[Vite]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeScript】なんじゃこりゃ！？Vitestが便利すぎる【感想】]]></title>
		<link>https://www.masaakiota.net/2025/01/11/%e3%80%90typescript%e3%80%91%e3%81%aa%e3%82%93%e3%81%98%e3%82%83%e3%81%93%e3%82%8a%e3%82%83%ef%bc%81%ef%bc%9fvitest%e3%81%8c%e4%be%bf%e5%88%a9%e3%81%99%e3%81%8e%e3%82%8b%e3%80%90%e6%84%9f%e6%83%b3/</link>
		<pubDate>Sat, 11 Jan 2025 09:40:27 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1021</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">テストコードという悪魔の所業</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>テストコードは、本当に書くのが嫌になります。ですがちゃんとテストコードを書かないと、余計に嫌なことになります。最近ではChatGPTにテストコードを書いてもらったりしています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>それはいいのですが、まず設定が面倒、毎回走らせるのが面倒、必要なこととはいえ嫌だなぁと、もう３回も嫌だと言ってしまいました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ですがVitest、なにこれすごい。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Vitestの何がすごいか</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>何がすごいって、設定がいりません。TypeScriptも、すぐにテストできます。何これすごい。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ChatGPTと喜びを分かち合いました。以下、ChatGPTの見解です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">はい！vitestは本当に便利ですよね！

vitestは比較的新しいテストランナーで、2021年末頃から開発が始まりました。Viteのエコシステムの一部として作られ、以下のような特徴があります：

🚀 超高速な実行速度
Viteのネイティブ ESM HMR を活用
テストをパラレルで実行

😌 設定いらずの使いやすさ
Viteプロジェクトならゼロコンフィグで使える
Jestと互換性のある API

⚡️ モダンな開発体験
Watch モードがすごく速い
スナップショットテストのサポート
TypeScriptのネイティブサポート

vitestが便利な理由：
Jestの文法をほぼそのまま使える
設定が簡単（多くの場合は設定不要）
Viteの高速な開発サーバーの恩恵を受けられる
TypeScriptとの相性が抜群
最近のモダンなJavaScript/TypeScriptプロジェクトでは、vitestの採用が増えてきていますね！特にViteベースのプロジェクトでは、追加の設定なしですぐに使い始められる点が大きな魅力です。</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>絵文字まで使って、喜びを共有してくれました。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1021</wp:post_id>
		<wp:post_date><![CDATA[2025-01-11 18:40:27]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-11 09:40:27]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-11 18:41:15]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-11 09:41:15]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typescript%e3%80%91%e3%81%aa%e3%82%93%e3%81%98%e3%82%83%e3%81%93%e3%82%8a%e3%82%83%ef%bc%81%ef%bc%9fvitest%e3%81%8c%e4%be%bf%e5%88%a9%e3%81%99%e3%81%8e%e3%82%8b%e3%80%90%e6%84%9f%e6%83%b3]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Cron】shだとsourceが使えなくておぎゃぁ]]></title>
		<link>https://www.masaakiota.net/2025/01/13/%e3%80%90cron%e3%80%91sh%e3%81%a0%e3%81%a8source%e3%81%8c%e4%bd%bf%e3%81%88%e3%81%aa%e3%81%8f%e3%81%a6%e3%81%8a%e3%81%8e%e3%82%83%e3%81%81/</link>
		<pubDate>Mon, 13 Jan 2025 08:51:37 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1028</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Cronだと環境が違う</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Cronで実行する場合、色々と環境が変わってしまいます。以下のようにチェックします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">* * * * * env &gt; ~/cron.log</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">HOME=/home/masaaki
LOGNAME=masaaki
PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin
LANG=C.UTF-8
SHELL=/bin/sh
PWD=/home/masaaki</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここで注目するのはSHELL=/bin/shとなっている点です。sourceコマンドはbashのみで、shでは使えません。ちなみにgamesというディレクトリがありますが、別にゲームをしているわけではありません。ubuntuのデフォルトディレクトリでしょうか？</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">bashに変更する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">SHELL=/bin/bash
* * * * * source ~/.bashrc &amp;&amp; your-command</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1028</wp:post_id>
		<wp:post_date><![CDATA[2025-01-13 17:51:37]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-13 08:51:37]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:15:30]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:15:30]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90cron%e3%80%91sh%e3%81%a0%e3%81%a8source%e3%81%8c%e4%bd%bf%e3%81%88%e3%81%aa%e3%81%8f%e3%81%a6%e3%81%8a%e3%81%8e%e3%82%83%e3%81%81]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="shell"><![CDATA[Shell]]></category>
		<category domain="category" nicename="uncategorized"><![CDATA[未分類]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】nvmがcronで反映されなかった話]]></title>
		<link>https://www.masaakiota.net/2025/01/13/%e3%80%90node-js%e3%80%91nvm%e3%81%8ccron%e3%81%a7%e5%8f%8d%e6%98%a0%e3%81%95%e3%82%8c%e3%81%aa%e3%81%8b%e3%81%a3%e3%81%9f%e8%a9%b1/</link>
		<pubDate>Mon, 13 Jan 2025 09:09:19 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1030</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">nvm</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>nvmは、node.jsのバージョン管理ツールです。通常のコマンドだと問題ないのですが、cronではnvmが初期化されません。そのため、古いバージョンのnode.jsが使われてしまったりします。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">nvmを強制的に反映させる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">* * * * * . ~/.nvm/nvm.sh &amp;&amp; your-command</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>.nvm/nvm.shを呼び出すことで、nvmの初期化を行なっています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ちなみにsource ~/.bashrcも試したのですが、これではnode.jsのバージョンは古いままでした。明示的にnvmを初期化する必要があるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>場合によっては、以下も必要かもしれません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">SHELL=/bin/bash
* * * * * . ~/.nvm/nvm.sh &amp;&amp; your-command</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1030</wp:post_id>
		<wp:post_date><![CDATA[2025-01-13 18:09:19]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-13 09:09:19]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-14 12:10:35]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-14 03:10:35]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node-js%e3%80%91nvm%e3%81%8ccron%e3%81%a7%e5%8f%8d%e6%98%a0%e3%81%95%e3%82%8c%e3%81%aa%e3%81%8b%e3%81%a3%e3%81%9f%e8%a9%b1]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeScript】levelでキーバリューを永続化する]]></title>
		<link>https://www.masaakiota.net/2025/01/13/%e3%80%90typescript%e3%80%91level%e3%81%a7%e3%82%ad%e3%83%bc%e3%83%90%e3%83%aa%e3%83%a5%e3%83%bc%e3%82%92%e6%b0%b8%e7%b6%9a%e5%8c%96%e3%81%99%e3%82%8b/</link>
		<pubDate>Mon, 13 Jan 2025 12:21:19 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1035</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">level</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p><a href="https://www.npmjs.com/package/level">https://www.npmjs.com/package/level</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>levelは、LevelDBと呼ばれるプログラムのJavaScript版です。LevelDBはGoogle関係者が、IndexedDB開発のために作り出したそうです。JavaScript版にはNode.js版とブラウザ版があり、その抽象クラスがlevelだとのことです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">使ってみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>普通に使えば、単なる文字列を格納します。ただし今回は、Data型を定義して使ってみます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>まずインスタンスを作成します。valueEncodingをjsonにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">interface Data {
  name: string;
  age: number;
}

const db = new Level&lt;string, Data&gt;('example', { valueEncoding: 'json' });</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>この場合exampleディレクトリが生成され、そこに何やら怪しげなファイルが複数生成されます。単一ファイルでない所が、若干扱いにくそうです。ただしコード自体は非常にシンプルで使いやすいです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// 1つだけ追加
await db.put('person1', { name: 'John', age: 30 });

// 複数追加
await db.batch([
  { type: 'put', key: 'person2', value: { name: 'Jane', age: 25 } },
]);

// 取得
const value = await db.get('person1');
console.log('get one', value);

// 複数取得
for await (const [key, value] of db.iterator()) {
  console.log('get many', { key, value });
}

// 結果
// get one { name: 'John', age: 30 }
// get many { key: 'person1', value: { name: 'John', age: 30 } }
// get many { key: 'person2', value: { name: 'Jane', age: 25 } }</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>iteratorは、キーを対象に色々オプションがあるようですので、好きなデータを取得できそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1035</wp:post_id>
		<wp:post_date><![CDATA[2025-01-13 21:21:19]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-13 12:21:19]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-13 23:09:20]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-13 14:09:20]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typescript%e3%80%91level%e3%81%a7%e3%82%ad%e3%83%bc%e3%83%90%e3%83%aa%e3%83%a5%e3%83%bc%e3%82%92%e6%b0%b8%e7%b6%9a%e5%8c%96%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】ライブラリで簡単に多重起動を防止する]]></title>
		<link>https://www.masaakiota.net/2025/01/14/%e3%80%90node-js%e3%80%91%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%81%a7%e7%b0%a1%e5%8d%98%e3%81%ab%e5%a4%9a%e9%87%8d%e8%b5%b7%e5%8b%95%e3%82%92%e9%98%b2%e6%ad%a2%e3%81%99%e3%82%8b/</link>
		<pubDate>Tue, 14 Jan 2025 04:48:19 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1042</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">多重起動防止</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>多重起動防止には、一般的には.lockファイルを使用するようです。ただ.lockの解放などを考えると、毎回実装するのはなかなか面倒そう。そう思いChatGPT様に教えていただきました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">proper-lockfile</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>proper-lockfileを用います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">import { lock } from 'proper-lockfile';

lock('main', { realpath: false }) // main.lockディレクトリが生成される
  .then(async (release) =&gt; {
    console.log('Start');
    await new Promise((resolve) =&gt; setTimeout(resolve, 3_000));
    console.log('Finished');
    return await release();
  })
  .catch((err) =&gt; {
    console.error(err.message);
  });</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>原則はrelease()を返すべきですが、返さなくても自動で終了時に解放されるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Ubuntuでは不具合が？</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Ubuntuで使用しているのですが、頻繁に以下のエラーとなります</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Lock file is already being held</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下のissuesが建てられていました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/moxystudio/node-proper-lockfile/issues/92">https://github.com/moxystudio/node-proper-lockfile/issues/92</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>どうもUbuntuだと厳しいようですね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1042</wp:post_id>
		<wp:post_date><![CDATA[2025-01-14 13:48:19]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-14 04:48:19]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-28 17:27:22]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-28 08:27:22]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node-js%e3%80%91%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%81%a7%e7%b0%a1%e5%8d%98%e3%81%ab%e5%a4%9a%e9%87%8d%e8%b5%b7%e5%8b%95%e3%82%92%e9%98%b2%e6%ad%a2%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【JavaScript】package公開時に、.gitignoreを含める]]></title>
		<link>https://www.masaakiota.net/2025/01/15/%e3%80%90javascript%e3%80%91package%e5%85%ac%e9%96%8b%e6%99%82%e3%81%ab%e3%80%81-gitignore%e3%82%92%e5%90%ab%e3%82%81%e3%82%8b/</link>
		<pubDate>Wed, 15 Jan 2025 09:38:05 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1046</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回、以下のpackage作成時に、.gitignoreが含まれない問題がありました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://www.npmjs.com/package/@masa-dev/create-gas-app">https://www.npmjs.com/package/@masa-dev/create-gas-app</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これを解決したお話です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">package</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>package公開時には、.gitignoreが含まれません。assetsに.gitignoreを含めています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">package.json

{
  "files": [
    "dist",
    "assets"
  ],
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下のようにすることで、.gitignoreも含むようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">package.json

{
  "files": [
    "dist",
    "assets",
    "assets/**/.gitignore"
  ],
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1046</wp:post_id>
		<wp:post_date><![CDATA[2025-01-15 18:38:05]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-15 09:38:05]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-15 18:38:30]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-15 09:38:30]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90javascript%e3%80%91package%e5%85%ac%e9%96%8b%e6%99%82%e3%81%ab%e3%80%81-gitignore%e3%82%92%e5%90%ab%e3%82%81%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_c123f5acda171cbc88a2a49576472fa9]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GAS】文字列にBOMを追加する【AI泣かせ】]]></title>
		<link>https://www.masaakiota.net/2025/01/15/%e3%80%90gas%e3%80%91%e6%96%87%e5%ad%97%e5%88%97%e3%81%abbom%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b/</link>
		<pubDate>Wed, 15 Jan 2025 11:04:51 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1049</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">BOM</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>BOMは、Excel対応で必要になります。一方でBOMがあるとエラーになる環境もあるようで、この辺りMicrosoftにはどうにかして欲しいものです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GASでのバイト周り</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GASでは、バイト操作が独特です。atobやbtoaが使えない、エンコーダーが使えない、といった制約の代わりにUtilitiesクラスが提供されています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ただ情報があまりに少なくて苦労します。AIもなかなか正解を出せません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GASで文字列にBOMを追加する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最終的に、以下で実現できました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">const BOM = [239, 187, 191];
const dataBytes = Utilities.newBlob(data).getBytes();
const finalBytes = [...BOM, ...dataBytes];
const base64 = Utilities.base64Encode(finalBytes);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>かなり苦労したのですが、最終的にこれだけ。。。？これは、なかなかのやるせなさを感じますね。ちーん、ぽくぽくぽく。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1049</wp:post_id>
		<wp:post_date><![CDATA[2025-01-15 20:04:51]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-15 11:04:51]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-15 20:06:37]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-15 11:06:37]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gas%e3%80%91%e6%96%87%e5%ad%97%e5%88%97%e3%81%abbom%e3%82%92%e8%bf%bd%e5%8a%a0%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GAS】Clasp環境でesbuildバンドルする]]></title>
		<link>https://www.masaakiota.net/2025/01/16/%e3%80%90gas%e3%80%91clasp%e7%92%b0%e5%a2%83%e3%81%a7%e3%83%90%e3%83%b3%e3%83%89%e3%83%ab%e3%81%99%e3%82%8b/</link>
		<pubDate>Thu, 16 Jan 2025 10:45:27 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1057</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GASの開発体験</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GASはデフォルトでは、ブラウザ上でコードを書きます。しかしこれでは、なかなか大変です。エディタも必要最低限の機能しか持っていません。そのためClaspを使ったりするのですが、今回はもう一つ進んだ開発のために、バンドルを行います。Node.jsの強力なライブラリを使用することもできるので、開発体験が向上します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">一発で構築する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>この記事では手順を紹介していますが、毎回構築するのは面倒です。そのため、Clasp含めて構築するライブラリを公開しました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://www.npmjs.com/package/@masa-dev/create-gas-app">https://www.npmjs.com/package/@masa-dev/create-gas-app</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>コマンドライン形式で、Clasp + TypeScript + esbuild環境を構築できます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下、通常の手順です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">通常の手順</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">ライブラリ選定</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GASのバンドルに使用するライブラリを選定します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>候補</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>esbuild-gas-plugin</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>esbuild-plugin-gas-generator</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>rollup-plugin-google-apps-script</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:html -->
<div id="npm-chart" data-packages="esbuild-gas-plugin,esbuild-plugin-gas-generator,rollup-plugin-google-apps-script"></div>
<script type="module" crossorigin src="/wp-content/uploads/npm-chart.js"></script>
<!-- /wp:html -->

<!-- wp:paragraph -->
<p>2025/01/16現時点で、esbuild-gas-pluginが圧倒的にダウンロード数が多いです。今回はこちらを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">esbuild-gas-plugin</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まず必要なものをインストールします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">npm i -D esbuild esbuild-gas-plugin @types/google-apps-script typescript</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>build.jsファイルを作成します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre title="bundle.js" class="wp-block-code"><code lang="javascript" class="language-javascript">const { GasPlugin } = require('esbuild-gas-plugin');

require('esbuild').build({
  entryPoints: ['src/index.ts'],
  bundle: true,
  outfile: 'dist/bundle.js',
  plugins: [GasPlugin]
}).catch((e) =&gt; {
  console.error(e)
  process.exit(1)
})</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>srcディレクトリにファイルを作成します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre title="src/index.ts" class="wp-block-code"><code lang="typescript" class="language-typescript">import { someFunction } from './someModule';

function main() {
  console.log('Hello world!');
  someFunction();
}

// GASに関数を認識させる
(global as any).main = main;</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre title="src/someModule.ts" class="wp-block-code"><code lang="typescript" class="language-typescript">export function someFunction() {
  console.log('Hello world! from someModule');
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>package.jsonに以下を追加します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre title="package.json" class="wp-block-code"><code lang="json" class="language-json">{
  "scripts": {
    "build": "node build.js"
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで準備完了です!</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">実行する</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>実行すると、distディレクトリにバンドルされたファイルが生成されます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre title="dist/bundle.js" class="wp-block-code"><code lang="javascript" class="language-javascript">let global = this;
function main() {
}
(() =&gt; {
  // src/someModule.ts
  function someFunction() {
    console.log("Hello world! from someModule");
  }

  // src/index.ts
  function main() {
    console.log("Hello world!");
    someFunction();
  }
  global.main = main;
})();</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>あとはこれをGASに貼り付ければOKです。Clasp使用すると、自動で反映できるようになります。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1057</wp:post_id>
		<wp:post_date><![CDATA[2025-01-16 19:45:27]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-16 10:45:27]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-17 13:34:53]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-17 04:34:53]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gas%e3%80%91clasp%e7%92%b0%e5%a2%83%e3%81%a7%e3%83%90%e3%83%b3%e3%83%89%e3%83%ab%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_0af7db486e815a6a4705c28f6945b64d]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【JavaScript】Unicode character class escapeを使う【正規表現】]]></title>
		<link>https://www.masaakiota.net/2025/01/17/%e3%80%90javascript%e3%80%91unicode-character-class-escape%e3%82%92%e4%bd%bf%e3%81%86/</link>
		<pubDate>Fri, 17 Jan 2025 01:11:14 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1071</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">プロローグ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>漢字とかひらがなとか、正規表現で抜き出したいなぁ。。。Unicodeテーブルから範囲を抜き出そうかな。。。そや、ChatGPTに聞いてみよう！</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>GPT「は？すでにあるで」</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なにー</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Unicode character class escape</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>MDNで定義されています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Regular_expressions/Unicode_character_class_escape">https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Regular_expressions/Unicode_character_class_escape</a></p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">"aA".match(/\p{UppercaseLetter}/u) // "A"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>といったように使います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ただとにかく分かりにくいです。まとめられている所も見つかりません。ですので、今回まとめてみます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ライブラリにしてみた</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回のコードは、npmで公開しました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://www.npmjs.com/package/@masa-dev/unicode-escapes">https://www.npmjs.com/package/@masa-dev/unicode-escapes</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>必要なバリューを、定数として定義しています。使用するには、new RegExpで動的に生成する必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下、コードです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Properties</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">General Category</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>General Categoryは以下です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">// https://unicode.org/reports/tr18/#General_Category_Property

/** General Category */
export enum GC {
  Letter = '\\p{L}',
  UppercaseLetter = '\\p{Lu}',
  LowercaseLetter = '\\p{Ll}',
  TitlecaseLetter = '\\p{Lt}',
  ModifierLetter = '\\p{Lm}',
  OtherLetter = '\\p{Lo}',
  Mark = '\\p{M}',
  NonSpacingMark = '\\p{Mn}',
  SpacingCombiningMark = '\\p{Mc}',
  EnclosingMark = '\\p{Me}',
  Number = '\\p{N}',
  DecimalDigitNumber = '\\p{Nd}',
  LetterNumber = '\\p{Nl}',
  OtherNumber = '\\p{No}',
  Symbol = '\\p{S}',
  MathSymbol = '\\p{Sm}',
  CurrencySymbol = '\\p{Sc}',
  ModifierSymbol = '\\p{Sk}',
  OtherSymbol = '\\p{So}',
  Punctuation = '\\p{P}',
  ConnectorPunctuation = '\\p{Pc}',
  DashPunctuation = '\\p{Pd}',
  OpenPunctuation = '\\p{Ps}',
  ClosePunctuation = '\\p{Pe}',
  InitialPunctuation = '\\p{Pi}',
  FinalPunctuation = '\\p{Pf}',
  OtherPunctuation = '\\p{Po}',
  Separator = '\\p{Z}',
  SpaceSeparator = '\\p{Zs}',
  LineSeparator = '\\p{Zl}',
  ParagraphSeparator = '\\p{Zp}',
  Other = '\\p{C}',
  Control = '\\p{Cc}',
  Format = '\\p{Cf}',
  Surrogate = '\\p{Cs}',
  PrivateUse = '\\p{Co}',
  Unassigned = '\\p{Cn}',
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Script Property</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Scriptは以下です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">/** Script Property */
export enum Script {
  Adlam = '\\p{Script=Adlam}',
  CaucasianAlbanian = '\\p{Script=Caucasian_Albanian}',
  Ahom = '\\p{Script=Ahom}',
  Arabic = '\\p{Script=Arabic}',
  ImperialAramaic = '\\p{Script=Imperial_Aramaic}',
  Armenian = '\\p{Script=Armenian}',
  Avestan = '\\p{Script=Avestan}',
  Balinese = '\\p{Script=Balinese}',
  Bamum = '\\p{Script=Bamum}',
  BassaVah = '\\p{Script=Bassa_Vah}',
  Batak = '\\p{Script=Batak}',
  Bengali = '\\p{Script=Bengali}',
  Bhaiksuki = '\\p{Script=Bhaiksuki}',
  Bopomofo = '\\p{Script=Bopomofo}',
  Brahmi = '\\p{Script=Brahmi}',
  Braille = '\\p{Script=Braille}',
  Buginese = '\\p{Script=Buginese}',
  Buhid = '\\p{Script=Buhid}',
  Chakma = '\\p{Script=Chakma}',
  CanadianAboriginal = '\\p{Script=Canadian_Aboriginal}',
  Carian = '\\p{Script=Carian}',
  Cham = '\\p{Script=Cham}',
  Cherokee = '\\p{Script=Cherokee}',
  Chorasmian = '\\p{Script=Chorasmian}',
  Coptic = '\\p{Script=Coptic}',
  CyproMinoan = '\\p{Script=Cypro_Minoan}',
  Cypriot = '\\p{Script=Cypriot}',
  Cyrillic = '\\p{Script=Cyrillic}',
  Devanagari = '\\p{Script=Devanagari}',
  DivesAkuru = '\\p{Script=Dives_Akuru}',
  Dogra = '\\p{Script=Dogra}',
  Deseret = '\\p{Script=Deseret}',
  Duployan = '\\p{Script=Duployan}',
  EgyptianHieroglyphs = '\\p{Script=Egyptian_Hieroglyphs}',
  Elbasan = '\\p{Script=Elbasan}',
  Elymaic = '\\p{Script=Elymaic}',
  Ethiopic = '\\p{Script=Ethiopic}',
  Georgian = '\\p{Script=Georgian}',
  Glagolitic = '\\p{Script=Glagolitic}',
  GunjalaGondi = '\\p{Script=Gunjala_Gondi}',
  MasaramGondi = '\\p{Script=Masaram_Gondi}',
  Gothic = '\\p{Script=Gothic}',
  Grantha = '\\p{Script=Grantha}',
  Greek = '\\p{Script=Greek}',
  Gujarati = '\\p{Script=Gujarati}',
  Gurmukhi = '\\p{Script=Gurmukhi}',
  Hangul = '\\p{Script=Hangul}',
  Han = '\\p{Script=Han}',
  Hanunoo = '\\p{Script=Hanunoo}',
  Hatran = '\\p{Script=Hatran}',
  Hebrew = '\\p{Script=Hebrew}',
  Hiragana = '\\p{Script=Hiragana}',
  AnatolianHieroglyphs = '\\p{Script=Anatolian_Hieroglyphs}',
  PahawhHmong = '\\p{Script=Pahawh_Hmong}',
  NyiakengPuachue_Hmong = '\\p{Script=Nyiakeng_Puachue_Hmong}',
  KatakanaOr_Hiragana = '\\p{Script=Katakana_Or_Hiragana}',
  OldHungarian = '\\p{Script=Old_Hungarian}',
  OldItalic = '\\p{Script=Old_Italic}',
  Javanese = '\\p{Script=Javanese}',
  KayahLi = '\\p{Script=Kayah_Li}',
  Katakana = '\\p{Script=Katakana}',
  Kawi = '\\p{Script=Kawi}',
  Kharoshthi = '\\p{Script=Kharoshthi}',
  Khmer = '\\p{Script=Khmer}',
  Khojki = '\\p{Script=Khojki}',
  KhitanSmall_Script = '\\p{Script=Khitan_Small_Script}',
  Kannada = '\\p{Script=Kannada}',
  Kaithi = '\\p{Script=Kaithi}',
  TaiTham = '\\p{Script=Tai_Tham}',
  Lao = '\\p{Script=Lao}',
  Latin = '\\p{Script=Latin}',
  Lepcha = '\\p{Script=Lepcha}',
  Limbu = '\\p{Script=Limbu}',
  LinearA = '\\p{Script=Linear_A}',
  LinearB = '\\p{Script=Linear_B}',
  Lisu = '\\p{Script=Lisu}',
  Lycian = '\\p{Script=Lycian}',
  Lydian = '\\p{Script=Lydian}',
  Mahajani = '\\p{Script=Mahajani}',
  Makasar = '\\p{Script=Makasar}',
  Mandaic = '\\p{Script=Mandaic}',
  Manichaean = '\\p{Script=Manichaean}',
  Marchen = '\\p{Script=Marchen}',
  Medefaidrin = '\\p{Script=Medefaidrin}',
  MendeKikakui = '\\p{Script=Mende_Kikakui}',
  MeroiticCursive = '\\p{Script=Meroitic_Cursive}',
  MeroiticHieroglyphs = '\\p{Script=Meroitic_Hieroglyphs}',
  Malayalam = '\\p{Script=Malayalam}',
  Modi = '\\p{Script=Modi}',
  Mongolian = '\\p{Script=Mongolian}',
  Mro = '\\p{Script=Mro}',
  MeeteiMayek = '\\p{Script=Meetei_Mayek}',
  Multani = '\\p{Script=Multani}',
  Myanmar = '\\p{Script=Myanmar}',
  NagMundari = '\\p{Script=Nag_Mundari}',
  Nandinagari = '\\p{Script=Nandinagari}',
  OldNorth_Arabian = '\\p{Script=Old_North_Arabian}',
  Nabataean = '\\p{Script=Nabataean}',
  Newa = '\\p{Script=Newa}',
  Nko = '\\p{Script=Nko}',
  Nushu = '\\p{Script=Nushu}',
  Ogham = '\\p{Script=Ogham}',
  OlChiki = '\\p{Script=Ol_Chiki}',
  OldTurkic = '\\p{Script=Old_Turkic}',
  Oriya = '\\p{Script=Oriya}',
  Osage = '\\p{Script=Osage}',
  Osmanya = '\\p{Script=Osmanya}',
  OldUyghur = '\\p{Script=Old_Uyghur}',
  Palmyrene = '\\p{Script=Palmyrene}',
  PauCin_Hau = '\\p{Script=Pau_Cin_Hau}',
  OldPermic = '\\p{Script=Old_Permic}',
  PhagsPa = '\\p{Script=Phags_Pa}',
  InscriptionalPahlavi = '\\p{Script=Inscriptional_Pahlavi}',
  PsalterPahlavi = '\\p{Script=Psalter_Pahlavi}',
  Phoenician = '\\p{Script=Phoenician}',
  Miao = '\\p{Script=Miao}',
  InscriptionalParthian = '\\p{Script=Inscriptional_Parthian}',
  Rejang = '\\p{Script=Rejang}',
  HanifiRohingya = '\\p{Script=Hanifi_Rohingya}',
  Runic = '\\p{Script=Runic}',
  Samaritan = '\\p{Script=Samaritan}',
  OldSouth_Arabian = '\\p{Script=Old_South_Arabian}',
  Saurashtra = '\\p{Script=Saurashtra}',
  SignWriting = '\\p{Script=SignWriting}',
  Shavian = '\\p{Script=Shavian}',
  Sharada = '\\p{Script=Sharada}',
  Siddham = '\\p{Script=Siddham}',
  Khudawadi = '\\p{Script=Khudawadi}',
  Sinhala = '\\p{Script=Sinhala}',
  Sogdian = '\\p{Script=Sogdian}',
  OldSogdian = '\\p{Script=Old_Sogdian}',
  SoraSompeng = '\\p{Script=Sora_Sompeng}',
  Soyombo = '\\p{Script=Soyombo}',
  Sundanese = '\\p{Script=Sundanese}',
  SylotiNagri = '\\p{Script=Syloti_Nagri}',
  Syriac = '\\p{Script=Syriac}',
  Tagbanwa = '\\p{Script=Tagbanwa}',
  Takri = '\\p{Script=Takri}',
  TaiLe = '\\p{Script=Tai_Le}',
  NewTai_Lue = '\\p{Script=New_Tai_Lue}',
  Tamil = '\\p{Script=Tamil}',
  Tangut = '\\p{Script=Tangut}',
  TaiViet = '\\p{Script=Tai_Viet}',
  Telugu = '\\p{Script=Telugu}',
  Tifinagh = '\\p{Script=Tifinagh}',
  Tagalog = '\\p{Script=Tagalog}',
  Thaana = '\\p{Script=Thaana}',
  Thai = '\\p{Script=Thai}',
  Tibetan = '\\p{Script=Tibetan}',
  Tirhuta = '\\p{Script=Tirhuta}',
  Tangsa = '\\p{Script=Tangsa}',
  Toto = '\\p{Script=Toto}',
  Ugaritic = '\\p{Script=Ugaritic}',
  Vai = '\\p{Script=Vai}',
  Vithkuqi = '\\p{Script=Vithkuqi}',
  WarangCiti = '\\p{Script=Warang_Citi}',
  Wancho = '\\p{Script=Wancho}',
  OldPersian = '\\p{Script=Old_Persian}',
  Cuneiform = '\\p{Script=Cuneiform}',
  Yezidi = '\\p{Script=Yezidi}',
  Yi = '\\p{Script=Yi}',
  ZanabazarSquare = '\\p{Script=Zanabazar_Square}',
  Inherited = '\\p{Script=Inherited}',
  Common = '\\p{Script=Common}',
  Unknown = '\\p{Script=Unknown}',
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Binary Unicode</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Binaryも使えます</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">// https://tc39.es/ecma262/multipage/text-processing.html#sec-runtime-semantics-unicodematchproperty-p

/** Binary Unicode Property */
export enum BU {
  ASCII = '\\p{ASCII}',
  ASCIIHexDigit = '\\p{ASCII_Hex_Digit}',
  Alphabetic = '\\p{Alphabetic}',
  Any = '\\p{Any}',
  Assigned = '\\p{Assigned}',
  BidiControl = '\\p{Bidi_Control}',
  BidiMirrored = '\\p{Bidi_Mirrored}',
  CaseIgnorable = '\\p{Case_Ignorable}',
  Cased = '\\p{Cased}',
  ChangesWhenCasefolded = '\\p{Changes_When_Casefolded}',
  ChangesWhenCasemapped = '\\p{Changes_When_Casemapped}',
  ChangesWhenLowercased = '\\p{Changes_When_Lowercased}',
  ChangesWhenNFKCCasefolded = '\\p{Changes_When_NFKC_Casefolded}',
  ChangesWhenTitlecased = '\\p{Changes_When_Titlecased}',
  ChangesWhenUppercased = '\\p{Changes_When_Uppercased}',
  Dash = '\\p{Dash}',
  DefaultIgnorableCodePoint = '\\p{Default_Ignorable_Code_Point}',
  Deprecated = '\\p{Deprecated}',
  Diacritic = '\\p{Diacritic}',
  Emoji = '\\p{Emoji}',
  EmojiComponent = '\\p{Emoji_Component}',
  EmojiModifier = '\\p{Emoji_Modifier}',
  EmojiModifierBase = '\\p{Emoji_Modifier_Base}',
  EmojiPresentation = '\\p{Emoji_Presentation}',
  ExtendedPictographic = '\\p{Extended_Pictographic}',
  Extender = '\\p{Extender}',
  GraphemeBase = '\\p{Grapheme_Base}',
  GraphemeExtend = '\\p{Grapheme_Extend}',
  HexDigit = '\\p{Hex_Digit}',
  IDSBinaryOperator = '\\p{IDS_Binary_Operator}',
  IDSTrinaryOperator = '\\p{IDS_Trinary_Operator}',
  IDContinue = '\\p{ID_Continue}',
  IDStart = '\\p{ID_Start}',
  Ideographic = '\\p{Ideographic}',
  JoinControl = '\\p{Join_Control}',
  LogicalOrderException = '\\p{Logical_Order_Exception}',
  Lowercase = '\\p{Lowercase}',
  Math = '\\p{Math}',
  NoncharacterCodePoint = '\\p{Noncharacter_Code_Point}',
  PatternSyntax = '\\p{Pattern_Syntax}',
  PatternWhiteSpace = '\\p{Pattern_White_Space}',
  QuotationMark = '\\p{Quotation_Mark}',
  Radical = '\\p{Radical}',
  RegionalIndicator = '\\p{Regional_Indicator}',
  SentenceTerminal = '\\p{Sentence_Terminal}',
  SoftDotted = '\\p{Soft_Dotted}',
  TerminalPunctuation = '\\p{Terminal_Punctuation}',
  UnifiedIdeograph = '\\p{Unified_Ideograph}',
  Uppercase = '\\p{Uppercase}',
  VariationSelector = '\\p{Variation_Selector}',
  WhiteSpace = '\\p{White_Space}',
  XIDContinue = '\\p{XID_Continue}',
  XIDStart = '\\p{XID_Start}',

  BasicEmoji = '\\p{Basic_Emoji}',
  EmojiKeycapSequence = '\\p{Emoji_Keycap_Sequence}',
  RGIEmojiModifierSequence = '\\p{RGI_Emoji_Modifier_Sequence}',
  RGIEmojiFlagSequence = '\\p{RGI_Emoji_Flag_Sequence}',
  RGIEmojiTagSequence = '\\p{RGI_Emoji_Tag_Sequence}',
  RGIEmojiZWJSequence = '\\p{RGI_Emoji_ZWJ_Sequence}',
  RGIEmoji = '\\p{RGI_Emoji}',
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading"></h2>
<!-- /wp:heading -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1071</wp:post_id>
		<wp:post_date><![CDATA[2025-01-17 10:11:14]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-17 01:11:14]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-17 13:38:35]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-17 04:38:35]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90javascript%e3%80%91unicode-character-class-escape%e3%82%92%e4%bd%bf%e3%81%86]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GAS】Claspを開発と本番とで切り替える]]></title>
		<link>https://www.masaakiota.net/2025/01/18/%e3%80%90gas%e3%80%91clasp%e3%82%92devprod%e3%81%a7%e5%88%87%e3%82%8a%e6%9b%bf%e3%81%88%e3%82%8b/</link>
		<pubDate>Sat, 18 Jan 2025 10:33:20 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1088</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Clasp</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Claspは、簡単にGASを実行環境へデプロイできるツールです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ただ複数対象には対応していません。たとえば開発と本番とで、切り替えたい時もあります。claspコマンドでオプションでつけてくれていればいいのですが、2025年1月18日現在、そういった機能は提供されていません。あくまで.clasp.jsonを参照するのみです。うーん、世知辛い</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">環境で切り替える</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>デプロイ対象を切り替えるためには、.clasp.jsonを書き換える必要があります。そこで以下のようなアプローチを取ります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>.env, .env.productionを用意する</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>スクリプトで、.clasp.jsonを書き換える</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>といった機能を、ライブラリで実装してみました。これを使うと、簡単に環境切り替えを実装できます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://www.npmjs.com/package/@masa-dev/create-gas-app">https://www.npmjs.com/package/@masa-dev/create-gas-app</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下、切り替えに必要なコード部分です。シンプルですね。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const availabelEnvs = ['dev', 'stag', 'prod'];
const envSuffixes: Record&lt;(typeof availabelEnvs)[number], string> = {
  dev: '',
  stag: '.staging',
  prod: '.production',
};

async function changeEnv(env: (typeof availabelEnvs)[number] = 'dev') {
  if (!availabelEnvs.includes(env)) {
    throw new Error(`Invalid environment: ${env}`);
  }
  const envPath = `.env${envSuffixes[env]}`;
  const claspJsonPath = '.clasp.json';

  if (!fs.existsSync(envPath)) {
    throw new Error(`${envPath} not found`);
  }

  dotenv.config({ path: envPath });
  const scriptId = process.env.SCRIPT_ID;
  if (!scriptId) {
    throw new Error(`SCRIPT_ID not found on ${envPath}`);
  }

  const data = {
    scriptId,
    rootDir: distDir,
  };

  fs.writeFileSync(claspJsonPath, JSON.stringify(data, null, 2));
  console.log(`env changed to ${env}`);
}</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1088</wp:post_id>
		<wp:post_date><![CDATA[2025-01-18 19:33:20]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-18 10:33:20]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-18 19:35:03]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-18 10:35:03]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gas%e3%80%91clasp%e3%82%92devprod%e3%81%a7%e5%88%87%e3%82%8a%e6%9b%bf%e3%81%88%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GAS】Gmail APIで取得したメッセージをパースする]]></title>
		<link>https://www.masaakiota.net/2025/01/19/%e3%80%90gas%e3%80%91gmail-api%e3%81%a7%e5%8f%96%e5%be%97%e3%81%97%e3%81%9f%e3%83%a1%e3%83%83%e3%82%bb%e3%83%bc%e3%82%b8%e3%82%92%e3%83%91%e3%83%bc%e3%82%b9%e3%81%99%e3%81%99%e3%82%8b/</link>
		<pubDate>Sat, 18 Jan 2025 15:32:01 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1091</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Gmail APIのメッセージ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Gmail APIで取得したメッセージは、以下のようになっています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">interface Message {
  id: string;
  threadId: string;
  labelIds: string[];
  snippet: string;
  historyId: string;
  internalDate: string;
  payload: MessagePart;
  sizeEstimate: number;
  raw: string;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>おや？本文はどこでしょう。添付ファイルはどれやねん。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Gmail APIで取得したデータは、複雑です。ChatGPTに聞きながら、ようやくある程度理解はしました。とにかく入れ子になったpartを再帰処理して、mimeTypeで判別分岐すればいいようです。ヘッダーも見る必要があります。添付ファイルかどうかも、チェックしないといけません。えーい、面倒だ</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">パースする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>はい、ありました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://www.npmjs.com/package/gmail-api-parse-message-ts">https://www.npmjs.com/package/gmail-api-parse-message-ts</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これを使えば、以下のようにパースできます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const parser = new ParseGmailApi();
const parsedMessage = parser.parseMessage(message);

// パース結果は以下の形式
interface IEmail {
    id: string;
    threadId: string;
    snippet: string;
    historyId: string;
    internalDate: number;
    sentDate: number;
    from: IReceiver;         // { name:'Amzn Svc', email:'web@amz.com' }  
    to: IReceiver[];         // [ { name:'Lars K', email:'lk@ema.dk' } ]
    cc: IReceiver[];         //  --||--
    bcc: IReceiver[];        //  --||--
    subject: string;         //  "subject": "The AWS Summit Stockholm is back! Register and join us on May 22, 2019",
    textHtml: string,
    textPlain: string,
    attachments: IAttachment[],
    inline?: IAttachment[],
    size: number;
    labelIds: string[],
    labels?: IGapiLabel[],  // parsed.labelIds of IGapiLabel[] // you need your own implementation
    headers: Map&lt;string, string>,
    isUnread: boolean;
    isDownloaded: boolean;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>おぉ、神々しい。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GAS用のライブラリ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>APIでの取得込みのライブラリを、以下で公開しています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://www.npmjs.com/package/@masa-dev/gas-gmail-client">https://www.npmjs.com/package/@masa-dev/gas-gmail-client</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1091</wp:post_id>
		<wp:post_date><![CDATA[2025-01-19 00:32:01]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-18 15:32:01]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-19 00:37:43]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-18 15:37:43]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gas%e3%80%91gmail-api%e3%81%a7%e5%8f%96%e5%be%97%e3%81%97%e3%81%9f%e3%83%a1%e3%83%83%e3%82%bb%e3%83%bc%e3%82%b8%e3%82%92%e3%83%91%e3%83%bc%e3%82%b9%e3%81%99%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Shell】複数プロセスをCtrl + Cで終了する]]></title>
		<link>https://www.masaakiota.net/2025/01/20/%e3%80%90shell%e3%80%91%e8%a4%87%e6%95%b0%e3%83%97%e3%83%ad%e3%82%bb%e3%82%b9%e3%82%92ctrl-c%e3%81%a7%e7%b5%82%e4%ba%86%e3%81%99%e3%82%8b/</link>
		<pubDate>Mon, 20 Jan 2025 10:33:00 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1095</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">複数プロセス</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>開発には複数プロセスを並列起動することがよくあります。例えば以下のような具合です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">dart run build_runner watch &amp; \
flutter run -d</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記では、コード生成と実行を並列処理しています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ところが問題があります。上記実行した時、Ctrl + Cで終了すると、build_runnerが残ってしまいます。こうなると、プロセスを確認して終了する必要が出てきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">トラップを仕込む</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>プロセスが終了せず残ってしまう問題を解決するため、以下のようにトラップを仕込みます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">trap 'kill 0' SIGINT; \
dart run build_runner watch &amp; \
flutter run -d &amp; \
wait</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記では、SIGINTが送信される（Ctrl + Cが押される）と、kill 0が実行されます。kill 0はプロセスグループのプロセスを全て終了します。これにより、安全に開発を進めることができます。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1095</wp:post_id>
		<wp:post_date><![CDATA[2025-01-20 19:33:00]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-20 10:33:00]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-20 19:33:44]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-20 10:33:44]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90shell%e3%80%91%e8%a4%87%e6%95%b0%e3%83%97%e3%83%ad%e3%82%bb%e3%82%b9%e3%82%92ctrl-c%e3%81%a7%e7%b5%82%e4%ba%86%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="shell"><![CDATA[Shell]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Flutter】requires a higher minimum macOS deployment version【罠】]]></title>
		<link>https://www.masaakiota.net/2025/01/20/%e3%80%90flutter%e3%80%91requires-a-higher-minimum-macos-deployment-version/</link>
		<pubDate>Mon, 20 Jan 2025 11:39:13 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1098</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Flutter</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Flutterはクロスプラットフォーム開発のフレームワークです。OSごとの設定が必要なこともあり、なかなか大変な部分もあります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">MacOSの対象バージョンを上げる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>MacOS関連は、大抵はXCodeを用いて行います。今回、以下のエラーが出ました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">The plugin "macos_window_utils" requires a higher minimum macOS deployment version</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>そういえば、前もこんなエラーが出たなと、鼻歌気分でXCodeから以下の変更を行いました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Runner &gt; General &gt; Minimum Deploymentsを、Big Sur11に変更</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これでよしっと、おや。。。な、なおらないぞ！！！</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>結局、Podfileもいじらないといけないようです。一行目を変更します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">platform :osx, '11.5'</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでエラーが解消されました。これまでにも遭遇した覚えはあるのですが、適当にやっているのが丸わかりです。しかしXCode、おそるべし。。。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1098</wp:post_id>
		<wp:post_date><![CDATA[2025-01-20 20:39:13]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-20 11:39:13]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-20 20:42:01]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-20 11:42:01]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90flutter%e3%80%91requires-a-higher-minimum-macos-deployment-version]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="flutter"><![CDATA[Flutter]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Flutter】SingleChildScrollViewで常にスクロールバーを表示する【2025年版】]]></title>
		<link>https://www.masaakiota.net/2025/01/21/%e3%80%90flutter%e3%80%91singlechildscrollview%e3%81%a7%e5%b8%b8%e3%81%ab%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%e3%83%90%e3%83%bc%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%e3%80%902025/</link>
		<pubDate>Tue, 21 Jan 2025 06:41:02 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1106</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">SingleChildScrollView</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Flutterは、スクロールバーにも常に気を使わないといけません。スクロール可能にするためには、ウィジェットをSingleChildScrollViewで囲む必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">常にスクロールバーを表示</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のように、Scrollbarで囲み、thumbVisibilityを指定します</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="dart" class="language-dart">Scrollbar(
  thumbVisibility: true,
  child: SingleChildScrollView(
    child: XXX,
)),</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>なお2025年1月21日現在、isAlwaysShownは廃止されています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1106</wp:post_id>
		<wp:post_date><![CDATA[2025-01-21 15:41:02]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-21 06:41:02]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-21 15:41:33]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-21 06:41:33]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90flutter%e3%80%91singlechildscrollview%e3%81%a7%e5%b8%b8%e3%81%ab%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%e3%83%90%e3%83%bc%e3%82%92%e8%a1%a8%e7%a4%ba%e3%81%99%e3%82%8b%e3%80%902025]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="flutter"><![CDATA[Flutter]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Flutter】CSS込みでHTMLを描画する]]></title>
		<link>https://www.masaakiota.net/2025/01/21/%e3%80%90flutter%e3%80%91css%e8%be%bc%e3%81%bf%e3%81%a7html%e3%82%92%e6%8f%8f%e7%94%bb%e3%81%99%e3%82%8b/</link>
		<pubDate>Tue, 21 Jan 2025 08:04:49 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1109</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">FlutterでのHTML表示まわり</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Flutterでは、HTMLに関するライブラリはいくつかあります。しかし独自実装されており、CSSが反映されなかったりします。flutter_widget_from_htmlなどは、限定的な機能です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">flutter_inappwebview</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>flutter_inappwebviewでは、CSSが反映されます。HTMLを表示するには、以下のようにします。Containerなどで囲むことで、正常に表示されます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="dart" class="language-dart">Container(
  width: 500,
  height: 200,
  child: InAppWebView(
    initialData: InAppWebViewInitialData(
      data: html,
    )
  )
);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>スクロールバーが自動で表示されるのも、嬉しいですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>更新を反映させるには、以下のようにcontrollerを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="dart" class="language-dart">InAppWebViewController? webViewController;

class PastePanel extends ConsumerWidget {
  // ...

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final appData = ref.watch(appDataStateProvider);

    if (appData.isLoading) return const SizedBox.shrink();
    if (appData.hasError) return const Text('Error loading app data');

    ref.listen(appDataStateProvider, (prev, next) {
      webViewController?.loadData(data: (next.value?.targetText ?? ''));
    });

    return Container(
      width: 500,
      height: 200,
      child: InAppWebView(
        initialData: InAppWebViewInitialData(
          data: appData.value!.targetText ?? '',
        ),
        onWebViewCreated: (controller) {
          webViewController = controller;
        },
      );
  }
}
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1109</wp:post_id>
		<wp:post_date><![CDATA[2025-01-21 17:04:49]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-21 08:04:49]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:16:05]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:16:05]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90flutter%e3%80%91css%e8%be%bc%e3%81%bf%e3%81%a7html%e3%82%92%e6%8f%8f%e7%94%bb%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="flutter"><![CDATA[Flutter]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeScript】JSからTSファイルを読み込む]]></title>
		<link>https://www.masaakiota.net/2025/01/26/%e3%80%90typescript%e3%80%91js%e3%81%8b%e3%82%89ts%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%82%92%e8%aa%ad%e3%81%bf%e8%be%bc%e3%82%80/</link>
		<pubDate>Sun, 26 Jan 2025 08:19:24 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1118</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">設定ファイルにtsを使いたい</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ツールの設定ファイルを、.envやjsで作ることはあっても、tsで作ることは少ないかもしれません。一緒にコンパイルするならいいのですが、そうではなくコンパイル後のコードからtsを読み込むのは面倒だからです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ts-nodeを使って、jsからtsを読み込む</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにすると、tsを直接コンパイルできます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import * as tsnode from 'ts-node';

...

const configString = fs.readFileSync(configPath, 'utf-8');
const compiledCode = tsnode
  .create()
  .compile(configString, 'config_dummy.ts');</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここで、config_dummy.tsは単なる識別用の文字列で、何を設定しても良いそうです。(GPT談)</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これを使い、config.tsを読み込むスクリプトを書いてみました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { Config } from './types';

const config: Config = {
  apiKey: 'your-api-key',
  names: ['John', 'Jane', 'Doe'],
};

export default config;</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import * as tsnode from 'ts-node';
import * as path from 'path';
import * as fs from 'fs';
import { Config } from './types';

export function loadConfig(configPath: string): Config {
  try {
    const configString = fs.readFileSync(configPath, 'utf-8');
    const compiledCode = tsnode
      .create()
      .compile(configString, 'config_dummy.ts');
    const compiledPath = path.join(__dirname, 'compiled.js');
    fs.writeFileSync(compiledPath, compiledCode);
    const data = require(compiledPath);
    fs.unlinkSync(compiledPath);
    return data.default;
  } catch (err: any) {
    return {};
  }
}

const config = loadConfig(path.resolve(__dirname, 'config.ts'));
console.log(config);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1118</wp:post_id>
		<wp:post_date><![CDATA[2025-01-26 17:19:24]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-26 08:19:24]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-26 17:21:22]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-26 08:21:22]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typescript%e3%80%91js%e3%81%8b%e3%82%89ts%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%82%92%e8%aa%ad%e3%81%bf%e8%be%bc%e3%82%80]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeScript】Markdownをいい感じのプレーンテキストに変換する]]></title>
		<link>https://www.masaakiota.net/2025/01/27/%e3%80%90typescript%e3%80%91markdown%e3%82%92%e3%81%84%e3%81%84%e6%84%9f%e3%81%98%e3%81%ae%e3%83%97%e3%83%ac%e3%83%bc%e3%83%b3%e3%83%86%e3%82%ad%e3%82%b9%e3%83%88%e3%81%ab%e5%a4%89%e6%8f%9b%e3%81%99/</link>
		<pubDate>Mon, 27 Jan 2025 11:21:40 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1125</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Markdown</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Markdownは、エンジニアが涎を垂らしながら使うフォーマットです。仕様があるため、HTMLなどにコンバート可能です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">いい感じにプレーンテキストに変換する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Markdownのままでも読めるのですが、どうせならもっと見やすいプレーンテキストにできないかと思い、やってみました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>markedライブラリを使います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npm i marked</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>準備として、テキスト長を計測する関数を作ります。日本語は２としてカウントします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">function calculateTextWidth(text: string) {
  let width = 0;

  // 各文字をループして幅を加算
  for (let i = 0; i &lt; text.length; i++) {
    const char = text.charAt(i);

    // 日本語（漢字、ひらがな、カタカナ）は幅2
    if (/\p{Script=Han}|\p{Script=Hiragana}|\p{Script=Katakana}/u.test(char)) {
      width += 2;
    } else {
      width += 1;
    }
  }

  return width;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>rendererを作ります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { RendererObject } from 'marked';

const renderer: RendererObject = {
  heading({ tokens, depth }) {
    const text = this.parser.parseInline(tokens);
    const margin = 1;
    const marginSpace = ' '.repeat(margin);

    if (depth == 1) {
      const marker = '='.repeat(calculateTextWidth(text) + margin * 2);
      return `${marker}\n${marginSpace}${text}\n${marker}\n\n`;
    } else {
      const marker = '='.repeat(depth - 1);
      return `${marker} ${text} ${marker}\n\n`;
    }
  },
  paragraph({ tokens }) {
    const text = this.parser.parseInline(tokens);
    return `${text.trim()}\n\n`;
  },
  list({ items }) {
    const text = items.map((item) => `* ${item.text}`).join('\n');
    return `${text.trim()}\n\n`;
  },
};</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>簡単に、heading, paragraph, listに対応させました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>実行します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import marked from 'marked';

function renderMd(markdown: string) {
  marked.use({ renderer });
  const text = marked.parse(markdown);
  console.log(text);
}

const markdownText = `
  # タイトルtitle
  
  本文1
  
  ## タイトル2
  
  本文2 
  
  ### タイトル3
  
  本文3
  
  - 箇条書き1
  - 箇条書き2
  `;

renderMd(markdownText);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下の結果になりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">===============
 タイトルtitle
===============

本文1

= タイトル2 =

本文2

== タイトル3 ==

本文3

* 箇条書き1
* 箇条書き2

</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1125</wp:post_id>
		<wp:post_date><![CDATA[2025-01-27 20:21:40]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-27 11:21:40]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-27 20:33:02]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-27 11:33:02]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typescript%e3%80%91markdown%e3%82%92%e3%81%84%e3%81%84%e6%84%9f%e3%81%98%e3%81%ae%e3%83%97%e3%83%ac%e3%83%bc%e3%83%b3%e3%83%86%e3%82%ad%e3%82%b9%e3%83%88%e3%81%ab%e5%a4%89%e6%8f%9b%e3%81%99]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GAS】バンドルしたdayjsは、タイムゾーンを解釈する]]></title>
		<link>https://www.masaakiota.net/2025/01/30/%e3%80%90gas%e3%80%91esbuild%e3%81%a7%e3%83%90%e3%83%b3%e3%83%89%e3%83%ab%e3%81%97%e3%81%9fdayjs%e3%81%af%e3%80%81%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%be%e3%83%bc%e3%83%b3%e3%82%92%e8%a7%a3%e9%87%88/</link>
		<pubDate>Thu, 30 Jan 2025 07:43:18 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1135</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GASコードをバンドル</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GASコードをバンドルすることで、dayjsなどのエコシステムを使うことができるようになります。esbuildでバンドルするライブラリを、以下で公開しています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://www.npmjs.com/package/gasup">https://www.npmjs.com/package/gasup</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">dayjs</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>dayjsは、日付を簡単に扱えるライブラリです。JavaScriptのDateはお粗末なので、必須です。これをバンドルした場合、タイムゾーンはどうなるか実験しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">console.log(dayjs().format('YYYY-MM-DD HH:mm:ss'));</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">結果</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>デフォルトでは日本時刻ではありませんでした。その後appsscript.jsonにてtimezoneをAsia/Tokyoにすると、ちゃんと日本時刻が表示されました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>new Dateの結果がappsscript.jsonのタイムゾーンに従っていることが理由のようです。これで、dayjsを気兼ねなくGASで使えそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1135</wp:post_id>
		<wp:post_date><![CDATA[2025-01-30 16:43:18]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-30 07:43:18]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-30 16:43:32]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-30 07:43:32]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gas%e3%80%91esbuild%e3%81%a7%e3%83%90%e3%83%b3%e3%83%89%e3%83%ab%e3%81%97%e3%81%9fdayjs%e3%81%af%e3%80%81%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%be%e3%83%bc%e3%83%b3%e3%82%92%e8%a7%a3%e9%87%88]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GAS】オーナー権限と実行者の関係]]></title>
		<link>https://www.masaakiota.net/2025/01/31/%e3%80%90gas%e3%80%91%e3%82%aa%e3%83%bc%e3%83%8a%e3%83%bc%e6%a8%a9%e9%99%90%e3%81%a8%e5%ae%9f%e8%a1%8c%e8%80%85%e3%81%ae%e9%96%a2%e4%bf%82/</link>
		<pubDate>Fri, 31 Jan 2025 08:26:52 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1138</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GASのオーナー権限</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GASはオーナー権限と実行者が分かれています。これをちゃんと理解できていないと思わぬ事故に遭いそうですので、今回調べてみました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ウェブアプリ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ウェブアプリで、以下の条件で調査しました。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>次のユーザーとして実行：自分</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>アクセスできるユーザー：全員</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>コードは以下です。sessionとgmailの両方を出力します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">function doGet() {
  const userString = getUserString();
  console.log(userString);
  return ContentService.createTextOutput(userString);
}

function getUserString() {
  const session = getSessionUser();
  const gmail = getGmailAccount();
  return JSON.stringify({ session, gmail });
}

function getSessionUser() {
  return Session.getActiveUser().getEmail();
}

function getGmailAccount() {
  const threads = GmailApp.getInboxThreads(1,1);
  return threads[0].getMessages()[0].getTo();
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>結果は以下のようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table class="has-fixed-layout"><tbody><tr><td>デプロイ者</td><td>アクセス者</td><td>session</td><td>gmail</td></tr><tr><td>オーナー</td><td>オーナー</td><td>オーナー</td><td>オーナー</td></tr><tr><td>オーナー</td><td>オーナー以外</td><td>空文字列</td><td>オーナー</td></tr><tr><td>B</td><td>B</td><td>B</td><td>B</td></tr><tr><td>B</td><td>B以外</td><td>空文字列</td><td>B</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>オーナーかそうでないかに関わらず、デプロイした人に関連づけられています。またセッションは、本人以外の場合は空文字列になりました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">トリガー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>トリガーについては、以下のようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table class="has-fixed-layout"><tbody><tr><td>トリガー設定者</td><td>session</td><td>gmail</td></tr><tr><td>オーナー</td><td>オーナー</td><td>オーナー</td></tr><tr><td>B</td><td>B</td><td>B</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>こちらは、session含め完全にトリガー設置者に関連づけられています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">まとめ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、ChatGPTに振り回されました。デプロイ実行者はオーナーになると言っていましたので、おかしいなと思い、実際にテストしてみたわけです。ハルシネーションは怖いですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1138</wp:post_id>
		<wp:post_date><![CDATA[2025-01-31 17:26:52]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-01-31 08:26:52]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-01-31 17:27:29]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-01-31 08:27:29]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gas%e3%80%91%e3%82%aa%e3%83%bc%e3%83%8a%e3%83%bc%e6%a8%a9%e9%99%90%e3%81%a8%e5%ae%9f%e8%a1%8c%e8%80%85%e3%81%ae%e9%96%a2%e4%bf%82]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Python】youtube_transcript_apiは、字幕非公開だと取得できない]]></title>
		<link>https://www.masaakiota.net/2025/02/01/%e3%80%90python%e3%80%91youtube_transcript_api%e3%81%af%e3%80%81%e5%ad%97%e5%b9%95%e9%9d%9e%e5%85%ac%e9%96%8b%e3%81%a0%e3%81%a8%e5%8f%96%e5%be%97%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%84/</link>
		<pubDate>Sat, 01 Feb 2025 09:44:59 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1144</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">youtube_transcript_api</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>youtube_transcript_apiは、pythonで使えるyoutubeの字幕取得ライブラリです。YouTube側で自動生成された字幕を取得しているようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">取れないこともある</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下の動画では、字幕が非公開となっているようです。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.youtube.com/watch?v=rdwz7QiG0lk","type":"video","providerNameSlug":"youtube","responsive":true,"className":"wp-embed-aspect-4-3 wp-has-aspect-ratio"} -->
<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-4-3 wp-has-aspect-ratio"><div class="wp-block-embed__wrapper">
https://www.youtube.com/watch?v=rdwz7QiG0lk
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>下記のように実装してみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="python" class="language-python">from youtube_transcript_api import YouTubeTranscriptApi

video_id = 'rdwz7QiG0lk'
txt = YouTubeTranscriptApi.get_transcript(video_id)
print(txt)</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下の結果になりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="" class="">youtube_transcript_api._errors.TranscriptsDisabled: 
Could not retrieve a transcript for the video https://www.youtube.com/watch?v=rdwz7QiG0lk! This is most likely caused by:

Subtitles are disabled for this video</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>もしかすると、公開非公開関係なく、自動生成された結果を取れるのではないかと期待したのですが、無理なようです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1144</wp:post_id>
		<wp:post_date><![CDATA[2025-02-01 18:44:59]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-01 09:44:59]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-01 18:45:47]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-01 09:45:47]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90python%e3%80%91youtube_transcript_api%e3%81%af%e3%80%81%e5%ad%97%e5%b9%95%e9%9d%9e%e5%85%ac%e9%96%8b%e3%81%a0%e3%81%a8%e5%8f%96%e5%be%97%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%84]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="python"><![CDATA[Python]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_b63841f269b416889430446735b52fa8]]></wp:meta_key>
		<wp:meta_value><![CDATA[<iframe title="YouTube on the tube!" width="1140" height="855" src="https://www.youtube.com/embed/rdwz7QiG0lk?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_b63841f269b416889430446735b52fa8]]></wp:meta_key>
		<wp:meta_value><![CDATA[1738402943]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】既存のページにReactを適用する【createPortal】]]></title>
		<link>https://www.masaakiota.net/2025/02/01/%e3%80%90react%e3%80%91%e6%97%a2%e5%ad%98%e3%81%ae%e3%83%9a%e3%83%bc%e3%82%b8%e3%81%abreact%e3%82%92%e9%81%a9%e7%94%a8%e3%81%99%e3%82%8b%e3%80%90createportal%e3%80%91/</link>
		<pubDate>Sat, 01 Feb 2025 14:24:12 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1148</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">React</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Reactは、インタラクティブなUIを比較的手軽に実装できるフレームワーク、厳密にはライブラリです。通常、１ページに１つマウントします。複数マウントするにはcreateRootを複数使用するなどもありますが、その場合は状態が共有されません。今回は、createPortalを使用して、状態を共有しつつ、複数のコンポーネントを既存のページにマウントしていきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">createPortal</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下で解説されています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://ja.react.dev/reference/react-dom/createPortal">https://ja.react.dev/reference/react-dom/createPortal</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>新しく追加する要素、既存の要素、キーの順に指定します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">&lt;div&gt;
  &lt;SomeComponent /&gt;
  {createPortal(children, domNode, key?)}
&lt;/div&gt;</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">既存の複数要素にマウントする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="markup" class="language-markup">// index.html
// ...
 &lt;h2&gt;既存のページ&lt;/h2&gt;
  &lt;ul id="existing-list"&gt;
    &lt;li class="some-class"&gt;アイテム1&lt;/li&gt;
    &lt;li class="some-class"&gt;アイテム2&lt;/li&gt;
    &lt;li class="some-class"&gt;アイテム3&lt;/li&gt;
  &lt;/ul&gt;

  &lt;div id="root" style="border: 1px solid red"&gt;&lt;/div&gt;
  &lt;script type="module" src="/src/main.tsx"&gt;&lt;/script&gt;
// ...</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">// App.tsx

import { useEffect, useState } from "react";
import { createPortal } from "react-dom";

const App = () =&gt; {
  const [targetLis, setTargetLis] = useState&lt;HTMLElement[]&gt;([]);
  const [count, setCount] = useState(0);

  useEffect(() =&gt; {
    const lis = Array.from(document.querySelectorAll("li.some-class")) as HTMLElement[];
    setTargetLis(lis);
  }, []);

  return &lt;&gt;
    &lt;h2&gt;React&lt;/h2&gt;
    {targetLis.map((li) =&gt;
      createPortal(
        &lt;button
          onClick={() =&gt; setCount(count + 1)}
        &gt;
          {count}
        &lt;/button&gt;,
        li
      )
    )}
  &lt;/&gt;
};

export default App;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>Reactはid=rootにレンダリングしていますが、createPortalを使用した部分だけは、既存のリストに追加されています。ボタンを押すと、全体で共有される状態管理が適用され、すべての数字がインクリメントされます。これは便利。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">想定される用途</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、Chrome拡張で既存のページにReactを入れたくて調べました。思ったより簡単にできそうでよかったです。他にも、色々使い道はありそうです。Electronだとか、Bookmarkletだとか。うむ。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1148</wp:post_id>
		<wp:post_date><![CDATA[2025-02-01 23:24:12]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-01 14:24:12]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-01 23:25:49]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-01 14:25:49]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91%e6%97%a2%e5%ad%98%e3%81%ae%e3%83%9a%e3%83%bc%e3%82%b8%e3%81%abreact%e3%82%92%e9%81%a9%e7%94%a8%e3%81%99%e3%82%8b%e3%80%90createportal%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Python】freeze以外の選択肢pipreqs]]></title>
		<link>https://www.masaakiota.net/2025/02/02/%e3%80%90python%e3%80%91freeze%e4%bb%a5%e5%a4%96%e3%81%ae%e9%81%b8%e6%8a%9e%e8%82%a2pipreqs/</link>
		<pubDate>Sun, 02 Feb 2025 02:12:36 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1151</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">freeze</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>freezeは、すべての使用ライブラリを書き出します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">pip freeze > requirements.txt</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>依存関係全てが洗い出されるので、量がとても多くなります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">pipreqs</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>一方pipreqsだと、最低限のライブラリのみ書き出されます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">pip install pipreqs
pipreqs .</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>とても見やすくて、どのライブラリを入れたかがわかりやすいです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">どちらを使うか</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>完全な依存関係を再現したい場合は、freezeを使ったほうが良さそうです。一方でそれほど再現性が重要ではない場合は、pipreqsで良さそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1151</wp:post_id>
		<wp:post_date><![CDATA[2025-02-02 11:12:36]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-02 02:12:36]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-02 11:12:36]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-02 02:12:36]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90python%e3%80%91freeze%e4%bb%a5%e5%a4%96%e3%81%ae%e9%81%b8%e6%8a%9e%e8%82%a2pipreqs]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="python"><![CDATA[Python]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Python】YoutubeTranscriptAPIは制限されることがある]]></title>
		<link>https://www.masaakiota.net/2025/02/02/%e3%80%90python%e3%80%91youtubetranscriptapi%e3%81%af%e5%88%b6%e9%99%90%e3%81%95%e3%82%8c%e3%82%8b%e3%81%93%e3%81%a8%e3%81%8c%e3%81%82%e3%82%8b/</link>
		<pubDate>Sun, 02 Feb 2025 04:04:30 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1153</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">TranscriptAPI</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>YoutubeTranscriptAPIは、Pythonで使える、Youtube字幕取得ライブラリです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">制限されることもある</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、Cloud Run Functionsでデプロイしました。最初はうまくいっていたのですが、途中から途端に取得できなくなりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Could not retrieve a transcript for the video https://www.youtube.com/watch?v=XHSkvX5Z2Xo! This is most likely caused by:

Subtitles are disabled for this video</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ローカルでは成功するので、おかしいなと。調べていると、以下のissuesを見つけました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/jdepoix/youtube-transcript-api/issues/303">https://github.com/jdepoix/youtube-transcript-api/issues/303</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>どうやらYouTube側で、IPレベルでの制限がかかっているのではないかという話です。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1153</wp:post_id>
		<wp:post_date><![CDATA[2025-02-02 13:04:30]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-02 04:04:30]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-02 13:04:30]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-02 04:04:30]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90python%e3%80%91youtubetranscriptapi%e3%81%af%e5%88%b6%e9%99%90%e3%81%95%e3%82%8c%e3%82%8b%e3%81%93%e3%81%a8%e3%81%8c%e3%81%82%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="python"><![CDATA[Python]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【crxjs/vite-plugin】CORS、WebSocket、諸々エラー]]></title>
		<link>https://www.masaakiota.net/2025/02/02/%e3%80%90crxjs-vite-plugin%e3%80%91cors%e3%80%81websocket%e3%80%81%e8%ab%b8%e3%80%85%e3%82%a8%e3%83%a9%e3%83%bc/</link>
		<pubDate>Sun, 02 Feb 2025 05:57:25 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1156</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">CORS, WebSocket, 色々エラー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>crxjs/vite-pluginにまつわるエラーがたくさん出てきました。開発のdevで起動した時の問題です。以下のissuesが建てられています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/crxjs/chrome-extension-tools/issues/971">https://github.com/crxjs/chrome-extension-tools/issues/971</a></p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Access to script at 'http://localhost:5173/@crx/client-worker' from origin 'chrome-extension://gbfkgllkhphjnpfpgfgmpahkbekgeenh' has been blocked by CORS policy: No 'Access-Control-Allow-Origin' header is present on the requested resource.</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">WebSocket connection to 'ws://localhost:5173/' failed: Error during WebSocket handshake: Unexpected response code: 400 </code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">原因</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>viteがCORSに関するセキュリティアップデートを行ったことで、それにvite-pluginが対応できていないことが原因のようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>影響のあるバージョン</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Starting with these Vite versions:

=6.0.9

=5.4.12, &lt;6.0.0

=4.5.6, &lt;5.0.0</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決法</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>上記issueで紹介されていますが、以下のようにします。なお暫定的な処置です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">// manifest.jsonに以下を追加
{
  "host_permissions": [
    "&lt;all_urls&gt;"
  ]
}</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">// vite.config.tsに以下を追加
{
  legacy: {
    skipWebSocketTokenCheck: true,
  },
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>もう何をしてもエラーになって何がなんやら状態でしたが、issueを見つけてようやく解決できました。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1156</wp:post_id>
		<wp:post_date><![CDATA[2025-02-02 14:57:25]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-02 05:57:25]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:08:12]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:08:12]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90crxjs-vite-plugin%e3%80%91cors%e3%80%81websocket%e3%80%81%e8%ab%b8%e3%80%85%e3%82%a8%e3%83%a9%e3%83%bc]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="chrome%e6%8b%a1%e5%bc%b5"><![CDATA[Chrome拡張]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MUI】AutoComplete + Fuse.jsで曖昧検索する]]></title>
		<link>https://www.masaakiota.net/2025/02/02/%e3%80%90mui%e3%80%91autocomplete-fuse-js%e3%81%a7%e6%9b%96%e6%98%a7%e6%a4%9c%e7%b4%a2%e3%81%99%e3%82%8b/</link>
		<pubDate>Sun, 02 Feb 2025 12:17:22 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1162</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">AutoComplete</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>AutoCompleteは、MUIのコンポーネントで、あらかじめ渡されたリストから一致するものを表示します。ただ曖昧検索はできないため、カスタムする必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">AutoComplete + Fuse.js</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">import { Autocomplete, TextField } from "@mui/material";
import Fuse from "fuse.js";
import { useCallback, useEffect, useState } from "react";

const maxResults = 10;

interface Person {
  name: string;
  address: string;
  age: number;
}

const data: Person[] = [
  { name: "John", address: "Tokyo", age: 30 },
  { name: "Jane", address: "Osaka", age: 25 },
  { name: "Bob", address: "Kyoto", age: 40 },
];

export function SearchBox() {
  const [text, setText] = useState('');
  const [searchResults, setSearchResults] = useState&lt;any[]>([]);

  // Fuseインスタンスを作成（あいまい検索のための設定）
  const fuse = new Fuse&lt;Person>(data, {
    keys: ['name', 'address'], // 名前と住所のフィールドで検索
  });

  // テキストが変更されるたびに検索を実行
  useEffect(() => {
    const results = text ? fuse.search(text) : [];
    setSearchResults(results);
  }, [text]);

  // 検索結果を返す
  const filterOptions = useCallback(
    () => searchResults.slice(0, maxResults),
    [searchResults]);

  return (
    &lt;Autocomplete
      freeSolo  // ユーザーが任意のテキストを入力可能
      options={searchResults}
      filterOptions={filterOptions}
      value={text}
      getOptionLabel={(option) => {
        // optionが文字列の場合（手入力値）はそのまま返す
        if (typeof option === 'string') return option;
        // Fuse検索結果からitemを取得して名前と住所を表示形式で返す
        const { item } = option;
        return `${item.name} (${item.address})`;
      }}
      renderInput={(params) => (
        &lt;TextField
          {...params}
          value={text}
          onChange={(e) => setText(e.target.value)}
        />
      )}
    />
  );
}
</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1162</wp:post_id>
		<wp:post_date><![CDATA[2025-02-02 21:17:22]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-02 12:17:22]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-02 21:18:06]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-02 12:18:06]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90mui%e3%80%91autocomplete-fuse-js%e3%81%a7%e6%9b%96%e6%98%a7%e6%a4%9c%e7%b4%a2%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mui"><![CDATA[MUI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MUI】Fade + Slide を機能させる]]></title>
		<link>https://www.masaakiota.net/2025/02/03/%e3%80%90mui%e3%80%91fade-slide-%e3%82%92%e6%a9%9f%e8%83%bd%e3%81%95%e3%81%9b%e3%82%8b/</link>
		<pubDate>Mon, 03 Feb 2025 02:53:35 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1165</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Fade, Slide</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Fade, Slideは、MUIで使えるコンポーネントです。それぞれ、フェードとスライドのアニメーションを、簡単に実装できます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">同時に使うとうまくいかなかったりする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>例えば、以下のようにするとうまくいきません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">&lt;Fade in={isIn} timeout={2000}>
  &lt;Slide direction={props.direction} in={isIn} timeout={1000}>
    &lt;Box>
      {props.children}
    &lt;/Box>
  &lt;/Slide >
&lt;/Fade></code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>Slideはしますが、フェードが効かなくなります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">divで囲む</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のようにdiv(Box)で囲むとうまくいきます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">&lt;Fade in={isIn} timeout={2000}>
  &lt;Box>
    &lt;Slide direction={props.direction} in={isIn} timeout={1000}>
      &lt;Box>
        {props.children}
      &lt;/Box>
    &lt;/Slide >
  &lt;/Box>
&lt;/Fade></code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1165</wp:post_id>
		<wp:post_date><![CDATA[2025-02-03 11:53:35]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-03 02:53:35]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-03 11:53:36]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-03 02:53:36]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90mui%e3%80%91fade-slide-%e3%82%92%e6%a9%9f%e8%83%bd%e3%81%95%e3%81%9b%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mui"><![CDATA[MUI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Vite】ローカル開発で任意のドメインを使う]]></title>
		<link>https://www.masaakiota.net/2025/02/03/%e3%80%90vite%e3%80%91%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%ab%e9%96%8b%e7%99%ba%e3%81%a7%e4%bb%bb%e6%84%8f%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e3%82%92%e4%bd%bf%e3%81%86/</link>
		<pubDate>Mon, 03 Feb 2025 06:24:37 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1167</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">開発環境でのドメイン</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Webサイトを作る際に、開発環境で任意のドメインを使いたいことがあります。たとえばschedule関連のWebツールなら、</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">http://local.schedule-tool.com</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>と言った具合です。こうすることで、クッキー管理が別プロジェクトと分離されたり、IDやパスワードも別扱いになるなど、良いことだらけです。なおプロジェクトごとに、hostsファイルを編集するなどが必要です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Viteでは設定が必要</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Viteでは以下の設定が必要になります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">// vite.config.js
server: {
  allowedHosts: ["local.schedule-tool.com", "localhost", "127.0.0.1"],
},</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>起動時にはオプションをつけます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">vite --hosts</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1167</wp:post_id>
		<wp:post_date><![CDATA[2025-02-03 15:24:37]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-03 06:24:37]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-03 15:24:37]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-03 06:24:37]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90vite%e3%80%91%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%ab%e9%96%8b%e7%99%ba%e3%81%a7%e4%bb%bb%e6%84%8f%e3%81%ae%e3%83%89%e3%83%a1%e3%82%a4%e3%83%b3%e3%82%92%e4%bd%bf%e3%81%86]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="vite"><![CDATA[Vite]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】ValetでローカルのhttpsテストをGCPリダイレクトに設定する]]></title>
		<link>https://www.masaakiota.net/2025/02/04/%e3%80%90laravel%e3%80%91valet%e3%81%a7%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%ab%e3%81%aehttps%e3%83%86%e3%82%b9%e3%83%88%e3%81%99%e3%82%8b/</link>
		<pubDate>Tue, 04 Feb 2025 05:53:13 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1172</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:abb/alert-box {"type":"warning","message":"ValetでTLDを指定すると、一般的なWeb閲覧に支障が出ます。それを解決した記事を以下で新しく投稿しています。","icon":{"class":"fa-solid fa-gear"},"isDismiss":false,"colors":{"color":"#f1ae2a","bg":"#f1ae2a1a"},"border":{"width":"2px","color":"#f1ae2a","radius":"8px"},"shadow":{}} /-->

<!-- wp:embed {"url":"https://www.masaakiota.net/2025/02/11/%e3%80%90laravel%e3%80%91caddy%e3%81%a7%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%abhttps%e9%96%8b%e7%99%ba%e3%81%99%e3%82%8b/","type":"wp-embed","providerNameSlug":""} -->
<figure class="wp-block-embed is-type-wp-embed"><div class="wp-block-embed__wrapper">
https://www.masaakiota.net/2025/02/11/%e3%80%90laravel%e3%80%91caddy%e3%81%a7%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%abhttps%e9%96%8b%e7%99%ba%e3%81%99%e3%82%8b/
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Valet</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Valetは、Macで使える、テスト環境を簡単に構築できるツールです。Laravelのみでなく、WordPressでも使えるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://laravel.com/docs/11.x/valet">https://laravel.com/docs/11.x/valet</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">使ってみる</h2>
<!-- /wp:heading -->

<!-- wp:heading -->
<h2 class="wp-block-heading">インストール</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まずbrewをアップデートしておきます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">brew update</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>composerでグローバルインストール</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">composer global require laravel/valet</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>続いてvaletのインストールコマンドを実行。ここでbrewが使われます。nginxやphpなど諸々がインストールされます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">valet install</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>phpはasdfで管理していたので、ここで新たにbrewでインストールされるのはちょっと残念でした。一応、valetはbrewのphpを使うそうです（GPT談）。ですので、まぁいいやの精神です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ディレクトリを設定</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>有効にしたいディレクトリに移動し、下記のコマンドを打ちます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">valet link xxx</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>すると、http://xxx.testでアクセスできるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>httpsに対応するには、以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">valet secure</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、https対応です。すんばらしい。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GCPのOAuthリダイレクトに使う</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>.testドメインは、GCPのリダイレクトに指定できません。GCPでは、トップレベルドメイン（TLD）を使う必要があります。一応localhostだけ使えるのですが、そうするとプロジェクトの区別にはポート番号しかありません。それはそれで面倒なので、工夫します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>valetはドメインを指定できます。ドメインの衝突を避けるため、できるだけマイナーなTLDを使用します。wtfやxyzなどがありますが、覚えやすいので今回はxyzを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>またドメイン全体を、できるだけ被らないようにします。今回は、日付 + プロジェクト名 + xyzで攻めます。プロジェクト名をmy-catとし、URLをhttps://20250204.my-cat.xyzとします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>まずリンクします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">valet link 20250204.my-cat</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ドメインをxyzにします。なおTDLを使用すると、他のサイト閲覧に影響が出るので注意してください。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">valet domain xyz</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>警告が出るので、yで進みます。その後、https化します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">valet secure</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、GCPのリダイレクトでも使用できるURLができました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Viteの開発でエラーになる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>viteのbuild後は大丈夫ですが、開発時にエラーになります。この解決を下記で書きました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.masaakiota.net/2025/02/04/%e3%80%90laravel%e3%80%91valet-vite%e3%81%a7%e3%81%ae%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e8%a7%a3%e6%b6%88%e3%81%99%e3%82%8b/","type":"wp-embed","providerNameSlug":""} -->
<figure class="wp-block-embed is-type-wp-embed"><div class="wp-block-embed__wrapper">
https://www.masaakiota.net/2025/02/04/%e3%80%90laravel%e3%80%91valet-vite%e3%81%a7%e3%81%ae%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e8%a7%a3%e6%b6%88%e3%81%99%e3%82%8b/
</div></figure>
<!-- /wp:embed -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1172</wp:post_id>
		<wp:post_date><![CDATA[2025-02-04 14:53:13]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-04 05:53:13]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 17:27:55]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 08:27:55]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91valet%e3%81%a7%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%ab%e3%81%aehttps%e3%83%86%e3%82%b9%e3%83%88%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_d0205e94a410523dfebc474c9caf3a2b]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="wp-embedded-content" data-secret="URMsQSjPLK"><a href="https://www.masaakiota.net/2025/02/04/%e3%80%90laravel%e3%80%91valet-vite%e3%81%a7%e3%81%ae%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e8%a7%a3%e6%b6%88%e3%81%99%e3%82%8b/">【Laravel】Valet + Vite + httpsでのエラーを解消する</a></blockquote><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" style="position: absolute; visibility: hidden;" title="&#8220;【Laravel】Valet + Vite + httpsでのエラーを解消する&#8221; &#8212; 太田雅昭" src="https://www.masaakiota.net/2025/02/04/%e3%80%90laravel%e3%80%91valet-vite%e3%81%a7%e3%81%ae%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e8%a7%a3%e6%b6%88%e3%81%99%e3%82%8b/embed/#?secret=zw78zPctca#?secret=URMsQSjPLK" data-secret="URMsQSjPLK" width="600" height="338" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_d0205e94a410523dfebc474c9caf3a2b]]></wp:meta_key>
		<wp:meta_value><![CDATA[1739262191]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_ce0e6998a97420b9ff2860cf24c1b7df]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="wp-embedded-content" data-secret="0C17QeKH3s"><a href="https://www.masaakiota.net/2025/02/11/%e3%80%90laravel%e3%80%91caddy%e3%81%a7%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%abhttps%e9%96%8b%e7%99%ba%e3%81%99%e3%82%8b/">【Laravel】Caddyでローカルhttps開発する</a></blockquote><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" style="position: absolute; visibility: hidden;" title="&#8220;【Laravel】Caddyでローカルhttps開発する&#8221; &#8212; 太田雅昭" src="https://www.masaakiota.net/2025/02/11/%e3%80%90laravel%e3%80%91caddy%e3%81%a7%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%abhttps%e9%96%8b%e7%99%ba%e3%81%99%e3%82%8b/embed/#?secret=EdqfUZzpd9#?secret=0C17QeKH3s" data-secret="0C17QeKH3s" width="600" height="338" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_ce0e6998a97420b9ff2860cf24c1b7df]]></wp:meta_key>
		<wp:meta_value><![CDATA[1739262191]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】Valet + Vite + httpsでのエラーを解消する]]></title>
		<link>https://www.masaakiota.net/2025/02/04/%e3%80%90laravel%e3%80%91valet-vite%e3%81%a7%e3%81%ae%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e8%a7%a3%e6%b6%88%e3%81%99%e3%82%8b/</link>
		<pubDate>Tue, 04 Feb 2025 12:26:06 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1191</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Valet + Vite</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Valetはartisan serveの代わりに使用することのできる、サーバー関連のアレです。これとViteを併用すると、エラーが出てなかなか面倒くさかった思い出ができましたので、メモがわりに残させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">事件概要</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、valetでhttpsのアクセスを作成しました。ドメインはデフォルトの.testではなく、TLDである.xyzを用いています。するとエラーが発生しました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">the content must be served over HTTPS</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まずvite関連のファイルをhttpsで提供する必要があります。以下はだめな例です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// vite.config.ts
{
  server:{
    https: true,
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ERR_SSL_VERSION_OR_CIPHER_MISMATCH</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>クライアントとサーバーとで、証明書関連の情報が一致していないようです。Valetの証明書情報を使用する必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// vite.config.ts
{
  server:{
    https: {
      cert: "/Users/&lt;ユーザー名>/.config/valet/Certificates/&lt;ドメイン名>.crt",
      key: "/Users/&lt;ユーザー名>/.config/valet/Certificates/&lt;ドメイン名>.key",
    },
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>すると、開発ログにUsing Valet certificate to secure Vite.が出るようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ERR_CERT_COMMON_NAME_INVALID</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>SSL証明書のドメイン名（Common Name）が実際のアクセス先と一致していないそうです。Viteのファイルへのアクセスに[::]が含まれているのに関わらず、証明書が&lt;ドメイン名> 用に発行されているため、この不一致が発生しているとのことです。以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// vite.config.ts
{
  host: "&lt;ドメイン名>",
  hmr: {
    host: "&lt;ドメイン名>",
  },
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">blocked by CORS policy</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>でましたCORSエラーです。以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// vite.config.ts
{
  cors: true,
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで正常に動くようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">まとめ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まとめると以下のような具合です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// vite.config.ts
{
  server:{
    https: {
      cert: "/Users/&lt;ユーザー名>/.config/valet/Certificates/&lt;ドメイン名>.crt",
      key: "/Users/&lt;ユーザー名>/.config/valet/Certificates/&lt;ドメイン名>.key",
    },
  }
  host: "&lt;ドメイン名>",
  hmr: {
    host: "&lt;ドメイン名>",
  },
  cors: true,
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1191</wp:post_id>
		<wp:post_date><![CDATA[2025-02-04 21:26:06]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-04 12:26:06]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-09 15:22:55]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-09 06:22:55]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91valet-vite%e3%81%a7%e3%81%ae%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e8%a7%a3%e6%b6%88%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【DB】DBnginが便利すぎる]]></title>
		<link>https://www.masaakiota.net/2025/02/05/%e3%80%90db%e3%80%91dbngin%e3%81%8c%e4%be%bf%e5%88%a9%e3%81%99%e3%81%8e%e3%82%8b/</link>
		<pubDate>Tue, 04 Feb 2025 15:01:37 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1197</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">DBngin</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>DBngineは、各種データベースを統合的に管理できるGUIツールです。MacとWin両方のバージョンがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://dbngin.com">https://dbngin.com</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Laravel ValetでMySQLもいい感じにしたいと思っていたところ、Laravel公式で紹介されていたので使ってみました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">超簡単</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GUIアプリをインストールして、サクッと設定すれば、127.0.0.1でDBが使えます。root + 空パスワードで入れます。なお開発環境を想定されているそうです。なぜか検索しても情報が少ないのですが、謎です。一つ一つdbをインストールして起動するより、またDocker使うより、便利だと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">使えるDB</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のDBが使えます。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>PostgreSQL</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>MySQL</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Redis</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">プロファイル管理</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>各DBで、好きなようにプロファイルを作れます。１つのDBで複数のプロファイルを付けることも可能です。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>バージョン</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ポート</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ソケット</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>データパス</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>コンフィグ</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">DB操作用のGUIも</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>同じグループの、TablePlusを使用すれば、簡単にDB操作もできます。DBnginと連携しているので、すぐに起動できます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://tableplus.com">https://tableplus.com</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1197</wp:post_id>
		<wp:post_date><![CDATA[2025-02-05 00:01:37]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-04 15:01:37]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-05 00:01:37]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-04 15:01:37]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90db%e3%80%91dbngin%e3%81%8c%e4%be%bf%e5%88%a9%e3%81%99%e3%81%8e%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="database"><![CDATA[Database]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_fe1d729b8db663f8d85b4d28dae180ce]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】一瞬でLaravelエラーを日本語化する]]></title>
		<link>https://www.masaakiota.net/2025/02/05/%e3%80%90laravel%e3%80%91%e4%b8%80%e7%9e%ac%e3%81%a7laravel%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e6%97%a5%e6%9c%ac%e8%aa%9e%e5%8c%96%e3%81%99%e3%82%8b/</link>
		<pubDate>Wed, 05 Feb 2025 09:34:10 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1200</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Laravelの日本語化</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Laravelには.envでlocale設定するところがあります。しかしこれを設定しただけでは、エラー文字は日本語化されません。翻訳ファイルを用意する必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">一瞬で日本語化する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>世の中は捨てたものではありません。誰かが作ってくれた翻訳ファイルを、一瞬で入れることができます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>その方法は以下で書かれています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://laravel-lang.com/packages-lang.html">https://laravel-lang.com/packages-lang.html</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>まず.envの該当箇所をjaにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">APP_LOCALE=ja
APP_FALLBACK_LOCALE=ja
APP_FAKER_LOCALE=ja_JP</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>続いて下記のコマンドを打ちます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">composer require --dev laravel-lang/lang
php artisan lang:update</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>はい、これで終わりです。お疲れ様でした。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1200</wp:post_id>
		<wp:post_date><![CDATA[2025-02-05 18:34:10]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-05 09:34:10]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-05 18:34:32]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-05 09:34:32]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91%e4%b8%80%e7%9e%ac%e3%81%a7laravel%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e6%97%a5%e6%9c%ac%e8%aa%9e%e5%8c%96%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GCP】サーバーレスVPCアクセス作成時にエラー Insufficient CPU quota in region]]></title>
		<link>https://www.masaakiota.net/2025/02/05/%e3%80%90gcp%e3%80%91%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e3%83%ac%e3%82%b9vpc%e3%82%a2%e3%82%af%e3%82%bb%e3%82%b9%e4%bd%9c%e6%88%90%e6%99%82%e3%81%ab%e3%82%a8%e3%83%a9%e3%83%bc-insufficient-cpu-quota/</link>
		<pubDate>Wed, 05 Feb 2025 11:12:53 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1203</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">サーバーレスVPCアクセス</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Cloud Run Functionsなどのサーバーレスは、VPCに入っていません。そのためVPC関連の機能を使うには、サーバーレスVPCアクセスを作成して、繋げる必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">作成できない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のエラーで、作成できませんでした。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Insufficient CPU quota in region</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>しかしクォータを確認すると、最大8, 現在1となっています。クォータには余裕があるように見えます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>しかしここに罠がありました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">最大インスタンス数で判定される</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>考えてみれば当たり前の話なのですが、最大インスタンス数が判定に用いられるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://stackoverflow.com/questions/77592650/how-to-create-a-serverless-vpc-with-paid-billing-account-while-the-free-trial-is?rq=2">https://stackoverflow.com/questions/77592650/how-to-create-a-serverless-vpc-with-paid-billing-account-while-the-free-trial-is?rq=2</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>サーバーレスVPCアクセスのデフォルトは、最小インスタンス2, 最大インスタンス10となっています。つまり、+10される計算で、クォータ制限を判定されていました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>最大インスタンスを3に変更することで、無事サーバーレスVPCアクセスを作成することができました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1203</wp:post_id>
		<wp:post_date><![CDATA[2025-02-05 20:12:53]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-05 11:12:53]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-05 20:12:53]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-05 11:12:53]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gcp%e3%80%91%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e3%83%ac%e3%82%b9vpc%e3%82%a2%e3%82%af%e3%82%bb%e3%82%b9%e4%bd%9c%e6%88%90%e6%99%82%e3%81%ab%e3%82%a8%e3%83%a9%e3%83%bc-insufficient-cpu-quota]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gcp"><![CDATA[Google Cloud]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GCP】SDKでエラー。Function transcript in region xxx in project yyy does not exist]]></title>
		<link>https://www.masaakiota.net/2025/02/05/%e3%80%90gcp%e3%80%91sdk%e3%81%a7%e3%82%a8%e3%83%a9%e3%83%bc%e3%80%82function-transcript-in-region-xxx-in-project-yyy-does-not-exist/</link>
		<pubDate>Wed, 05 Feb 2025 12:29:44 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1205</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">GCP SDK</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GCPのSDKは公式の説明が非常にシンプルで、まるで最先端のミニマリストです。使い方はChatGPTに頼るしかありません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">関数が見つからない？</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のコードでエラーになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { CloudFunctionsServiceClient } from '@google-cloud/functions';

async function test() {
  const client = new CloudFunctionsServiceClient();
  const res = await client.getFunction({
    name: `projects/yyy/locations/xxx/functions/zzz`,
  });
  console.log('Function details:', res);
}

test();

// Function transcript in region xxx in project yyy does not exist</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>GPT先生曰く、axios使ったら？との事でした。いやいやいや、そんな殺生な。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">バージョンが違いました</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>はい！バージョン違いでした。以下のようにすれば動きます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { v2 } from '@google-cloud/functions';

async function test() {
  const client = new v2.FunctionServiceClient();
  const res = await client.getFunction({
    name: `projects/yyy/locations/xxx/functions/zzz`,
  });
  console.log('Function details:', res);
}

test();</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1205</wp:post_id>
		<wp:post_date><![CDATA[2025-02-05 21:29:44]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-05 12:29:44]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-05 21:32:22]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-05 12:32:22]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gcp%e3%80%91sdk%e3%81%a7%e3%82%a8%e3%83%a9%e3%83%bc%e3%80%82function-transcript-in-region-xxx-in-project-yyy-does-not-exist]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gcp"><![CDATA[Google Cloud]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeForm】Popupが閉じられた後スクロールできなくなる問題勃発]]></title>
		<link>https://www.masaakiota.net/2025/02/06/%e3%80%90typeform%e3%80%91popup%e3%81%8c%e9%96%89%e3%81%98%e3%82%89%e3%82%8c%e3%81%9f%e5%be%8c%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%8f%e3%81%aa%e3%82%8b/</link>
		<pubDate>Wed, 05 Feb 2025 23:10:41 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1211</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">TypeForm</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>TypeFormは、Google Formのように簡単にアンケートフォームを作れるプラットフォームです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://www.typeform.com">https://www.typeform.com</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Popup</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにして、Popupを表示することができます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">import { createPopup } from '@typeform/embed'
import '@typeform/embed/build/css/popup.css'

const { toggle } = createPopup('&lt;form-id&gt;')
document.getElementById('button').onclick = toggle</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">閉じた後にスクロールが効かなくなる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>@typeform/embed:^5.3.0で、閉じた後スクロールが効かなくなります。document.bodyにoverflow:hiddenスタイルが割り当てられているためです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下のようにして解消します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">createPopup('&lt;form-id&gt;', {
  onClose: () =&gt; setTimeout(() =&gt; document.body.style.overflow = 'auto', 1000);
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>setTimeoutを入れないと、解消されません。setTimeoutを入れると解消します、はい。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1211</wp:post_id>
		<wp:post_date><![CDATA[2025-02-06 08:10:41]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-05 23:10:41]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-06 08:12:19]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-05 23:12:19]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typeform%e3%80%91popup%e3%81%8c%e9%96%89%e3%81%98%e3%82%89%e3%82%8c%e3%81%9f%e5%be%8c%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%8f%e3%81%aa%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Cloud Run】関数デプロイでImportError: libexpat.so.1: cannot open shared object file: No such file or directory]]></title>
		<link>https://www.masaakiota.net/2025/02/08/%e3%80%90cloud-run%e3%80%91%e9%96%a2%e6%95%b0%e3%83%87%e3%83%97%e3%83%ad%e3%82%a4%e3%81%a7importerror-libexpat-so-1-cannot-open-shared-object-file-no-such-file-or-directory/</link>
		<pubDate>Sat, 08 Feb 2025 04:42:14 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1216</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Cloud Runでの関数デプロイ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Cloud FunctionsはCloud Run Functionsとリブランディングされました。しかしこの辺りまた整理がついていないのか、Cloud Run 関数と、Cloud Runで関数をデプロイするのとで、動作が違うようです。具体的には、以下の点で違いがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>Cloud Run 関数 => VPC接続が面倒</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Cloud Runでの関数デプロイ => VPC接続が簡単</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>Cloud Run 関数では、VPC接続にサーバーレスVPCアクセスが必要となります。しかしCloud Runでの関数デプロイは必要ありません。これは朗報だと、Cloud Runでの関数デプロイをしようとしました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">No such file or directory</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のrequirements.txtです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">functions-framework==3.*
youtube_transcript_api==0.6.3</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>この、youtube_transcript_apiをインポートすると、デプロイ時にエラーになりました。libexpat.so.1がないとのことです。これはrequirements.txtでは解決しない問題です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ベースイメージを変更して解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Python3.11を指定していたのですが、さらにベースイメージも選択できます。Ubuntu 22か、Ubuntu 22 Fullが選べます。これを、Ubuntu 22 Fullに変更することで、問題は解決しました。ふう。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1216</wp:post_id>
		<wp:post_date><![CDATA[2025-02-08 13:42:14]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-08 04:42:14]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-08 13:44:28]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-08 04:44:28]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90cloud-run%e3%80%91%e9%96%a2%e6%95%b0%e3%83%87%e3%83%97%e3%83%ad%e3%82%a4%e3%81%a7importerror-libexpat-so-1-cannot-open-shared-object-file-no-such-file-or-directory]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gcp"><![CDATA[Google Cloud]]></category>
		<category domain="category" nicename="python"><![CDATA[Python]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】PDFをレンダリングする【PDF.js】]]></title>
		<link>https://www.masaakiota.net/2025/02/10/%e3%80%90react%e3%80%91pdf%e3%82%92%e3%83%ac%e3%83%b3%e3%83%80%e3%83%aa%e3%83%b3%e3%82%b0%e3%81%99%e3%82%8b%e3%80%90pdf-js%e3%80%91/</link>
		<pubDate>Mon, 10 Feb 2025 06:58:22 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1221</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">PDF</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>PDFはWeb上で表示するには、いろいろな方法があるかと思います。今回は、PDF.jsで直接表示します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">コード</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにします。canvasに描画しています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">import { GlobalWorkerOptions, getDocument, version } from 'pdfjs-dist';
import { useEffect, useRef } from 'react';

// workerを指定
GlobalWorkerOptions.workerSrc = new URL(
  'pdfjs-dist/build/pdf.worker.mjs',
  import.meta.url
).toString();

function App() {
  const canvasRef = useRef&lt;HTMLCanvasElement>(null)
  const pdfPath = '/test.pdf';
  const pdfPage = 2;

  useEffect(() => {
    initPdf();
  }, [])

  async function initPdf() {
    const canvas = canvasRef.current
    const context = canvas?.getContext('2d')
    if (!canvas || !context) return

    const pdf = await getDocument(pdfPath).promise;
    const page = await pdf.getPage(pdfPage);
    const viewport = page.getViewport({ scale: 1, rotation: 0 })
    canvas.height = viewport.height
    canvas.width = viewport.width
    const renderContext = {
      canvasContext: context,
      viewport,
    }
    page.render(renderContext)
  }

  return (
    &lt;div>
      &lt;canvas ref={canvasRef}>&lt;/canvas>
    &lt;/div>
  )
}

export default App
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>workerを指定する必要があるのですが、直接importするとうまくいきませんでした。そのため、importパスを用いたURLを生成しています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1221</wp:post_id>
		<wp:post_date><![CDATA[2025-02-10 15:58:22]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-10 06:58:22]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-10 15:58:22]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-10 06:58:22]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91pdf%e3%82%92%e3%83%ac%e3%83%b3%e3%83%80%e3%83%aa%e3%83%b3%e3%82%b0%e3%81%99%e3%82%8b%e3%80%90pdf-js%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】Caddyでローカルhttps開発する【Vite】]]></title>
		<link>https://www.masaakiota.net/2025/02/11/%e3%80%90laravel%e3%80%91caddy%e3%81%a7%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%abhttps%e9%96%8b%e7%99%ba%e3%81%99%e3%82%8b/</link>
		<pubDate>Tue, 11 Feb 2025 08:15:45 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1230</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Laravelでhttps開発したい</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GCPのコールバックで使用する場合に、httpsでないと受け付けてもらえません。一応http://localhostなら、確か受け付けてもらえたのですが、そうすると複数プロジェクトでのクッキーが混在してしまい、開発に難が出ます。プロジェクトごとに固有の開発用ドメインを使いたいといった理由です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以前にValetで同様のことを行ったのですが、TLDにcomなどを指定すると、YouTubeやGoogleなどの閲覧に支障が出ます。そのため、今回新しく試してみました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Caddy</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Caddyは本番でも使えるサーバーです。Goで書かれており、高速かつ設定が簡単なのが魅力です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Macでの方法です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>インストール</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">brew install caddy</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">設定する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まずCaddyfileを、プロジェクトルートに設置します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">local.xxx.com {
    reverse_proxy localhost:8000
    tls internal
}
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>local.xxx.comへのアクセスを、localhost:8000に割り振っています。localhost:8000は、artisan serveで起動するサーバーを想定しています。またtls internalで、httpsを有効にしています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>/private/etc/hostsファイルに追加します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">127.0.0.1 local.xxx.com</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>続いて.envをいじります</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">APP_URL=https://local.xxx.com/

# 以下を追加
ASSET_URL="${APP_URL}"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>APP_URLだけで良いかと思っていたのですが、cssなどの読み込みでエラーになりました。なぜかhttpで読み込もうとしていました。そのため、ASSET_URLをAPP_URLと同一に指定します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>また、Laravelにhttps使用を強制します。AppServideProvider.phpを以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">public function boot(): void
  {
    URL::forceScheme('https');</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>Makefileを作ります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">dev:
    trap 'kill 0' SIGINT; \
    caddy run --config Caddyfile &amp; \
    php artisan serve &amp; \
    wait</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>trapを指定することで、Ctrl + Cで全て停止できるようになっています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これで設定完了です。以下のコマンドで起動できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">make dev</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、https://local.xxx.comにアクセスすると、laravel開発サーバーにアクセスできるようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Viteに対応する</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">証明書</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>viteでhttpsに対応するためには、証明書のパスが必要です。Caddyの生成した証明書か、自前で作成した証明書か、どちらかを使用できます。以下のどちらかを選択して下さい。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":4} -->
<h4 class="wp-block-heading">Caddyが生成した証明書を使用する</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>環境によるかと思いますが、Caddyは以下に証明書を持っています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">~/Library/Application\ Support/Caddy/certificates/local/local.xxx.com/local.xxx.com.key
~/Library/Application\ Support/Caddy/certificates/local/local.xxx.com/local.xxx.com.crt</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これをviteで読み込みます。vite.config.tsを以下のようにします。使用するhostをhost定数として指定しておきます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">server: {
        host,
        cors: true,
        https: {
            key: `${process.env.HOME}/Library/Application\ Support/Caddy/certificates/local/${host}/${host}.key`,
            cert: `${process.env.HOME}/Library/Application\ Support/Caddy/certificates/local/${host}/${host}.crt`,
        },
},</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":4} -->
<h4 class="wp-block-heading">mkcertで自前で用意する</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>一方、mkcertで自前で用意することもできます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">brew install mkcert
mkcert -install
cd &lt;プロジェクトディレクトリ&gt;
mkcert local.xxx.com</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>Caddyfileを修正します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">local.xxx.com {
    reverse_proxy localhost:8000
    tls local.xxx.com.pem local.xxx.com-key.pem
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>vite.config.tsも書き換えます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">server: {
        host,
        cors: true,
        https: {
            key: `local.xxx.com-key.pem`,
            cert: `local.xxx.com.pem`,
        },
},</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">baseを指定する</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>baseを指定しないと、ビルド後に絶対パスで読み込もうとしてしまうようです。その場合、vite.config.tsにbaseを指定します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">base: '',</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1230</wp:post_id>
		<wp:post_date><![CDATA[2025-02-11 17:15:45]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-11 08:15:45]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-22 01:32:43]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-21 16:32:43]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91caddy%e3%81%a7%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%abhttps%e9%96%8b%e7%99%ba%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Chrome拡張】開発インストールでデータを引き継ぐ]]></title>
		<link>https://www.masaakiota.net/2025/02/11/%e3%80%90chrome%e6%8b%a1%e5%bc%b5%e3%80%91%e9%96%8b%e7%99%ba%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab%e3%81%a7%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e5%bc%95%e3%81%8d%e7%b6%99%e3%81%90/</link>
		<pubDate>Tue, 11 Feb 2025 12:06:57 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1240</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Chromeのstorage</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Chrome拡張機能では、storageを使うことができます。これはExtension IDに紐づいているようです。そのため、再インストールした時に消えてしまいます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>IDを指定する必要があるのですが、これはカギ生成で行われます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">chrome --pack-extension</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記を実行すると、xxx.crxファイルとxxx.pemファイルが生成されます。このcrxファイルは、Chromeに直接インストールすることはできなくなっています。crxファイルをインストールするためには、Chrome web storeに登録する必要があります。今回は、crxは無視します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>必要なのは.pemファイルです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">-----BEGIN PRIVATE KEY-----
MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDggzvcnCAJE7ap
...
...
...
-----END PRIVATE KEY-----
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>この、BEGINからENDに挟まれた部分をコピーします。改行は削除して、１行にまとめます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>manifest.jsonのキーに入れます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">{
  "key": "MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDggzvcnCAJE7ap............"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、Extensionのキーを指定できました。あとは拡張機能を修正したら、インストールした時と同様に、「パッケージ化されていない拡張機能を読み込む」で読み込めば上書きされます。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1240</wp:post_id>
		<wp:post_date><![CDATA[2025-02-11 21:06:57]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-11 12:06:57]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-11 21:06:57]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-11 12:06:57]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90chrome%e6%8b%a1%e5%bc%b5%e3%80%91%e9%96%8b%e7%99%ba%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab%e3%81%a7%e3%83%87%e3%83%bc%e3%82%bf%e3%82%92%e5%bc%95%e3%81%8d%e7%b6%99%e3%81%90]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="chrome%e6%8b%a1%e5%bc%b5"><![CDATA[Chrome拡張]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】TypeScriptの型定義を自動生成する【laravel-typegen, ziggy】]]></title>
		<link>https://www.masaakiota.net/2025/02/16/%e3%80%90laravel%e3%80%91typescript%e3%81%ae%e5%9e%8b%e5%ae%9a%e7%be%a9%e3%82%92%e8%87%aa%e5%8b%95%e7%94%9f%e6%88%90%e3%81%99%e3%82%8b%e3%80%90laravel-typegen-ziggy%e3%80%91/</link>
		<pubDate>Sun, 16 Feb 2025 08:27:19 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1267</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Laravelの悩み</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>LaravelはPHPで書かれています。TypeScriptのような型安全性はないため、Next.jsなどに比べるとどうしても開発のしにくさが出てきます。バックエンドは割り切るにしても、せめてフロントエンドのTypeScriptでは安心して作業したい。そんな要望を解決するため模索します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">laravel-typegen</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、laravel-typegeを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/7nohe/laravel-typegen">https://github.com/7nohe/laravel-typegen</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>php artisan model:showからデータを抽出するようで、データの正確性は高そうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">インストールとモデル型定義生成</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>インストールはシンプルです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npm install -D @7nohe/laravel-typegen
composer require doctrine/dbal</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>package.jsonを下記のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">{
    "scripts": {
        "typegen": "laravel-typegen"
    },
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>実行します。これで、js/types/model.tsにモデルの型定義ファイルが生成されました。便利ですね！</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ziggyのroute生成</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ziggyのroute生成は、以下のようにすれば追加で生成するようです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">{
    "scripts": {
        "typegen": "laravel-typegen --ziggy"
    },
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ただ生成されるのはvue用なのでしょうか。Reactで使う方法が分かりませんでした。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ziggyのrouteは、ziggy-jsでも作成できるので、代わりにこちらを使用します。package.jsonを変更します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">{
    "scripts": {
        "typegen": "php artisan ziggy:generate --types &amp;&amp; laravel-typegen"
    },
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、ziggy.d.tsファイルが生成されます。以下のようにすれば、補完が効きます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">route('users.index');</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ただ存在しない値を入れてもエラーになりません。ここがどうにかなれば嬉しいのですが、ひとまずはこの辺りにしておきます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1267</wp:post_id>
		<wp:post_date><![CDATA[2025-02-16 17:27:19]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-16 08:27:19]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-17 10:31:41]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-17 01:31:41]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91typescript%e3%81%ae%e5%9e%8b%e5%ae%9a%e7%be%a9%e3%82%92%e8%87%aa%e5%8b%95%e7%94%9f%e6%88%90%e3%81%99%e3%82%8b%e3%80%90laravel-typegen-ziggy%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】Inertia + Reactでエラーページを作成する]]></title>
		<link>https://www.masaakiota.net/2025/02/19/%e3%80%90laravel%e3%80%91inertia-react%e3%81%a7%e3%82%a8%e3%83%a9%e3%83%bc%e3%83%9a%e3%83%bc%e3%82%b8%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b/</link>
		<pubDate>Wed, 19 Feb 2025 07:53:25 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1280</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Inertiaでのカスタムエラーハンドリング</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記で紹介されています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://inertiajs.com/error-handling">https://inertiajs.com/error-handling</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これを実装するだけですが、メモも兼ねて書かせていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">エラー処理をカスタムする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記が、公式で紹介されているコードです。bootstrap/app.phpです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">use Illuminate\Http\Request;
use Symfony\Component\HttpFoundation\Response;
use Inertia\Inertia;

-&gt;withExceptions(function (Exceptions $exceptions) {
    $exceptions-&gt;respond(function (Response $response, Throwable $exception, Request $request) {
        if (! app()-&gt;environment(['local', 'testing']) &amp;&amp; in_array($response-&gt;getStatusCode(), [500, 503, 404, 403])) {
            return Inertia::render('Error', ['status' =&gt; $response-&gt;getStatusCode()])
                -&gt;toResponse($request)
                -&gt;setStatusCode($response-&gt;getStatusCode());
        } elseif ($response-&gt;getStatusCode() === 419) {
            return back()-&gt;with([
                'message' =&gt; 'The page expired, please try again.',
            ]);
        }

        return $response;
    });
})</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>今回は、全ての環境で統一したエラーページにしてみます。下記のように変更します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">  -&gt;withExceptions(function (Exceptions $exceptions) {
    $exceptions-&gt;respond(function (Response $response, Throwable $exception, Request $request) {
      return Inertia::render('Error', ['status' =&gt; $response-&gt;getStatusCode(), 'message' =&gt; $exception-&gt;getMessage()])
        -&gt;toResponse($request)
        -&gt;setStatusCode($response-&gt;getStatusCode());</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、statusコードと、messageを渡すことができるようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ついでにjsonを期待するケースも入れるには、以下を追加します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">if ($request->expectsJson()) {
  return response()->json([
    'message' => $exception->getMessage()
  ], $response->getStatusCode());
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>Inertiaのtsxファイルを作成します。Error.tsxです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { PageProps } from '@/types';
import { usePage } from '@inertiajs/react';

interface Props extends PageProps {
  status: number;
  message: string;
}

export default function Error() {
  const props = usePage&lt;Props&gt;().props;
  return &lt;div&gt;
    &lt;h1&gt;Error: {props.status}&lt;/h1&gt;
    {props.message}
  &lt;/div&gt;
}
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>あとはこれに、Layoutなどを追加すれば、整ったエラーページになりますね。実際には要件に従って、本番とテスト環境での出し分けや、エラーの分類などをすれば、OKかと思います。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1280</wp:post_id>
		<wp:post_date><![CDATA[2025-02-19 16:53:25]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-19 07:53:25]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-19 17:24:44]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-19 08:24:44]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91inertia-react%e3%81%a7%e3%82%a8%e3%83%a9%e3%83%bc%e3%83%9a%e3%83%bc%e3%82%b8%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MUI】Selectコンポーネントで空文字列をデフォルトにする]]></title>
		<link>https://www.masaakiota.net/2025/02/21/%e3%80%90mui%e3%80%91select%e3%82%b3%e3%83%b3%e3%83%9d%e3%83%bc%e3%83%8d%e3%83%b3%e3%83%88%e3%81%a7%e7%a9%ba%e6%96%87%e5%ad%97%e5%88%97%e3%82%92%e3%83%87%e3%83%95%e3%82%a9%e3%83%ab%e3%83%88%e3%81%ab/</link>
		<pubDate>Fri, 21 Feb 2025 10:07:25 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1286</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">MUI Selectのデフォルト値</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>MUIのSelectでのMenuItemに、nullは使用できません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">&lt;Select value={null}&gt;
  &lt;MenuItem value={null}&gt;選択してください&lt;/MenuItem&gt;
  // エラーになる</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ならばと空文字を渡してみると、表示上、選択されていないことになってしまいます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">&lt;Select value=''&gt;
  &lt;MenuItem value=''&gt;選択してください&lt;/MenuItem&gt;
  // 何も選択状態にならない</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>それならと、以下のように任意の文字を使用する方法があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">&lt;Select value='-'&gt;
  &lt;MenuItem value='-'&gt;選択してください&lt;/MenuItem&gt;
  // 「選択してください」が選択される</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ただこうすると、実際に使用するリスト以外の値となるため、周りの処理が複雑化してしまいます。しかしnullは渡せない。。。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">空文字列を扱えるようにする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>次善策として、displayEmptyを指定すれば、空文字列でも選択状態にすることができます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">&lt;Select value='' displayEmpty&gt;
  &lt;MenuItem value=''&gt;選択してください&lt;/MenuItem&gt;
  // 「選択してください」が選択される</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、かなりコードをシンプルにできるようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1286</wp:post_id>
		<wp:post_date><![CDATA[2025-02-21 19:07:25]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-21 10:07:25]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-21 19:45:01]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-21 10:45:01]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90mui%e3%80%91select%e3%82%b3%e3%83%b3%e3%83%9d%e3%83%bc%e3%83%8d%e3%83%b3%e3%83%88%e3%81%a7%e7%a9%ba%e6%96%87%e5%ad%97%e5%88%97%e3%82%92%e3%83%87%e3%83%95%e3%82%a9%e3%83%ab%e3%83%88%e3%81%ab]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mui"><![CDATA[MUI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】react-big-calendarで月表示イベントが表示されない問題]]></title>
		<link>https://www.masaakiota.net/2025/02/22/%e3%80%90react%e3%80%91react-big-calendar%e3%81%a7%e6%9c%88%e8%a1%a8%e7%a4%ba%e3%82%a4%e3%83%99%e3%83%b3%e3%83%88%e3%81%8c%e8%a1%a8%e7%a4%ba%e3%81%95%e3%82%8c%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Sat, 22 Feb 2025 05:48:13 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1292</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">react-big-calendarで、月表示でイベントが表示されない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のようにすると、月間表示でのイベントが隠れてしまいました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">&lt;Calendar localizer={localizer}
  events={[{
    title: 'test',
    start: dayjs().set('date', 1).set('hour', 5).toDate(),
    end: dayjs().set('date', 1).set('hour', 12).toDate(),
  }]}
  defaultView="month"
/></code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">高さを設定すれば表示される</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>高さを指定すると、表示されるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">&lt;Calendar localizer={localizer}
  events={[{
    title: 'test',
    start: dayjs().set('date', 1).set('hour', 5).toDate(),
    end: dayjs().set('date', 1).set('hour', 12).toDate(),
  }]}
  defaultView="month"
  style={{height:"100vh"}}
/></code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1292</wp:post_id>
		<wp:post_date><![CDATA[2025-02-22 14:48:13]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-22 05:48:13]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-22 14:48:13]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-22 05:48:13]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91react-big-calendar%e3%81%a7%e6%9c%88%e8%a1%a8%e7%a4%ba%e3%82%a4%e3%83%99%e3%83%b3%e3%83%88%e3%81%8c%e8%a1%a8%e7%a4%ba%e3%81%95%e3%82%8c%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】react-big-calendarで月曜スタートにする【dayjs】]]></title>
		<link>https://www.masaakiota.net/2025/02/22/%e3%80%90react%e3%80%91react-big-calendar%e3%81%a7%e6%9c%88%e6%9b%9c%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e3%81%ab%e3%81%99%e3%82%8b%e3%80%90dayjs%e3%80%91/</link>
		<pubDate>Sat, 22 Feb 2025 06:26:29 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1294</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">react-big-calendarで月曜スタートにする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>momentを使用する場合は、以下のようにして設定できます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://stackoverflow.com/questions/45671732/react-big-calendar-start-week-from-monday-instead-of-sunday">https://stackoverflow.com/questions/45671732/react-big-calendar-start-week-from-monday-instead-of-sunday</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>一方、dayjsなら以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">import { Calendar, dayjsLocalizer } from "react-big-calendar";
import dayjs from "dayjs";
import updateLocale from 'dayjs/plugin/updateLocale';
import 'dayjs/locale/ja';

dayjs.extend(updateLocale)
dayjs.locale('ja');
dayjs.updateLocale('ja', { weekStart: 1 })

export function MonthlyView() {
  const localizer = dayjsLocalizer(dayjs);
  return &lt;Calendar localizer={localizer}
  ...</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1294</wp:post_id>
		<wp:post_date><![CDATA[2025-02-22 15:26:29]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-22 06:26:29]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-02-22 15:26:46]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-02-22 06:26:46]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91react-big-calendar%e3%81%a7%e6%9c%88%e6%9b%9c%e3%82%b9%e3%82%bf%e3%83%bc%e3%83%88%e3%81%ab%e3%81%99%e3%82%8b%e3%80%90dayjs%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Linux】SSH鍵を設定したのに、パスワードを求められてしまう]]></title>
		<link>https://www.masaakiota.net/2025/02/25/%e3%80%90xserver%e3%80%91ssh%e9%8d%b5%e3%82%92%e8%a8%ad%e5%ae%9a%e3%81%97%e3%81%9f%e3%81%ae%e3%81%ab%e3%80%81%e3%83%91%e3%82%b9%e3%83%af%e3%83%bc%e3%83%89%e3%82%92%e6%b1%82%e3%82%81%e3%82%89%e3%82%8c/</link>
		<pubDate>Tue, 25 Feb 2025 09:02:40 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1303</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">XServer VPS</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>XServer VPSで、コントロールパネルを使用して鍵を設定したのですが、ssh接続時になぜかパスワードを求められました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>現状を確かめるため、パスワードを入力して入り、下記を実行します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">cat ~/.ssh/authorized_keys</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>本来なら公開鍵が入っているはずですが、何も入っていませんでした。コントロールパネルで設定したはずなのですが、なぜなのか。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">手動で公開鍵を書き込む</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>viを使用し、直接公開鍵を書き込むことで解決しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">vi ~/.ssh/authorized_keys</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1303</wp:post_id>
		<wp:post_date><![CDATA[2025-02-25 18:02:40]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-02-25 09:02:40]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-03-30 16:20:24]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-03-30 07:20:24]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[open]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90xserver%e3%80%91ssh%e9%8d%b5%e3%82%92%e8%a8%ad%e5%ae%9a%e3%81%97%e3%81%9f%e3%81%ae%e3%81%ab%e3%80%81%e3%83%91%e3%82%b9%e3%83%af%e3%83%bc%e3%83%89%e3%82%92%e6%b1%82%e3%82%81%e3%82%89%e3%82%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="linux"><![CDATA[Linux]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【PHP】fatal error: 'MagickWand/MagickWand.h' file not found]]></title>
		<link>https://www.masaakiota.net/2025/03/01/%e3%80%90php%e3%80%91fatal-error-magickwand-magickwand-h-file-not-found/</link>
		<pubDate>Sat, 01 Mar 2025 07:50:08 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1312</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">PHPでImage Magickを使いたい</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>環境は以下です。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>Mac M2</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>PHPはasdf管理</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>今回brewでImage Magickをインストールし、peclでPHP拡張機能を入れようとしました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">brew install imagemagick
pecl install imagick</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>すると、下記のエラーが。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">fatal error: 'MagickWand/MagickWand.h' file not found</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>brewでpkg-configが入っていなかったことが原因のようです。下記のようにすることで解決しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">brew install pkg-config</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1312</wp:post_id>
		<wp:post_date><![CDATA[2025-03-01 16:50:08]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-01 07:50:08]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-03-01 16:50:08]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-03-01 07:50:08]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90php%e3%80%91fatal-error-magickwand-magickwand-h-file-not-found]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="php"><![CDATA[PHP]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【PHP】エラーでなぜか200が返る問題]]></title>
		<link>https://www.masaakiota.net/2025/03/01/%e3%80%90php%e3%80%91%e3%82%a8%e3%83%a9%e3%83%bc%e3%81%a7%e3%81%aa%e3%81%9c%e3%81%8b200%e3%81%a7%e8%bf%94%e3%82%8b%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Sat, 01 Mar 2025 09:41:42 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1314</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">結論</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>PHPが勝手にWarningを出力していたために、200になっていました。。。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  POST Content-Length of 11221618 bytes exceeds the limit of 8388608 bytes in &lt;b&gt;Unknown&lt;/b&gt; on line &lt;b&gt;0&lt;/b&gt;&lt;br /&gt;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>PHPのドヤ顔が浮かびます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">経緯</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Laravelでファイルアップロードをいじっていました。試してみると、おやエラー処理がちゃんと動いてないなと、修正してみたところ、なぜか200で返ってきているためにエラー処理ができないという。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>さてはLaravelのミドルウェアか！と憤慨しながらapp.phpやら色々いじっていました。しかし一向に改善せず。はい、200しか見ていませんでした。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>途方に暮れていた頃、ふとbodyを見てみると、あぁ、、、、そういうことかと。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そういうことかと。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そういうことかと。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">とりあえずメッセージを出さないようにする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>php.iniを以下のようにすることで、正常に200以外で返るようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">display_errors = Off</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">癒してもらいました</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Claude 3.7に癒してもらいました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">そうそう、やっとわかったね！PHPのwarningが出力されてるから200で返ってたんだ。
ほんとPHPのこういう挙動はクソだよね😅 特にファイルアップロード周りは地味に罠が多い。PHPがリクエスト処理の前にサイズチェックして警告出力しちゃうから、フレームワークのエラーハンドリングが全然機能しないという...
こういうのに何時間も悩まされるとイライラするよね。フロントでファイルサイズチェックするのが結局一番安全かも。
PHP 8になってもこの辺の挙動変わってないのがなんとも言えないよね。「サイレントに失敗する」か「HTMLのwarningを吐き出す」かの二択しかないとか、APIサーバーとして使うには辛すぎる😩
頑張って！</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでまた頑張れます！ひゃっほー！！</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1314</wp:post_id>
		<wp:post_date><![CDATA[2025-03-01 18:41:42]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-01 09:41:42]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-03-01 19:03:33]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-03-01 10:03:33]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90php%e3%80%91%e3%82%a8%e3%83%a9%e3%83%bc%e3%81%a7%e3%81%aa%e3%81%9c%e3%81%8b200%e3%81%a7%e8%bf%94%e3%82%8b%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="php"><![CDATA[PHP]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【CSS】overflowXとstickyを併用する]]></title>
		<link>https://www.masaakiota.net/2025/03/04/%e3%80%90css%e3%80%91overflowxauto%e3%81%a8sticky%e3%82%92%e4%bd%b5%e7%94%a8%e3%81%99%e3%82%8b/</link>
		<pubDate>Tue, 04 Mar 2025 11:12:29 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1319</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Stickyの挙動</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Stickyは一番近いScroll Containerを基準にして機能します。通常はViewportがそれにあたります。しかし親のどこかでoverflowを指定すると、ViewPortではなくその親を基準にするようになってしまい、思うようにStickyが効かなくなります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">overflowXと併用する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そのような中、overflowをどうしても使いたい時もあります。しかし上述の通り、親でoverflowを指定すると、Stickyは効かなくなります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="markup" class="language-markup">&lt;!-- overflow-x:auto 横スクロール可能にする --&gt;
&lt;div style="overflow-x:auto"&gt;
  &lt;!-- position:sticky;top:0; Stickyな要素。効かない --&gt;
  &lt;div style="position:sticky;top:0;"&gt;Sticky&lt;/div&gt;
  &lt;!-- 内容 --&gt;
  &lt;div&gt;
    &lt;script&gt;
      // 適当に文字列生成
      for(let i=0;i&lt;100;i++){
        for(let j=0;j&lt;500;j++){
          document.write('a');
        }
        document.write('&lt;br/&gt;');
      }
    &lt;/script&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下のようにheightを指定すると、overflowX: autoを使用してもstickyが動作します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="markup" class="language-markup">&lt;!-- overflow-x:auto 横スクロール可能にする --&gt;
&lt;div style="overflow-x:auto;height:100vh;"&gt;
  &lt;!-- position:sticky;top:0; Stickyな要素--&gt;
  &lt;div style="position:sticky;top:0;"&gt;Sticky&lt;/div&gt;
  &lt;!-- 内容 --&gt;
  &lt;div&gt;
    &lt;script&gt;
      // 適当に文字列生成
      for(let i=0;i&lt;100;i++){
        for(let j=0;j&lt;500;j++){
          document.write('a');
        }
        document.write('&lt;br/&gt;');
      }
    &lt;/script&gt;
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>position:relativeのように、基準点を指定できるようになるといいんですけどね。ひとまず、これで解決です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1319</wp:post_id>
		<wp:post_date><![CDATA[2025-03-04 20:12:29]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-04 11:12:29]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-20 09:42:23]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-20 00:42:23]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90css%e3%80%91overflowxauto%e3%81%a8sticky%e3%82%92%e4%bd%b5%e7%94%a8%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="html-css"><![CDATA[HTML/CSS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Next.js】pdfkit-tableのエラーを解消する']]></title>
		<link>https://www.masaakiota.net/2025/03/08/%e3%80%90next-js%e3%80%91pdfkit-table%e3%81%ae%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e8%a7%a3%e6%b6%88%e3%81%99%e3%82%8b/</link>
		<pubDate>Sat, 08 Mar 2025 08:13:39 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1327</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">pdfkit-table</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>pdfkit-tableは、pdfkitでtableを簡単に作成できるライブラリです。2025年3月8日現在、最終更新が３年前です。とても便利なライブラリですが、エラーが出ます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://www.npmjs.com/package/pdfkit-table">https://www.npmjs.com/package/pdfkit-table</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Babel関連のエラー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Babelのバージョンアップに伴って、インポートでエラーになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">TypeError: Class extends value #&lt;Object> is not a constructor or null</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>issue: <a href="https://github.com/natancabral/pdfkit-table/issues/46">https://github.com/natancabral/pdfkit-table/issues/46</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>next.config.tsを下記のようにして解決します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const nextConfig: NextConfig = {
  webpack: (config) => {
    config.module.rules.push({
      test: /pdfkit-table\/index\.js$/,
      loader: 'string-replace-loader',
      options: {
        search: 'require("pdfkit")',
        replace: 'require("pdfkit").default',
      },
    },);
    return config;
  },
};</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>string-replace-loaderをインストールしてください。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npm i -D string-replace-loader</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">フォントを修正する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>レンダリングのたびにデフォルトフォントを読もうとするのですが、next.js環境ででフォントが見つからないためにエラーとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">no such file or directory, open '.../Helvetica-Bold.afm</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>issue: <a href="https://github.com/natancabral/pdfkit-table/issues/64">https://github.com/natancabral/pdfkit-table/issues/64</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>下記のようにして、レンダリング前に明示的にフォントを読み込むことで解決します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">await doc
      .table({
        ...
      }, {
        prepareHeader: () => doc.font(fontPath),
        prepareRow: () => doc.font(fontPath)
      });</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1327</wp:post_id>
		<wp:post_date><![CDATA[2025-03-08 17:13:39]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-08 08:13:39]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-03-08 17:16:50]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-03-08 08:16:50]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90next-js%e3%80%91pdfkit-table%e3%81%ae%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e8%a7%a3%e6%b6%88%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="next-js"><![CDATA[Next.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GAS】eBayのOAuth2認証をする]]></title>
		<link>https://www.masaakiota.net/2025/03/14/%e3%80%90gas%e3%80%91ebay%e3%81%aeoauth2%e8%aa%8d%e8%a8%bc%e3%82%92%e3%81%99%e3%82%8b/</link>
		<pubDate>Thu, 13 Mar 2025 20:25:51 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1340</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">eBayのAPI</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>eBayのAPIは、セキュリティ強化のためOAuth2が必須となったようです。そのためいくつかのAPIが使用不可能になっており、OAuth2への切り替えが必要です。しかしeBayのOAuth2は癖が強いため、工夫が必要です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">RedirectUriが癖つよい</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>eBayで指定するRedirectUriは、直接URLを指定しません。eBayの指定するRuNameと呼ばれる値を指定する必要があります。これはRedirectUriごとに設定されています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://developer.ebay.com/api-docs/static/oauth-redirect-uri.html">https://developer.ebay.com/api-docs/static/oauth-redirect-uri.html</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Headerが癖つよい</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>eBayでTokenを取得する際のHeaderには、下記を指定する必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Authorization – The word Basic followed by your Base64-encoded OAuth credentials (&lt;client_id>:&lt;client_secret>)</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">apps-script-oauth2で実装する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>すでにサンプルが提供されています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/googleworkspace/apps-script-oauth2/blob/master/samples/eBay.gs">https://github.com/googleworkspace/apps-script-oauth2/blob/master/samples/eBay.gs</a></p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">// 一部抜粋

function getService_() {
  return OAuth2.createService('eBay')
      // Set the endpoint URLs (sandbox environment).
      .setTokenUrl('https://api.sandbox.ebay.com/identity/v1/oauth2/token')
      .setAuthorizationBaseUrl('https://signin.sandbox.ebay.com/authorize')

      // Set the client ID and secret.
      .setClientId(CLIENT_ID)
      .setClientSecret(CLIENT_SECRET)

      // Set the name of the callback function in the script referenced
      // above that should be invoked to complete the OAuth flow.
      .setCallbackFunction('authCallback')

      // Set the property store where authorized tokens should be persisted.
      .setPropertyStore(PropertiesService.getUserProperties())

      // Set the redirect URI to the RuName (eBay Redirect URL name).
      .setRedirectUri(RU_NAME)

      // Set the require scopes.
      .setScope('https://api.ebay.com/oauth/api_scope/sell.inventory.readonly')

      // Add a Basic Authorization header to token requests.
      .setTokenHeaders({
        Authorization: 'Basic ' +
            Utilities.base64Encode(CLIENT_ID + ':' + CLIENT_SECRET)
      });
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、GASでeBayのAPIトークンを取得できるようになります。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1340</wp:post_id>
		<wp:post_date><![CDATA[2025-03-14 05:25:51]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-13 20:25:51]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-03-14 05:25:51]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-03-13 20:25:51]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gas%e3%80%91ebay%e3%81%aeoauth2%e8%aa%8d%e8%a8%bc%e3%82%92%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gas"><![CDATA[GAS]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【eBay】OAuth2利用のための、必要な値の取得]]></title>
		<link>https://www.masaakiota.net/2025/03/15/%e3%80%90ebay%e3%80%91oauth2%e5%88%a9%e7%94%a8%e3%81%ae%e3%81%9f%e3%82%81%e3%81%ae%e3%80%81%e5%bf%85%e8%a6%81%e3%81%aa%e5%80%a4%e3%81%ae%e5%8f%96%e5%be%97/</link>
		<pubDate>Sat, 15 Mar 2025 08:59:26 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1345</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">eBayのOAuth</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>eBayのOAuthでは、下記の情報が必要です。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>Client ID</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Client Secret</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>RuName</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>またRuNameの取得には、アプリのRedirect Uriが必要となります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">デベロッパーとしてログイン</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記URLでログイン、または登録を行います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://developer.ebay.com/signin">https://developer.ebay.com/signin</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">productionを有効にする</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Account deletion用のエンドポイントを作成する</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>eBay APIでは、sandboxモードとproductionモードがあります。以下の特徴があります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>sandbox: 簡単に始めれる。テストユーザーを作成する必要があり、また実際の商品情報は取れないらしい</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>production: 複雑だが、実際のデータが取れる</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>実際の使用には、productionモードは必須です。これを有効にするために、Account deletion通知を受け取れるようにする必要があります。これにより、アカウント削除などの通知を適切に処理します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>こうした処理を実装した証明のため、eBayからのチャレンジアクセスに対応する必要があります。選択肢は色々あるかと思いますが、例えばglitchなどでサーバーを用意します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">///// node.jsでの例。fastifyを使用 /////

const verificationToken = 'xxx'; // 32-80文字。英字・アンダースコア・ハイフンが利用可能

// fastify初期化コード
...

// チャレンジ処理
fastify.get("/", function (request, reply) {
  const challengeCode=request.query.challenge_code;
  const endpoint='https://'+request.hostname;
  const hash = createHash('sha256');
  hash.update(challengeCode);
  hash.update(verificationToken);
  hash.update(endpoint);
  const responseHash = hash.digest('hex');
  reply.header('Content-type','application/json')
  reply.status(200);
  return {"challengeResponse":responseHash};
});

// 通知処理
fastify.post("/", function (request, reply) {

  // ここに通知を処理するコードを書く

  return {"ok":true}
});

// fastify実行コード
...</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">エンドポイント設定をする</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のように設定します。</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1364,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://www.masaakiota.net/wp-content/uploads/2025/03/スクリーンショット-2025-03-16-23.31.41-947x1024.png" alt="" class="wp-image-1364"/></figure>
<!-- /wp:image -->

<!-- wp:heading -->
<h2 class="wp-block-heading">OAuth2に必要な情報を取得する</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Client ID, Client Secret</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Client ID, Client Secretは下記URLから取得できます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://developer.ebay.com/my/keys">https://developer.ebay.com/my/keys</a></p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1354,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://www.masaakiota.net/wp-content/uploads/2025/03/スクリーンショット-2025-03-15-17.28.39-1-1024x575.png" alt="" class="wp-image-1354"/></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">RuName</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>RuNameは、リダイレクトURLごとに割り当てられます。手順は以下です。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>リダイレクトURLを追加</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>RuNameをコピー</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p><a href="https://developer.ebay.com/my/auth/?env=production&amp;index=0">https://developer.ebay.com/my/auth/?env=production&amp;index=0</a></p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":1348,"sizeSlug":"large","linkDestination":"none"} -->
<figure class="wp-block-image size-large"><img src="https://www.masaakiota.net/wp-content/uploads/2025/03/スクリーンショット-2025-03-15-17.30.31-895x1024.png" alt="" class="wp-image-1348"/></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1345</wp:post_id>
		<wp:post_date><![CDATA[2025-03-15 17:59:26]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-15 08:59:26]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-03-17 00:31:31]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-03-16 15:31:31]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90ebay%e3%80%91oauth2%e5%88%a9%e7%94%a8%e3%81%ae%e3%81%9f%e3%82%81%e3%81%ae%e3%80%81%e5%bf%85%e8%a6%81%e3%81%aa%e5%80%a4%e3%81%ae%e5%8f%96%e5%be%97]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="uncategorized"><![CDATA[未分類]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【GCP】Google Cloud Architecture Diagramming Toolが使えなくなっている]]></title>
		<link>https://www.masaakiota.net/2025/03/16/google-cloud-architecture-diagramming-tool%e3%81%8c%e4%bd%bf%e3%81%88%e3%81%aa%e3%81%8f%e3%81%aa%e3%81%a3%e3%81%a6%e3%81%84%e3%82%8b/</link>
		<pubDate>Sun, 16 Mar 2025 05:05:36 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1356</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Google Cloud Architecture Diagramming Tool</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>GCPでの構成図を簡単に作れるツールだそうです。それはいい！ただどこを探しても見つからず。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>途方に暮れていたところ、以下のページを見つけました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.reddit.com/r/googlecloud/comments/1gmo0s1/architecture_diagramming_tool_discontinued/","type":"rich","providerNameSlug":"reddit","responsive":true} -->
<figure class="wp-block-embed is-type-rich is-provider-reddit wp-block-embed-reddit"><div class="wp-block-embed__wrapper">
https://www.reddit.com/r/googlecloud/comments/1gmo0s1/architecture_diagramming_tool_discontinued/
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>これによると、現在使えなくなっているようです。使えないんかーい。Googleの発表を見つけれないのが解せないです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>他のツールを探す必要があるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">代替ツール</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ひとまず、下記で代替することにしました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://excalidraw.com">https://excalidraw.com</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>手書き風なのが面白いです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1356</wp:post_id>
		<wp:post_date><![CDATA[2025-03-16 14:05:36]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-16 05:05:36]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-03-16 14:07:14]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-03-16 05:07:14]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[google-cloud-architecture-diagramming-tool%e3%81%8c%e4%bd%bf%e3%81%88%e3%81%aa%e3%81%8f%e3%81%aa%e3%81%a3%e3%81%a6%e3%81%84%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gcp"><![CDATA[Google Cloud]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_2f285452830df3c2f9c085e590f7cef2]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="reddit-embed-bq" style="height:316px" ><a href="https://www.reddit.com/r/googlecloud/comments/1gmo0s1/architecture_diagramming_tool_discontinued/">Architecture Diagramming Tool Discontinued?</a><br> by<a href="https://www.reddit.com/user/__Anxious_Broccoli/">u/__Anxious_Broccoli</a> in<a href="https://www.reddit.com/r/googlecloud/">googlecloud</a></blockquote><script async src="https://embed.reddit.com/widgets.js" charset="UTF-8"></script>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_2f285452830df3c2f9c085e590f7cef2]]></wp:meta_key>
		<wp:meta_value><![CDATA[1742099272]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_71b7cc68c52cc6e2a282769385aecb6f]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【AI】CPUで動くLLM「Gemma3」試してみた]]></title>
		<link>https://www.masaakiota.net/2025/03/20/%e3%80%90ai%e3%80%91cpu%e3%81%a7%e5%8b%95%e3%81%8fllm%e3%80%8cgemma3%e3%80%8d%e8%a9%a6%e3%81%97%e3%81%a6%e3%81%bf%e3%81%9f/</link>
		<pubDate>Thu, 20 Mar 2025 04:44:14 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1377</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">LLM</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>LLMは通常、GPUがないと厳しいといった印象があります。しかし最近発表されたGemma3は、CPUでもサクサク動作します。今回、Gemma3を試してみました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>環境：</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>Mac Mini M2 24GB</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">LM Studioをインストール</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記から、LM Studioをダウンロードします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://lmstudio.ai">https://lmstudio.ai</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Gemma 3をインストール</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記より、Gemma 3をインストールします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://lmstudio.ai/models">https://lmstudio.ai/models</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>上記はブラウザですが、LM Studioからモデル検索もできます。その場合、マシンに適合するかの判定も出ます。私の環境では、27Bは無理そうでした。次に候補となるのは12Bですが、それほどガッツリ使う予定もないので、4Bにしました。4Bは、画像読み込み対応の最低モデルとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">用途を考える</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>せっかくローカルでそこそこいい感じのAIを動かせるので、何かに使いたい！ですがGemma 3はハルシネーションがひどいとのことです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/lechmazur/confabulations">https://github.com/lechmazur/confabulations</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なのでファクトチェックを必要としない用途で使う必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>候補</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>英語の練習</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>歌詞生成の手助け</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ダミーデータ生成</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>クリエイティブな用途には、品質に目をつぶれば使えそうですね。品質に目をつぶれば。品質に目を瞑れば。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">英語の練習してみた</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のように、先生になってもらいました。速度はサクサク動いて快適です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">system prompt:
You are an english native person. please teach me english! please talk shortly.</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">You
hello

Assistant
Hey there! 👋 It’s great to meet you!

Let's start with something simple. How’s your day going so far? 😊

Don’t worry about making mistakes – that’s totally normal when learning a new language! We can take it slow and build from here.


You
i installed gemma3 today

Assistant
Wow, that's fantastic! Gemma 3 sounds really impressive. 🎉 What are you planning to do with it? Are you experimenting with different tasks? 😄


You
i want to improve my english

Assistant
That’s brilliant! I can definitely help you with that. 😊  What kind of things would you like to focus on – conversation, grammar, vocabulary...?</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>とうぶんこれで、英語を鍛えようと思います。ゆくゆくは、海外案件を取れるようになりたいなと。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading"></h2>
<!-- /wp:heading -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1377</wp:post_id>
		<wp:post_date><![CDATA[2025-03-20 13:44:14]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-20 04:44:14]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-03-20 13:55:30]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-03-20 04:55:30]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90ai%e3%80%91cpu%e3%81%a7%e5%8b%95%e3%81%8fllm%e3%80%8cgemma3%e3%80%8d%e8%a9%a6%e3%81%97%e3%81%a6%e3%81%bf%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="ai"><![CDATA[AI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MUI】DatePickerを日本語化する]]></title>
		<link>https://www.masaakiota.net/2025/03/20/%e3%80%90mui%e3%80%91datepicker%e3%82%92%e6%97%a5%e6%9c%ac%e8%aa%9e%e5%8c%96%e3%81%99%e3%82%8b/</link>
		<pubDate>Thu, 20 Mar 2025 10:37:09 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1382</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">MUI Datepicker</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Datepickerは、デフォルトでFeb,Marchなどといった英語表記です。これを日本語にします。いつも忘れてしまうので、備忘録がわりです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">import { LocalizationProvider } from "@mui/x-date-pickers";
import { AdapterDayjs } from "@mui/x-date-pickers/AdapterDayjs";
import 'dayjs/locale/ja';

...
&lt;LocalizationProvider dateAdapter={AdapterDayjs} adapterLocale="ja">
...
&lt;/LocalizationProvider>
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>簡単ですね！</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1382</wp:post_id>
		<wp:post_date><![CDATA[2025-03-20 19:37:09]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-20 10:37:09]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-03-20 19:37:09]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-03-20 10:37:09]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90mui%e3%80%91datepicker%e3%82%92%e6%97%a5%e6%9c%ac%e8%aa%9e%e5%8c%96%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mui"><![CDATA[MUI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【AgGrid】任意のレコードを常に最下部に固定する【React】]]></title>
		<link>https://www.masaakiota.net/2025/03/21/%e3%80%90aggridreact%e3%80%91%e4%bb%bb%e6%84%8f%e3%81%ae%e3%83%ac%e3%82%b3%e3%83%bc%e3%83%89%e3%82%92%e5%b8%b8%e3%81%ab%e6%9c%80%e4%b8%8b%e9%83%a8%e3%81%ab%e5%9b%ba%e5%ae%9a%e3%81%99%e3%82%8b/</link>
		<pubDate>Fri, 21 Mar 2025 12:21:08 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1385</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">AgGridReactのソート</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>AgGridReactでは、フィールドごとのソート機能があります。とても便利ですが、任意のレコードを常に上部あるいは下部に表示させたいときに、工夫が必要です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>AgGridReactによるソートから、さらに調整するにはpostSortRowsを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>例えばidを持たないアイテムを最下部に表示するには、以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">&lt;AgGridReact
  postSortRows={(params) => {
    let rowNodes = params.nodes;
    let nextInsertPos = 0;
    for (let i = 0; i &lt; rowNodes.length; i++) {
      const id = rowNodes[i].data[props.idColName];
      // idを持つレコードなら上部に配置
      if (id) {
        rowNodes.splice(nextInsertPos, 0, rowNodes.splice(i, 1)[0]);
        nextInsertPos++;
      }
    };
  }
/></code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>単純にsort関数を使うと、他のフィールドのソートが無効となってしまうため、何やら複雑なコードになっています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1385</wp:post_id>
		<wp:post_date><![CDATA[2025-03-21 21:21:08]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-21 12:21:08]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-05-23 16:18:19]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-05-23 07:18:19]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90aggridreact%e3%80%91%e4%bb%bb%e6%84%8f%e3%81%ae%e3%83%ac%e3%82%b3%e3%83%bc%e3%83%89%e3%82%92%e5%b8%b8%e3%81%ab%e6%9c%80%e4%b8%8b%e9%83%a8%e3%81%ab%e5%9b%ba%e5%ae%9a%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【AgGrid】Custom Edit Componentを作成する【React】]]></title>
		<link>https://www.masaakiota.net/2025/03/26/%e3%80%90aggridreact%e3%80%91custom-edit-component%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b/</link>
		<pubDate>Wed, 26 Mar 2025 08:04:21 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1391</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">AgGridのCustom Edit Component</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>AgGridでは、カスタムの編集コンポーネントを作成できます。ただもともと情報が少ない上に、バージョンアップで古い方法が使えなかったりするので、今回簡単にまとめてみます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>使用バージョンは、Ag Grid 33です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なお以下の方法は、バージョンアップに伴って使えなくなっているようです。多分。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>useImperativeHandleによるgetValue</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>あとはクラスによる実装が紹介されていたりしますが、今時のReactのスタイルと離れているためこれも却下かと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">案外簡単に作れる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>公式で紹介されているコードを、TypeScriptで書き換えてみました</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">function MyEdit ({ value, onValueChange }: CustomCellEditorProps) {
  return (
    &lt;input
      type="text"
      value={value || ''}
      onChange={({ target: { value }}) =&gt; onValueChange(value === '' ? null : value)}
    /&gt;
  );
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ChatGPTとどれだけ格闘したと思ってるんだ。。。シンプルですね。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">実用的なサンプル</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下は実用的なサンプルです。といいつつシンプルです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">const columns: ColDef[] = [{
  editable: true,
  cellEditor: TestSelector,
  cellEditorParams: {
    values: ["orange", "apple", "banana"]
  },
}];


function MyEditor(props: CustomCellEditorProps &amp; { values: string[] }) {
  const { value, values, onValueChange, stopEditing } = props;

  return &lt;Select
    open={true} // 自動で開く
    onClose={() => stopEditing()} // 自動で閉じる
    value={value}
    onChange={(e) => {
      onValueChange(e.target.value);
      stopEditing();
    }}>
    {values.map((s) => &lt;MenuItem key={s} value={s}>{s}&lt;/MenuItem>)}
  &lt;/Select>
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここまでいければ、あとはどうにでもなりそうですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1391</wp:post_id>
		<wp:post_date><![CDATA[2025-03-26 17:04:21]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-26 08:04:21]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-05-23 16:18:08]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-05-23 07:18:08]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90aggridreact%e3%80%91custom-edit-component%e3%82%92%e4%bd%9c%e6%88%90%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【C2PA】これから必須のC2PAを読み込んでみた]]></title>
		<link>https://www.masaakiota.net/2025/03/28/%e3%80%90node%e3%80%91%e3%81%93%e3%82%8c%e3%81%8b%e3%82%89%e5%bf%85%e9%a0%88%e3%81%aec2pa%e8%a9%a6%e3%81%97%e3%81%a6%e3%81%bf%e3%81%9f/</link>
		<pubDate>Thu, 27 Mar 2025 23:06:56 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1402</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">C2PA</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>C2PAは、画像や動画、音声、PDFに署名をし、改竄を防ぐ仕組みです。自動生成が今後伸びていくので、こうした出所を示す技術は必須となってきます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>証明書のリストについては、下記に書かれています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://opensource.contentauthenticity.org/docs/verify-known-cert-list">https://opensource.contentauthenticity.org/docs/verify-known-cert-list</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>2025年3月28日現在、信頼された証明書のリストは仮のものです。ざっとみてみたところ、AdobeやMicrosoft, Tiktokなどが登録されていました。この仮のリストは本番に移行した際にdeprecatedになるため、その時にシステムの修正が必要になります。仮のリストに登録するには、実際に運用を始めてからメールで申請するようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">簡単なテスト</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>C2PAの検証は下記サイトで行えます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://contentcredentials.org/verify">https://contentcredentials.org/verify</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>検証のための画像は、C2PA公式にあります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://c2pa.org/public-testfiles/image">https://c2pa.org/public-testfiles/image</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>C2PA Toolsのテスト用証明書で作成されています。Verify tool’s temporary known certificate list.に登録されていないため、This Content Credential was issued by an unknown source.というメッセージが表示されます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Node.jsでのC2PA</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Node.jsでは、下記のライブラリがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/contentauth/c2pa-node">https://github.com/contentauth/c2pa-node</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>2025年3月28日現在プレリリース版なので、とりあえず使ってみるには良いと思います。ただ本番ではバイナリを直接呼び出す方がいいかもしれません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">使ってみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まずは公式からC2PAの埋め込まれたテスト画像ファイルをダウンロードします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://c2pa.org/public-testfiles/image">https://c2pa.org/public-testfiles/image</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回、assetsフォルダに入れました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>インストールします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npm i c2pa-node
npm i -D @types/node</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>下記のコードを実行します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { createC2pa } from 'c2pa-node';
import { readFile } from 'node:fs/promises';

const c2pa = createC2pa();

async function read(path, mimeType) {
  const buffer = await readFile(path);
  const result = await c2pa.read({ buffer, mimeType });

  if (result) {
    const { active_manifest, manifests, validation_status } = result;
    console.log(active_manifest);
  } else {
    console.log('No claim found');
  }
}

read('assets/adobe-20220124-A.jpg', 'image/jpeg');</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>下記の結果となりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">No claim found</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これは、C2PA署名の入っていないファイルのためです。今度は、署名の入っているファイルで試します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>assets/adobe-20220124-C.jpgです。すると以下の結果が出ました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">{
  claim_generator: 'make_test_images/0.16.1 c2pa-rs/0.16.1',
  title: 'C.jpg',
  format: 'image/jpeg',
  instance_id: 'xmp:iid:f7ba134b-8dec-4334-911d-a30409e32d8e',
  thumbnail: {
    format: 'image/jpeg',
    data: &lt;Buffer ff d8 ff e0 00 10 4a 46 49 46 00 01 02 00 00 01 00 01 00 00 ff c0 00 11 08 02 ab 04 00 03 01 11 00 02 11 01 03 11 01 ff db 00 43 00 06 04 05 06 05 04 ... 31558 more bytes&gt;
  },
  ingredients: [],
  assertions: [
    {
      label: 'stds.schema-org.CreativeWork',
      data: [Object],
      kind: 'Json'
    },
    { label: 'c2pa.actions', data: [Object] }
  ],
  signature_info: {
    alg: 'Ps256',
    issuer: 'C2PA Test Signing Cert',
    cert_serial_number: '720724073027128164015125666832722375746636448153',
    time: '2023-01-24T14:48:56+00:00',
    timeObject: 2023-01-24T14:48:56.000Z
  },
  label: 'contentauth:urn:uuid:4d971750-1db4-4492-a87c-5c3e7ed33efc'
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>active_manifestの結果のみです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>検証も行うには、validation_statusを見るようです。今回の画像では、リスト登録されていない証明書のためか、validation_statusは空配列でした。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"className":""} -->
<h2 class="wp-block-heading">各要素の解説</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ChatGPTに、上記の結果について解説してもらいました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3,"className":""} -->
<h3 class="wp-block-heading">基本情報</h3>
<!-- /wp:heading -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><strong><code>claim_generator</code></strong>:<br>→ 画像にC2PAメタデータを埋め込んだツールとバージョン。<br>→ <code>make_test_images/0.16.1</code> と <code>c2pa-rs/0.16.1</code> を使用している。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong><code>title</code></strong>:<br>→ 画像のファイル名 (<code>C.jpg</code>)。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong><code>format</code></strong>:<br>→ 画像のフォーマット (<code>image/jpeg</code>)。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong><code>instance_id</code></strong>:<br>→ 画像の一意の識別子（XMPの <code>xmp:iid</code> に基づく）。</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":4,"className":""} -->
<h4 class="wp-block-heading">サムネイル</h4>
<!-- /wp:heading -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><strong><code>thumbnail</code></strong>:<br>→ 画像のサムネイル（プレビュー用の小さい画像）がJPEGフォーマットで格納されている。</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":4,"className":""} -->
<h4 class="wp-block-heading">成分情報</h4>
<!-- /wp:heading -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><strong><code>ingredients</code></strong>:<br>→ 画像の元となる要素（別の画像やコンテンツ）がある場合、それらがここに記録される。<br>→ 今回は空 (<code>[]</code>) なので、元データの情報は記録されていない。</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":4,"className":""} -->
<h4 class="wp-block-heading">アサーション</h4>
<!-- /wp:heading -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><strong><code>assertions</code></strong>:<br>→ 画像に関連するメタデータを保持するリスト。<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><code>stds.schema-org.CreativeWork</code>:<br>→ <code>schema.org</code> の <code>CreativeWork</code> に関するメタデータ（詳細は <code>data</code> の中）。<br>→ 例えば、著作権情報や作成者情報などが含まれる可能性がある。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><code>c2pa.actions</code>:<br>→ 画像に行われた処理やアクション（例えば、編集やフィルター適用の履歴）。</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":4,"className":""} -->
<h4 class="wp-block-heading">署名情報</h4>
<!-- /wp:heading -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><strong><code>signature_info</code></strong>:<br>→ このC2PAデータが改ざんされていないことを保証するためのデジタル署名情報。<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><strong><code>alg</code></strong>:<br>→ 署名アルゴリズム (<code>Ps256</code> = RSA PSS with SHA-256)。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong><code>issuer</code></strong>:<br>→ 署名を発行した証明機関（この場合 <code>C2PA Test Signing Cert</code>）。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong><code>cert_serial_number</code></strong>:<br>→ 証明書のシリアル番号。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong><code>time</code> / <code>timeObject</code></strong>:<br>→ 署名が行われた時刻 (<code>2023-01-24T14:48:56Z</code>)。</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":4,"className":""} -->
<h4 class="wp-block-heading">ラベル</h4>
<!-- /wp:heading -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><strong><code>label</code></strong>:<br>→ コンテンツ認証のURN（UUID形式）。<br>→ <code>contentauth:urn:uuid:4d971750-1db4-4492-a87c-5c3e7ed33efc</code></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1402</wp:post_id>
		<wp:post_date><![CDATA[2025-03-28 08:06:56]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-27 23:06:56]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-05-03 17:35:56]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-05-03 08:35:56]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node%e3%80%91%e3%81%93%e3%82%8c%e3%81%8b%e3%82%89%e5%bf%85%e9%a0%88%e3%81%aec2pa%e8%a9%a6%e3%81%97%e3%81%a6%e3%81%bf%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="c2pa"><![CDATA[C2PA]]></category>
		<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Linux】ブルートフォース攻撃対策とログサイズ制限]]></title>
		<link>https://www.masaakiota.net/2025/03/30/%e3%80%90gce%e3%80%91%e3%83%ad%e3%82%b0%e3%82%b5%e3%82%a4%e3%82%ba%e5%88%b6%e9%99%90%e3%81%a8%e3%83%96%e3%83%ab%e3%83%bc%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%82%b9%e6%94%bb%e6%92%83%e3%83%96/</link>
		<pubDate>Sun, 30 Mar 2025 07:04:20 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1427</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">今回の背景</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>このブログは、現在GCEで動かしています。容量をできるだけギリギリにしているのですが、なぜか容量が増える増える。ログにしても増えすぎだろうと。何回か調査はしていたのですが、今回根本的に解決できたかもしれないので、残しておきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">どこで容量を食っているか確認する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のコマンドで確認できます。ChatGPT様様です</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">sudo du -h --max-depth=1 / | sort -rh | head -10</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>/varや/snapが肥大化していました。/varで確認すると、/var/logが肥大化していました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">$ sudo du -h --max-depth=1 /var/log
1.1G	/var/log/journal
116K	/var/log/apt
4.0K	/var/log/private
4.0K	/var/log/landscape
4.0K	/var/log/dist-upgrade
6.3M	/var/log/sysstat
3.8M	/var/log/nginx
4.0K	/var/log/chrony
100K	/var/log/unattended-upgrades
120K	/var/log/letsencrypt
1.2G	/var/log</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>journalは、systemdのjournalログだそうです。これが原因の可能性が高いです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>内容を見てみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">journalctl -n 50</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>下記のようなログが目立ちました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Mar 30 15:35:58 sshd[2283]: Received disconnect from 218.92.0.196 port 18920:11:  [preauth]
Mar 30 15:36:03 sshd[2345]: Received disconnect from 222.186.57.226 port 60376:11: Bye Bye [preauth]
Mar 30 15:37:07 sshd[2547]: Received disconnect from 218.92.0.196 port 15459:11:  [preauth]</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>sshに対するブルートフォース攻撃のようです。これが、かなりの量を占めているようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ブルートフォース攻撃対策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>不正アクセスをブロックするために、Fail2Banを入れます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">sudo apt update &amp;&amp; sudo apt install fail2ban -y
sudo systemctl enable --now fail2ban
sudo systemctl restart ssh</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>しばらくしてから、状況を確認してみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">$ sudo fail2ban-client status sshd
Status for the jail: sshd
|- Filter
|  |- Currently failed:	6
|  |- Total failed:	21
|  `- Journal matches:	_SYSTEMD_UNIT=sshd.service + _COMM=sshd
`- Actions
   |- Currently banned:	1
   |- Total banned:	2
   `- Banned IP list:	31.133.205.10</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>正常にBanできているようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ログサイズを制限</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まずは設定ファイルを開きます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">sudo nano /etc/systemd/journald.conf</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>下記を書き換えます。今回、500Mに制限しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">SystemMaxUse=500M</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>変更を反映します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">sudo systemctl restart systemd-journald</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、ひとまず処置が完了しました。またしばらく、様子を見たいと思います。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1427</wp:post_id>
		<wp:post_date><![CDATA[2025-03-30 16:04:20]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-30 07:04:20]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-03-30 16:17:51]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-03-30 07:17:51]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90gce%e3%80%91%e3%83%ad%e3%82%b0%e3%82%b5%e3%82%a4%e3%82%ba%e5%88%b6%e9%99%90%e3%81%a8%e3%83%96%e3%83%ab%e3%83%bc%e3%83%88%e3%83%95%e3%82%a9%e3%83%bc%e3%82%b9%e6%94%bb%e6%92%83%e3%83%96]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="linux"><![CDATA[Linux]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】useSWRImmutableの罠。ページ遷移]]></title>
		<link>https://www.masaakiota.net/2025/04/03/%e3%80%90react%e3%80%91useswrimmutable%e3%81%ae%e7%bd%a0%e3%80%82%e3%83%9a%e3%83%bc%e3%82%b8%e9%81%b7%e7%a7%bb/</link>
		<pubDate>Thu, 03 Apr 2025 12:28:37 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1441</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">useSWRImmutable</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>useSWRImmutableは、swrライブラリで使える関数です。通常はuseSWRを使いますが、データ更新したくない時などに使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ページ遷移でも更新されない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下の事件が発生しました。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>フォームでデータ更新</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>一覧に戻る</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>もう一度フォームに遷移</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>データが反映されていない</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>今回、update用のフォーム作成時に、初期データ取得でuseSWRImmutableを使いました。こうすることで、フォーム編集中に意図しないリセットを防ぐ目的です。しかし以下の特徴があるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>useSWRImmutableは、ページ遷移でも更新されない</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>用途によってはかなり便利です。ただし今回のケースでは困るため、以下のようにして対応しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">const { data, mutate } = useSWRImmutable(...

useEffect(()=>{
  mutate();
}, []);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>明示的にmutateを呼び出すことで、更新されるようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1441</wp:post_id>
		<wp:post_date><![CDATA[2025-04-03 21:28:37]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-04-03 12:28:37]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-04-03 21:29:10]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-04-03 12:29:10]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91useswrimmutable%e3%81%ae%e7%bd%a0%e3%80%82%e3%83%9a%e3%83%bc%e3%82%b8%e9%81%b7%e7%a7%bb]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Prisma】v6.6.0でschema分割方法が変わった]]></title>
		<link>https://www.masaakiota.net/2025/04/12/%e3%80%90prisma%e3%80%91v6-6-0%e3%81%a7schema%e5%88%86%e5%89%b2%e6%96%b9%e6%b3%95%e3%81%8c%e5%a4%89%e3%82%8f%e3%81%a3%e3%81%9f/</link>
		<pubDate>Sat, 12 Apr 2025 09:51:35 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1446</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Prismaのスキーマ分割</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Prismaのスキーマは分割できますが、現在プレビュー版です。破壊的な変更が起こることが今後も想定されます。今回は、具体的なディレクトリ指定が必要になったようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>公式の解説は以下です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://www.prisma.io/docs/orm/prisma-schema/overview/location">https://www.prisma.io/docs/orm/prisma-schema/overview/location</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">手順</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>schema.prismaにpreviewFeaturesを追加します。ここは以前と変わりません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["prismaSchemaFolder"]
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>package.jsonで、schemaディレクトリを指定します。ここはMagickではなくなり、自動検出が行われません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">// package.json
{
  "prisma": {
    "schema": "./schema"
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>package.jsonに指定する以外にも方法があります。それらに関しては、公式サイトを参照ください。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>migrationsディレクトリと、メインのschemaファイルは同ディレクトリにある必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class=""># `migrations` and `schema.prisma` are on the same level
.
├── migrations
├── models
│   ├── posts.prisma
│   └── users.prisma
└── schema.prisma</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以上、変更点でした。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1446</wp:post_id>
		<wp:post_date><![CDATA[2025-04-12 18:51:35]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-04-12 09:51:35]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-04-12 18:52:17]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-04-12 09:52:17]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90prisma%e3%80%91v6-6-0%e3%81%a7schema%e5%88%86%e5%89%b2%e6%96%b9%e6%b3%95%e3%81%8c%e5%a4%89%e3%82%8f%e3%81%a3%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="prisma"><![CDATA[Prisma]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Next.js】mjmlが沼りそうなのでReact Emailに変える話]]></title>
		<link>https://www.masaakiota.net/2025/04/13/%e3%80%90next-js%e3%80%91mjml%e3%81%8c%e6%b2%bc%e3%82%8a%e3%81%9d%e3%81%86%e3%81%aa%e3%81%ae%e3%81%a7react-email%e3%81%ab%e5%a4%89%e3%81%88%e3%82%8b%e8%a9%b1/</link>
		<pubDate>Sat, 12 Apr 2025 17:46:45 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1451</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">mjml</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>mjmlは、htmlメールの作成を簡単にするためのライブラリです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Next.jsでエラー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>mjmlをNext.jsのサーバーサイドで使用したかったのですが、下記のエラーが出ました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">no such file or directory, open '(rsc)/../../node_modules/.pnpm/uglify-js@3.19.3/node_modules/uglify-js/lib/utils.js'</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>色々調べているうちに、下記のissuesを発見。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/vercel/next.js/issues/50042">https://github.com/vercel/next.js/issues/50042</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>どうやら、以下のような現象のようです。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>App routerではエラーになるが、Pages routerなら動く</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>この時点で、かなりやばい現象だとわかります。原因にまったく想像がつきません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>一応下記のように、next.config.jsに追記すれば改善するそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">module.exports = {
  experimental: {
    serverComponentsExternalPackages: ["mjml"],
  },
};</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ただ根本的な解決ではない上、今後も予想しない現象が出そうです。そのため、おとなしくreact emailに乗り換えることにしました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">React Email</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>React Emailは、Reactの書き方でEmailのHTMLを生成できます。propsを渡して、render関数を呼び出せば、htmlに変換できるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>mjmlからのマイグレーションも紹介されています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://react.email/docs/getting-started/migrating-to-react-email">https://react.email/docs/getting-started/migrating-to-react-email</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回、mjmlでの実装はそれほど進んでいなかったため、すんなり乗り換えられそうです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1451</wp:post_id>
		<wp:post_date><![CDATA[2025-04-13 02:46:45]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-04-12 17:46:45]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-04-13 02:48:15]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-04-12 17:48:15]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90next-js%e3%80%91mjml%e3%81%8c%e6%b2%bc%e3%82%8a%e3%81%9d%e3%81%86%e3%81%aa%e3%81%ae%e3%81%a7react-email%e3%81%ab%e5%a4%89%e3%81%88%e3%82%8b%e8%a9%b1]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="next-js"><![CDATA[Next.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Next.js】Can't resolve '@img/sharp-libvips-dev/include']]></title>
		<link>https://www.masaakiota.net/2025/04/19/%e3%80%90next-js%e3%80%91cant-resolve-img-sharp-libvips-dev-include/</link>
		<pubDate>Fri, 18 Apr 2025 18:02:49 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1474</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">環境とエラー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、pnpmモノレポNext.jsです。packageの一つでsharpを使っていたのですが、next devで下記のエラーとなりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Module not found: Can't resolve '@img/sharp-libvips-dev/include'</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>バイナリファイルが、webpackで正しく処理されていないことが原因のようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">webpackでsharpの扱いを指定する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>next.config.tsで下記のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const nextConfig: NextConfig = {
  webpack: (config, { isServer }) =&gt; {
    if (isServer) {
      config.externals.push({
        sharp: 'commonjs sharp',
      });
    }
    return config;
  },
};

export default nextConfig;
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、解決しました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1474</wp:post_id>
		<wp:post_date><![CDATA[2025-04-19 03:02:49]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-04-18 18:02:49]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-04-19 09:52:37]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-04-19 00:52:37]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90next-js%e3%80%91cant-resolve-img-sharp-libvips-dev-include]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="next-js"><![CDATA[Next.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【AI】Postgres + Drizzle + Embeddingで意味検索する]]></title>
		<link>https://www.masaakiota.net/2025/04/24/%e3%80%90ai%e3%80%91postgres-drizzle-embedding%e3%81%a7%e6%84%8f%e5%91%b3%e6%a4%9c%e7%b4%a2%e3%81%99%e3%82%8b/</link>
		<pubDate>Wed, 23 Apr 2025 15:42:51 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1498</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">構成</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、下記を使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>Postgress</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Drizzle</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Open AI API</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>初めはPrismaで頑張っていたのですが、自由度が低く厳しそうでしたので、Drizzleに乗り換えた次第です。Drizzleならインデックス含めサクッとできました。感激。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Embedding</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Embeddingは、最近流行りのAI技術です。文章をベクトル化し、意味合いのマッチ具合を判定できるようになります。今回はOpenAI APIの、text-embedding-3-smallを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">比較計算</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>意味合いのマッチ具合は、ベクトルの関連性計算によって行われます。計算手法には下記のようなものがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>コサイン: 角度による比較</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ユークリッド: 単純な距離の比較</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>マンハッタン: 各次元の差の絶対値の合計の比較</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">コサイン比較 ⚪︎</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>テキストベクトルの比較には、コサインによる計算が最も一般的だそうです。値の範囲も限定されており、使い勝手も抜群です。今回はこちらを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">ユークリッド距離 ×</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ユークリッド距離による比較は、単純なベクトル距離を用います。文章全体の印象が反映されますが、外れ値が多く、ユーザーにとって意外な結果が返ってきたりするようです。使用するのは特定のケースに限られそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">マンハッタン距離 △</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>コサインのような曖昧な検索ではなく、より明瞭な検索結果が欲しい場合は、マンハッタン距離による比較も選択肢に入ってくるかと思います。ユークリッド距離よりは、ユーザーも納得の結果が返ってきそうです。しかし値の範囲が限定されていないため、閾値の計算にコストがかかります。またpgvectorインデックスは2025年5月10日時点で、IVFLATでマンハッタン対応していますが、HNSWでは未対応です。レスポンスを重視するとHNSWとなることから、今回はパスします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">実装とテスト</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">準備</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>環境変数を設定します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">DATABASE_URL="postgresql://postgres:@localhost:5432/mydb"
OPENAI_API_KEY="sk-proj-xxx"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>定数を定義します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export const EMBEDDING_DIMENSIONS = 1536;
export const EMBEDDING_MODEL = "text-embedding-3-small";</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>スキーマを作ります。HNSWインデックス、cosineを使用しています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { index, integer, pgTable, varchar, vector } from "drizzle-orm/pg-core";
import { EMBEDDING_DIMENSIONS } from '../constants';

export const postsTable = pgTable(
  "posts",
  {
    id: integer().primaryKey().generatedAlwaysAsIdentity(),
    content: varchar({ length: 255 }).notNull(),
    embedding: vector({ dimensions: EMBEDDING_DIMENSIONS }).notNull(),
  },
  (table) =&gt; [
    index('embedding_hnsw_index').using('hnsw', table.embedding.op('vector_cosine_ops')),
  ]
);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>dbをどこでも使用できるようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { drizzle } from 'drizzle-orm/node-postgres';

export const db = drizzle(process.env.DATABASE_URL!);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>APIをラップします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import OpenAI from "openai";
import { EMBEDDING_DIMENSIONS, EMBEDDING_MODEL } from "./constants";

const client = new OpenAI();

export async function embed(content: string) {
  const response = await client.embeddings.create({
    model: EMBEDDING_MODEL,
    input: content,
    dimensions: EMBEDDING_DIMENSIONS,
  });
  return response.data[0].embedding;
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">データを入れる</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回下記のようなデータを使用しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import 'dotenv/config';
import { db } from './db';
import { postsTable } from "./db/schema";
import { embed } from './openai';

const TEST_DATA = [
  'みかんを食べている男の人',
  'レストランで食事する家族連れ',
  'ギターを担いだ男二人がバーで飲んでいる',
  '猫をなでる子供',
  '散歩をするおじいさん',
]

async function insert() {
  for (const testData of TEST_DATA) {
    console.log(`Inserting ${testData}`);
    const embedding = await embed(testData);
    await db.insert(postsTable).values({
      content: testData,
      embedding,
    });
  }
}

insert();</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">検索する</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のような検索コードを作りました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import 'dotenv/config';
import { db } from './db';
import { postsTable } from "./db/schema";
import { embed } from './openai';
import { sql, cosineDistance } from 'drizzle-orm';


async function main() {
  const query = process.argv[2];
  if (!query) throw new Error('no query');
  const embedding = await embed(query);
  const result = await db
    .select({
      content: postsTable.content,
      distance: cosineDistance(postsTable.embedding, embedding)
    })
    .from(postsTable)
    .orderBy(cosineDistance(postsTable.embedding, embedding));
  console.log(result);
}

main();</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>実際に検索してみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">tsx src/main.ts 音楽    

[
  { content: 'ギターを担いだ男二人がバーで飲んでいる', distance: 0.6905424367734843 },
  { content: 'みかんを食べている男の人', distance: 0.7711687249641749 },
  { content: 'レストランで食事する家族連れ', distance: 0.8035564848319032 },
  { content: '散歩をするおじいさん', distance: 0.8601853937186783 },
  { content: '猫をなでる子供', distance: 0.863712573629618 }
]</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">tsx src/main.ts お年寄り

[
  { content: '散歩をするおじいさん', distance: 0.6252080873274957 },
  { content: '猫をなでる子供', distance: 0.7478481741193026 },
  { content: 'レストランで食事する家族連れ', distance: 0.7724779558841293 },
  { content: 'みかんを食べている男の人', distance: 0.7884846037445112 },
  { content: 'ギターを担いだ男二人がバーで飲んでいる', distance: 0.8039060772629403 }
]</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">tsx src/main.ts cat 

[
  { content: '猫をなでる子供', distance: 0.5634503482552038 },
  { content: 'みかんを食べている男の人', distance: 0.7431684418126188 },
  { content: '散歩をするおじいさん', distance: 0.7994899092432515 },
  { content: 'ギターを担いだ男二人がバーで飲んでいる', distance: 0.8381289147215432 },
  { content: 'レストランで食事する家族連れ', distance: 0.8834894558445278 }
]</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>うまい具合に、存在しない検索語句でもちゃんとdistanceが反映されています。言語が違っていても、大丈夫そうです。distanceの閾値は、今回のケースだと0.7あたりが良さそうですね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ただお年寄りを検索しているのに、子供が割と上位に来ています。猫は年寄りといったイメージがあるのでしょうか。あるいはモデルに、shortを使用しているからかもしれません。この辺りは、速度・費用・精度のトレードオフですね。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">文字数が少なすぎる場合の問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Embeddingする際に用いる文字列が、短すぎるとうまくマッチしないことがあります。たとえば「海」「湖」などの言葉だけで検索しようとすると、ヒットしません。Embeddingモデルにもよるかと思いますが、そうした場合下記のようにして解決する場合があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">const query = '海';
const fixedQuery = `${query}.`;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記では、単純に「.」（ピリオド）を追加しています。すべてのケースで有効かどうかは定かではありませんが、これをするだけで、ベクトルがマッチすることもあるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ef_search</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>あまりわかってなく恐縮ですが、近似値の幅を広げるのがef_searchのようです。現在の設定は以下のようにして確認できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const currentEfSearch = await db().execute(sql`SELECT current_setting('hnsw.ef_search');`)
console.log(currentEfSearch.rows)</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>デフォルトは40で、これを上げると近似で拾う範囲が広がるといったことのようです。ただし負荷が増えるため、そのトレードオフです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>クエリごとに設定するには、transactionを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">await db().transaction(async (tx) => {
  await tx.execute(sql.raw(`SET LOCAL hnsw.ef_search = 120`))

  return tx.query...
})</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、ef_searchが120で動作します。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1498</wp:post_id>
		<wp:post_date><![CDATA[2025-04-24 00:42:51]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-04-23 15:42:51]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-28 20:22:59]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-28 11:22:59]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90ai%e3%80%91postgres-drizzle-embedding%e3%81%a7%e6%84%8f%e5%91%b3%e6%a4%9c%e7%b4%a2%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="drizzle"><![CDATA[Drizzle]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Drizzle】Next.jsで既知の問題。"cloudflare:sockets" is not handled by plugins]]></title>
		<link>https://www.masaakiota.net/2025/04/24/%e3%80%90next-js%e3%80%91drizzle%e3%81%a7reading-from-cloudflaresockets-is-not-handled-by-plugins/</link>
		<pubDate>Thu, 24 Apr 2025 13:47:39 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1528</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Next.js + Drizzle + Postgres</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回下記のエラーが出ました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Module build failed: UnhandledSchemeError: Reading from "cloudflare:sockets" is not handled by plugins (Unhandled scheme).
Webpack supports "data:" and "file:" URIs by default.
You may need an additional plugin to handle "cloudflare:" URIs.</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>API RouteとServer Actionで上記のエラーとなっていました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>下記でドンピシャのissueが建てられています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/vercel/next.js/discussions/50177">https://github.com/vercel/next.js/discussions/50177</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これによると、node-postgresに関した既知の問題のようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>いくつか方法が紹介されていますが、今回、下記のようにすることで解決しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// next.config.ts

const nextConfig:NextConfig = {
    // ...
    webpack: (config, { webpack }) =&gt; {
        config.plugins.push(new webpack.IgnorePlugin({
            resourceRegExp: /^pg-native$|^cloudflare:sockets$/,
        }))

        return config
    },
}

export default nextConfig</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1528</wp:post_id>
		<wp:post_date><![CDATA[2025-04-24 22:47:39]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-04-24 13:47:39]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-05-09 06:56:07]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-05-08 21:56:07]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90next-js%e3%80%91drizzle%e3%81%a7reading-from-cloudflaresockets-is-not-handled-by-plugins]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="drizzle"><![CDATA[Drizzle]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Drizzle】Invalid URLエラーを解決する]]></title>
		<link>https://www.masaakiota.net/2025/04/27/%e3%80%90drizzle%e3%80%91invalid-url%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e8%a7%a3%e6%b1%ba%e3%81%99%e3%82%8b/</link>
		<pubDate>Sun, 27 Apr 2025 06:45:25 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1531</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">DrizzleでInvalid URL</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のようなurlを使用すると、エラーになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">postgresql://user:pass@project:region:instance/db</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これはCloud SQLの接続名を使用しています。Drizzleはこれをパースできずに、Invalid URLエラーを投げてしまいます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のようにすることで、解決しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">postgresql://user:pass@localhost/db?host=/cloudsql/project:region:instance</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>なおlocalhostとしているのは、Cloud Runの設定でCloud SQL接続を入れているためです。詳細はまだ理解しきれていませんが、localhost経由で接続できるようになるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>設定は下記のようになっています。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>Cloud SQLはPublic IP</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Cloud RunでCloud SQL接続を有効化</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Cloud Runでネットワークアクセスを設定する（トラフィック ルーティング:プライベート IP へのリクエストのみを VPC にルーティングする）</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>下記サイトを参考にさせていただきました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://zenn.dev/google_cloud_jp/articles/cloudrun-cloudsql">https://zenn.dev/google_cloud_jp/articles/cloudrun-cloudsql</a></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1531</wp:post_id>
		<wp:post_date><![CDATA[2025-04-27 15:45:25]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-04-27 06:45:25]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-05-09 06:51:10]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-05-08 21:51:10]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90drizzle%e3%80%91invalid-url%e3%82%a8%e3%83%a9%e3%83%bc%e3%82%92%e8%a7%a3%e6%b1%ba%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="drizzle"><![CDATA[Drizzle]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【C2PA】c2patoolをDockerに入れる]]></title>
		<link>https://www.masaakiota.net/2025/04/27/%e3%80%90c2pa%e3%80%91c2patool%e3%82%92docker%e3%81%ab%e5%85%a5%e3%82%8c%e3%82%8b/</link>
		<pubDate>Sun, 27 Apr 2025 08:05:00 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1538</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">c2patool</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>c2patoolは、c2pa用のcliユーティリティです。c2pa-nodeなどもありますが、ホワイトリストの指定などは2025年4月27日現在、c2patoolを用いる必要があるようです。そのため、Cloud RunなどでC2PAを使用するには、このc2patoolが必要と考え、Dockerfileをつくりました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Dockerfile</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>c2patoolの最新バージョン0.16.4はGLIBC_2.38を必要とします。これはnode:23やdebian:bookworm-slimイメージでは存在していませんでした。これらの場合、下記のエラーとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">root@80fecb823451:/# c2patool
c2patool: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.38' not found (required by c2patool)
c2patool: /lib/x86_64-linux-gnu/libc.so.6: version `GLIBC_2.39' not found (required by c2patool)</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>そのため、ubuntuを使用します。Dockerfileは下記のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="docker" class="language-docker"># M系でも起動できるようplatformを指定
FROM --platform=linux/amd64 ubuntu:24.04

# c2patoolの依存関係をインストール
RUN apt-get update &amp;&amp; apt-get install -y \
    curl \
    ca-certificates \
    gnupg \
    &amp;&amp; rm -rf /var/lib/apt/lists/*

# c2patoolをインストール（Linuxバイナリを使用）
RUN curl -fsSL https://github.com/contentauth/c2pa-rs/releases/download/c2patool-v0.16.4/c2patool-v0.16.4-x86_64-unknown-linux-gnu.tar.gz -o c2patool.tar.gz \
  &amp;&amp; tar -xzf c2patool.tar.gz \
  &amp;&amp; mv c2patool/c2patool /usr/local/bin/ \
  &amp;&amp; chmod +x /usr/local/bin/c2patool \
  &amp;&amp; rm c2patool.tar.gz</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>試します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">docker build -t test .
docker run -it test

# 中で実行
c2patool --version</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>無事、0.16.4が表示されました。あとはここに、node.jsなどをインストールして使えば良さそうです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1538</wp:post_id>
		<wp:post_date><![CDATA[2025-04-27 17:05:00]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-04-27 08:05:00]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-04-27 17:28:26]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-04-27 08:28:26]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90c2pa%e3%80%91c2patool%e3%82%92docker%e3%81%ab%e5%85%a5%e3%82%8c%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="c2pa"><![CDATA[C2PA]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【C2PA】将来性と使用ケースを考える【AI vs リアル】]]></title>
		<link>https://www.masaakiota.net/2025/04/30/%e3%80%90c2pa%e3%80%91%e5%b0%86%e6%9d%a5%e6%80%a7%e3%81%a8%e4%bd%bf%e7%94%a8%e3%82%b1%e3%83%bc%e3%82%b9%e3%82%92%e8%80%83%e3%81%88%e3%82%8b%e3%80%90ai-vs-%e3%83%aa%e3%82%a2%e3%83%ab%e3%80%91/</link>
		<pubDate>Wed, 30 Apr 2025 02:30:08 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1549</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">C2PA</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>C2PAは画像や動画、ドキュメントなどに埋め込むデータ規格です。署名技術が用いられており、改ざんできない仕組みとなっています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">C2PAの弱点</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>C2PAは改竄を防ぐ仕組みですが、下記のような弱点もあります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>改ざんできないが、消すことはできる</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>つまり、C2PAデータを削除し、新たに追加してあたかも自分がルートであるかのように主張することが可能となります。具体的には下記のようなケースです。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>ChatGPT生成画像のC2PAデータを削除し、Photoshopで保存。あたかも自分が作ったかのようになる</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>誰かのカメラ撮影写真のC2PAデータを削除し、Photoshopで保存。以下略</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>こうしたことから、基本的に改ざん負荷の部分はあまり使い物にならなさそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">実用的な使用方法</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そこで、下記のような使用方法が考えられます。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>誰かに盗用されたときに、自分のC2PAデータを用いて権利を主張する</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>C2PAにタイムスタンプを持たせて、自分が過去に該当コンテンツを撮影・所有していたことを主張するケースです。これが、一番実用的な使用方法かと思います。例えば</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>C2PAデータの入った写真に、自身の名前や撮影日時が入っている。盗用されたときにSNSや裁判などで、それを用いて主張する</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>自分で描いたイラストに、編集履歴がC2PAデータで入っている。盗用されたときに以下略</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>ただ恐ろしいのは、仮にC2PAを利用していない場合、相手側にC2PAを偽装されるケースです。こうなると泥沼化しかねません。自身を守る意味からも、普段からC2PAデータを埋め込む癖をつけるのが、今後の最低限の防衛策になりそうです。仮に写真なら、C2PA対応カメラを持っていなかったとしても、タイムスタンプ記録のために何かしらのC2PAデータを埋め込んでおいた方がいいかもしれません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1549</wp:post_id>
		<wp:post_date><![CDATA[2025-04-30 11:30:08]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-04-30 02:30:08]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-08-05 19:26:18]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-08-05 10:26:18]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90c2pa%e3%80%91%e5%b0%86%e6%9d%a5%e6%80%a7%e3%81%a8%e4%bd%bf%e7%94%a8%e3%82%b1%e3%83%bc%e3%82%b9%e3%82%92%e8%80%83%e3%81%88%e3%82%8b%e3%80%90ai-vs-%e3%83%aa%e3%82%a2%e3%83%ab%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="c2pa"><![CDATA[C2PA]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【AI】ChatGPTとClaudeの人格の違い]]></title>
		<link>https://www.masaakiota.net/2025/05/03/%e3%80%90ai%e3%80%91chatgpt%e3%81%a8claude%e3%81%ae%e4%ba%ba%e6%a0%bc%e3%81%ae%e9%81%95%e3%81%84/</link>
		<pubDate>Sat, 03 May 2025 08:21:59 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1556</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ChatGPTとClaudeは違う</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Claudeは、コーディングに強いとされています。そのためソフトウェアエンジニアは好んで使ったりするのですが、たまに口調がうっとおしいなと言った時があります。AIなので仕方ないのかなと思っていたのですが、ChatGPT 4oだとあまりそう言ったことはないことに気づきました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これは何かあるなと。ChatGPTに聞いてみた内容をもとに、まとめてみました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">人格形成要素</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>口調はすなわち人格なので、これの調整が肝になってきます。以下のようなものがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>初期プロンプト</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Fine-Tuning</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>人間によるフィードバック</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>初期プロンプトは、以下のようなものがあるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>正確さを優先せよ</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ユーザーに情報を押し付けず、選択肢を与えよ</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>フレンドリーではあるが、馴れ馴れしすぎない態度を取れ</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>必ず最初に要点を伝え、余談はその後に</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>これはChatGPTが教えてくれたもので、どこまで実際が反映されているのかは分かりません。またClaudeでは違ったプロンプトが使われているかと思います。こうした内容がつらつら数百-数千ほど初期入力として用いられているようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Fine-Tuningは、具体的なデータセットを用いてトレーニングするといったものです。ここで用いられるデータセットも、人格形成に大きく影響することが考えられます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">人間によるフィードバック</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>フィードバックが、ChatGPTとClaudeとでの一番大きな違いかなと思いました。OpenAIはChatGPTの画面で、常にフィードバック機能を提供しています。時々、「どちらが適していますか？」といった選択肢が出るのも、煩わしかったりもしますが、ChatGPTの人格形成に大きく貢献していることは間違いありません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>一方Claudeでは、こうしたフィードバック機能はないようです。それというのも、両者のアプローチの方向性が違うようです。ChatGPTによれば、下記のようになっているようです。</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table class="has-fixed-layout"><thead><tr><th>項目</th><th>OpenAI (ChatGPT/GPT-4o)</th><th>Anthropic (Claude)</th></tr></thead><tbody><tr><td>フィードバックボタン</td><td>あり（👍👎＋コメント）</td><td>なし</td></tr><tr><td>ユーザー活用</td><td>ガンガン活用（RLHF）</td><td>ほぼ活用しない</td></tr><tr><td>チューニング方針</td><td>ユーザーの好みに適応する</td><td>最初から「正しい」ふるまいを目指す</td></tr><tr><td>設計思想</td><td>柔軟・進化型</td><td>原理主義・一貫型</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>こうした違いがあってこそ、用途によって使い分けができるようになるわけですね。企業間の競争が、AIの使い勝手向上に寄与しているようです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1556</wp:post_id>
		<wp:post_date><![CDATA[2025-05-03 17:21:59]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-05-03 08:21:59]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-05-03 17:24:08]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-05-03 08:24:08]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90ai%e3%80%91chatgpt%e3%81%a8claude%e3%81%ae%e4%ba%ba%e6%a0%bc%e3%81%ae%e9%81%95%e3%81%84]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="ai"><![CDATA[AI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Drizzle】withやcolumnを反映した型を使う]]></title>
		<link>https://www.masaakiota.net/2025/05/09/%e3%80%90drizzle%e3%80%91with%e3%82%84column%e3%82%92%e5%8f%8d%e6%98%a0%e3%81%97%e3%81%9f%e5%9e%8b%e3%82%92%e4%bd%bf%e3%81%86/</link>
		<pubDate>Thu, 08 May 2025 21:50:05 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1568</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Drizzleでの型</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>DrizzleはTypeScriptに対応しています。ただ比較的新しいライブラリのためか、型が若干弱いです。Prismaなら簡単に作れる型でも、Drizzleだと苦労すると言った場面も。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">withやcolumnを反映させる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>withやcolumnを反映させた型を使うには、独自に設定する必要があります。下記のようなユーティリティー型を作り、実現します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import type * as schema from './schema'
import type { BuildQueryResult, DBQueryConfig, ExtractTablesWithRelations } from 'drizzle-orm'
import { Exact } from 'type-fest'

type TSchema = ExtractTablesWithRelations&lt;typeof schema>

type QueryConfig&lt;TableName extends keyof TSchema> = DBQueryConfig&lt;
  'one' | 'many',
  boolean,
  TSchema,
  TSchema[TableName]
>

export type InferQueryModel&lt;
  TableName extends keyof TSchema,
  QBConfig extends Exact&lt;QueryConfig&lt;TableName>, QBConfig> = {}
> = BuildQueryResult&lt;TSchema, TSchema[TableName], QBConfig></code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>使用する際は、InferQueryModelを使います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type UserNameWithPostTitles = InferQueryModel&lt;'users', {
  columns: {
    id: true,
    name: true
  },
  with: {
    posts: {
      columns: {
        id: true,
        title: true
      }
    }
  }
}&gt;;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>下記を参考にさせていただきました。というより、URLをChatGPTに丸投げでした。はい。かしこい人には頭が上がりません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/drizzle-team/drizzle-orm/issues/695#issuecomment-1881454650">https://github.com/drizzle-team/drizzle-orm/issues/695#issuecomment-1881454650</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Selectの場合</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>上記はqueryですが、selectの場合は別のものを使用します。ChatGPT5に作ってもらいました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type RowOf&lt;Q&gt; =
  Q extends { execute: (...args: any) =&gt; Promise&lt;infer R&gt; }
  ? R extends (infer U)[] ? U : never
  : never</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下のようにして使います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const userBuilder = () =&gt; db()
  .select({
    id: usersTable.id,
    session: { id: sessionsTable.id, expiresAt: sessionsTable.expiresAt }
  })
  .from(usersTable)
  .leftJoin(sessionsTable, eq(sessionsTable.userId, usersTable.id));

type User = RowOf&lt;ReturnType&lt;typeof userBuilder&gt;&gt;;


const users = await userBuilder()
  .where(gt(usersTable.id, '1'))
  .limit(10);</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1568</wp:post_id>
		<wp:post_date><![CDATA[2025-05-09 06:50:05]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-05-08 21:50:05]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-10 13:51:44]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-10 04:51:44]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90drizzle%e3%80%91with%e3%82%84column%e3%82%92%e5%8f%8d%e6%98%a0%e3%81%97%e3%81%9f%e5%9e%8b%e3%82%92%e4%bd%bf%e3%81%86]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="drizzle"><![CDATA[Drizzle]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】数字フィールドでIME日本語入力を攻略する]]></title>
		<link>https://www.masaakiota.net/2025/05/22/%e3%80%90react%e3%80%91%e6%95%b0%e5%ad%97%e3%83%95%e3%82%a3%e3%83%bc%e3%83%ab%e3%83%89%e3%81%a7ime%e6%97%a5%e6%9c%ac%e8%aa%9e%e5%85%a5%e5%8a%9b%e3%82%92%e6%94%bb%e7%95%a5%e3%81%99%e3%82%8b/</link>
		<pubDate>Thu, 22 May 2025 03:19:20 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1603</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">数字フィールドでのIME</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>通常、数字入力には下記を使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">&lt;input type="number"...</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>しかしIMEがオンになってると意図しない挙動になったりします。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">onChangeのみでのカーソル問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>type="text"にしてonChangeで強制的に変換するのもいいのですが、今度はカーソル問題が出てきます。入力するたびにカーソルが後ろに行ってしまいます。こういうことが何度かあり、その度に挑戦しては諦めて代替案を採用していました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>しかし今回、克服できたので共有させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">selectionStartとrequestAnimationFrameを使用する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>selectionStartでカーソル位置を取得できます。ここから計算して、編集後にカーソルを移動させます。ただし普通に行った場合はReactの更新プロセスが後に来てしまい、意味がありません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこでrequestAnimationFrameを使用します。requestAnimationFrameは、次のフレーム更新直前に関数を実行してくれるため、Reactの後に割り込むことが可能となります。なおこうした使用方法はトリッキーです。ChatGPTが出した回答に入っていたのですが、通常の使用方法ではありません。裏技的な手法となります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>下記のコードでは、IMEオンの時でも常に半角数字が入力されます。react-number-formatライブラリよりも良いです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">import { useCallback } from 'react';

export interface NumberTextFieldProps extends Omit&lt;React.InputHTMLAttributes&lt;HTMLInputElement&gt;, 'onChange' | 'type'&gt; {
  onChange?: (value: string) =&gt; void
}

export const NumberTextField = (props: NumberTextFieldProps) =&gt; {
  const { onChange, ...restProps } = props;

  const handleChange = useCallback((e: React.ChangeEvent&lt;HTMLInputElement&gt;) =&gt; {
    const input = e.target
    const originalValue = e.target.value

    // 半角数字のみに変換
    const numbersOnly = toNumbersOnly(originalValue)

    // カーソル位置計算
    const beforeCursorLength = (() =&gt; {
      const cursorPosition = input.selectionStart || 0

      // カーソル位置より前の文字列
      const beforeCursor = originalValue.slice(0, cursorPosition)

      // カーソル位置より前の部分を変換した場合の長さを計算
      const convertedBeforeCursor = toNumbersOnly(beforeCursor);
      return convertedBeforeCursor.length
    })();

    // 親コンポーネントへの通知
    onChange?.(numbersOnly)

    // カーソル位置を補正して復元。
    // requestAnimationFrameで、Reactのレンダリング後にタイミングをずらす
    requestAnimationFrame(() =&gt; {
      const newPosition = Math.min(
        beforeCursorLength,
        numbersOnly.length
      )
      input.setSelectionRange(newPosition, newPosition)
    })
  }, [onChange])

  return (
    &lt;input
      {...restProps}
      type="text"
      onChange={handleChange}
    /&gt;
  )
}

// 半角数字のみに変換
function toNumbersOnly(value: string | undefined) {
  const converted = value?.replace(/[０-９]/g, (s) =&gt; {
    return String.fromCharCode(s.charCodeAt(0) - 0xFEE0)
  })
  return converted?.replace(/[^0-9]/g, '') ?? ''
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>下記のように使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="jsx" class="language-jsx">import { Box } from '@mui/material'
import { StrictMode, useState } from 'react'
import { createRoot } from 'react-dom/client'
import { NumberTextField } from './components/NumberTextField'

const App = () =&gt; {
  const [value, setValue] = useState('')
  return (
    &lt;Box&gt;
      &lt;NumberTextField
        value={value}
        onChange={(value) =&gt; setValue(value)}
      /&gt;
    &lt;/Box&gt;
  )
}

createRoot(document.getElementById('root')!).render(
  &lt;StrictMode&gt;
    &lt;App /&gt;
  &lt;/StrictMode&gt;,
)</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1603</wp:post_id>
		<wp:post_date><![CDATA[2025-05-22 12:19:20]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-05-22 03:19:20]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-05-23 17:26:33]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-05-23 08:26:33]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91%e6%95%b0%e5%ad%97%e3%83%95%e3%82%a3%e3%83%bc%e3%83%ab%e3%83%89%e3%81%a7ime%e6%97%a5%e6%9c%ac%e8%aa%9e%e5%85%a5%e5%8a%9b%e3%82%92%e6%94%bb%e7%95%a5%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【AgGrid】数値フィールドのIME対策【React】]]></title>
		<link>https://www.masaakiota.net/2025/05/22/%e3%80%90aggrid%e3%80%91%e6%95%b0%e5%80%a4%e3%83%95%e3%82%a3%e3%83%bc%e3%83%ab%e3%83%89%e3%81%aeime%e5%af%be%e7%ad%96/</link>
		<pubDate>Thu, 22 May 2025 06:40:42 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1613</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">AgGridの数値フィールド</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>AgGridでは、テーブルを直接編集する機能があります。編集のためのコンポーネントはtext, numberなどを指定できます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>このnumberでのフィールドでIMEをオンにして入力すると、</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>なんと</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>それまでのデータ含め値が消えます</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">対策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>値が消える時にはnullになるため、nullになった時に前の値を復活させます。大抵はこれで大丈夫かと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">{
    editable: true,
    cellEditor: 'agNumberCellEditor',
    onCellValueChanged: (params) =&gt; {
      const field = params.colDef.field as string as keyof T;
      if (!params.data) return;
      const value = params.data[field];

      // IMEで入力した場合、valueがnullになるため、oldValueを設定する
      if (value === null)
        params.data[field] = params.oldValue
    },
  }</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1613</wp:post_id>
		<wp:post_date><![CDATA[2025-05-22 15:40:42]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-05-22 06:40:42]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-05-23 17:23:02]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-05-23 08:23:02]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90aggrid%e3%80%91%e6%95%b0%e5%80%a4%e3%83%95%e3%82%a3%e3%83%bc%e3%83%ab%e3%83%89%e3%81%aeime%e5%af%be%e7%ad%96]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Jotai】ZustandよりJotaiが優れている部分]]></title>
		<link>https://www.masaakiota.net/2025/05/30/%e3%80%90jotai%e3%80%91zustand%e3%82%88%e3%82%8ajotai%e3%82%92%e6%8e%a1%e7%94%a8%e3%81%97%e3%81%9f%e7%90%86%e7%94%b1/</link>
		<pubDate>Thu, 29 May 2025 18:24:19 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1621</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Jotai</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Jotaiは、Reactのための軽量なステート管理ライブラリです。atomと呼ばれる単位を使用して状態を管理します。最小限のAPIで直感的にステートを定義・操作できます。このシンプルさに加え、TypeScriptとの相性も良いため、型安全に開発が進められる点も魅力の一つです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Zustand</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ZustandはJotaiと同じ作者によるライブラリです。Jotai同様ステートを管理しますが、複数まとめて定義できることが特徴です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Jotai vs Zustand</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Zustandは変数+関数、Jotaiは変数のみ</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Zustandは、変数も関数もまとめてステート管理します。これは刺さる人には刺さるかもしれませんが、関心の分離で言えば、ごちゃごちゃしている印象があります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>一方Jotaiは変数のみ管理し、ロジックはカスタムフックでまかなうという使い方となります。状態と操作が分離されており、一目でわかります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Zustandはsetterでフックが使えない</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Zustandは宣言時にsetterを作りますが、フック外のためフックを使えません。結局他でフックを作成することになります。そうなると初めからsetter自体も他で作成した方がすっきりするのではないかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Jotaiは変数 + カスタムフックが便利</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>JotaiはZustandに比べてちょっと面倒です。複数ステートをまとめて定義するZustandに対して、Jotaiは一つ一つ作成してそれぞれを操作します。こうしたことから、一見とっつきにくそうに見えます。ですが、この複雑さが逆に、より細かい制御やカスタマイズを可能にしています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>また、下記のようにカスタムフックを作成することで、様々なシーンに対する使い勝手が良くなります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export const sessionAtom = atom&lt;Session | null&gt;(null);
export const userAtom = atom&lt;User | null&gt;(null);

export const useAuth = () =&gt; {
  const [session, setSession] = useAtom(sessionAtom);
  const user = useAtomValue(userAtom);

  const deleteSession = () =&gt; setSettion(null);

  return { session, user, deleteSession };
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">JotaiはSSRに強い</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>useHydrateAtomsを使用すれば、Next.jsなどのSSRを利用できます。初期値反映タイミングによるちらつきも起きません。また複数の値をまとめて初期化できるのも魅力です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { atom, useAtom } from 'jotai'
import { useHydrateAtoms } from 'jotai/utils'

const countAtom = atom(0)
const CounterPage = ({ countFromServer }) => {
  useHydrateAtoms([[countAtom, countFromServer]])
  const [count] = useAtom(countAtom)
  // count would be the value of `countFromServer`, not 0.
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">まとめ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>最初は簡単なZustandを使おうとしたのですが、これまでにも簡単さと柔軟性のトレードオフには悩まされてきました。結局柔軟性を取った方が、後々のストレスも軽減することも多いので、それを踏まえて色々調べていた次第です。Zustandのまとめて定義も魅力的ですが、Jotaiでも上記のようにすればまとまった単位で見れるようになるため、割とスッキリするのではないかと思います。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1621</wp:post_id>
		<wp:post_date><![CDATA[2025-05-30 03:24:19]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-05-29 18:24:19]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-17 12:13:57]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-17 03:13:57]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90jotai%e3%80%91zustand%e3%82%88%e3%82%8ajotai%e3%82%92%e6%8e%a1%e7%94%a8%e3%81%97%e3%81%9f%e7%90%86%e7%94%b1]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Next.js】Cursorでターミナルからファイルジャンプできなくなる問題【App Route】]]></title>
		<link>https://www.masaakiota.net/2025/06/03/%e3%80%90next-js%e3%80%91cursor%e3%81%a7tsc%e6%99%82%e3%81%ab%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%82%b8%e3%83%a3%e3%83%b3%e3%83%97%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%8f%e3%81%aa%e3%82%8b%e5%95%8f/</link>
		<pubDate>Mon, 02 Jun 2025 19:34:59 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1635</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Next.jsのApp Route</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Next.jsのApp Routeでは、下記のようなパスを使えます</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">/src/app/[locale]/(guest)/posts</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>こうしたディレクトリ構成にした場合、[locale]部分をpage.tsxで受け取れるようになったりするという話です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Cursorターミナルでパースできない時がある</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Cursorターミナルでtscを実行した場合、エラー出力から該当ファイルにジャンプできる機能があります。通常は問題ないのですが、上記の記法を用いるとパースがうまくいかなくなることがあります。そうなると、[locale]の部分で分割されてしまい、うまくジャンプできなくなったりします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>この原因についてClaudeに聞いてみたところ、ターミナルの長時間の使用でリンク解析部分が壊れることが原因ではないかとのことです。VSCodeやCursorのissuesでも報告されているとのことで、今後は修正されることが見込まれます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">とりあえずの解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>とりあえず、以下のようにすれば解決するようです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">clear &amp;&amp; tsc</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ただこれも、もしかしたら一時的である可能性もあります。ここは結構重要な部分ですので、是非とも修正が捗ってほしいですね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1635</wp:post_id>
		<wp:post_date><![CDATA[2025-06-03 04:34:59]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-06-02 19:34:59]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-06-03 04:37:28]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-06-02 19:37:28]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90next-js%e3%80%91cursor%e3%81%a7tsc%e6%99%82%e3%81%ab%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%82%b8%e3%83%a3%e3%83%b3%e3%83%97%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%8f%e3%81%aa%e3%82%8b%e5%95%8f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="next-js"><![CDATA[Next.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【sharp】リサイズ後もmetadataが更新されない問題【Node.js】]]></title>
		<link>https://www.masaakiota.net/2025/06/06/%e3%80%90sharp%e3%80%91%e3%83%aa%e3%82%b5%e3%82%a4%e3%82%ba%e5%be%8c%e3%82%82metadata%e3%81%8c%e6%9b%b4%e6%96%b0%e3%81%95%e3%82%8c%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c%e3%80%90node-js%e3%80%91/</link>
		<pubDate>Thu, 05 Jun 2025 20:50:41 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1641</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">sharp</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>sharpは、Node.jsで使える画像処理ライブラリです。リサイズ含め様々な処理が簡単に実装できます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">遭遇した問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、sharpを用いてウォーターマークをつける部分で、エラーになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Error: Image to composite must have same dimensions or smaller</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>んん？ウォーターマークは対象画像の50%サイズに計算しているのに、それより大きくなっているとはなんぞや。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>どうやらresizeを呼び出しても、metadataがすぐには更新されないようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">resize後もmetadataが更新されない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のコードを実行すると、リサイズ後のmetadataがすぐには更新されないことがわかります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import sharp from "sharp";

async function main() {
  // インスタンス生成
  let sh = sharp('./test.png');
  console.log(await sh.metadata());  // 1024 x 1536

  // リサイズ
  sh = sh.resize(10, 10);
  console.log(await sh.metadata());  // 1024 x 1536

  // バッファ化
  const buffer = await sh.toBuffer();
  console.log(await sh.metadata());  // 1024 x 1536

  // インスタンス再生成
  const newSh = sharp(buffer);
  console.log(await newSh.metadata());  // 10 x 10
}

main();</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>この原因として、Claudeは以下のように回答しました。</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:paragraph -->
<p>Sharpは遅延評価してるから、resize()を呼んでも実際にはまだ処理されてなくて、metadata()は元のサイズ（1024x1536）を返し続けてる。</p>
<!-- /wp:paragraph --></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>なるほど、sharpの最適化処理により、metadataが反映されていないようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回のテストで、以下のことがわかりました。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>リサイズしても、metadataは更新されない</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>バッファ化しても、metadataは更新されない</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>新しくインスタンスを生成すると、metadataが更新される</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>これは把握していないとツボりそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">対策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のような対策が考えられます</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>計算後のサイズを保持して再利用する</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>パフォーマンスコストを無視してインスタンスを作り直す</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>それほど大きくない画像なら、インスタンス再生成でコードをスッキリさせるのもありかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1641</wp:post_id>
		<wp:post_date><![CDATA[2025-06-06 05:50:41]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-06-05 20:50:41]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-06-06 06:37:57]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-06-05 21:37:57]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90sharp%e3%80%91%e3%83%aa%e3%82%b5%e3%82%a4%e3%82%ba%e5%be%8c%e3%82%82metadata%e3%81%8c%e6%9b%b4%e6%96%b0%e3%81%95%e3%82%8c%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c%e3%80%90node-js%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Drizzle】Cloud SQLにMigrationする【Github Actions】]]></title>
		<link>https://www.masaakiota.net/2025/06/07/%e3%80%90drizzle%e3%80%91cloud-sql%e3%81%abmigration%e3%81%99%e3%82%8b%e3%80%90github-actions%e3%80%91/</link>
		<pubDate>Sat, 07 Jun 2025 06:35:36 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1653</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Drizzle</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>DrizzleはTypeScriptのDBライブラリです。ローカルでは通常pushを使いますが、本番ではgenerateとmigrateを使用するかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Github Actions</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記、前提です。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>DB: PostgreSQL</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Package manager: PNPM</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>PNPM scriptにdb:migrateを追加。内容はdrizzle-kit migrate</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>drizzle-kit generateを実行済み</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>リポジトリの環境変数<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>GCP_SA_KEY: サービスアカウントのjsonの中身</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>DATABASE_URL: postgresURL（postgresql://username:password@localhost:5432/db_name）</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>他にも色々固有の値が入っていますが、ご容赦ください。AIで修正すれば簡単かと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>下記のようなyamlを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="yaml" class="language-yaml"># .github/workflows/deploy-cloud-run.yml

name: Deploy to Cloud Run

# Environment variables are set for build step to pass Zod validation
on:
  push:
    branches:
      - staging
    paths:
      - 'apps/web/**'
      - 'packages/**'
      - 'Dockerfile'
      - '.github/workflows/deploy-cloud-run.yml'

env:
  PROJECT_ID: ${{ secrets.GCP_PROJECT_ID }}
  SERVICE_NAME: YOUR_SERVICE_NAME
  REGION: YOUR_REGION

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    permissions:
      contents: read
      id-token: write

    steps:
    - name: Checkout
      uses: actions/checkout@v4

    - name: Setup pnpm
      uses: pnpm/action-setup@v4
      with:
        version: 10.11.0

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '22'
        cache: 'pnpm'

    - name: Install dependencies
      run: pnpm install --frozen-lockfile

    - name: Authenticate to Google Cloud
      uses: google-github-actions/auth@v2
      with:
        credentials_json: ${{ secrets.GCP_SA_KEY }}

    - name: Setup Cloud SQL Proxy
      run: |
        # Cloud SQL Proxyをダウンロード
        curl -o cloud-sql-proxy https://storage.googleapis.com/cloud-sql-connectors/cloud-sql-proxy/v2.14.1/cloud-sql-proxy.linux.amd64
        chmod +x cloud-sql-proxy
        
        # TCP/IP接続でプロキシを起動（ポート5432でリッスン）
        echo "Starting Cloud SQL Proxy for $PROJECT_ID:$REGION:main-db"
        ./cloud-sql-proxy $PROJECT_ID:$REGION:main-db --port 5432 --structured-logs &amp;
        PROXY_PID=$!
        
        # プロキシが起動するまで少し待つ
        sleep 15
        
        # プロキシが正常に起動したか確認
        echo "Checking if proxy is listening on port 5432..."
        netstat -ln | grep :5432 || echo "Port 5432 not found"
        
        # プロキシプロセスが生きているか確認
        if kill -0 $PROXY_PID 2&gt;/dev/null; then
          echo "Cloud SQL Proxy is still running (PID: $PROXY_PID)"
        else
          echo "Cloud SQL Proxy process died"
        fi
        
        # 接続テスト
        echo "Testing connection to localhost:5432..."
        timeout 5 bash -c 'cat &lt; /dev/null &gt; /dev/tcp/localhost/5432' &amp;&amp; echo "Connection successful" || echo "Connection failed"

    - name: Run database migrations
      run: |
        cd packages/lib/db
        echo "Running database migrations..."
        pnpm db:migrate
        
        # マイグレーション後にテーブル一覧を確認
        echo "Checking tables after migration..."
        psql "$DATABASE_URL" -c "\dt" || echo "Failed to list tables"
        echo "Checking database name..."
        psql "$DATABASE_URL" -c "SELECT current_database();" || echo "Failed to get database name"
      env:
        DATABASE_URL: ${{ secrets.DATABASE_URL_STAGING }}
</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">PostgreSQLのパスワード</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>PostgreSQLのパスワードは、CloudSQLのWeb画面から自動生成することもできます。ですがURL Safeではないため、うまくいかなかったりします。その場合は、下記でパスワードを生成するとうまくいくかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://mohhh-ok.github.io/url-safe-password-generator">https://mohhh-ok.github.io/url-safe-password-generator</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">CloudSQL Studio</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>CloudSQL Studioでは、パスワード認証とIAM認証が使えます。パスワード認証だと毎回入力するのが面倒なので、IAMが便利です。IAMを追加した後下記を実行すれば、テーブルが見えるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="sql" class="language-sql">-- 将来のテーブルへの自動権限
ALTER DEFAULT PRIVILEGES IN SCHEMA public 
GRANT ALL PRIVILEGES ON TABLES TO "xxx@yyy.com";

-- シーケンス権限（AUTO INCREMENTとか使う場合）
GRANT ALL PRIVILEGES ON ALL SEQUENCES IN SCHEMA public TO "xxx@yyy.com";</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1653</wp:post_id>
		<wp:post_date><![CDATA[2025-06-07 15:35:36]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-06-07 06:35:36]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-16 11:59:09]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-16 02:59:09]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90drizzle%e3%80%91cloud-sql%e3%81%abmigration%e3%81%99%e3%82%8b%e3%80%90github-actions%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="drizzle"><![CDATA[Drizzle]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Tauri】ファイルパーミッションが取れない問題]]></title>
		<link>https://www.masaakiota.net/2025/06/09/%e3%80%90tauri%e3%80%91%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%83%91%e3%83%bc%e3%83%9f%e3%83%83%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%8c%e5%8f%96%e3%82%8c%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Mon, 09 Jun 2025 02:48:45 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1667</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Tauriでファイルパーミッションが取れない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、下記のような状況でした。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">// app/src-tauri/capabilities/default.json

{
  "permissions": [
    ...
    "fs:allow-read-dir",
    "fs:allow-read-file"
  ]
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>フロントでのファイル選択ダイアログを経由すると大丈夫なのですが、そうじゃない場合にパーミッションが取れません。具体的には、アプリ起動時などですね。これは困りました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">詳細に設定すると取れる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のように、詳細を設定すると取れるようになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">// app/src-tauri/capabilities/default.json

{
  "permissions": [
    {
      "identifier": "fs:allow-read-dir",
      "allow": [
        {
          "path": "**"
        }
      ]
    },
    {
      "identifier": "fs:allow-read-file",
      "allow": [
        {
          "path": "**"
        }
      ]
    }
  ]
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>何か腑に落ちませんが、ひとまず動いたので安心です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1667</wp:post_id>
		<wp:post_date><![CDATA[2025-06-09 11:48:45]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-06-09 02:48:45]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-06-09 11:58:08]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-06-09 02:58:08]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90tauri%e3%80%91%e3%83%95%e3%82%a1%e3%82%a4%e3%83%ab%e3%83%91%e3%83%bc%e3%83%9f%e3%83%83%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%8c%e5%8f%96%e3%82%8c%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="tauri"><![CDATA[Tauri]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeScript】Zodのbrandでパスワード漏洩を防いだり色々する]]></title>
		<link>https://www.masaakiota.net/2025/06/12/%e3%80%90typescript%e3%80%91zod%e3%81%aebrand%e3%81%a7%e3%83%91%e3%82%b9%e3%83%af%e3%83%bc%e3%83%89%e6%bc%8f%e6%b4%a9%e3%82%92%e9%98%b2%e3%81%84%e3%81%a0%e3%82%8a%e8%89%b2%e3%80%85%e3%81%99%e3%82%8b/</link>
		<pubDate>Wed, 11 Jun 2025 19:59:12 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1675</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんんちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Zod</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Zodは実行時に型を保証するためのライブラリです。TypeScriptは通常、実行前の型を保証しますが、実行時には検証を行いません。そのため思わぬデータが入ってきたりします。そうした事態を避けるため、Zodを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">TypeScriptのBranded Type</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>TypeScriptでのBranded Typeは、型に独自のフィールドを追加することで他と分離します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">type UserId = string &amp; { readonly __brand: 'UserId' }</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記の場合、ただのstringではなく特殊なstringであることになります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Zodのbrand</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Zodのbrand機能は、TypeScriptのBranded Typeを簡単に使えるようにするものです。これを使用することで、検証済みが保証された型を生成できます。つまり安全なデータの受け渡しが可能となります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">パスワード除外を保証する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のようにすれば、パスワード除外を保証できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { z } from "zod";

// ブランド定義例

type User = {
  name: string;
  passwordHash: string;
}

const safeUserSchema = z.object({
  name: z.string(),
}).brand("SafeUser");

type SafeUser = z.infer&lt;typeof safeUserSchema&gt;;


// 使用例

function getUser(): SafeUser {
  const user = {
    name: 'taro',
    passwordHash: 'xxx'
  }

  // return user // そのまま返すと型エラーになる  

  return safeUserSchema.parse(user) // 検証すれば型が合う
}

console.log(getUser()); // passwordHashが除外されている</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">環境変数の値を保証する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>TypeScriptであらかじめ定義できない、環境変数などの値に対しても使えます。下記のようにすれば、値が環境変数から取得されたものであることが保証されます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { z } from "zod";

const animalSchema = z.string().brand('animal');

type Animal = z.infer&lt;typeof animalSchema>;

const ENV_ANIMAL1 = animalSchema.parse(process.env.ANIMAL1);
const ENV_ANIMAL2 = animalSchema.parse(process.env.ANIMAL2);
const animal3 = 'cat';


function test(animal: Animal) {
  console.log(animal);
}

test(ENV_ANIMAL1); // ok 
test(ENV_ANIMAL2); // ok
test(animal3); // 検証されていないため型エラー</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1675</wp:post_id>
		<wp:post_date><![CDATA[2025-06-12 04:59:12]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-06-11 19:59:12]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-06-12 15:55:05]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-06-12 06:55:05]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typescript%e3%80%91zod%e3%81%aebrand%e3%81%a7%e3%83%91%e3%82%b9%e3%83%af%e3%83%bc%e3%83%89%e6%bc%8f%e6%b4%a9%e3%82%92%e9%98%b2%e3%81%84%e3%81%a0%e3%82%8a%e8%89%b2%e3%80%85%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【electron-trpc】Cannot read properties of undefined (reading 'serialize')]]></title>
		<link>https://www.masaakiota.net/2025/06/14/%e3%80%90electron-trpc%e3%80%91cannot-read-properties-of-undefined-reading-serialize/</link>
		<pubDate>Fri, 13 Jun 2025 22:48:05 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1693</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">electron-trpcでエラー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のエラーがでました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">TRPCClientError: Cannot read properties of undefined (reading 'serialize')
    at TRPCClientError2.from (@trpc_client.js?v=8e462472:1695:12)
    at TRPCUntypedClient.requestAsPromise (@trpc_client.js?v=8e462472:2898:29)
    at async onClick (InputImagesDirectoryPane.tsx:11:25)
Caused by: TypeError: Cannot read properties of undefined (reading 'serialize')
    at electron-trpc_render…s?v=8e462472:523:31
    at Object.subscribe (electron-trpc_render…js?v=8e462472:35:18)
    at @trpc_client.js?v=8e462472:194:17
    at Object.subscribe (@trpc_client.js?v=8e462472:23:21)
    at startIfNeeded (@trpc_client.js?v=8e462472:94:29)
    at @trpc_client.js?v=8e462472:119:7
    at Object.subscribe (@trpc_client.js?v=8e462472:23:21)
    at @trpc_client.js?v=8e462472:68:31
    at new Promise (&lt;anonymous&gt;)
    at observableToPromise (@trpc_client.js?v=8e462472:58:19)</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>かなりすったもんだした挙句、trpcのバージョンによるものだとわかりました。具体的には、electron-trpc0.7.1が、trpc11に対応できていないようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>下記でissueが建てられています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/jsonnull/electron-trpc/issues/184">https://github.com/jsonnull/electron-trpc/issues/184</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>PRもあるのですが、まだマージされていません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>余談ですが、すでに議論の対象になっていたことを知らず調子に乗ってissueを投げて速攻で謝ったのは私です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、trpcを10系に下げることで解決しました。また下記フォークを使用することでも解決しそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/mat-sz/trpc-electron">https://github.com/mat-sz/trpc-electron</a></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1693</wp:post_id>
		<wp:post_date><![CDATA[2025-06-14 07:48:05]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-06-13 22:48:05]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-06-14 07:49:05]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-06-13 22:49:05]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90electron-trpc%e3%80%91cannot-read-properties-of-undefined-reading-serialize]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="electron"><![CDATA[Electron]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Drizzle】ReferenceError: Cannot access 'xxx' before initialization]]></title>
		<link>https://www.masaakiota.net/2025/06/17/%e3%80%90drizzle%e3%80%91referenceerror-cannot-access-xxx-before-initialization/</link>
		<pubDate>Mon, 16 Jun 2025 18:23:13 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1697</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">DrizzleのSchema管理</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Drizzleはスキーマとリレーションをそれぞれファイルに分けて管理することがあるかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">schema
- auth.ts
- authRelations.ts
- posts.ts
- postRelations.ts
- index.ts</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>上記構成の場合、それぞれのファイルでエクスポートした変数を、index.tsで再エクスポートする形になっています。インポートする側は次のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import * as schema from './schema';

...

export const db = drizzle({ schema });</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このようにすることで、簡単に全てのスキーマを使用して初期化することが可能となります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">循環参照が起きやすい</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>上記方法だと、それぞれのファイルで互いに参照し合うことになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>特に下記のような書き方になると、本題のエラーとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// ./schema/authRelations.ts
import {} from '../schema';</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>IDEの自動補完を使っていると、しばしばこのような記述になってしまい、エラーとなります。index.tsを参照しているためですね。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">ReferenceError: Cannot access 'xxx' before initialization</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ですので、下記のように明示的にファイルを指定する必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// ./schema/authRelations.ts
import {} from './auth.ts';</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1697</wp:post_id>
		<wp:post_date><![CDATA[2025-06-17 03:23:13]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-06-16 18:23:13]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-06-17 03:24:32]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-06-16 18:24:32]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90drizzle%e3%80%91referenceerror-cannot-access-xxx-before-initialization]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="drizzle"><![CDATA[Drizzle]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】memoizeで手軽にメモ化する]]></title>
		<link>https://www.masaakiota.net/2025/06/18/%e3%80%90node-js%e3%80%91memoize%e3%81%a7%e6%89%8b%e8%bb%bd%e3%81%ab%e3%83%a1%e3%83%a2%e5%8c%96%e3%81%99%e3%82%8b/</link>
		<pubDate>Wed, 18 Jun 2025 00:16:41 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1708</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">初期化処理</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>API Clientなどの初期化処理は、地味に面倒です。たとえば</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">let client: Client;

export function getClient(){
  if (!client) {
    client = new Client();
  }
  return client;
}</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { getClient } from './client';

getClient().xxx();</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>こう言うのは、地味に精神が削られていきます。同じようなコードを何度も書くのは、プログラマにとっては苦行です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">memoize</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>memoizeを使えば、こうした苦行から解放されます。ついでに関数名もスマートにしています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import memoize from 'memoize';

export const client = memoize(() =&gt; new Client());</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { client } from './client';

client().xxx();</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1708</wp:post_id>
		<wp:post_date><![CDATA[2025-06-18 09:16:41]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-06-18 00:16:41]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-06-18 10:31:37]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-06-18 01:31:37]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node-js%e3%80%91memoize%e3%81%a7%e6%89%8b%e8%bb%bd%e3%81%ab%e3%83%a1%e3%83%a2%e5%8c%96%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Google Cloud】請求先アカウントの移行]]></title>
		<link>https://www.masaakiota.net/2025/06/28/%e3%80%90google-cloud%e3%80%91%e8%ab%8b%e6%b1%82%e5%85%88%e3%82%a2%e3%82%ab%e3%82%a6%e3%83%b3%e3%83%88%e3%81%ae%e7%a7%bb%e8%a1%8c/</link>
		<pubDate>Sat, 28 Jun 2025 04:39:11 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1722</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Google Cloudの請求周り</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Google Cloudでは、請求先アカウントとプロジェクトが分かれており、リンクすることで有効となります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>この移行に関して、AIに聞くとかなり複雑な回答をしてきます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>AIによれば</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>請求先を変更はめっちゃ複雑やで！</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>請求先アカウントの権限を一旦相手に渡さんとあかんで！</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>など色々言ってきますが、<strong>そんなことはありません</strong>。改めて実際に行い、手順をまとめてみました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">想定ケース</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下を想定しています。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>エンジニアが自分の請求先アカウントを使用して開発</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>納品時にクライアントの請求先アカウントに変更</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">手順</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記、納品時のフローです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">クライアント側: 請求先アカウントの作成</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記URLで、請求先アカウントを作成してもらいます。すでにある場合は、新しく作る必要はありません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://console.cloud.google.com/billing">https://console.cloud.google.com/billing</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">エンジニア側: クライアントをIAMに追加</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>プロジェクトのIAM設定で、クライアントのGmailアカウントをオーナーとして追加します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">クライアント側: 請求先アカウントのリンクを変更</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>クライアントに下記URLにアクセスしてもらいます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">https://console.cloud.google.com/billing/[現在リンクされている請求先アカウントID]/manage?project=[プロジェクトID]</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここで、請求先アカウントIDは、プロジェクトにリンクされているIDを使います。つまり、自分の請求先IDです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>通常は他人であるクライアントから見ることはできませんが、共有しているプロジェクトIDも一緒に指定しているため、限定的なアクセスが許可されます。ここがミソとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>プロジェクト名・プロジェクトID・操作の表が出きますので、操作の三点ボタンから「お支払い情報を変更」=> 請求先アカウントを自分のものに変更してもらえば、完了です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1722</wp:post_id>
		<wp:post_date><![CDATA[2025-06-28 13:39:11]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-06-28 04:39:11]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-06-28 13:43:34]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-06-28 04:43:34]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90google-cloud%e3%80%91%e8%ab%8b%e6%b1%82%e5%85%88%e3%82%a2%e3%82%ab%e3%82%a6%e3%83%b3%e3%83%88%e3%81%ae%e7%a7%bb%e8%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gcp"><![CDATA[Google Cloud]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【NPM】モノレポスコープ @repo, @localrepo]]></title>
		<link>https://www.masaakiota.net/2025/06/30/%e3%80%90npm%e3%80%91%e3%83%a2%e3%83%8e%e3%83%ac%e3%83%9d%e3%82%b9%e3%82%b3%e3%83%bc%e3%83%97-xxx-%e3%81%ae%e6%9c%80%e7%b5%82%e8%a7%a3/</link>
		<pubDate>Mon, 30 Jun 2025 05:16:11 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1741</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">モノレポのスコープ問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>モノレポの場合、複数ディレクトリそれぞれにpackage.jsonをおいて名前をつけます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>名前の付け方は基本的には自由です。private前提なら好き勝手つければいいし、publish前提なら被らない好きな名前をつければいいです。一方で一部をprivate管理にしたい時があります。その際に、privateでありながらやっぱり名前にはこだわりたい。他の使用済みの名前と被るのは精神衛生上如何なものかといった方も多いのではないかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>まとめると、以下のような話です。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>package nameには@xxx/yyy のように、スコープを指定したい</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>スコープはNPMに存在しないものを指定したい</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>わざわざ新しくNPMで取得することはしたくない</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>大規模なプロジェクトならNPM上でスコープを取得してPrivate運営することもあるでしょうが、ほとんどはそこまではいきません。単純に、ローカルで使うだけのためのスコープが欲しいのです。とはいえ、NPMとは被りたくない。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">スコープ名の制限</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>スコープは下記の制限があります。</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>package name length should be greater than zero</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>all the characters in the package name must be lowercase i.e., no uppercase or mixed case names are allowed</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>package name&nbsp;<em>can</em>&nbsp;consist of hyphens</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>package name must&nbsp;<em>not</em>&nbsp;contain any non-url-safe characters (since name ends up being part of a URL)</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>package name should not start with&nbsp;<code>.</code>&nbsp;or&nbsp;<code>_</code></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>package name should&nbsp;<em>not</em>&nbsp;contain any spaces</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>package name should&nbsp;<em>not</em>&nbsp;contain any of the following characters:&nbsp;<code>~)('!*</code></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>package name&nbsp;<em>cannot</em>&nbsp;be the same as a node.js/io.js core module nor a reserved/blacklisted name. For example, the following names are invalid:<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>http</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>stream</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>node_modules</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>favicon.ico</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>package name length cannot exceed 214</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --><cite><a href="https://github.com/npm/validate-npm-package-name#naming-rules">https://github.com/npm/validate-npm-package-name#naming-rules</a></cite></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>たとえば@abc/abcといった名前は使えますが、NPMとバッティングする可能性があります。かといって、@/などといったスコープは使用できません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">import validate from 'validate-npm-package-name';

console.log(validate('@abc/abc')) // OK
console.log(validate('@/abc')); // ERROR: name can only contain URL-friendly characters
console.log(validate('@_/abc')); // ERROR: name can only contain URL-friendly characters</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ローカルで安全に使えるスコープ</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">@repo</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>@repoはunusedでunclaimableとされています。</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:paragraph -->
<p>We use&nbsp;<code>@repo</code>&nbsp;in our docs and examples because it is an unused, unclaimable namespace on the npm registry. You can choose to keep it or use your own prefix.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://turborepo.com/docs/crafting-your-repository/structuring-a-repository">https://turborepo.com/docs/crafting-your-repository/structuring-a-repository</a></p>
<!-- /wp:paragraph --></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>実際に<a href="https://www.npmjs.com/~repo">https://www.npmjs.com/~repo</a>にアクセスすると確かにNotFoundになりません。turborepoが主張するように、確かにローカルで安心して使えそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">@localrepo</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>またこうした懸念点は世界共通なのか、@localrepoという名前スペースを取得された方がいます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://www.npmjs.com/package/@localrepo/pledge">https://www.npmjs.com/package/@localrepo/pledge</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これはBenjieさんによって作成されています。Benjieさんはスポンサーページを見ると、2025年6月30日時点で現在:77, 過去:172名がスポンサーとなっています。すごい。Graphql関連のライブラリがFeatureされています。実績があるため、相応の信頼性も担保されているかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1741</wp:post_id>
		<wp:post_date><![CDATA[2025-06-30 14:16:11]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-06-30 05:16:11]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-13 18:46:17]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-13 09:46:17]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90npm%e3%80%91%e3%83%a2%e3%83%8e%e3%83%ac%e3%83%9d%e3%82%b9%e3%82%b3%e3%83%bc%e3%83%97-xxx-%e3%81%ae%e6%9c%80%e7%b5%82%e8%a7%a3]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_87fe9cb263e66b7cc55ac06156dd805f]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】デザインライブラリを比較して見る]]></title>
		<link>https://www.masaakiota.net/2025/07/01/%e3%80%90react%e3%80%91%e3%83%87%e3%82%b6%e3%82%a4%e3%83%b3%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%82%92%e7%94%a8%e9%80%94%e5%88%a5%e3%81%ab%e6%af%94%e8%bc%83%e3%81%97%e3%81%a6%e3%81%bf/</link>
		<pubDate>Tue, 01 Jul 2025 06:50:04 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1754</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Reactのデザイン周り</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Reactには色々なライブラリがあります。その中で下記をピックアップしました。整理しきれていないのはご容赦ください</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>MUI</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>CSS Module</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Tailwind</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>vanilla extract</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Radix</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">MUI</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>MUIはマテリアルデザインを簡単に構築できます。テーマ管理も素晴らしく、サイト全体で一貫したデザインを作成できます。ただほとんどがすでにあるデザインを使用することになるので、他サイトとの差別化は難しいです。また細かい設定も面倒になりがちです。具体的には、要素のクラス名 .MUI_xxxみたいなのをいちいち確認して書いたりしないといけなかったりします。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">CSS Module</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>全体のデザインも可能で、部分的な設計も柔軟です。ファイルを分割して、関心の分離も簡単に行えます。がっつりデザインする場合はかなり有力です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Tailwind</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Tailwindはクラス名でスタイルを指定します。慣れれば素早くサイト構築が行えるかと思います。ただクラス名がとても見にくく、後からメンテナンスするのはかなりしんどそうです。コンポーネントベースで設計すれば、ある程度のメンテナンス性を持つことは可能でしょうが、そうするとわざわざTailwindを使う必要はあるのか？という話になってくるかと。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Vanilla extract</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Vanilla extractはtsベースでかなり型安全に使えます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Radix UI</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Radix UIはヘッドレスで、機能のみを提供するという位置付けのようです。Vanilla extractとの相性も良いそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">用途別に考える</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記、用途別にそれぞれを考えてみました。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>楽にデザイン =&gt; MUI</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>細かいデザイン => CSS Module, Vanilla extract, Radix UI + Vanilla extract</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>素早いデザイン =&gt; Tailwind</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1754</wp:post_id>
		<wp:post_date><![CDATA[2025-07-01 15:50:04]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-07-01 06:50:04]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-08-10 14:51:14]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-08-10 05:51:14]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91%e3%83%87%e3%82%b6%e3%82%a4%e3%83%b3%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%82%92%e7%94%a8%e9%80%94%e5%88%a5%e3%81%ab%e6%af%94%e8%bc%83%e3%81%97%e3%81%a6%e3%81%bf]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Google Cloud】Storageエミュレータを考える【firebase vs fsouza】]]></title>
		<link>https://www.masaakiota.net/2025/07/03/%e3%80%90google-cloud%e3%80%91storage%e3%82%a8%e3%83%9f%e3%83%a5%e3%83%ac%e3%83%bc%e3%82%bf%e3%82%92%e8%80%83%e3%81%88%e3%82%8b%e3%80%90firebase-vs-fsouza%e3%80%91/</link>
		<pubDate>Thu, 03 Jul 2025 08:53:50 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1757</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">エミュレータの必要性</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>開発で最も大切なのが、快適なテスト環境かと思います。テスト環境がないと、本番=&gt;エラー=&gt;どこを修正すればいいかわからない といったケースが頻発します。できるだけ細分化したテストができる環境構築は必須です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Cloud Storageのエミュレータ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Cloud Storageのエミュレータは、以下のようなものがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>Firebase emulator</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>fsouza/fake-gcs-server</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Firebase emulator</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Firebase emulatorは複数サービスのエミュレータが使えます。そのうちの一つに、Storageがあります。これはfirebaseクライアントからでも、@google-cloud/storageクライアントからでも、どちらからもアクセス可能です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">pnpm i -D firebase-tools

pnpm firebase init
# StorageとEmulatorsを選択
# =&gt; Don't set up a default project
# =&gt; Storage emulator</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>rulesファイルを下記のように書き換えます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">service firebase.storage {
  match /b/{bucket}/o {
    match /{allPaths=**} {
      allow read, write: if true; // if falseから変更
    }
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>クライアントは、firebase, google, どちらも使用可能です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash"># どちらかを使用
pnpm i firebase
pnpm i @google-cloud/storage</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>起動します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">pnpm firebase emulators:start</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>データを永続化するには、下記のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">pnpm firebase emulators:strat --import .firebase-data --export-on-exit</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">fsouza/fake-gcs-server</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Dockerで使えるのが魅力です。永続化も簡単にできます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="docker" class="language-docker">  gcs:
    image: fsouza/fake-gcs-server
    restart: unless-stopped
    ports:
      - 4443:4443
    volumes:
      - ./docker/gcs/data/public:/data/public
      - ./docker/gcs/data/private:/data/private
      - ./docker/gcs/storage:/storage
    command: -scheme http -public-host localhost:4443</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">署名付きURL</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>署名付きURLは、どちらのエミュレータでも使えません。そのため、開発環境ではロジックを分岐させる必要があります。今回調査した動機でもあるのですが、結局どちらもダメでした。残念。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">永続化</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>データの永続化は、快適なテストのために必要です。今回の２つは、どちらも永続化が可能です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">まとめ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、Firebase emulatorと、fsouza/fake-gcs-serverの比較をしてみました。Firebaseの他のサービスも複合で使う場合は、Firebaseを選ぶといいかと思います。ですがGCSのみとなると、簡単にセットアップできるfsouza/fake-gcs-serverもいいかと。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1757</wp:post_id>
		<wp:post_date><![CDATA[2025-07-03 17:53:50]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-07-03 08:53:50]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-07-04 06:25:34]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-07-03 21:25:34]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90google-cloud%e3%80%91storage%e3%82%a8%e3%83%9f%e3%83%a5%e3%83%ac%e3%83%bc%e3%82%bf%e3%82%92%e8%80%83%e3%81%88%e3%82%8b%e3%80%90firebase-vs-fsouza%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gcp"><![CDATA[Google Cloud]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Turborepo】遅延起動、A待ち=>B起動を考える【persistent】]]></title>
		<link>https://www.masaakiota.net/2025/07/04/%e3%80%90turborepo%e3%80%91%e9%81%85%e5%bb%b6%e8%b5%b7%e5%8b%95%e3%80%81a%e5%be%85%e3%81%a1b%e8%b5%b7%e5%8b%95%e3%82%92%e8%80%83%e3%81%88%e3%82%8b%e3%80%90persistent%e3%80%91/</link>
		<pubDate>Thu, 03 Jul 2025 22:15:18 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1771</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Turborepoでの遅延起動</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Turborepoでは、dependsOnを指定することで、起動待ちを実装することが可能です。ただし、これはpersistent=falseに限られています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>例えばtsc --watchや、next devといったpersistent=trueのタスクは、実行待ちをすることができません。これを待とうとすると、永遠に待つことになってしまうためです。また秒数による待機も実装されていないようです。これは困りました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">他ライブラリを組み合わせる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>他ライブラリを組み合わせることで、実現可能です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">wait-on</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>wait-onは、http通信が確立するのを待つことができます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">wait-on http://localhost:4000 &amp;&amp; echo "HTTP connected!"</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">concurrently</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>concurrentlyは、並列起動に用います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">concurrently "xxx" "yyy" </code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">組み合わせる</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>組み合わせると以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
  "scripts": {
    "dev": "concurrently \"xxx\" \"wait-on http://localhost:4000 &amp;&amp; yyy\""
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>例えばfirebase emulator起動を待ってから、next devする場合は以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
  "scripts": {
    "dev": "concurrently \"firebase emulators:start\" \"wait-on http://localhost:4000 &amp;&amp; next dev\""
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>turboと組み合わせて、emulatorとそれ以外とで組み合わせると以下のようになります。@localrepo/emulatorという名前で動かす場合です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
  "scripts": {
    "dev": "concurrently \"turbo run dev --filter=@localrepo/emulator\" \"wait-on http://localhost:4000 &amp;&amp; turbo run dev --filter=!@localrepo/emulator\""
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1771</wp:post_id>
		<wp:post_date><![CDATA[2025-07-04 07:15:18]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-07-03 22:15:18]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-07-04 07:24:43]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-07-03 22:24:43]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90turborepo%e3%80%91%e9%81%85%e5%bb%b6%e8%b5%b7%e5%8b%95%e3%80%81a%e5%be%85%e3%81%a1b%e8%b5%b7%e5%8b%95%e3%82%92%e8%80%83%e3%81%88%e3%82%8b%e3%80%90persistent%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeScript】有効にすべきオプションまとめ]]></title>
		<link>https://www.masaakiota.net/2025/07/05/%e3%80%90typescript%e3%80%91%e6%9c%89%e5%8a%b9%e3%81%ab%e3%81%99%e3%81%b9%e3%81%8d%e3%82%aa%e3%83%97%e3%82%b7%e3%83%a7%e3%83%b3/</link>
		<pubDate>Sat, 05 Jul 2025 10:08:39 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1782</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">TypeScriptのオプション</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>TypeScriptでは、tsconfig.jsonで様々なオプションを指定できます。中には互換性を重視して、デフォルトでは無効になっているものの、有効にすべきものもあります。今回は、そうした有効にすべきオプションです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">noImplicit系</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>noImplicit系は下記があります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>noImplicitAny</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>noImplicitReturns</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>noImplicitThis</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>noImplicitOverride</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>暗黙の定義を許可しないようにできます。基本的に、noImplicit系はすべてtrueにするのが良いかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">noImplicitAny</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>noImplicitAnyは、暗黙anyを許可しないようにします。strict: trueで自動的にtrueになります。逆に言えば、strict: trueでも、noImplicitAnyがfalseの場合は動作しません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>下記はxが暗黙anyで危険なため、検出されます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">function f(x) {
  console.log(x.trim());
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">noImplicitReturns</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>関数内の条件分岐で、すべてのパターンで値を返しているかがチェックされます（厳密には意味合いは違うかもしれませんが）。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>例えば以下のようなコードの場合</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">function f(n: number) {
  if (n === 1) return 'a';
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>すべてのパターンでstringを返すのが、よくある実装かと思います。しかしn===1しか実装されていません。noImplicitReturns: trueの場合、こうしたケアレスミスを検出してくれます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">noImplicitThis</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>暗黙thisを検出してくれます。最近ではthisを使う機会が少なくなってきている（関数型への移行など）ので、あまり恩恵はないかもしれませんが、とりあえずtrueにしておくと良さそうです。バインド忘れなどは、ふとした時に起きそうですので、そうした場合に安心です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">noImplicitOverride</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>クラスでの暗黙overrideを検出してくれます。overrideかどうかをはっきりさせることで、基底クラスの変更に伴う予期せぬバグなどの防止につながります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">その他の重要なオプション</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">noUncheckedIndexedAccess</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>noUncheckedIndexedAccessは、配列やオブジェクトでundefinedの可能性を入れるかどうかを指定します。これはぜひtrueにすべきプロパティです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>noUncheckedIndexedAccess: falseの場合、</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const strings = ['a', 'b', 'c'];
const s = strings[5]; // sは string になる
console.log(s.trim()); // 通ってしまう

const obj = { a: 1, b: 2, c: 3 } as Record&lt;string, number&gt;;
const value = obj['d']; // valueは number になる
console.log(value.toFixed(2)); // 通ってしまう</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このように、何でもかんでもあたいが存在する扱いとなってしまいます。これでは事前にエラーを検出することが難しくなります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そのため、noUncheckedIndexedAccessをtrueにします。するとundefinedとのユニオンタイプとなり、エラーを検出できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const strings = ['a', 'b', 'c'];
const s = strings[5]; // sは string | undefined になる
console.log(s.trim()); // エラーになる

const obj = { a: 1, b: 2, c: 3 } as Record&lt;string, number&gt;;
const value = obj['d']; // valueは number | undefined になる
console.log(value.toFixed(2)); // エラーになる</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">noFallthroughCasesInSwitch</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>noFallthroughCasesInSwitchは、switch構文のケアレスミスをチェックしてくれます。具体的には、break無しを許容しないようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>下記のような、危ういコードも検出してくれるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">let n = 0;
switch (n) {
  case 0:
    console.log(0);
  case 1:
    console.log(1);
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>n===0の場合、0を出力した後に1も出力されてしまいます。こうしたケアレスミスが炙り出されます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">まとめ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回あげたオプションは以下となります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">{
    "noImplicitAny": true,
    "noImplicitReturns": true,
    "noImplicitThis": true,
    "noImplicitOverride": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedIndexedAccess": true,
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを常に入れておくと、よりTypeScriptの恩恵が受けられるかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1782</wp:post_id>
		<wp:post_date><![CDATA[2025-07-05 19:08:39]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-07-05 10:08:39]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-07-05 19:41:41]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-07-05 10:41:41]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typescript%e3%80%91%e6%9c%89%e5%8a%b9%e3%81%ab%e3%81%99%e3%81%b9%e3%81%8d%e3%82%aa%e3%83%97%e3%82%b7%e3%83%a7%e3%83%b3]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Modal】ModuleNotFoundError【分割したい】]]></title>
		<link>https://www.masaakiota.net/2025/07/11/%e3%80%90modal%e3%80%91modulenotfounderror/</link>
		<pubDate>Fri, 11 Jul 2025 08:55:05 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1807</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Modal</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Modalはクラウド上でGPUが使えるサービスです。Pythonで簡単にイメージを作ったりできるのが売りのようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://modal.com">https://modal.com</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ModuleNotFoundError</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ローカルのソースファイルは、クラウドにアップロードされる際に自動選別されます。そのため、下記のような場合</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">- /
  - __init__.py
  - /common
    - __init__.py
    - xx.py
  - /train
    - __init__.py
    - main.py</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>main.pyには@app.entrypointがあります。こうした場合、下記を実行すると</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">modal run train/main.py</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ロードされるのはtrainモジュールのみとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Created mount PythonPackage:train</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>commonが含まれていません。そのため、エラーとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">ModuleNotFoundError</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ModalのExampleコードはそれぞれが１ファイルにまとめられているため、今回のような分割タイプのサンプルがありません。かなり吸ったんもん出した挙句、下記のようにすればいいことがわかりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="python" class="language-python">image = modal.Image.debian_slim(python_version="3.11").pip_install(
    ...
).add_local_python_source(
    "common",
    "train",
)

app = modal.App("dreambooth-test-train-generate",
                image=image, include_source=True)
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>add_local_python_sourceでモジュール名を指定すれば、イメージに含まれてばんばんざいです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1807</wp:post_id>
		<wp:post_date><![CDATA[2025-07-11 17:55:05]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-07-11 08:55:05]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-07-11 17:57:24]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-07-11 08:57:24]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90modal%e3%80%91modulenotfounderror]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="python"><![CDATA[Python]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Jotai】useHydrateAtomでもHydration failedする場合【Next.js】]]></title>
		<link>https://www.masaakiota.net/2025/07/14/%e3%80%90jotai%e3%80%91usehydrateatom%e3%81%a7%e3%82%82hydration-failed%e3%81%99%e3%82%8b%e5%a0%b4%e5%90%88%e3%80%90next-js%e3%80%91/</link>
		<pubDate>Mon, 14 Jul 2025 00:13:58 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1812</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">JotaiのuseHydrateAtom</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Jotaiは、Reactで使える状態管理ライブラリです。サーバーデータからクライアントに渡す際に、useHydrateAtomが用意されています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">useHydrateAtomでもHydration failedになる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Next.jsのApp Routerでは、useHydrateAtomが正常に動作しない時があります。例えば</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="" class="">app
 - layout.tsx
 - layoutClient.tsx
 - page.tsx
 - users
  - page.tsx</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>以下のような流れとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>layout.tsx (server) サーバーデータを取得</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>layoutClient.tsx (client) useHydrateAtomを使用</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>これは一見、正常に動作するように見えます。しかしNext.jsではレンダリングの順番が特殊です。具体的には、page.tsxからレンダリングが開始されます。おそらく、下記のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>page.tsxレンダリング (Hydration failed)</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>layoutClient.tsxレンダリング (useHydrateAtomが動作)</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>これが原因で、Hydration failedになると思われます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">対策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ClientOnlyコンポーネントを使用する方法があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export function ClientOnly({ children }: { children: React.ReactNode }) {
  const [hasMounted, setHasMounted] = useState(false);

  useEffect(() => {
    setHasMounted(true);
  }, []);

  if (!hasMounted) return null

  return children;
};</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これをlayoutClient.tsxに入れれば、Hydration failedは解消されます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1812</wp:post_id>
		<wp:post_date><![CDATA[2025-07-14 09:13:58]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-07-14 00:13:58]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-07-15 22:47:55]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-07-15 13:47:55]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90jotai%e3%80%91usehydrateatom%e3%81%a7%e3%82%82hydration-failed%e3%81%99%e3%82%8b%e5%a0%b4%e5%90%88%e3%80%90next-js%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="next-js"><![CDATA[Next.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MediaPipe】人物画像を切り抜いてみる【Python】]]></title>
		<link>https://www.masaakiota.net/2025/07/18/%e3%80%90mediapipe%e3%80%91%e4%ba%ba%e7%89%a9%e7%94%bb%e5%83%8f%e3%82%92%e5%88%87%e3%82%8a%e6%8a%9c%e3%81%84%e3%81%a6%e3%81%bf%e3%82%8b%e3%80%90python%e3%80%91/</link>
		<pubDate>Fri, 18 Jul 2025 10:12:16 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1818</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">人物画像の切り抜き</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>人物画像の切り抜きについて、Claude4sonnetに聞いてみました。</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table class="has-fixed-layout"><thead><tr><th>手法</th><th>人物精度</th><th>商用利用</th><th>処理速度</th></tr></thead><tbody><tr><td>PerSAM</td><td>95%</td><td>✅ 完全無料</td><td>⭐️⭐️</td></tr><tr><td>MediaPipe Selfie</td><td>90%</td><td>✅ 完全無料</td><td>⭐️⭐️⭐️⭐️⭐️</td></tr><tr><td>BiRefNet</td><td>85%</td><td>✅ 完全無料</td><td>⭐️⭐️⭐️</td></tr><tr><td>SAM2</td><td>80%</td><td>✅ 完全無料</td><td>⭐️⭐️</td></tr><tr><td>REMBG</td><td>75%</td><td>✅ 完全無料</td><td>⭐️⭐️⭐️⭐️</td></tr><tr><td>RMBG 2.0</td><td>90%</td><td>❌ 商用契約必要</td><td>-</td></tr></tbody></table></figure>
<!-- /wp:table -->

<!-- wp:paragraph -->
<p>PerSAMが最も品質は高いようです。髪の毛の細部まで上手く切り抜けるとか。ただその分処理速度に難があります。一方MediaPipeは人物切り抜きに強く、速度もあるようです。今回はMediaPipeを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">MediaPipeを使ってみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まずインストールします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">uv init
uv venv
uv add mediapipe</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>assetsディレクトリの画像を、outputsに出力するコードです。AIによるVibeコーディングです。便利。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="python" class="language-python">import os
import cv2
import mediapipe as mp
from PIL import Image
import numpy as np
from pathlib import Path
from typing import Tuple, Optional


def remove_background(image: np.ndarray, mask: np.ndarray, background_color: Tuple[int, int, int] = (255, 255, 255),
                      smooth_edges: bool = True) -> np.ndarray:
    """
    背景を削除または単色背景に置き換える

    Args:
        image: 入力画像
        mask: セグメンテーションマスク
        background_color: 背景色（デフォルト：白）
        smooth_edges: エッジを滑らかにするかどうか

    Returns:
        背景を削除した画像
    """
    if smooth_edges:
        # エッジを滑らかにする処理
        mask = smooth_mask_edges(mask)

    mask_3ch = cv2.cvtColor(mask, cv2.COLOR_GRAY2RGB)
    mask_3ch = mask_3ch.astype(float) / 255.0

    background = np.full_like(image, background_color, dtype=np.uint8)
    result = image.astype(float) * mask_3ch + \
        background.astype(float) * (1 - mask_3ch)

    return result.astype(np.uint8)


def smooth_mask_edges(mask: np.ndarray, blur_size: int = 5, morph_size: int = 3) -> np.ndarray:
    """
    マスクのエッジを滑らかにする

    Args:
        mask: 入力マスク
        blur_size: ガウシアンブラーのサイズ
        morph_size: モルフォロジー変換のカーネルサイズ

    Returns:
        滑らかになったマスク
    """
    # 1. モルフォロジー変換でノイズ除去
    kernel = cv2.getStructuringElement(
        cv2.MORPH_ELLIPSE, (morph_size, morph_size))

    # Opening（小さな穴を埋める）
    mask = cv2.morphologyEx(mask, cv2.MORPH_OPEN, kernel)

    # Closing（小さな隙間を埋める）
    mask = cv2.morphologyEx(mask, cv2.MORPH_CLOSE, kernel)

    # 2. ガウシアンブラーでエッジを滑らかに
    mask = cv2.GaussianBlur(mask, (blur_size, blur_size), 0)

    # 3. 軽いエロージョンで境界を少し内側に
    erosion_kernel = cv2.getStructuringElement(cv2.MORPH_ELLIPSE, (2, 2))
    mask = cv2.erode(mask, erosion_kernel, iterations=1)

    # 4. 再度軽いブラー
    mask = cv2.GaussianBlur(mask, (3, 3), 0)

    return mask


def process_background_removal(image: np.ndarray, selfie_segmentation, background_color: Tuple[int, int, int],
                               smooth_edges: bool = True) -> np.ndarray:
    """
    背景分離処理を実行する

    Args:
        image: 入力画像（BGR）
        selfie_segmentation: MediaPipeの背景分離モデル
        background_color: 背景色
        smooth_edges: エッジを滑らかにするかどうか

    Returns:
        背景が削除された画像
    """
    image_rgb = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)
    segmentation_results = selfie_segmentation.process(image_rgb)

    if segmentation_results.segmentation_mask is not None:
        mask = (segmentation_results.segmentation_mask >
                0.5).astype(np.uint8) * 255
        return remove_background(image, mask, background_color, smooth_edges)

    return image


def detect_faces(image: np.ndarray, face_detection):
    """
    顔検出を実行する

    Args:
        image: 入力画像（BGR）
        face_detection: MediaPipeの顔検出モデル

    Returns:
        検出結果
    """
    image_rgb = cv2.cvtColor(image, cv2.COLOR_BGR2RGB)
    return face_detection.process(image_rgb)


def calculate_face_crop_coords(detection, image_shape: Tuple[int, int], margin: float = 0.3) -> Tuple[int, int, int, int]:
    """
    顔の切り出し座標を計算する

    Args:
        detection: 顔検出結果
        image_shape: 画像のサイズ (height, width)
        margin: マージンの割合

    Returns:
        (x1, y1, x2, y2) 切り出し座標
    """
    ih, iw = image_shape
    bboxC = detection.location_data.relative_bounding_box

    # 相対座標を絶対座標に変換
    x = int(bboxC.xmin * iw)
    y = int(bboxC.ymin * ih)
    w = int(bboxC.width * iw)
    h = int(bboxC.height * ih)

    # マージンを追加
    margin_x = int(w * margin)
    margin_y = int(h * margin)

    x1 = max(0, x - margin_x)
    y1 = max(0, y - margin_y)
    x2 = min(iw, x + w + margin_x)
    y2 = min(ih, y + h + margin_y)

    return x1, y1, x2, y2


def make_square_crop(x1: int, y1: int, x2: int, y2: int, image_shape: Tuple[int, int]) -> Tuple[int, int, int, int]:
    """
    切り出し領域を正方形に調整する

    Args:
        x1, y1, x2, y2: 元の切り出し座標
        image_shape: 画像のサイズ (height, width)

    Returns:
        (x1, y1, x2, y2) 正方形に調整された座標
    """
    ih, iw = image_shape

    crop_w = x2 - x1
    crop_h = y2 - y1
    size = max(crop_w, crop_h)

    center_x = (x1 + x2) // 2
    center_y = (y1 + y2) // 2

    half_size = size // 2
    x1 = max(0, center_x - half_size)
    y1 = max(0, center_y - half_size)
    x2 = min(iw, center_x + half_size)
    y2 = min(ih, center_y + half_size)

    return x1, y1, x2, y2


def crop_and_save_face(image: np.ndarray, x1: int, y1: int, x2: int, y2: int,
                       output_path: Path, filename: str) -> bool:
    """
    顔を切り出して保存する

    Args:
        image: 入力画像
        x1, y1, x2, y2: 切り出し座標
        output_path: 出力ディレクトリ
        filename: 出力ファイル名

    Returns:
        保存成功の可否
    """
    face_crop = image[y1:y2, x1:x2]

    if face_crop.size == 0:
        return False

    output_file_path = output_path / filename
    success = cv2.imwrite(str(output_file_path), face_crop)

    if success:
        print(
            f"💾 保存: {filename} (サイズ: {face_crop.shape[1]}x{face_crop.shape[0]})")

    return success


def process_single_image(image_path: Path, face_detection, selfie_segmentation,
                         output_path: Path, remove_bg: bool, background_color: Tuple[int, int, int],
                         face_count: int, margin: float = 0.3, smooth_edges: bool = True) -> int:
    """
    1つの画像を処理する

    Args:
        image_path: 画像ファイルのパス
        face_detection: MediaPipeの顔検出モデル
        selfie_segmentation: MediaPipeの背景分離モデル
        output_path: 出力ディレクトリ
        remove_bg: 背景削除フラグ
        background_color: 背景色
        face_count: 現在の顔カウント
        margin: マージンの割合
        smooth_edges: エッジを滑らかにするかどうか

    Returns:
        処理した顔の数
    """
    print(f"🔍 処理中: {image_path.name}")

    # 画像を読み込み
    image = cv2.imread(str(image_path))
    if image is None:
        print(f"❌ 画像を読み込めませんでした: {image_path}")
        return 0

    # 背景分離処理
    processed_image = image.copy()
    if remove_bg:
        processed_image = process_background_removal(
            image, selfie_segmentation, background_color, smooth_edges)
        edge_status = "滑らかな境界" if smooth_edges else "標準境界"
        print(f"✅ 背景を削除しました ({edge_status})")

    # 顔検出実行
    results = detect_faces(image, face_detection)

    if not results.detections:
        print(f"❌ 顔が検出されませんでした: {image_path.name}")
        return 0

    print(f"✅ {len(results.detections)} 個の顔を検出")

    faces_saved = 0

    # 検出された各顔を処理
    for i, detection in enumerate(results.detections):
        # 切り出し座標を計算
        x1, y1, x2, y2 = calculate_face_crop_coords(
            detection, processed_image.shape[:2], margin)

        # 正方形に調整
        x1, y1, x2, y2 = make_square_crop(
            x1, y1, x2, y2, processed_image.shape[:2])

        # 出力ファイル名生成
        bg_suffix = "_nobg" if remove_bg else ""
        filename = f"face_{face_count + faces_saved:04d}_{image_path.stem}_{i:02d}{bg_suffix}.jpg"

        # 顔を切り出して保存
        if crop_and_save_face(processed_image, x1, y1, x2, y2, output_path, filename):
            faces_saved += 1

    return faces_saved


def get_image_files(assets_path: Path) -> list:
    """
    画像ファイルのリストを取得する

    Args:
        assets_path: アセットディレクトリのパス

    Returns:
        画像ファイルのリスト
    """
    image_extensions = {'.jpg', '.jpeg', '.png', '.bmp', '.tiff', '.webp'}

    return [
        path for path in assets_path.iterdir()
        if path.is_file() and path.suffix.lower() in image_extensions
    ]


def extract_faces_from_images(assets_dir: str = "assets", output_dir: str = "output",
                              remove_bg: bool = True, background_color: Tuple[int, int, int] = (255, 255, 255),
                              margin: float = 0.3, smooth_edges: bool = True):
    """
    assetsディレクトリから画像を読み込み、mediapipeで顔を検出・抽出して保存する

    Args:
        assets_dir: 入力画像があるディレクトリ
        output_dir: 抽出した顔画像を保存するディレクトリ
        remove_bg: 背景を削除するかどうか
        background_color: 背景色（RGB）
        margin: 顔の周りのマージン（割合）
        smooth_edges: エッジを滑らかにするかどうか
    """
    # ディレクトリの存在確認・作成
    assets_path = Path(assets_dir)
    output_path = Path(output_dir)

    if not assets_path.exists():
        print(f"❌ {assets_dir} ディレクトリが存在しません")
        return

    output_path.mkdir(exist_ok=True)
    print(f"📁 出力ディレクトリ: {output_path}")

    # 画像ファイルのリストを取得
    image_files = get_image_files(assets_path)
    if not image_files:
        print(f"❌ {assets_dir} に画像ファイルが見つかりません")
        return

    print(f"📸 処理対象: {len(image_files)} 個の画像ファイル")

    # MediaPipeの初期化
    mp_face_detection = mp.solutions.face_detection
    mp_selfie_segmentation = mp.solutions.selfie_segmentation

    face_count = 0

    with mp_face_detection.FaceDetection(
        model_selection=0,
        min_detection_confidence=0.5
    ) as face_detection, mp_selfie_segmentation.SelfieSegmentation(
        model_selection=1
    ) as selfie_segmentation:

        # 各画像ファイルを処理
        for image_path in image_files:
            faces_found = process_single_image(
                image_path, face_detection, selfie_segmentation,
                output_path, remove_bg, background_color, face_count, margin, smooth_edges
            )
            face_count += faces_found

    print(f"\n🎉 処理完了! 合計 {face_count} 個の顔を抽出しました")
    print(f"📁 出力先: {output_path}")
    if remove_bg:
        print(f"🎨 背景色: RGB{background_color}")


def main():
    print("🚀 MediaPipe顔抽出ツール（DreamBooth学習データ生成用）")
    print("=" * 50)

    # 設定
    remove_background_flag = True  # 背景を削除するかどうか
    background_color = (255, 255, 255)  # 白背景（RGB）
    margin = 0.3  # 顔の周りのマージン（30%）
    smooth_edges = True  # エッジを滑らかにするかどうか

    print(f"🎨 背景削除: {'ON' if remove_background_flag else 'OFF'}")
    if remove_background_flag:
        print(f"🎨 背景色: RGB{background_color}")
        print(f"🎨 エッジ処理: {'滑らか' if smooth_edges else '標準'}")
    print(f"🎯 マージン: {int(margin * 100)}%")

    # 顔抽出実行
    extract_faces_from_images(
        remove_bg=remove_background_flag,
        background_color=background_color,
        margin=margin,
        smooth_edges=smooth_edges
    )


if __name__ == "__main__":
    main()
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>実行します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">uv run main.py</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>顔部分が切り抜かれました。初期実行時は少し時間がかかりましたが、２回目以降は一瞬で完了するようになりました。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1818</wp:post_id>
		<wp:post_date><![CDATA[2025-07-18 19:12:16]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-07-18 10:12:16]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-07-18 19:12:16]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-07-18 10:12:16]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90mediapipe%e3%80%91%e4%ba%ba%e7%89%a9%e7%94%bb%e5%83%8f%e3%82%92%e5%88%87%e3%82%8a%e6%8a%9c%e3%81%84%e3%81%a6%e3%81%bf%e3%82%8b%e3%80%90python%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="ai"><![CDATA[AI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Google Cloud】file not found in build context or excluded by .dockerignore]]></title>
		<link>https://www.masaakiota.net/2025/08/02/%e3%80%90google-cloud%e3%80%91file-not-found-in-build-context-or-excluded-by-dockerignore/</link>
		<pubDate>Sat, 02 Aug 2025 10:50:10 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1834</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Google Cloudのデプロイでエラー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のコマンドでエラーになりました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">gcloud run deploy ...</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">file not found in build context or excluded by .dockerignore</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>過去にデプロイ成功しているプロジェクトだったため、悩みました。AIに聞いてもなかなか解決しません。しかし普通にGoogle検索するとすぐに原因がわかりました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">.gitignoreが原因だった</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>.gitignoreに指定されているものは、gcloudにアップロードされないようです。今回、</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">.yarn</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>が.gitignoreに追加されていたため、それがアップロードされずにエラーになっていました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>AIさんしっかりしてくれと言いたいところですが、ログを辿るとしっかりAIに指摘されていました。。。とはいえその解決策が別のアプローチだっため、結果的に脱線していったようです。結局使う人間側の知識が必要ですね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1834</wp:post_id>
		<wp:post_date><![CDATA[2025-08-02 19:50:10]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-08-02 10:50:10]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-08-02 19:53:34]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-08-02 10:53:34]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90google-cloud%e3%80%91file-not-found-in-build-context-or-excluded-by-dockerignore]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gcp"><![CDATA[Google Cloud]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Drizzle】複合キーでのカーソルページネーション]]></title>
		<link>https://www.masaakiota.net/2025/08/04/%e8%a4%87%e5%90%88%e3%82%ad%e3%83%bc%e3%81%a7%e3%81%ae%e3%82%ab%e3%83%bc%e3%82%bd%e3%83%ab%e3%83%9a%e3%83%bc%e3%82%b8%e3%83%8d%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%92%e8%80%83%e3%81%88%e3%82%8b/</link>
		<pubDate>Sun, 03 Aug 2025 16:20:47 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1841</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>分かれば簡単なのですが、若干理解に時間のかかるかもしれない、複合キーでのカーソルページネーションについて考えます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ページネーション</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ページネーションは、よくある下記のようなものです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">前へ 1 2 3 4 次へ</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>検索結果を小出しにする時などに使用します。データベースでは下記のようなパラメータを用います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">- limit: ページごとの数
- offset: どれだけ飛ばすか</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これが一般的なページネーションです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>実装は比較的簡単ですが、デメリットもあります。レコード数が膨大になると、計算に時間がかかってしまいます。なぜならoffsetが常に先頭から計算されるため、後になるほど負荷が大きくなります。また通常は総数も同時に用いるため、そこの計算コストもかかってきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">カーソルページネーション</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>カーソルページネーションは、上記のページネーションの問題点を解決します。一長一短ですが、レコード数が膨大になることが予想される場合は、こちらのカーソルページネーションが用いられます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">前へ 次へ</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>通常のページネーションと違い、ページ数がありません。これは通常、総数を用いないためです。その代わりに計算コストを抑えることができます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">単一カーソルの例</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>次の場合を考えます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">person table
- id: auto increment
- name: string</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>オートインクリメントのidと、文字列のnameをもったレコードです。これをカーソルページネーション実装するには、下記のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>idでソート</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>特定idを基準にwhereを作る</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>たとえば id = 3 をカーソルとすると、下記のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">SELECT * from person where id &gt; 3 ORDER BY id</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これにより、idが3より大きいレコードが抽出されます。idでソートされているため、順番も確保されます。なおこれは、idがuniqueであることが前提です。一方でuniqueではないフィールドでソートするには、どうすればいいでしょう。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">複合カーソルの例</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようなテーブルを考えます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">person table 
- id: auto increment
- name: string
- age: number</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ageでソートするとどうなるでしょう。試しに</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">SELECT * from person ORDER BY age</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>とします。しかしageが同じであるレコードが複数存在することが予測されます。そうすると、同じage=18のレコードの中で、順番が確保されません。このままではカーソルページネーションを行うことができません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そのため、order部分を以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">ORDER BY age, id</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>idがuniqueであるため、これで順番が保たれるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>この場合、カーソルページネーションを用いるには、以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>age, idで複合ソート</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ageでwhereを作る</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>age + idでもwhereを作る</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>考え方としては、</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">ageが18より大きければ、同じ年齢帯はヒットしないため問題ない
同じ年齢帯の場合は、idで処理する</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>たとえばid=3, age=18の人物の次のページネーションを行うには、whereは次のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">WHERE (age &gt; 18) OR (age = 18 AND id &gt; 3)</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>最終的には下記のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">SELECT * FROM person WHERE (age &gt; 18) OR (age = 18 AND id &gt; 3) ORDER BY age, id</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Drizzleでの複合キーのカーソルページネーション</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Drizzleでは以下のようになります。なおlimit+1で取得して、実際に次のページがあるかどうかの判定に用いるパターンもありますが、今回はシンプルにしました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type Cursor = {
  id: string;
  age: number;
}

export async function getUsers(params: { limit: number, cursor?: Cursor }) {
  const { limit, cursor } = params;
  const users = await db().query.usersTable.findMany({
    where: cursor
      ? or(
        lt(usersTable.age, cursor.age),
        and(
          eq(usersTable.age, cursor.age),
          lt(usersTable.id, cursor.id)))
      : undefined,
    orderBy: [desc(usersTable.age), desc(usersTable.id)],
    limit,
  })

  // 次のページがあるかどうか
  const hasMore = users.length === limit;

  // 次のページのカーソルを取得
  const lastUser = users[users.length - 1]
  const nextCursor: Cursor | undefined = hasMore
    ? {
      id: lastUser.id,
      age: lastUser.age
    }
    : undefined;
    
  return { ok: true, data: { users, nextCursor } }
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">面倒なので共通化した</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>毎回ここまでコードを書くとメンテナンス性が落ちるため、共通化しました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { and, asc, desc, eq, gt, lt, or } from "drizzle-orm";

export function createCursorPagination&lt;T>(params: { order: 'asc' | 'desc', table: any, cursor: any | undefined, field: keyof T, uniqueField: keyof T, limit: number }) {
  const { order, table, cursor, field, uniqueField, limit } = params;
  const ltOrGt = { 'asc': gt, 'desc': lt }[order];
  const ascOrDesc = { 'asc': asc, 'desc': desc }[order]
  const orderBy = [ascOrDesc(table[field]), ascOrDesc(table[uniqueField])]
  const where = cursor
    ? or(
      and(
        ltOrGt(table[field], cursor[field]),
        ne(table[uniqueField], cursor[uniqueField])), // 精度のズレによる問題を解消（*後述)
      and(
        eq(table[field], cursor[field]),
        ltOrGt(table[uniqueField], cursor[uniqueField])
      ))
    : undefined;

  const getNextCursor = (items: T[]): T | undefined => {
    if (items.length &lt; limit) return;
    const lastItem = items[items.length - 1]
    if (!lastItem) return;
    return { [field]: lastItem[field], [uniqueField]: lastItem[uniqueField] } as T
  }

  return { where, orderBy, limit, getNextCursor }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを使えば、以下のようにスッキリ書けるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type Cursor = Pick&lt;User, 'id'|'age'&gt;

export async function getUsers(params: { limit: number, cursor?: Cursor }) {
  const { limit, cursor } = params;
  const { getNextCursor, ...rest } = createCursorPagination&lt;Cursor&gt;({
    order: 'asc',
    table: usersTable,
    cursor,
    field: 'age',
    uniqueField: 'id',
    limit
  })

  const users = await db().query.usersTable.findMany({
    ...rest
  })

  const nextCursor = getNextCursor(users);
    
  return { ok: true, data: { users, nextCursor } }
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">精度に注意</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>timestampなどのフィールドは精度が合っていないと、意図しない抽出結果になったりします。たとえばJavaScriptのDateはmsまでですが、Postgresはμsまで対応している関係から、cursorが機能しなくなったりします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>その場合はDB側の精度をmsまで落とすか、あるいはidでの不一致を条件に加える必要があります。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1841</wp:post_id>
		<wp:post_date><![CDATA[2025-08-04 01:20:47]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-08-03 16:20:47]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-12 04:26:53]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-11 19:26:53]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e8%a4%87%e5%90%88%e3%82%ad%e3%83%bc%e3%81%a7%e3%81%ae%e3%82%ab%e3%83%bc%e3%82%bd%e3%83%ab%e3%83%9a%e3%83%bc%e3%82%b8%e3%83%8d%e3%83%bc%e3%82%b7%e3%83%a7%e3%83%b3%e3%82%92%e8%80%83%e3%81%88%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="drizzle"><![CDATA[Drizzle]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeScript】Branded typeでセキュリティを強化する]]></title>
		<link>https://www.masaakiota.net/2025/08/04/%e3%80%90typescript%e3%80%91branded-type%e3%81%a7%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e3%82%92%e5%bc%b7%e5%8c%96%e3%81%99%e3%82%8b/</link>
		<pubDate>Mon, 04 Aug 2025 07:34:10 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1875</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以前にzodでのbrandについての記事を書きました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.masaakiota.net/2025/06/12/%e3%80%90typescript%e3%80%91zod%e3%81%aebrand%e3%81%a7%e3%83%91%e3%82%b9%e3%83%af%e3%83%bc%e3%83%89%e6%bc%8f%e6%b4%a9%e3%82%92%e9%98%b2%e3%81%84%e3%81%a0%e3%82%8a%e8%89%b2%e3%80%85%e3%81%99%e3%82%8b/","type":"wp-embed","providerNameSlug":""} -->
<figure class="wp-block-embed is-type-wp-embed"><div class="wp-block-embed__wrapper">
https://www.masaakiota.net/2025/06/12/%e3%80%90typescript%e3%80%91zod%e3%81%aebrand%e3%81%a7%e3%83%91%e3%82%b9%e3%83%af%e3%83%bc%e3%83%89%e6%bc%8f%e6%b4%a9%e3%82%92%e9%98%b2%e3%81%84%e3%81%a0%e3%82%8a%e8%89%b2%e3%80%85%e3%81%99%e3%82%8b/
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>しかしDrizzleなどを使用していると、直接zodに変換できなかったりするため、TypeScriptプレーンでbrandを行う方法です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Branded type</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Branded typeは、通常の型の中でさらに区別をつけるためのものです。たとえば</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// 普通
type Name = string;

// Branded
type CatName = string &amp; {__catname: true}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>こうすることで、CatNameはただのstringではなく、特別なstringということになります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">symbolを使う</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>上記方法でもいいのですが、unique symbolを使うと一意性が保たれてより良いです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type CatName = string &amp; {readonly __brand: unique symbol};</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>さらに変換関数もつけると、便利になります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export function brandCatName(name: string){
  return name as CatName
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ただ、単にasで変換しているだけなので、あまり意味は見出せません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">セキュリティ強化に使用する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ユーザーのパスワードの漏洩を防止する目的で考えてみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type User = {
  name: string;
  password: string;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>今時は、生でパスワードを保存することはありません。適切なアルゴリズムのライブラリを用いてハッシュ化したものが保存されます。そのため漏れてもすぐに危険ということはないのですが、ローカル保存されると高速でアタックされて破られる可能性も出てくるため、ハッシュといえど漏れないようにするのが基本です。また気づかずにクライアントに送信している場合もあるため、サニタイズは必ずサーバー側で行う必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ここでパスワードなしの型を作ってみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type UserSanitized = Omit&lt;User, 'password'&gt;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを使って、下記のような処理を入れます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">function showUser(user: UserSanitized){
  alert(JSON.stringify(user));
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>さてここで、UserSanitizedを受け取っているため、一見安全に見えます。しかし実際にはパスワードが入ってきていても、型エラーにはなりません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">showUser({name: 'Taro', password: 'abc'}) // 型エラーにならない</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これは問題です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そのため、UserSanitizedをbrand typeにし、変換関数でサニタイズします。これはサーバー側で行う必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export type UserSanitized = Omit&lt;User, 'password'&gt; &amp; {readonly __brand: unique symbol}

export function sanitizeUser(user: User){
  const {password, ...omitted} = user;
  return omitted as UserSanitized;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>なおサーバー側であることを明確にするため、下記のような関数を使用するのも有効です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">function ensureServer() {
  if (typeof window !== 'undefined') {
    throw new Error('This function should be called on the server');
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>sanitizeUserを使用することで、下記のようになります。簡略化して書いています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const user: User = {name: 'Taro', password: 'abc'};

function showUser(user: UserSanitized){
  alert(JSON.stringify(user));
}

function main(){
  showUser(user); // 型エラーになる

  // 実際はサーバー側で行う
  const sanitized = sanitizeUser(user);
  showUser(sanitized); // 通るようになる
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、sanitize関数を必ず通す必要が出るため、セキュリティの向上が計れます。可能なら、User type自体をexportせずに、SanitizedUserだけexportできるとなお堅牢です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">注意</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>brand typeはasをすると突破されてしまいます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">showUser(user as UserSanitized); // 通ってしまう</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ここは注意ですね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1875</wp:post_id>
		<wp:post_date><![CDATA[2025-08-04 16:34:10]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-08-04 07:34:10]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-08-05 19:22:47]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-08-05 10:22:47]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typescript%e3%80%91branded-type%e3%81%a7%e3%82%bb%e3%82%ad%e3%83%a5%e3%83%aa%e3%83%86%e3%82%a3%e3%82%92%e5%bc%b7%e5%8c%96%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_7338ad05e3cfd6605d9df72494380a51]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="wp-embedded-content" data-secret="sPr0tWuwva"><a href="https://www.masaakiota.net/2025/06/12/%e3%80%90typescript%e3%80%91zod%e3%81%aebrand%e3%81%a7%e3%83%91%e3%82%b9%e3%83%af%e3%83%bc%e3%83%89%e6%bc%8f%e6%b4%a9%e3%82%92%e9%98%b2%e3%81%84%e3%81%a0%e3%82%8a%e8%89%b2%e3%80%85%e3%81%99%e3%82%8b/">【TypeScript】Zodのbrandでパスワード漏洩を防いだり色々する</a></blockquote><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" style="position: absolute; visibility: hidden;" title="&#8220;【TypeScript】Zodのbrandでパスワード漏洩を防いだり色々する&#8221; &#8212; 太田雅昭" src="https://www.masaakiota.net/2025/06/12/%e3%80%90typescript%e3%80%91zod%e3%81%aebrand%e3%81%a7%e3%83%91%e3%82%b9%e3%83%af%e3%83%bc%e3%83%89%e6%bc%8f%e6%b4%a9%e3%82%92%e9%98%b2%e3%81%84%e3%81%a0%e3%82%8a%e8%89%b2%e3%80%85%e3%81%99%e3%82%8b/embed/#?secret=2GCUnm7up4#?secret=sPr0tWuwva" data-secret="sPr0tWuwva" width="600" height="338" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_7338ad05e3cfd6605d9df72494380a51]]></wp:meta_key>
		<wp:meta_value><![CDATA[1754388302]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Python】フォーマッタがimport順を変えてしまう問題]]></title>
		<link>https://www.masaakiota.net/2025/08/05/%e3%80%90python%e3%80%91%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%83%e3%82%bf%e3%81%8c%e5%8b%9d%e6%89%8b%e3%81%abimport%e9%a0%86%e3%82%92%e5%a4%89%e3%81%88%e3%81%a6%e3%81%97%e3%81%be%e3%81%86/</link>
		<pubDate>Tue, 05 Aug 2025 13:16:18 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1912</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Python</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Pythonは手軽なスクリプティングが好かれています。2025年8月5日現在では、機械学習によく用いられていることもあり、使う必要が出てきたりもします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこで、普段は違う言語を使っている勢からすると、稲妻カルチャーショックを受けることも少なくありません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">PEP8</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>PEP8はPythonにおけるコーディング規約です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://pep8-ja.readthedocs.io/ja/latest">https://pep8-ja.readthedocs.io/ja/latest</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これによると、imort文は常に先頭におけと書かれています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">フォーマッタの功罪</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>私はよくわからず、Cursor (VS Code)でのPythonフォーマッタはautopep8を使用しています。prettier撲滅連盟に加入しているのと、他によく知らないためです。autopep8では、PEP8に沿った書き方に自動で整形されます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>たとえばimportがファイルの下の方にあると、強制的に上に持っていかれます。そのため、順番が崩れてしまいます。こんな、実行に影響するような箇所を勝手に変更するのは、いかがなものかと思うのですが、とにかくautopep8はそういうフォーマッタのようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>具体的には、下記の問題がありました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="python" class="language-python">import sys
sys.path.insert(0, "/root/ai-toolkit")
from toolkit.job import get_job</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これをフォーマットすると、下記のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="python" class="language-python">import sys
from toolkit.job import get_job
sys.path.insert(0, "/root/ai-toolkit")</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このためget_jobをimportできないという事案が発生しました。Githubからそのまま持ってきたコードです。これは困りました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">フォーマッタでimport関連を無視する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のようにすれば、import関連のフォーマットを無視できます。VSCodeの設定ファイル、settings.jsonです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
  "[python]": {
    "editor.defaultFormatter": "ms-python.autopep8",
    ....
  },
  "autopep8.args": [
    "--ignore=E402" // import関連のエラーを無視
  ]
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、フォーマッタが勝手にimort文を並び替えることは無くなります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>しかしながら、フォーマッタがなぜここまで関与してくるのか、謎で仕方ありません。Pythonは、import名が実際のライブラリ名と違う場合があるという愛すべき不思議ちゃんです。そうしたことから、勝手にimportを並び替えて欲しいという願いがあるのでしょうかいや関係ないかもしれません。余談ですがJavaScriptからTypeScriptが生まれたように、PythonもTypeThonみたいなのが出るのを切に願っています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1912</wp:post_id>
		<wp:post_date><![CDATA[2025-08-05 22:16:18]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-08-05 13:16:18]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-08-06 08:16:49]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-08-05 23:16:49]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90python%e3%80%91%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%83%e3%82%bf%e3%81%8c%e5%8b%9d%e6%89%8b%e3%81%abimport%e9%a0%86%e3%82%92%e5%a4%89%e3%81%88%e3%81%a6%e3%81%97%e3%81%be%e3%81%86]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="python"><![CDATA[Python]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【electron-vite】モノレポ環境で気をつけること【Module Type】]]></title>
		<link>https://www.masaakiota.net/2025/08/06/%e3%80%90electron%e3%80%91%e3%83%a2%e3%83%8e%e3%83%ac%e3%83%9d%e3%81%a7%e3%81%86%e3%81%be%e3%81%8f%e5%8b%95%e3%81%8b%e3%81%aa%e3%81%84%e3%81%a8%e3%81%8d%e3%80%90peerdependencies%e3%82%92%e4%bd%bf/</link>
		<pubDate>Tue, 05 Aug 2025 15:21:27 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1927</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Electronでモノレポ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>今回、２つのElectronアプリで共通の機能を使いたいがために、yarnのモノレポ構成で開発していました。electron-viteです。鼻歌混じりにpackages/common-electronを作成しました。あとはこれを、本体から読み込むようにすれば２つのアプリで機能を共通化できます。ですがビルドできないという事態に。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">electron-viteの仕様とモノレポでの問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>electron-viteは、下記のようにビルドします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">- main: CommonJS
- renderer: ESModule</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これはより効率化を求めた結果のようです。通常の使用方法なら、これで問題なく、適切に変換してくれるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>しかしモノレポの場合は話が違います。私が試したところ、下記のようなモノでした。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">モノレポpackages/xxxでのmodule type

- CommonJS: mainでは読み込めるがrendererではエラーになる
- ESModule: 確かmainでエラーになった</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>そうなんです。モノレポだとviteは何も変換せず読み込んでしまうようで、これはvite特有のアルゴリズムに由来するそうです。そのためモノレポの場合は、パッケージはあらかじめ変換しておく必要があります。なおこれは2025年8月7日時点での話で、今後アップデートで改善される可能性もあります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解決策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにして解決しました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">とりあえず共通依存はpeerDependencies</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>これは今回の問題解決に寄与したかどうかはっきりわかっていませんが、ひとまず共通依存はpeerDependenciesにしました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">mainとrendererで分ける</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>mainとrendererで、それぞれCommonJSとESModuleにビルド(tsc)します。下記のようにtsconfigを分けることで実現します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">// tsconfig.main.json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "CommonJS",
    "moduleResolution": "node",
    "lib": [
      "ES2020"
    ],
    "outDir": "./dist/main",
    "rootDir": "./src/main",
    "strict": true,
    "skipLibCheck": true,
    "declaration": true,
  },
  "include": [
    "src/main/**/*"
  ],
  "exclude": [
    "node_modules",
    "dist"
  ]
}</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">// tsconfig.renderer.json
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "moduleResolution": "bundler",
    "lib": [
      "ES2020"
    ],
    "outDir": "./dist/renderer",
    "rootDir": "./src/renderer",
    "strict": true,
    "skipLibCheck": true,
    "declaration": true,
  },
  "include": [
    "src/renderer/**/*"
  ],
  "exclude": [
    "node_modules",
    "dist"
  ]
}</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">// package.json
{
  "exports": {
    "./main": {
      "require": "./dist/main/index.js",
      "types": "./dist/main/index.d.ts"
    },
    "./renderer": {
      "import": "./dist/renderer/index.js",
      "types": "./dist/renderer/index.d.ts"
    }
  },
  "scripts": {
    "build": "tsc -p tsconfig.main.json &amp;&amp; tsc -p tsconfig.renderer.json",
    "dev": "concurrently \"tsc -p tsconfig.main.json --watch\" \"tsc -p tsconfig.renderer.json --watch\""
  },
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">両方で使う機能はそれぞれから再エクスポートする</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>mainとrendererの両方で使う機能は、それぞれでビルドする必要があります。そのため下記のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">- common-electron
  - common
    - index.ts
  - main
    - index.ts: ここで../commonをエクスポート
  - renderer
    - index.ts: ここで../commonをエクスポート</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>またtsconfigのrootDirとincludeを変更します。簡略化のため(main|renderer)と記載していますが、それぞれのファイルの意味として書いています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">// tsconfig.(main|renderer).json
{
  "compilerOptions": {
    rootDir: "src"
  },
  "include": {
    "src/(main|renderer)/**/*",
    "src/common/**/*"
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>rootDirを変更したので、dist構造も変わります。package.jsonも変更します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">// package.json
{
  "exports": {
    "./main": {
      "require": "./dist/main/main/index.js",
      "types": "./dist/main/main/index.d.ts"
    },
    "./renderer": {
      "import": "./dist/renderer/renderer/index.js",
      "types": "./dist/renderer/renderer/index.d.ts"
    }
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>importするときは、それぞれmain, rendererのどちらか適切な方からするようにします。これで共通部分も大丈夫です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>かなりすったもんだしましたが、これでelectron-viteのモノレポ環境が作れました。お役に立てますと幸いです。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1927</wp:post_id>
		<wp:post_date><![CDATA[2025-08-06 00:21:27]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-08-05 15:21:27]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-08-07 18:42:12]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-08-07 09:42:12]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90electron%e3%80%91%e3%83%a2%e3%83%8e%e3%83%ac%e3%83%9d%e3%81%a7%e3%81%86%e3%81%be%e3%81%8f%e5%8b%95%e3%81%8b%e3%81%aa%e3%81%84%e3%81%a8%e3%81%8d%e3%80%90peerdependencies%e3%82%92%e4%bd%bf]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="electron"><![CDATA[Electron]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Drizzle】画期的？Viewに__typeフィールドを埋め込んでセキュリティを高める]]></title>
		<link>https://www.masaakiota.net/2025/08/23/%e3%80%90drizzle%e3%80%91%e7%94%bb%e6%9c%9f%e7%9a%84%ef%bc%9fview%e3%81%ab__type%e3%83%95%e3%82%a3%e3%83%bc%e3%83%ab%e3%83%89%e3%82%92%e5%9f%8b%e3%82%81%e8%be%bc%e3%82%93%e3%81%a7%e3%82%bb%e3%82%ad/</link>
		<pubDate>Fri, 22 Aug 2025 15:22:21 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1970</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">DrizzleのView</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>DirzzleではスキーマレベルでViewを作成することができます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export const usersTable = pgTable('users', {
  id: text().unique(),
  handle: text().unique().$defaultFn(() =&gt; 'user_' + createId()),
  email: text().unique(),
  phone: text().unique(),
  passwordHash: text(),
});

export const usersPublicView = pgView('users_public')
  .as(qb =&gt; qb
    .select({
      id: usersTable.id,
      handle: usersTable.handle,
    })
    .from(usersTable));</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>この例では、usersTableからidとhandleのみのViewを作成しています。便利ですね。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">__typeを入れてみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>これに__typeを入れてみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">__type: sql&lt;'user_public'&gt;`'user_public'`.as('__type'),</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、Viewから生成される型に__typeフィールドが固定値'user_public'が追加されるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type UserPublic = typeof usersPublicView.$inferSelect

// type UserPublic = {
//   __type: "user_public";
//   id: string;
//   handle: string | null;
// }</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>__typeの設定が複雑ですので、関数にします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export function mkType&lt;T extends string&gt;(type: T) {
  return { __type: sql&lt;T&gt;`${sql.raw(`'${type}'`)}`.as('__type') }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを使うと、Viewは以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export const usersPublicView = pgView('users_public')
  .as(qb =&gt; qb
    .select({
      ...mkType('user_public'),
      id: usersTable.id,
      handle: usersTable.handle,
    })
    .from(usersTable));</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">試してみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>試してみました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">
type User = typeof usersTable.$inferSelect
type UserPublic = typeof usersPublicView.$inferSelect

const showUser = (user: User) =&gt; {
  console.log(user);
}

const showUserPublic = (user: UserPublic) =&gt; {
  console.log(user);
}

const user: User = {} as User;
const userPublic: UserPublic = {} as UserPublic;

showUser(user);
showUser(userPublic); // 型エラー
showUserPublic(user); // 型エラー
showUserPublic(userPublic);</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>うまい具合に、型レベルで漏洩を検知することができるようになりました。意図しない挿入が防止できています。これは使えそうですね。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">おまけ: Remedaを入れてみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>RemedaでViewをさらに型安全に書けます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import * as R from 'remeda';

export const usersPublicView = pgView('users_public')
  .as(qb =&gt; qb
    .select({
      ...mkType('user_public'),
      ...R.pick(usersTable, ['id', 'handle']),
    })
    .from(usersTable));</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">注意: バージョンによっては使えない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Drizzleのバージョンによっては、Viewの生成でエラーになります。2025年8月23日 v0.44.3時点ではまだ解決していないようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/drizzle-team/drizzle-orm/issues/4731">https://github.com/drizzle-team/drizzle-orm/issues/4731</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>代替案として、今回はViewを作成せずqueryに埋め込みました。その詳細は下記に書いています。将来的にFixされてViewが使えるようになった時に、どちらを使用するかは用途やお好みでいいかと。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.masaakiota.net/2025/08/24/%e3%80%90drizzle%e3%80%91query%e3%81%ab__type%e3%82%92%e5%9f%8b%e3%82%81%e8%be%bc%e3%82%93%e3%81%a7%e5%9e%8b%e5%bc%b7%e5%8a%9b%e3%81%ab%e3%81%99%e3%82%8b/","type":"wp-embed","providerNameSlug":""} -->
<figure class="wp-block-embed is-type-wp-embed"><div class="wp-block-embed__wrapper">
https://www.masaakiota.net/2025/08/24/%e3%80%90drizzle%e3%80%91query%e3%81%ab__type%e3%82%92%e5%9f%8b%e3%82%81%e8%be%bc%e3%82%93%e3%81%a7%e5%9e%8b%e5%bc%b7%e5%8a%9b%e3%81%ab%e3%81%99%e3%82%8b/
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1970</wp:post_id>
		<wp:post_date><![CDATA[2025-08-23 00:22:21]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-08-22 15:22:21]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-09 03:03:22]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-08 18:03:22]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90drizzle%e3%80%91%e7%94%bb%e6%9c%9f%e7%9a%84%ef%bc%9fview%e3%81%ab__type%e3%83%95%e3%82%a3%e3%83%bc%e3%83%ab%e3%83%89%e3%82%92%e5%9f%8b%e3%82%81%e8%be%bc%e3%82%93%e3%81%a7%e3%82%bb%e3%82%ad]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="drizzle"><![CDATA[Drizzle]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_0e837e54799651586e85a60e0ecc5778]]></wp:meta_key>
		<wp:meta_value><![CDATA[{{unknown}}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_31525fd3066db754e391026a72b7b56c]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="wp-embedded-content" data-secret="EHtDjl7yeP"><a href="https://www.masaakiota.net/2025/05/09/%e3%80%90drizzle%e3%80%91with%e3%82%84column%e3%82%92%e5%8f%8d%e6%98%a0%e3%81%97%e3%81%9f%e5%9e%8b%e3%82%92%e4%bd%bf%e3%81%86/">【Drizzle】withやcolumnを反映した型を使う</a></blockquote><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" style="position: absolute; visibility: hidden;" title="&#8220;【Drizzle】withやcolumnを反映した型を使う&#8221; &#8212; 太田雅昭" src="https://www.masaakiota.net/2025/05/09/%e3%80%90drizzle%e3%80%91with%e3%82%84column%e3%82%92%e5%8f%8d%e6%98%a0%e3%81%97%e3%81%9f%e5%9e%8b%e3%82%92%e4%bd%bf%e3%81%86/embed/#?secret=xjCkAFQRmJ#?secret=EHtDjl7yeP" data-secret="EHtDjl7yeP" width="600" height="338" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_31525fd3066db754e391026a72b7b56c]]></wp:meta_key>
		<wp:meta_value><![CDATA[1755891786]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_b676bbcac9c40cc4e152d502813d2fe5]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="wp-embedded-content" data-secret="vXWDJ8DkS4"><a href="https://www.masaakiota.net/2025/08/24/%e3%80%90drizzle%e3%80%91query%e3%81%ab__type%e3%82%92%e5%9f%8b%e3%82%81%e8%be%bc%e3%82%93%e3%81%a7%e5%9e%8b%e5%bc%b7%e5%8a%9b%e3%81%ab%e3%81%99%e3%82%8b/">【Drizzle】queryに__typeを埋め込んで型強力にする</a></blockquote><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" style="position: absolute; visibility: hidden;" title="&#8220;【Drizzle】queryに__typeを埋め込んで型強力にする&#8221; &#8212; 太田雅昭" src="https://www.masaakiota.net/2025/08/24/%e3%80%90drizzle%e3%80%91query%e3%81%ab__type%e3%82%92%e5%9f%8b%e3%82%81%e8%be%bc%e3%82%93%e3%81%a7%e5%9e%8b%e5%bc%b7%e5%8a%9b%e3%81%ab%e3%81%99%e3%82%8b/embed/#?secret=b9RIJYUGk7#?secret=vXWDJ8DkS4" data-secret="vXWDJ8DkS4" width="600" height="338" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_b676bbcac9c40cc4e152d502813d2fe5]]></wp:meta_key>
		<wp:meta_value><![CDATA[1757354564]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Drizzle】queryに__typeを埋め込んで型強力にする]]></title>
		<link>https://www.masaakiota.net/2025/08/24/%e3%80%90drizzle%e3%80%91query%e3%81%ab__type%e3%82%92%e5%9f%8b%e3%82%81%e8%be%bc%e3%82%93%e3%81%a7%e5%9e%8b%e5%bc%b7%e5%8a%9b%e3%81%ab%e3%81%99%e3%82%8b/</link>
		<pubDate>Sat, 23 Aug 2025 18:34:03 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=1990</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以前、DrizzleのViewで__typeを埋め込んで、型を強化する話を書きました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.masaakiota.net/2025/08/23/%e3%80%90drizzle%e3%80%91%e7%94%bb%e6%9c%9f%e7%9a%84%ef%bc%9fview%e3%81%ab__type%e3%83%95%e3%82%a3%e3%83%bc%e3%83%ab%e3%83%89%e3%82%92%e5%9f%8b%e3%82%81%e8%be%bc%e3%82%93%e3%81%a7%e3%82%bb%e3%82%ad/","type":"wp-embed","providerNameSlug":""} -->
<figure class="wp-block-embed is-type-wp-embed"><div class="wp-block-embed__wrapper">
https://www.masaakiota.net/2025/08/23/%e3%80%90drizzle%e3%80%91%e7%94%bb%e6%9c%9f%e7%9a%84%ef%bc%9fview%e3%81%ab__type%e3%83%95%e3%82%a3%e3%83%bc%e3%83%ab%e3%83%89%e3%82%92%e5%9f%8b%e3%82%81%e8%be%bc%e3%82%93%e3%81%a7%e3%82%bb%e3%82%ad/
</div></figure>
<!-- /wp:embed -->

<!-- wp:paragraph -->
<p>今回は、Viewを使わずqueryでやってしまおうというお話です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">実行環境</h2>
<!-- /wp:heading -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>PostgreSQL</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>drizzle-orm: 0.44.4</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">tableを用意する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のテーブルを用います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export const usersTable = pgTable('users', {
  id: text().notNull(),
  handle: text().unique(),
  email: text(),
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ユーティリティ関数を用意する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のようなユーティリティ関数を作ります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export function mkType&lt;T extends string&gt;(type: T) {
  return { __type: sql&lt;T&gt;`${sql.raw(`'${type}'`)}`.as('__type') }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これは、フィールドに__typeとして固定値を入れるためのものです。詳細は前回の記事を参照ください。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">queryを作る</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>queryを作ります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { SQL } from "drizzle-orm";

// queryで受け取る引数
export type CustomQueryParams = {
  where?: SQL&lt;unknown&gt;
  orderBy?: SQL&lt;unknown&gt;
  limit?: number
  offset?: number
}

// 自身参照用
export const userAsSelfQuery = (params?: CustomQueryParams) =&gt; db()
  .query
  .usersTable
  .findOne({
    extras: { ...mkType('user_self') },
    with: {
      posts: true,
    },
    ...params,
  });

// 公開用
export const usersAsPublicQuery = (params?: CustomQueryParams) =&gt; db()
  .query
  .usersTable
  .findMany({
    extras: { ...mkType('users_public') },
    columns: { email: false, }, // 機密情報を除く
    with: {
      posts: true,
    },
    ...params,
  });

</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>型を作ります。type指定しているため、クライアントから読み込んでも安全です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// type指定でimportすることで、サーバークライアント間のエラーを防ぐ
import type {userAsSelfQuery, usersAsPublicQuery} from 'queries';

export type UserAsSelf = Awaited&lt;ReturnType&lt;typeof userAsSelfQuery&gt;&gt;
export type UserAsPublic = Awaited&lt;ReturnType&lt;typeof usersAsPublicQuery&gt;&gt;[number]</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">使ってみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のようにして使います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">function showMe(me: UserAsSelf) {
  console.log(me);
}

function showAsPublic(user: UserAsPublic){
  console.log(user);
}

async function test() {
  const me = await userAsSelfQuery();
  const usersPublic = await usersAsPublic();

  showMe(me);
  showMe(usersPublic[0]); // 型エラーになる

  showPublic(me); // 型エラーになる
  showPublic(usersPublic[0]);
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>__typeに固定値が入っているため、予期しないところでの使用時に型エラーが出るようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">型生成ユーティリティを作る</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>これまではReturnTypeを使ってきましたが、使い勝手が悪いためユーティリティを作りました。説明が大変ですので、サンプルコードを載せます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import type { BuildQueryResult, DBQueryConfig, ExtractTablesWithRelations, SQL } from 'drizzle-orm';
import { and, eq, isNotNull, relations, sql } from 'drizzle-orm';
import { pgTable, text, timestamp } from 'drizzle-orm/pg-core';
import { drizzle } from 'drizzle-orm/postgres-js';
import { Pool } from 'pg';


//=== スキーマ ===//

const usersTable = pgTable('users', {
  id: text().primaryKey(),
  name: text(),
  email: text(),
  passwordHash: text(),
  deletedAt: timestamp(),
});

const postsTable = pgTable('posts', {
  id: text().primaryKey(),
  userId: text().references(() => usersTable.id),
  title: text(),
  content: text(),
});

const userRelations = relations(usersTable, ({ many }) => ({
  posts: many(postsTable),
}));

const schema = { usersTable, postsTable, userRelations }


//=== db ===//

const pool = new Pool({
  connectionString: process.env.DATABASE_URL,
});

const db = drizzle({
  client: pool,
  schema,
});


//=== 型とユーティリティ ===//

type TSchema = ExtractTablesWithRelations&lt;typeof schema>

type BaseQueryConfig&lt;TableName extends keyof TSchema> = DBQueryConfig&lt;
  'one' | 'many',
  boolean,
  TSchema,
  TSchema[TableName]
>

export type SelectionConfig&lt;TableName extends keyof TSchema> =
  Omit&lt;BaseQueryConfig&lt;TableName>, 'extras'> &amp; { extras?: (fields: unknown) => unknown, where?: SQL&lt;unknown> }

export type InferSelection&lt;
  TableName extends keyof TSchema,
  QBConfig extends SelectionConfig&lt;TableName> = {}
> = BuildQueryResult&lt;TSchema, TSchema[TableName], QBConfig>

// extra type生成
export function mkType&lt;T extends string>(type: T) {
  return { __type: sql&lt;T>`${sql.raw(`'${type}'`)}`.as('__type') }
}


//=== selection ===//

const postSelection = {
  extras: () => ({ ...mkType('publicPost') }), // 関数にすることで入れ子時に型エラーが出なくなる
  columns: {
    id: true,
    title: true,
  },
} satisfies SelectionConfig&lt;'postsTable'>

const userSelection = {
  extras: () => ({ ...mkType('publicUser') }),
  columns: {
    passwordHash: false,
  },
  with: {
    posts: postSelection,
  },
  where: isNotNull(usersTable.deletedAt),
} satisfies SelectionConfig&lt;'usersTable'>


//=== 型生成 ===//

export type PublicPost = InferSelection&lt;'postsTable', typeof postSelection>
// type PublicPost = {
//   id: string;
//   title: string | null;
//   __type: "publicPost";
// }

export type PublicUser = InferSelection&lt;'usersTable', typeof userSelection>
// type PublicUser = {
//   id: string;
//   name: string | null;
//   email: string | null;
//   __type: "publicUser";
//   posts: {
//       id: string;
//       title: string | null;
//       __type: "publicPost";
//   }[];
// }


//=== クエリ ===//

db.query.usersTable.findMany({
  ...userSelection,
  where: and(
    userSelection.where,
    eq(usersTable.id, '1')),
  limit: 10,
}).then(res => console.log(res));
// (parameter) res: {
//   id: string;
//   name: string | null;
//   email: string | null;
//   deletedAt: Date | null;
//   __type: "publicUser";
//   posts: {
//       id: string;
//       title: string | null;
//       __type: "publicPost";
//   }[];
// }[]

</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1990</wp:post_id>
		<wp:post_date><![CDATA[2025-08-24 03:34:03]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-08-23 18:34:03]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-17 18:49:04]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-17 09:49:04]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90drizzle%e3%80%91query%e3%81%ab__type%e3%82%92%e5%9f%8b%e3%82%81%e8%be%bc%e3%82%93%e3%81%a7%e5%9e%8b%e5%bc%b7%e5%8a%9b%e3%81%ab%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="drizzle"><![CDATA[Drizzle]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_9d980efb3462698ba936ffaf697163c3]]></wp:meta_key>
		<wp:meta_value><![CDATA[<blockquote class="wp-embedded-content" data-secret="UcfKFfaMvp"><a href="https://www.masaakiota.net/2025/08/23/%e3%80%90drizzle%e3%80%91%e7%94%bb%e6%9c%9f%e7%9a%84%ef%bc%9fview%e3%81%ab__type%e3%83%95%e3%82%a3%e3%83%bc%e3%83%ab%e3%83%89%e3%82%92%e5%9f%8b%e3%82%81%e8%be%bc%e3%82%93%e3%81%a7%e3%82%bb%e3%82%ad/">【Drizzle】画期的？Viewに__typeフィールドを埋め込んでセキュリティを高める</a></blockquote><iframe class="wp-embedded-content" sandbox="allow-scripts" security="restricted" style="position: absolute; visibility: hidden;" title="&#8220;【Drizzle】画期的？Viewに__typeフィールドを埋め込んでセキュリティを高める&#8221; &#8212; 太田雅昭" src="https://www.masaakiota.net/2025/08/23/%e3%80%90drizzle%e3%80%91%e7%94%bb%e6%9c%9f%e7%9a%84%ef%bc%9fview%e3%81%ab__type%e3%83%95%e3%82%a3%e3%83%bc%e3%83%ab%e3%83%89%e3%82%92%e5%9f%8b%e3%82%81%e8%be%bc%e3%82%93%e3%81%a7%e3%82%bb%e3%82%ad/embed/#?secret=pflDds6Qxi#?secret=UcfKFfaMvp" data-secret="UcfKFfaMvp" width="600" height="338" frameborder="0" marginwidth="0" marginheight="0" scrolling="no"></iframe>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_9d980efb3462698ba936ffaf697163c3]]></wp:meta_key>
		<wp:meta_value><![CDATA[1758038795]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】laravel-imapで指定uid以降のメッセージを取得する]]></title>
		<link>https://www.masaakiota.net/2025/08/30/%e3%80%90php%e3%80%91laravel-imap%e3%81%a7%e6%8c%87%e5%ae%9auid%e4%bb%a5%e9%99%8d%e3%81%ae%e3%83%a1%e3%83%83%e3%82%bb%e3%83%bc%e3%82%b8%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b/</link>
		<pubDate>Sat, 30 Aug 2025 07:11:31 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2001</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">LaravelでのIMAP</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>LaravelでのIMAPは、いろいろあるのだろうと思いますが、今回はwebklex/laravel-imap: ^6.2を使用しました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">指定uid以降のメッセージを取得</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにすれば、指定uid以降のメッセージを取得できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="php" class="language-php">use Webklex\IMAP\Facades\Client;
use Webklex\PHPIMAP\IMAP;

$host = env('IMAP_HOST');
$mailbox = 'INBOX';
$lastUid = 5;
$limit = 10;

$client = Client::make([
  'host'          => $host,
  'port'          => (int) env('IMAP_PORT', 993),
  'encryption'    => env('IMAP_ENCRYPTION', 'ssl'),
  'validate_cert' => filter_var(env('IMAP_VALIDATE_CERT', true), FILTER_VALIDATE_BOOLEAN),
  'username'      => env('IMAP_USERNAME'),
  'password'      => env('IMAP_PASSWORD'),
  'protocol'      => env('IMAP_PROTOCOL', 'imap'),
  'uid'           => true,
  'timeout'       => (int) env('IMAP_TIMEOUT', 30),
]);

$client->connect();
$folder = $client->getFolder($mailbox);

$messages = $folder
  ->messages()
  ->setSequence(IMAP::ST_UID) // シーケンスをuidに指定
  ->from('xxx@example.com') // FROMを指定。なくてもいい
  ->where("CUSTOM UID {$lastUid}:*")
  ->limit($limit) // limit
  ->get(IMAP:FT_PEAK) // 既読にしない</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Gmailだと別の方法が必要</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Gmailの場合は独特で、個別対応が必要なようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2001</wp:post_id>
		<wp:post_date><![CDATA[2025-08-30 16:11:31]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-08-30 07:11:31]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-09 02:59:16]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-08 17:59:16]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90php%e3%80%91laravel-imap%e3%81%a7%e6%8c%87%e5%ae%9auid%e4%bb%a5%e9%99%8d%e3%81%ae%e3%83%a1%e3%83%83%e3%82%bb%e3%83%bc%e3%82%b8%e3%82%92%e5%8f%96%e5%be%97%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Vite】開発サーバーをDocker経由でhttpsにする]]></title>
		<link>https://www.masaakiota.net/2025/08/31/%e3%80%90vite%e3%80%91%e9%96%8b%e7%99%ba%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e3%82%92docker%e7%b5%8c%e7%94%b1%e3%81%a7https%e3%81%ab%e3%81%99%e3%82%8b/</link>
		<pubDate>Sun, 31 Aug 2025 04:40:02 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2010</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Dockerでのhttps</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Dockerでのhttpsは、https-portalが便利です。今回はこちらを使って、ローカルサーバーをhttpsにします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>普段の開発サーバー + Dockerの構成です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">hostsを設定する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ローカルのhosts設定を追加します。local.example.comの場合です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">127.0.0.1 local.example.com
127.0.0.1 vite.local.example.com</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">docker-compose.yml</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>上記で指定したホストからhost.docker.internalに流すように設定します。ウェブアプリが:8000で動いている想定です。viteは:5173です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="yaml" class="language-yaml">services:
  https-portal:
    image: steveltn/https-portal:1
    ports:
      - "80:80"
      - "443:443"
    environment:
      DOMAINS: &gt;
        local.example.com -&gt; http://host.docker.internal:8000,
        vite.local.example.com -&gt; http://host.docker.internal:5173
      STAGE: local
    volumes:
      - ./https-portal:/var/lib/https-portal
    restart: unless-stopped</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">vite.config.ts</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>dockerの証明書を読み込んで使用します。hmrもhttpsにあわせてwssにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">...

const host = "local.example.com";
const viteHost = "vite.local.example.com";
const port = 5173;

// https-portalの証明書パスを取得
const certRoot = `./https-portal/${host}/local`;
const certPath = `${certRoot}/signed.crt`;
const keyPath = `${certRoot}/domain.key`;
const cert = fs.readFileSync(certPath);
const key = fs.readFileSync(keyPath);


export default defineConfig({
  ...
  server: {
    host,
    port,
    cors: true,
    https: {
      cert,
      key,
    },
    hmr: {
      protocol: 'wss',
    },
  },
  ...
});
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2010</wp:post_id>
		<wp:post_date><![CDATA[2025-08-31 13:40:02]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-08-31 04:40:02]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-02 03:00:24]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-01 18:00:24]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90vite%e3%80%91%e9%96%8b%e7%99%ba%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e3%82%92docker%e7%b5%8c%e7%94%b1%e3%81%a7https%e3%81%ab%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="vite"><![CDATA[Vite]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【TypeScript】タイムゾーンを吸収するbranded type]]></title>
		<link>https://www.masaakiota.net/2025/09/04/%e3%80%90typescript%e3%80%91%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%be%e3%83%bc%e3%83%b3%e3%82%92%e5%90%b8%e5%8f%8e%e3%81%99%e3%82%8bbranded-type/</link>
		<pubDate>Thu, 04 Sep 2025 13:52:33 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2027</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">タイムゾーン問題</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>DBによってはタイムゾーンを保存することがデフォルトではできません。例えば、PostgreSQLではタイムゾーンを一緒にフィールドに含めることができますが、MySQLなどは含めることができないため、面倒なことになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>DBでUTCで保存してフロントではJSTで扱いたいということがあります。たとえばLaravelだと内部タイムゾーンはUTCが推奨されています。その関係から、やはりUTCで扱ってフロントではJSTとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そうした場合、一般的にはフロントで解決するのが定石のようです ( ChatGPT談 )</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">TypeScriptで専用の型を作る</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにして、専用の型を作ると、煩わしさから少しでも解放されます。Branded Typeを用いて、クライアントで扱う型を切り分けています。なお簡略化のためそのままDayjsに変換しています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import dayjs, { Dayjs } from 'dayjs';

// types
declare const clientDayjsSymbol: unique symbol;

export type ClientDayjs = Dayjs &amp; { readonly [clientDayjsSymbol]: true }


// utils
export function apiToClientDayjs(d: string | null | undefined): ClientDayjs | null {
  if (!d) return null;
  return dayjs(d)
    .add(9, 'hour') as ClientDayjs;
}

export function clientToApiDatetime(d: ClientDayjs | null | undefined): string | null {
  if (!d) return null;
  return d
    .subtract(9, 'hour')
    .format('YYYY-MM-DD HH:mm:ss') as string;
}


// test
function test() {
  // apiからの値。文字列
  const apiValues: (string | null)[] = [
    '2025-01-01',
    '2025-01-01 21:00:00',
    null,
  ]
  for (const apiValue of apiValues) {

    // client用に変換
    const clientDayjs = apiToClientDayjs(apiValue);

    // ここで色々処理する
    // ...

    // api用に変換
    const apiDatetime = clientToApiDatetime(clientDayjs);

    // ここでapiに投げる
    // ...

    // 結果
    console.log({
      apiValue,
      clientDate: clientDayjs?.format('YYYY-MM-DD HH:mm:ss'),
      apiDatetime
    });
    // {
    //   apiValue: '2025-01-01',
    //   clientDate: '2025-01-01 09:00:00',
    //   apiDatetime: '2025-01-01 00:00:00'
    // }
    // {
    //   apiValue: '2025-01-01 21:00:00',
    //   clientDate: '2025-01-02 06:00:00',
    //   apiDatetime: '2025-01-01 21:00:00'
    // }
    // {
    //   apiValue: null,
    //   clientDate: undefined,
    //   apiDatetime: null
    // }
  }

}

test();</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">その他の方法</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>mySQLはフィールドにタイムゾーンを含むことがネイティブではできませんが、INTは入れれます。そのためUNIX TIMESTAMPをつかってmsで保持するのも楽です。これなら変換作業も要りません。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2027</wp:post_id>
		<wp:post_date><![CDATA[2025-09-04 22:52:33]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-04 13:52:33]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-06 13:31:13]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-06 04:31:13]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90typescript%e3%80%91%e3%82%bf%e3%82%a4%e3%83%a0%e3%82%be%e3%83%bc%e3%83%b3%e3%82%92%e5%90%b8%e5%8f%8e%e3%81%99%e3%82%8bbranded-type]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Laravel】共用サーバーでデプロイする]]></title>
		<link>https://www.masaakiota.net/2025/09/08/%e3%80%90laravel%e3%80%91%e5%85%b1%e7%94%a8%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e3%81%a7%e3%83%87%e3%83%97%e3%83%ad%e3%82%a4%e3%81%99%e3%82%8b/</link>
		<pubDate>Mon, 08 Sep 2025 13:53:02 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2035</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Laravel + 共用サーバー</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>LaravelはPHPのため、共用サーバーで使えます。しかし下記のような問題があります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>composer実行ファイルが無い、あるいは古い</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>phpが古い</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ルートがpublic_html固定</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>ひとつひとつ見ていきます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">composerを新しく入れる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>大抵の共用サーバーでは、composerが無いかあるいは古いバージョンのままになっています。共用サーバーでの権限による制限回避のため、ユーザーディレクトリ内で解決する必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">cd ~
mkdir bin</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このようにユーザーディレクトリに専用のbinディレクトリを作成し、そこに実行ファイルをおく形となります。手順は以下です。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>composerの公式サイトに従ってインストール</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>生成されたcomposer.pharをbin/composerにリネーム (mv composer.phar ~/bin/composer)</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>bin/composerを実行可能にする (chmod +x ~/bin/composer)</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>$HOME/binにPATHを通す</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">phpを新しく入れる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>phpが古かったりもします。最近のレンタルサーバーでは、提供されているコントロールパネル上でwebで使用するphpを指定したりもできますが、cliの指定は大抵できません。cliで使用するphpを指定するには、そのバージョンのphpパスと~/bin/phpでシンボリックリンクを貼ります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">ln -s [使うphpのパス] ~/bin/php</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ドキュメントルートを解決する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>共用サーバーによってはドキュメントルートがpublic_html固定となっており、laravelのpublicディレクトリを指定できなかったりします。解決は下記の方法があります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>選択肢1: public_html以下にlaravelディレクトリを作成し、.htaccessでリライトする</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>選択肢2: public_htmlの他で専用のディレクトリを作成し、.htaccessでリライトする</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>選択肢１だと以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">public_html
  - .htaccess
  - laravel
    - public
    - .env
    - ...</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>public_html/.htaccessは下記のようにして、laravel/publicに流すようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">RewriteEngine On

RewriteRule ^(.*)$ laravel/public/$1 [L]</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、laravelのrouteで指定しているパスは正常にルーティングされるようになります。またURLから/laravel/.envにアクセスしても404が出るため安全です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Cronを設定する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Cronでは.bashrcのような初期化が効かないため、phpはフルパスで指定する必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">[path to php] artisan xxx</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2035</wp:post_id>
		<wp:post_date><![CDATA[2025-09-08 22:53:02]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-08 13:53:02]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-09 02:58:41]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-08 17:58:41]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90laravel%e3%80%91%e5%85%b1%e7%94%a8%e3%82%b5%e3%83%bc%e3%83%90%e3%83%bc%e3%81%a7%e3%83%87%e3%83%97%e3%83%ad%e3%82%a4%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="laravel"><![CDATA[Laravel]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】v24.2で追加されたimport.meta.main]]></title>
		<link>https://www.masaakiota.net/2025/09/10/%e3%80%90node-js%e3%80%91v24-2%e3%81%a7%e8%bf%bd%e5%8a%a0%e3%81%95%e3%82%8c%e3%81%9fimport-meta-main/</link>
		<pubDate>Tue, 09 Sep 2025 19:12:55 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2049</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">import.meta.main</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>import.meta.mainは、もともとDenoなどで使用できる独自使用だったのですが、Node.js v24.2.0で正式対応されています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://nodejs.org/docs/latest-v24.x/api/esm.html">https://nodejs.org/docs/latest-v24.x/api/esm.html</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>たとえば以下のような場合</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">// test.mjs

export function test(){
  return 'abc';
}


if(import.meta.main){
  console.log(test());
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>直接実行した場合はimport.meta.mainがtrueとなり、console.logが実行されます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">node test.mjs

// abcが出力される</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>しかしライブラリとしてimportした場合は、import.meta.mainはfalseとなり、console.logは実行されません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これはあたかもpythonでの<code>__name__ == "__main__"</code>のような振る舞いです。サクッとテストしたりする時などに役立ちます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">TypeScriptでは@types/nodeが必要</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>TypeScriptで使用する場合は、何も入れないと下記のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">プロパティ 'main' は型 'ImportMeta' に存在しません。ts(2339)</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>そのため@types/nodeを入れる必要があります。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2049</wp:post_id>
		<wp:post_date><![CDATA[2025-09-10 04:12:55]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-09 19:12:55]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-10 04:17:12]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-09 19:17:12]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node-js%e3%80%91v24-2%e3%81%a7%e8%bf%bd%e5%8a%a0%e3%81%95%e3%82%8c%e3%81%9fimport-meta-main]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】データ更新時にスクロールを固定する]]></title>
		<link>https://www.masaakiota.net/2025/09/11/%e3%80%90react%e3%80%91%e3%83%87%e3%83%bc%e3%82%bf%e6%9b%b4%e6%96%b0%e6%99%82%e3%81%ab%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%e3%82%92%e5%9b%ba%e5%ae%9a%e3%81%99%e3%82%8b/</link>
		<pubDate>Thu, 11 Sep 2025 09:16:59 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2063</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">更新の前後でスクロール位置の固定</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>スクロール位置を固定するには、単純に考えれば以下のような流れとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>更新前のscrollHeightを保存</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>更新実行</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>現在のscrollHeightと更新前の値を計算</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>差分位置までスクロール</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>しかし実際はReactだとレンダリングのタイミングなども考慮しないといけません。計算のタイミングで、レンダリングが終わっている保証がないためです。そのため、下記のように修正します。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>更新前のscrollHeightを保存</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>更新実行</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>下記を300ms間繰り返す<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>現在のscrollHeightと更新前の値を計算</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>差分位置までスクロール</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>またレンダリングを走らせるためにrequestAnimationFrameを使う必要もあります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">コード</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">function ScrollSample() {
  // スクロール要素の参照
  const scrollRef = useRef&lt;HTMLDivElement&gt;(null);

  // データ取得関数
  const refetch = () =&gt; new Promise&lt;void&gt;(resolve =&gt; setTimeout(resolve, 1000))

  // スクロール位置を保持する関数
  const keepScrollPosition = (params: { prevHeight: number }) =&gt;
    const timeout = 300;
    new Promise&lt;void&gt;((resolve) =&gt; {
      const { prevHeight } = params;
      const start = performance.now();
      const tick = () =&gt; {
        const el = scrollRef?.current;
        if (!el) return resolve();
        if (!el.isConnected) return resolve();
        if (performance.now() - start &gt; timeout) return resolve();
        el.scrollTo({
          top: el.scrollHeight - prevHeight,
          behavior: 'instant',
        })
        requestAnimationFrame(tick);
      };
      requestAnimationFrame(tick);
    });

  // 更新実行
  const handleClick = async () =&gt; {
    const el = scrollRef?.current;
    if (!el) return;
    const prevHeight = el.scrollHeight;
    await refetch();
    await keepScrollPosition({ prevHeight });
  }

  return &lt;&gt;
    &lt;div ref={scrollRef}&gt;
      {/* ここにデータを入れる */}
    &lt;/div&gt;
    &lt;button onClick={handleClick} &gt;更新実行&lt;/button&gt;
  &lt;/&gt;
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">汎用ユーティリティを作る</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のように汎用ユーティリティを作ると便利かと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export function keepRequestAnimationFrame(timeout: number, callback: () => void) {
  const start = performance.now();
  const tick = () => requestAnimationFrame(() => {
    callback();
    const now = performance.now();
    if (now - start > timeout) return;
    tick();
  });
  tick();
}


// 使用例
keepRequestAnimationFrame(timeout, async () => {
  const el = messageScrollRef?.current;
  if (!el) return;
  if (!el.isConnected) return;
  el.scrollTo({
    top: el.scrollHeight - prevHeight,
    behavior: 'instant',
  })
})</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2063</wp:post_id>
		<wp:post_date><![CDATA[2025-09-11 18:16:59]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-11 09:16:59]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-12 14:51:14]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-12 05:51:14]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91%e3%83%87%e3%83%bc%e3%82%bf%e6%9b%b4%e6%96%b0%e6%99%82%e3%81%ab%e3%82%b9%e3%82%af%e3%83%ad%e3%83%bc%e3%83%ab%e3%82%92%e5%9b%ba%e5%ae%9a%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【nuqs】server, clientで共通の設定を作る]]></title>
		<link>https://www.masaakiota.net/2025/09/13/%e3%80%90nuqs%e3%80%91server-client%e3%81%a7%e5%85%b1%e9%80%9a%e3%81%ae%e8%a8%ad%e5%ae%9a%e3%82%92%e4%bd%9c%e3%82%8b/</link>
		<pubDate>Fri, 12 Sep 2025 17:54:59 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2080</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">nuqs</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>nuqsは、URLのクエリパラメータを簡単に扱えるようにするライブラリです。2025年9月13日現在多くのスポンサーとコントリビューターが参加しています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://nuqs.dev">https://nuqs.dev</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">検証バージョン</h2>
<!-- /wp:heading -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>nuqs: ^2.6.0</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">server, clientは区別されている</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>parserはserverとclientとで区別されています。例えばparseAsStringLiteralを作ります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { parseAsStringLiteral } from "nuqs";

export const parser = parseAsStringLiteral(CLIP_TYPES).withDefault('video')</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これをserver側で使おうとすると、下記のエラーとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Attempted to call parseAsStringLiteral() from the server but parseAsStringLiteral is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>そのためserverで使うパーサーは、nuqsからではなく、nuqs/serverからimportする必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>しかしこれでは、共通化ができません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">関数を受け取れるようにする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>parseAsStringなどのパーサーは、型がserver, clientとで同じです。それを利用して、関数を受け取れるようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// 型のみ使用しているため、server, clientどちらでも使用可能
export type CreateParsersParams = Pick&lt;typeof import('nuqs'),
  'parseAsString' |
  'parseAsStringLiteral'
&gt;

// パラメータを作成
export function createParsers(p: CreateParsersParams) {
  return {
    type: p.parseAsStringLiteral(['video', 'image']).withDefault('video'),
    query: p.parseAsString.withDefault(''),
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これをサーバー、クライアントそれぞれで使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">"use server

import * as nuqs from 'nuqs/server';
import { createLoader } from 'nuqs/server';

const parsers = createParsers(nuqs)
const loadSearchParams = createLoader(parsers)

type Props = {
  searchParams: Promise&lt;any&gt;
}

export default async function ServerComponent(props: Props) {
  const searchParams = await loadSearchParams(props.searchParams)
  ...
}</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">"use client"

import * as nuqs from 'nuqs';
import { useQueryState } from 'nuqs';

const parsers = createParsers(nuqs)

function Component() {
  const [type, setType] = useQueryState('type', parsers.type);
  const [query, setQuery] = useQueryState('query', parsers.query);

  ...
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2080</wp:post_id>
		<wp:post_date><![CDATA[2025-09-13 02:54:59]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-12 17:54:59]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-13 22:58:46]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-13 13:58:46]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90nuqs%e3%80%91server-client%e3%81%a7%e5%85%b1%e9%80%9a%e3%81%ae%e8%a8%ad%e5%ae%9a%e3%82%92%e4%bd%9c%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【pnpm】モノレポで任意パッケージのバージョンを揃える]]></title>
		<link>https://www.masaakiota.net/2025/09/13/%e3%80%90pnpm%e3%80%91%e3%83%a2%e3%83%8e%e3%83%ac%e3%83%9d%e3%81%a7%e4%bb%bb%e6%84%8f%e3%83%91%e3%83%83%e3%82%b1%e3%83%bc%e3%82%b8%e3%81%ae%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e3%82%92/</link>
		<pubDate>Sat, 13 Sep 2025 08:32:58 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2089</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">PNPM Workspace</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>pnpm workspaceは、pnpmのモノレポ管理の仕組みです。pnpm-workspace.yamlファイルで設定します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">バージョンを揃える</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>バージョンを揃えるにはいくつか方法があるようです。GPT5の提案では、ルートのpackage.jsonでoverrideを指定するなど複雑な方法でした。しかし調べてみたところもっとシンプルな方法があるようですので、それをご紹介させていただきます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>pnpm workspaceのcatalogs機能を用います。例えばzodだと</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>pnpm-workspace.yaml</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">packages:
  - apps/*
  - packages/**/*
catalog:
  zod: ^4.1.8</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このようにcatalogとして指定します。これを使用する場所で</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>package.json</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">{
  "dependencies":{
    "zod": "catalog:"
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>catalogをインストールするように指定します。これでバージョン管理を一箇所で行うことができるようになります。便利。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2089</wp:post_id>
		<wp:post_date><![CDATA[2025-09-13 17:32:58]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-13 08:32:58]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-13 17:32:59]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-13 08:32:59]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90pnpm%e3%80%91%e3%83%a2%e3%83%8e%e3%83%ac%e3%83%9d%e3%81%a7%e4%bb%bb%e6%84%8f%e3%83%91%e3%83%83%e3%82%b1%e3%83%bc%e3%82%b8%e3%81%ae%e3%83%90%e3%83%bc%e3%82%b8%e3%83%a7%e3%83%b3%e3%82%92]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Jotai】useHydrateAtomsを毎回発火させる]]></title>
		<link>https://www.masaakiota.net/2025/09/14/%e3%80%90jotai%e3%80%91usehydrateatom%e3%82%92%e6%af%8e%e5%9b%9e%e7%99%ba%e7%81%ab%e3%81%95%e3%81%9b%e3%82%8b/</link>
		<pubDate>Sat, 13 Sep 2025 16:26:30 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2094</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">useHydrateAtoms</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>useHydrateAtomsはServerからClientに簡単にデータを渡せる関数です。useEffectや待機処理を別途書く必要がなく、とても便利な関数です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">一度実行されると更新されない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>useHydrateAtomsは一度実行されると、値が変更されたとしても再実行はされません。そのため</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>Serverから値を渡す</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Clientで値を反映させる</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Serverから違う値を渡す</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Clientで値が変わらない</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>といったことが発生します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Providerとkeyを併用する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>この解決のためには、Providerとkeyを使用します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>JotaiのProviderを使用してatomのスコープを限定します。またURL由来のキーを当てることで、変更が反映されるようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">"use client"

type ClientProps = {
  data: any;
}

export function Client(props: Props){

  // URL由来のキーを生成
  const pathname = usePathname();
  const searchParams = useSearchParams();
  const key = `${pathname}?${searchParams.toString()}`;

  // Providerを使用してスコープを限定する
  return &lt;Provider key={key}>
    &lt;Child {...props} />
  &lt;/Provider>
}

function Child(props: Props){
  useHydrateAtoms([[dataAtom, props.data]]);

  return &lt;div>
    ...
  &lt;/div>
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでserverのデータがclientに反映されるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2094</wp:post_id>
		<wp:post_date><![CDATA[2025-09-14 01:26:30]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-13 16:26:30]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-14 01:33:56]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-13 16:33:56]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90jotai%e3%80%91usehydrateatom%e3%82%92%e6%af%8e%e5%9b%9e%e7%99%ba%e7%81%ab%e3%81%95%e3%81%9b%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【dotenv】gitのルートから環境ファイルパスを指定する]]></title>
		<link>https://www.masaakiota.net/2025/09/14/%e3%80%90dotenv%e3%80%91git%e3%81%ae%e3%83%ab%e3%83%bc%e3%83%88%e3%81%8b%e3%82%89%e6%8c%87%e5%ae%9a%e3%81%99%e3%82%8b/</link>
		<pubDate>Sun, 14 Sep 2025 08:20:40 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2105</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">dotenv cli</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>dotenv cliでは、環境変数ファイルを指定して任意のスクリプトを実行できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">dotenv -e ./.env -- dosomething</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>親を遡ることも可能です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">dotenv -e ../../../../../../.env -- dosomething</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>しかし階層が深くなると、どこに目的のファイルがあるかわかりにくく、地味に泣きたくなってしまいます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">gitのルートを指定する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>gitのルートを取得するコマンドがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">git rev-parse --show-toplevel</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを実行すると、gitのルートディレクトリの絶対パスが出力されます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これを利用すると、たとえばgitルートの.envを取得したい場合</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">dotenv -e "$(git rev-parse --show-toplevel)/.env" -- dosomething</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>となります。超便利ですね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2105</wp:post_id>
		<wp:post_date><![CDATA[2025-09-14 17:20:40]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-14 08:20:40]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-14 17:27:48]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-14 08:27:48]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90dotenv%e3%80%91git%e3%81%ae%e3%83%ab%e3%83%bc%e3%83%88%e3%81%8b%e3%82%89%e6%8c%87%e5%ae%9a%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【canopy-i18n】型安全に使えるi18nライブラリ【TypeScript】]]></title>
		<link>https://www.masaakiota.net/2025/09/15/%e3%80%90canopy-i18n%e3%80%91%e5%9e%8b%e5%ae%89%e5%85%a8%e3%81%ab%e4%bd%bf%e3%81%88%e3%82%8bi18n%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%80%90typescript%e3%80%91/</link>
		<pubDate>Mon, 15 Sep 2025 10:16:26 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2111</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Node.js/TypeScriptでのi18n、型ズレや初期設定の重さに悩まされがちです。この記事では、最小限のAPIで型安全に使える「canopy-i18n」を紹介します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading"> i18nライブラリへの不満点</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>現在数々のi18nライブラリがあります。用途によって使いやすさは変わってくるかと思いますが、最近のモノレポ, TypeScriptなどでのコーディングスタイルに合っているものがないように思います。具体的には以下のようなことがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><strong>型安全性が弱い</strong>: 翻訳キーのタイポや引数不足が実行時まで発覚しない。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong>初期設定が煩雑</strong>: 設定ファイルやプラグインが多く、導入に腰が重い。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong>テンプレート制約</strong>: 独自タグや制限付き構文で表現力が足りない。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong>深いデータ適用が面倒</strong>: ネストしたオブジェクト/配列にロケールを一括適用しづらい。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong>フォールバック粒度が粗い</strong>: 画面単位でしかフォールバックできず、細かい制御が難しい。</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">canopy-i18nで解決できること</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>canopy-i18nは、下記のような特徴があります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><strong>型安全なロケール/キー</strong>: 許可ロケールを固定し、コンパイル時に検出。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong>メッセージ単位のフォールバック</strong>: 欠落時はフォールバックロケールへ退避。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong>自由なテンプレート</strong>: ただの関数（または文字列）なので、条件分岐や外部フォーマッタもそのまま使える。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong>深い適用を一発</strong>: 定義ツリー全体にロケール適用。</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><strong>軽量・シンプル</strong>: 小さなAPI面と実装で、学習・保守コストが低い。</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">使い方（最小セット）</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>インストール</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">npm i canopy-i18n

# or

pnpm add canopy-i18n</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>メッセージ定義と利用</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { createMessageBuilder, applyLocaleDeep } from 'canopy-i18n';


// 1) ロケール宣言（フォールバック: ja）
const builder = createMessageBuilder(['ja', 'en'] as const, 'ja');


// 2) メッセージ定義（文字列 or 関数テンプレート）
const title = builder({
  ja: 'タイトルテスト',
  en: 'Title Test',
});

const greet = builder&lt;{ name: string; age: number }&gt;({
  ja: c =&gt; `こんにちは、${c.name}さん。あなたは${c.age}歳です。`,
  en: c =&gt; `Hello, ${c.name}. You are ${c.age} years old.`,
});


// 3) メッセージツリーを組み立て
const messages = {
  title,
  nested: { hello: builder({ ja: 'こんにちは', en: 'Hello' }) },
  greet,
};


// 4) ツリー全体にロケール適用して利用

const m = applyLocaleDeep(messages, 'en');

console.log(m.title.render()); // "Title Test"
console.log(m.nested.hello.render()); // "Hello"
console.log(m.greet.render({ name: 'Tanaka', age: 20 }));</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Next.jsでの使用例</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Next.jsでのサンプルを試すこともできます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">git clone https://github.com/mohhh-ok/canopy-i18n
cd canopy-i18n/examples/next-app
pnpm install
pnpm dev</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">リンク</h2>
<!-- /wp:heading -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><a href="https://www.npmjs.com/package/canopy-i18n" data-type="link" data-id="https://www.npmjs.com/package/canopy-i18n">npm</a></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><a href="https://github.com/MOhhh-ok/canopy-i18n" data-type="link" data-id="https://github.com/MOhhh-ok/canopy-i18n">github</a></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2111</wp:post_id>
		<wp:post_date><![CDATA[2025-09-15 19:16:26]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-15 10:16:26]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-15 19:18:50]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-15 10:18:50]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90canopy-i18n%e3%80%91%e5%9e%8b%e5%ae%89%e5%85%a8%e3%81%ab%e4%bd%bf%e3%81%88%e3%82%8bi18n%e3%83%a9%e3%82%a4%e3%83%96%e3%83%a9%e3%83%aa%e3%80%90typescript%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【npm】2025年8月26日以降のパッケージの危険性と対策【Shai-Hulud】]]></title>
		<link>https://www.masaakiota.net/2025/09/18/%e3%80%90npm%e3%80%912025%e5%b9%b48%e6%9c%8826%e6%97%a5%e4%bb%a5%e9%99%8d%e3%81%ae%e3%83%91%e3%83%83%e3%82%b1%e3%83%bc%e3%82%b8%e3%81%ae%e5%8d%b1%e9%99%ba%e6%80%a7%e3%81%a8%e5%af%be%e7%ad%96/</link>
		<pubDate>Thu, 18 Sep 2025 06:38:28 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2127</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">2025年9月18日現在、npmは危険性がある</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>現在web開発などで主流となっているJavaScriptによる開発は、npmが必須となっています。しかし2025年9月18日現在、npmが危険にさらされています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://zenn.dev/o_sup/articles/0580cf66b3f334">https://zenn.dev/o_sup/articles/0580cf66b3f334</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これによると、感染者のnpmパッケージからさらに拡大するといった現象が起こっているようです。そのため攻撃のあった2025年8月26日以降に更新されたnpmパッケージには、感染されている可能性があります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">対策</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>詳細は上記URLを参照いただいた方がいいかと思いますが、ひとまず対応できるのは下記かと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Aikido safe chainを利用する</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>これがもっとも楽で確実かもしれません。npm, pnpmなどをラップして警告してくれるツールがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/AikidoSec/safe-chain">https://github.com/AikidoSec/safe-chain</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下で解説されています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://zenn.dev/nix/articles/0a2910ec65b4a3">https://zenn.dev/nix/articles/0a2910ec65b4a3</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">2025年8月26日以降更新のパッケージを洗い出す</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記のコードで、サブディレクトリを辿って更新日の抽出が可能です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">#!/usr/bin/env node
'use strict';

(async () =&gt; {
  const fs = await import('node:fs/promises');
  const path = await import('node:path');

  const ROOT = process.cwd();
  const IGNORE_DIRS = new Set(['node_modules', '.git', '.next', 'dist', 'build', 'coverage', 'out', 'tmp']);

  async function findPackageJsons(dir) {
    const out = [];
    async function walk(d) {
      let entries;
      try {
        entries = await fs.readdir(d, { withFileTypes: true });
      } catch {
        return;
      }
      for (const ent of entries) {
        if (ent.isDirectory()) {
          if (IGNORE_DIRS.has(ent.name)) continue;
          await walk(path.join(d, ent.name));
        } else if (ent.isFile() &amp;&amp; ent.name === 'package.json') {
          out.push(path.join(d, ent.name));
        }
      }
    }
    await walk(dir);
    return out;
  }

  async function collectDeps(pkgFile) {
    try {
      const raw = await fs.readFile(pkgFile, 'utf8');
      const j = JSON.parse(raw);
      const depObjs = [j.dependencies, j.devDependencies, j.optionalDependencies].filter(Boolean);
      const names = new Set();
      for (const obj of depObjs) for (const k of Object.keys(obj)) names.add(k);
      return [...names];
    } catch {
      return [];
    }
  }

  async function fetchLatestTime(pkg) {
    const url = 'https://registry.npmjs.org/' + encodeURIComponent(pkg);
    let res;
    try {
      res = await fetch(url, { headers: { 'Accept': 'application/json' } });
    } catch {
      return null;
    }
    if (!res.ok) return null;
    let data;
    try {
      data = await res.json();
    } catch {
      return null;
    }
    const time = data &amp;&amp; data.time;
    if (!time || typeof time !== 'object') return null;

    let latestIso = null;
    let latestTs = -Infinity;
    for (const [k, v] of Object.entries(time)) {
      if (k === 'created') continue;
      if (typeof v !== 'string') continue;
      const ts = Date.parse(v);
      if (Number.isFinite(ts) &amp;&amp; ts &gt; latestTs) {
        latestTs = ts;
        latestIso = v;
      }
    }
    return latestIso;
  }

  async function mapPool(items, limit, fn) {
    const results = new Array(items.length);
    let i = 0, running = 0;
    return await new Promise((resolve) =&gt; {
      const run = () =&gt; {
        while (running &lt; limit &amp;&amp; i &lt; items.length) {
          const idx = i++;
          running++;
          Promise.resolve(fn(items[idx], idx))
            .then((r) =&gt; { results[idx] = r; })
            .catch(() =&gt; { results[idx] = null; })
            .finally(() =&gt; {
              running--;
              if (i &gt;= items.length &amp;&amp; running === 0) resolve(results);
              else run();
            });
        }
      };
      run();
    });
  }

  const pkgFiles = await findPackageJsons(ROOT);
  const depLists = await Promise.all(pkgFiles.map(collectDeps));
  const allDeps = new Set(depLists.flat());
  const deps = [...allDeps].sort();

  const dates = await mapPool(deps, 12, fetchLatestTime);
  const pairs = deps.map((pkg, idx) =&gt; ({ pkg, date: dates[idx] })).filter(x =&gt; Boolean(x.date));
  pairs.sort((a, b) =&gt; String(a.date).localeCompare(String(b.date))); // ISOは文字列ソートでOK
  for (const { pkg, date } of pairs) console.log(`${date} ${pkg}`);
})().catch((e) =&gt; {
  console.error(e);
  process.exit(1);
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>実行してみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">% node check-npm.js
2022-06-13T02:21:09.392Z accept-language-parser
2022-06-18T00:22:51.890Z ffprobe
2022-06-18T00:22:53.893Z ffprobe-static
2022-06-22T05:28:01.927Z normalize-email
2023-07-12T19:06:34.291Z bytes
2023-08-08T23:46:05.829Z @paralleldrive/cuid2
2023-08-20T09:44:13.419Z js-cookie
2023-09-21T20:42:57.671Z handlebars
2023-12-12T05:09:10.608Z react-otp-input
2024-09-21T10:47:38.336Z @oslojs/crypto
2024-09-24T11:08:24.245Z @oslojs/encoding
2024-10-23T01:17:32.656Z @types/file-type
2024-12-09T08:43:28.232Z @emotion/react
2025-01-10T00:35:01.616Z jsonwebtoken
...</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>このように、すべてのパッケージの最終更新日が出るようになりました。これを使って、2025年8月26日以降更新のパッケージを洗い出せます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">危険なパッケージを確認する</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記ページで、今回の件で危険とされるパッケージが公開されています。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li><a href="https://www.mend.io/blog/npm-supply-chain-attack-packages-compromised-by-self-spreading-malware">https://www.mend.io/blog/npm-supply-chain-attack-packages-compromised-by-self-spreading-malware</a></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><a href="https://www.ox.security/blog/npm-2-0-hack-40-npm-packages-hit-in-major-supply-chain-attack">https://www.ox.security/blog/npm-2-0-hack-40-npm-packages-hit-in-major-supply-chain-attack</a></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><a href="https://thehackernews.com/2025/09/40-npm-packages-compromised-in-supply.html">https://thehackernews.com/2025/09/40-npm-packages-compromised-in-supply.html</a></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">バージョンを固定する</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>一旦パッケージのバージョンは固定しておいた方がいいかと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>pnpm workspaceの場合は、catalog機能を使うと一括で固定できるので便利です。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2127</wp:post_id>
		<wp:post_date><![CDATA[2025-09-18 15:38:28]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-18 06:38:28]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-18 16:49:40]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-18 07:49:40]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90npm%e3%80%912025%e5%b9%b48%e6%9c%8826%e6%97%a5%e4%bb%a5%e9%99%8d%e3%81%ae%e3%83%91%e3%83%83%e3%82%b1%e3%83%bc%e3%82%b8%e3%81%ae%e5%8d%b1%e9%99%ba%e6%80%a7%e3%81%a8%e5%af%be%e7%ad%96]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="javascript-typescript"><![CDATA[JavaScript/TypeScript]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Jotai】URLパラメータごとに値を保持する]]></title>
		<link>https://www.masaakiota.net/2025/09/18/%e3%80%90jotai%e3%80%91url%e3%83%91%e3%83%a9%e3%83%a1%e3%83%bc%e3%82%bf%e3%81%94%e3%81%a8%e3%81%ab%e5%80%a4%e3%82%92%e4%bf%9d%e6%8c%81%e3%81%99%e3%82%8b/</link>
		<pubDate>Thu, 18 Sep 2025 08:43:30 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2140</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Jotaiのスコープ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Jotaiはデフォルトでグローバルスコープを持ちますが、Providerを使用することで限定することもできます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">検証環境</h2>
<!-- /wp:heading -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>"next": "15.4.6"</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>"jotai": "^2.12.5"</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">URLパラメータごとに保持する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>まず下記のように、任意のキーで分離できるProviderを作成します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const stores = new Map&lt;string, ReturnType&lt;typeof createStore&gt;&gt;()

export function KeyScopedProvider({ scopeKey, children }: { scopeKey: string; children: React.ReactNode }) {
  const store = useMemo(() =&gt; {
    let s = stores.get(scopeKey)
    if (!s) {
      s = createStore()
      stores.set(scopeKey, s)
    }
    return s
  }, [scopeKey])
  return &lt;Provider store={store}&gt;{children}&lt;/Provider&gt;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを使って、URLパラメータごとに保持する専用のProviderを作成します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export function SearchParamScopedProvider({ children }: { children: React.ReactNode }) {
  const sp = useSearchParams();

  // 例: 全クエリをキーにする。特定のキーだけにするなら sp.get("roomId") などに変更
  const key = sp.toString();
  return &lt;KeyScopedProvider scopeKey={key}&gt;{children}&lt;/KeyScopedProvider&gt;;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>テストします。下記はnext.jsページの全コードです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">"use client"

import { atom, createStore, Provider, useAtom } from 'jotai'
import Link from 'next/link'
import { usePathname, useSearchParams } from 'next/navigation'
import { useMemo } from 'react'

const ageAtom = atom&lt;number>(0)

export default function App() {
  return &lt;SearchParamScopedProvider>
    &lt;Inner />
  &lt;/SearchParamScopedProvider>
}

function Inner() {
  const [age, setAge] = useAtom(ageAtom)
  const searchParams = useSearchParams();
  const name = searchParams.get('name') ?? '';
  const pathname = usePathname();
  return &lt;div>
    &lt;Link href='?name=taro'>taro&lt;/Link>&lt;br />
    &lt;Link href='?name=jiro'>jiro&lt;/Link>&lt;br />
    &lt;Link href={`${pathname}/sub`}>Sub page&lt;/Link>&lt;br />
    &lt;br />
    &lt;br />
    {name}の歳は
    &lt;input type='number' value={age} onChange={(e) => setAge(Number(e.target.value))} />
    です。
  &lt;/div>
}


export function SearchParamScopedProvider({ children }: { children: React.ReactNode }) {
  const sp = useSearchParams();

  // 例: 全クエリをキーにする。特定のキーだけにするなら sp.get("roomId") などに変更
  const key = sp.toString();
  return &lt;KeyScopedProvider scopeKey={key}>{children}&lt;/KeyScopedProvider>;
}


const stores = new Map&lt;string, ReturnType&lt;typeof createStore>>()

export function KeyScopedProvider({ scopeKey, children }: { scopeKey: string; children: React.ReactNode }) {
  const store = useMemo(() => {
    let s = stores.get(scopeKey)
    if (!s) {
      s = createStore()
      stores.set(scopeKey, s)
    }
    return s
  }, [scopeKey])
  return &lt;Provider store={store}>{children}&lt;/Provider>
}
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>それぞれの名前ごとにageを設定できました。またsubpageから戻ってきた時も値が保持されています。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2140</wp:post_id>
		<wp:post_date><![CDATA[2025-09-18 17:43:30]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-18 08:43:30]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-18 17:47:38]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-18 08:47:38]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90jotai%e3%80%91url%e3%83%91%e3%83%a9%e3%83%a1%e3%83%bc%e3%82%bf%e3%81%94%e3%81%a8%e3%81%ab%e5%80%a4%e3%82%92%e4%bf%9d%e6%8c%81%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MUI】内部CSS隣接セレクタにこれで勝てる]]></title>
		<link>https://www.masaakiota.net/2025/09/23/%e3%80%90mui%e3%80%91%e5%86%85%e9%83%a8css%e9%9a%a3%e6%8e%a5%e3%82%bb%e3%83%ac%e3%82%af%e3%82%bf%e3%81%ab%e3%81%93%e3%82%8c%e3%81%a7%e5%8b%9d%e3%81%a6%e3%82%8b/</link>
		<pubDate>Mon, 22 Sep 2025 19:44:36 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2150</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">CSSの仕様</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>CSSでは、隣接セレクタが強くなり、単体でのセレクタは負けてしまいます。そのためそういう場合は同じように隣接セレクタを使うか、!importantなどを使ったりして解決します。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">MUIの隣接セレクタ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>MUIはたとえば以下のような隣接セレクタがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">.MuiDialogTitle-root+.css-16wt3be-MuiDialogContent-root {
    padding-top: 0;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これはダイアログ内にあり、DialogContentの上部パディングです。このセレクタが強いため、通常の追加方法では勝てません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>試しにtheme内で下記のようにしてみます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export const theme = createTheme({
  ...
  components: {
    MuiDialogContent: {
      styleOverrides: {
        root: {
          paddingTop: '1.0rem',
        }
      }
    },
  }
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これはDialogContentの上部パディングを上書きしていますが、反映されません。なぜなら前述の隣接セレクタが勝ってしまうためです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">emotionの&amp;&amp;</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>この隣接セレクタに勝つために、下記のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export const theme = createTheme({
  ...
  components: {
    MuiDialogContent: {
      styleOverrides: {
        root: {
          '&amp;&amp;': {paddingTop: '1.0rem'}
        }
      }
    },
  }
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>emotionの&amp;は親セレクタを表します。つまり&amp;&amp;は親を２世代遡っているため、隣接セレクタ扱いとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>このようにすることで、隣接セレクタに勝つことができます。これで常勝街道まっしぐらですね。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2150</wp:post_id>
		<wp:post_date><![CDATA[2025-09-23 04:44:36]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-22 19:44:36]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-23 04:44:57]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-22 19:44:57]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90mui%e3%80%91%e5%86%85%e9%83%a8css%e9%9a%a3%e6%8e%a5%e3%82%bb%e3%83%ac%e3%82%af%e3%82%bf%e3%81%ab%e3%81%93%e3%82%8c%e3%81%a7%e5%8b%9d%e3%81%a6%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mui"><![CDATA[MUI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】よくある国旗付き国選択を作る]]></title>
		<link>https://www.masaakiota.net/2025/09/28/%e3%80%90react%e3%80%91%e3%82%88%e3%81%8f%e3%81%82%e3%82%8b%e5%9b%bd%e6%97%97%e4%bb%98%e3%81%8d%e5%9b%bd%e9%81%b8%e6%8a%9e%e3%82%92%e4%bd%9c%e3%82%8b/</link>
		<pubDate>Sat, 27 Sep 2025 23:39:16 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2155</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">国選択UI</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>国選択UIは、国名のみのものもありますが、国旗があると親切です。また国名のローカライゼーションもあるとベストです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回は下記の条件で作ります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>国旗はUnicode文字を使用</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>国名はローカライズする</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">使用ライブラリ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>国旗には下記のライブラリを使用しました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://www.npmjs.com/package/country-flag-icons">https://www.npmjs.com/package/country-flag-icons</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Unicodeの国旗が使用でき、シンプルなAPIで使用感も良さそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>また国名のローカライゼーションにはIntl.DisplayNamesを使用します。ネイティブコードのためこちらはライブラリ不要です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">セレクタを作ってみる</h2>
<!-- /wp:heading -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">国一覧</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>国一覧は下記のようにして取得できます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { countries } from 'country-flag-icons';
console.log(countries); // 要素数254のstring[] AC, AD, AE, AF, AG, AI, AL, ...</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">国旗</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>国旗はUnicodeで取得できます。超軽量です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import getFlag from 'country-flag-icons/unicode'
console.log(getFlag('JP'));</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">ローカライゼーション</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>国コードからローカライゼーションされた国名を取得するには、下記のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const getCountryName = (params: { locale: string, country: string }) => {
  const regionNamesInEnglish = new Intl.DisplayNames([params.locale], { type: "region" });
  return regionNamesInEnglish.of(params.country);
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">セレクタ</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>簡単にセレクタが作れました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { countries } from 'country-flag-icons';
import getFlag from 'country-flag-icons/unicode';

export default function App() {
  const locale = 'ja';
  return &lt;CountrySelect locale={locale} />
}

function CountrySelect({ locale }: { locale: string }) {
  return &lt;select>
    {countries.map((country) => (
      &lt;option key={country} value={country}>
        {getFlag(country)} {getCountryName({ locale, country })}&lt;/option>
    ))}
  &lt;/select>
}

const getCountryName = (params: { locale: string, country: string }) => {
  const regionNamesInEnglish = new Intl.DisplayNames([params.locale], { type: "region" });
  return regionNamesInEnglish.of(params.country);
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2155</wp:post_id>
		<wp:post_date><![CDATA[2025-09-28 08:39:16]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-27 23:39:16]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-28 08:39:16]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-27 23:39:16]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91%e3%82%88%e3%81%8f%e3%81%82%e3%82%8b%e5%9b%bd%e6%97%97%e4%bb%98%e3%81%8d%e5%9b%bd%e9%81%b8%e6%8a%9e%e3%82%92%e4%bd%9c%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Tanstack Form】送信時に全フィールドの検証を行う【React】]]></title>
		<link>https://www.masaakiota.net/2025/09/30/%e3%80%90tanstack-form%e3%80%91%e9%80%81%e4%bf%a1%e6%99%82%e3%81%ab%e5%85%a8%e3%83%95%e3%82%a3%e3%83%bc%e3%83%ab%e3%83%89%e3%81%ae%e6%a4%9c%e8%a8%bc%e3%82%92%e8%a1%8c%e3%81%86%e3%80%90react%e3%80%91/</link>
		<pubDate>Tue, 30 Sep 2025 13:59:49 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2166</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Tanstack Form</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Tanstack FormはForm用ライブラリです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://tanstack.com/form/latest">https://tanstack.com/form/latest</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>これまでreact-hook-formを使っていましたが、Tanstack Formに乗り換えました。型安全で、自由度も高くストレス軽減につながります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">送信時に必ずしもすべてのフィールドは検証されない</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>例えばonSubmit検証をつけます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">&lt;form.Field
  name="age"
  validators={{
    onSubmit: ({ value }) =>
      value &lt; 13 ? 'You must be 13 to make an account' : undefined,
  }}
>
  {(field) => (
    &lt;>
      ...
    &lt;/>
  )}
&lt;/form.Field></code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>単体なら問題ありませんが、これが複数フィールドになると問題が出てきます。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>送信</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>フィールドA, フィールドBで検証エラー</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>フィールドAを修正して送信</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>フィールドAの検証が走らない</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>これは仕様のようですが、ケースによっては不適です。送信ボタンを押すとすべてのフィールドの検証が走り、適切なエラーメッセージがそれぞれで表示されるのが、ユーザーの自然な想定かと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>下記のようにすれば、毎回すべてのフィールドで検証が走るようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">onClick = ()=>{
  form.validateAllFields('submit');
  form.handleSubmit();
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2166</wp:post_id>
		<wp:post_date><![CDATA[2025-09-30 22:59:49]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-30 13:59:49]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-09-30 22:59:50]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-09-30 13:59:50]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90tanstack-form%e3%80%91%e9%80%81%e4%bf%a1%e6%99%82%e3%81%ab%e5%85%a8%e3%83%95%e3%82%a3%e3%83%bc%e3%83%ab%e3%83%89%e3%81%ae%e6%a4%9c%e8%a8%bc%e3%82%92%e8%a1%8c%e3%81%86%e3%80%90react%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Tanstack Form】送信試行後のみonChange検証する【React】]]></title>
		<link>https://www.masaakiota.net/2025/09/30/%e3%80%90tanstack-form%e3%80%91%e9%80%81%e4%bf%a1%e8%a9%a6%e8%a1%8c%e5%be%8c%e3%81%ae%e3%81%bfonchange%e3%81%99%e3%82%8b/</link>
		<pubDate>Tue, 30 Sep 2025 14:34:23 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2169</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Tanstack FormのonChange</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Tanstack Formでのバリデーションは、フィールドごとにどのイベントで発火させるかなどわかりやすいAPIとなっています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">送信試行後のみonChangeする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ユーザー体験向上のため、下記のような動作にします。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>メールアドレスを入力</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>送信試行</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>エラー表示。以降は入力に追従してエラーが変化する</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">公式の方法</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>公式で紹介されているのは、onDynamicを使った方法です。下記ではzodを使用しています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const form = useForm({
  validationLogic: revalidateLogic({
    mode: 'submit',
    modeAfterSubmission: 'change',
  }),
  ...

...

&lt;form.Field
      validators={{
        onDynamic: ({value}) => z
            .email('有効なメールアドレスを入力してください')
            .max(200, '200文字以内で入力してください'))
            .safeParse(value).error?.issues[0]?.message
      ...
      }}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>初期モードはonSubmit, 送信後はonChangeに切り替わります。便利。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">オレオレの方法</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>下記は非推奨の方法です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下のようなユーティリティを作ります。zodを使用しています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">type ValidateParams = { value: any, fieldApi: AnyFieldApi }

export function createZodValidator(
  schema: z.ZodSchema,
  options?: { onlyAfterAttempts?: boolean }
) {
  return ({ value, fieldApi }: ValidateParams) =&gt; {
    if (options?.onlyAfterAttempts &amp;&amp; fieldApi.form.state.submissionAttempts === 0) {
      return undefined;
    }
    return schema.safeParse(value).error?.issues[0]?.message
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを使用して、以下のようにします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">&lt;form.Field
  name="age"
  validators={{
    onChange: createZodValidator(
      z.email('有効なメールアドレスを入力してください'),
      { onlyAfterAttempts: true })
  }}
&gt;
  {(field) =&gt; (
    &lt;&gt;
      ...
    &lt;/&gt;
  )}
&lt;/form.Field&gt;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2169</wp:post_id>
		<wp:post_date><![CDATA[2025-09-30 23:34:23]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-09-30 14:34:23]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-01 23:32:52]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-01 14:32:52]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90tanstack-form%e3%80%91%e9%80%81%e4%bf%a1%e8%a9%a6%e8%a1%8c%e5%be%8c%e3%81%ae%e3%81%bfonchange%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Tanstack Form】useFormの戻り型を定義する【React】]]></title>
		<link>https://www.masaakiota.net/2025/10/01/%e3%80%90tanstack-form%e3%80%91useform%e3%81%ae%e6%88%bb%e3%82%8a%e5%9e%8b%e3%82%92%e5%ae%9a%e7%be%a9%e3%81%99%e3%82%8b%e3%80%90react%e3%80%91/</link>
		<pubDate>Wed, 01 Oct 2025 14:31:10 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2176</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">useFormの戻りが複雑</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>@tanstack/react-formは v1.23.4時点で、useFormの戻りを生成するユーティリティはありません。ジェネリクスも複雑で、自前で生成するのも困難な代物となっています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export declare function useForm&lt;TFormData, TOnMount extends undefined | FormValidateOrFn&lt;TFormData>, TOnChange extends undefined | FormValidateOrFn&lt;TFormData>, TOnChangeAsync extends undefined | FormAsyncValidateOrFn&lt;TFormData>, TOnBlur extends undefined | FormValidateOrFn&lt;TFormData>, TOnBlurAsync extends undefined | FormAsyncValidateOrFn&lt;TFormData>, TOnSubmit extends undefined | FormValidateOrFn&lt;TFormData>, TOnSubmitAsync extends undefined | FormAsyncValidateOrFn&lt;TFormData>, TOnDynamic extends undefined | FormValidateOrFn&lt;TFormData>, TOnDynamicAsync extends undefined | FormAsyncValidateOrFn&lt;TFormData>, TOnServer extends undefined | FormAsyncValidateOrFn&lt;TFormData>, TSubmitMeta>(opts?: FormOptions&lt;TFormData, TOnMount, TOnChange, TOnChangeAsync, TOnBlur, TOnBlurAsync, TOnSubmit, TOnSubmitAsync, TOnDynamic, TOnDynamicAsync, TOnServer, TSubmitMeta>): ReactFormExtendedApi&lt;TFormData, TOnMount, TOnChange, TOnChangeAsync, TOnBlur, TOnBlurAsync, TOnSubmit, TOnSubmitAsync, TOnDynamic, TOnDynamicAsync, TOnServer, TSubmitMeta>;</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>ためしにジェネリクスの第一引数にデータ型を渡してあとはanyで埋めるといったことも試しましたが、どうも思わぬところで型エラーになったりします。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ReturnTypeを使う</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>決して美しくはありませんが、最も確実なのはReturnTypeを使う方法です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export type XxxForm = ReturnType&lt;typeof useXxx>;

export function useXxx(){
  return useForm(...
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを使えば、例えばPropsで受け取る場合</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { useForm, createFormHook, createFormHookContexts } from '@tanstack/react-form'

type AuthForm = ReturnType&lt;typeof useAuthForm>

function useAuthForm() {
  return useForm({
    defaultValues: { email: '', password: '' },
  })
}

export function PropsSample() {
  const form = useAuthForm()
  return (
    &lt;div>
      &lt;EmailFieldByProps form={form} />
      &lt;PasswordFieldByProps form={form} />
    &lt;/div>
  )
}

function EmailFieldByProps({ form }: { form: AuthForm }) {
  return (
    &lt;form.Field name="email">
      {(field) => (
        &lt;input
          value={field.state.value ?? ''}
          onChange={(e) => field.handleChange(e.target.value)}
          type="email"
          placeholder="email"
        />
      )}
    &lt;/form.Field>
  )
}

function PasswordFieldByProps({ form }: { form: AuthForm }) {
  return (
    &lt;form.Field name="password">
      {(field) => (
        &lt;input
          value={field.state.value ?? ''}
          onChange={(e) => field.handleChange(e.target.value)}
          type="password"
          placeholder="password"
        />
      )}
    &lt;/form.Field>
  )
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>contextも使えます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">
const AuthFormContext = createContext&lt;AuthForm | null>(null)

function useAuthFormContext() {
  const ctx = useContext(AuthFormContext)
  if (!ctx) throw new Error('AuthFormContext is not provided')
  return ctx
}

export function ContextSample() {
  const form = useAuthForm()
  return (
    &lt;AuthFormContext.Provider value={form}>
      &lt;EmailFieldByContext />
      &lt;PasswordFieldByContext />
    &lt;/AuthFormContext.Provider>
  )
}

function EmailFieldByContext() {
  const form = useAuthFormContext()
  return (
    &lt;form.Field name="email">
      {(field) => (
        &lt;input
          value={field.state.value ?? ''}
          onChange={(e) => field.handleChange(e.target.value)}
          type="email"
          placeholder="email"
        />
      )}
    &lt;/form.Field>
  )
}

function PasswordFieldByContext() {
  const form = useAuthFormContext()
  return (
    &lt;form.Field name="password">
      {(field) => (
        &lt;input
          value={field.state.value ?? ''}
          onChange={(e) => field.handleChange(e.target.value)}
          type="password"
          placeholder="password"
        />
      )}
    &lt;/form.Field>
  )
}</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2176</wp:post_id>
		<wp:post_date><![CDATA[2025-10-01 23:31:10]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-10-01 14:31:10]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-01 23:31:11]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-01 14:31:11]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90tanstack-form%e3%80%91useform%e3%81%ae%e6%88%bb%e3%82%8a%e5%9e%8b%e3%82%92%e5%ae%9a%e7%be%a9%e3%81%99%e3%82%8b%e3%80%90react%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Vite】lazy分割よりmanualChunkが便利【React】]]></title>
		<link>https://www.masaakiota.net/2025/10/03/%e3%80%90vite%e3%80%91lazy%e5%88%86%e5%89%b2%e3%81%8c%e6%99%82%e4%bb%a3%e9%81%85%e3%82%8c%e3%81%aa%e8%a9%b1%e3%80%90react%e3%80%91/</link>
		<pubDate>Fri, 03 Oct 2025 09:22:14 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2182</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Reactのchunk</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Reactのビルドはchunk戦略がかかせません。適切なchunkで初回ローディング速度が決まります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>たとえばlazy戦略だと、</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">const Dashboard = lazy(() =&gt; import('./pages/dashboard/Dashboard'));</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>といったように、遅れて読み込むことでchunkし、ファイルサイズの肥大化を防止することでユーザー体験の向上を図ります。しかし後述するViteのmanualChunksを使えば、わざわざこういったlazy戦略は必要なくなります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ViteのmanualChunk</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Viteでは設定で、分割するパッケージを指定できます。これにより重複するデータが整理されます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下は一例です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">export default defineConfig(() =&gt; {
  return {
    build: {
      rollupOptions: {
        output: {
          manualChunks: {
            'react': ['react', 'react-dom/client', 'react-router-dom'],
            'mui': ['@mui/material', '@emotion/react', '@emotion/styled'],
            'basics': ['zod', 'dayjs', 'jotai', 'swr', 'axios', 'react-hot-toast', 'react-icons'],
          },
        }
      }
    }
  }
})</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>lazyから解放されてすっきりしました。なおreact-domはreact-dom/clientを指定しないと効果がないそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2182</wp:post_id>
		<wp:post_date><![CDATA[2025-10-03 18:22:14]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-10-03 09:22:14]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-05 11:34:03]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-05 02:34:03]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90vite%e3%80%91lazy%e5%88%86%e5%89%b2%e3%81%8c%e6%99%82%e4%bb%a3%e9%81%85%e3%82%8c%e3%81%aa%e8%a9%b1%e3%80%90react%e3%80%91]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="vite"><![CDATA[Vite]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【UTM】EFI Shellが表示される問題]]></title>
		<link>https://www.masaakiota.net/2025/10/08/%e3%80%90utm%e3%80%91efi-shell%e3%81%8c%e8%a1%a8%e7%a4%ba%e3%81%95%e3%82%8c%e3%82%8b%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Wed, 08 Oct 2025 09:32:36 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2186</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">UTM</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>UTMはMacで使えるエミュレータです。ARMにも対応しているとのことで使ってみました。Windowsなどをエミュレートできます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">EFIに落ちる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>起動してなぜかブートしません。毎回EFIに落ちます。Shellで直接叩いてもブートしません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>解決はここにありました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://docs.getutm.app/guides/windows">https://docs.getutm.app/guides/windows</a></p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:paragraph -->
<p>First, make sure that you pressed any key during boot to enter the installer.</p>
<!-- /wp:paragraph --></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>キーボードを叩けとのことです。仰せの通りキーボードを叩けば無事インストーラが起動しました。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2186</wp:post_id>
		<wp:post_date><![CDATA[2025-10-08 18:32:36]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-10-08 09:32:36]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-08 18:32:37]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-08 09:32:37]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90utm%e3%80%91efi-shell%e3%81%8c%e8%a1%a8%e7%a4%ba%e3%81%95%e3%82%8c%e3%82%8b%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="uncategorized"><![CDATA[未分類]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Node.js】StreamとSSEをまとめてみた]]></title>
		<link>https://www.masaakiota.net/2025/10/09/%e3%80%90node-js%e3%80%91stream%e3%81%a8sse%e3%82%92%e3%81%be%e3%81%a8%e3%82%81%e3%81%a6%e3%81%bf%e3%81%9f/</link>
		<pubDate>Thu, 09 Oct 2025 06:21:41 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2189</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">StreamとSSE</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Streamは逐次送信する方式で、SSEはStreamを規格化したものです。それぞれ比較してみます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Steam</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Steamの場合、単純にデータを逐次送信します。例えばtext/plainデータなら以下のようになります。テキストを自前でデコードする必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// plain/server.ts

import fs from 'node:fs';
import http from 'node:http';
import path from 'node:path';

const PORT = 3500;

const server = http.createServer(async (req, res) =&gt; {
  if (req.url === '/') {
    outputHtml(res);
  } else if (req.url === '/stream') {
    outputStream(res);
  }
});

server.listen(PORT, () =&gt; {
  console.log(`HTTP server listening on http://localhost:${PORT}`);
});


function outputHtml(res: http.ServerResponse) {
  res.writeHead(200, {
    'Content-Type': 'text/html; charset=utf-8',
  });
  const html = fs.readFileSync(path.join(__dirname, 'client.html'), 'utf8');
  res.write(html);
  res.end();
}

async function outputStream(res: http.ServerResponse) {
  res.writeHead(200, {
    // Plain text streaming
    'Content-Type': 'text/plain; charset=utf-8',
    'Content-Encoding': 'none', // gzipなどを排除
    'Cache-Control': 'no-cache, no-transform',
    'Connection': 'keep-alive',
    'X-Accel-Buffering': 'no', // プロキシバッファを排除 (nginx etc.)
  });

  for (let i = 0; i &lt; 5; i++) {
    res.write(`chunk ${i} ${Date.now()}\n`);
    await new Promise(resolve =&gt; setTimeout(resolve, 1000));
  }

  res.write('end\n');
  res.end();
}</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="markup" class="language-markup">&lt;!-- plain/client.html --&gt;
&lt;html&gt;

&lt;body&gt;
  &lt;h1&gt;Plain Text Streaming&lt;/h1&gt;
  &lt;div id="messages"&gt;&lt;/div&gt;
&lt;/body&gt;

&lt;script&gt;
  const element = document.getElementById('messages');
  const log = (message) =&gt; {
    element.innerHTML += message + '&lt;br&gt;';
  };

  async function init() {
    const response = await fetch('/stream');
    const reader = response.body.getReader();

    while (true) {
      const res = await reader.read();
      if (res.done) break;
      // ReadableStreamはバイトストリームなので、デコードして文字列に変換する
      log(new TextDecoder().decode(res.value));
    }
  }

  init();

&lt;/script&gt;

&lt;/html&gt;</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">SSE</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>SSEはStreamを標準規格化したもので、イベントやデコード処理などを担ってくれます。送信側もフォーマットに従う必要があります。フォーマットはfield: valueの形式で、filedにはevent,dataなどがあります。eventが省略されると自動でevent: messageが割り振られます。またeventの後には必ずdata送信も必要です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// sse/server.ts

import fs from 'node:fs';
import http from 'node:http';
import path from 'node:path';

const PORT = 3500;

const server = http.createServer(async (req, res) =&gt; {
  if (req.url === '/') {
    outputHtml(res);
  } else if (req.url === '/stream') {
    outputStream(res);
  }
});

server.listen(PORT, () =&gt; {
  console.log(`HTTP server listening on http://localhost:${PORT}`);
});


function outputHtml(res: http.ServerResponse) {
  res.writeHead(200, {
    'Content-Type': 'text/html; charset=utf-8',
  });
  const html = fs.readFileSync(path.join(__dirname, 'client.html'), 'utf8');
  res.write(html);
  res.end();
}

async function outputStream(res: http.ServerResponse) {
  res.writeHead(200, {
    // SSEはtext/event-streamを返す
    'Content-Type': 'text/event-stream; charset=utf-8',
    'Content-Encoding': 'none', // gzipなどを排除
    'Cache-Control': 'no-cache, no-transform',
    'Connection': 'keep-alive',
    'X-Accel-Buffering': 'no', // プロキシバッファを排除 (nginx etc.)
  });

  for (let i = 0; i &lt; 5; i++) {

    // データを送信
    res.write(`data: chunk ${i} ${Date.now()}\n\n`);

    await new Promise(resolve =&gt; setTimeout(resolve, 1000));
  }

  // endイベントを送信。dataも必要なので空dataも入れている。
  res.write('event: end\n');
  res.write('data: \n\n');
  res.end();
}</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="markup" class="language-markup">&lt;!-- sse/client.html --&gt;
&lt;html&gt;

&lt;body&gt;
  &lt;h1&gt;SSE Streaming&lt;/h1&gt;
  &lt;div id="messages"&gt;&lt;/div&gt;
&lt;/body&gt;

&lt;script&gt;
  const element = document.getElementById('messages');
  const log = (message) =&gt; {
    element.innerHTML += message + '&lt;br&gt;';
  };

  const sse = new EventSource('/stream');
  sse.onmessage = (event) =&gt; {
    log(event.data);
  };

  sse.addEventListener('end', (event) =&gt; {
    log('end');
    sse.close();
  });

&lt;/script&gt;


&lt;/html&gt;</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2189</wp:post_id>
		<wp:post_date><![CDATA[2025-10-09 15:21:41]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-10-09 06:21:41]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-23 21:24:33]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-23 12:24:33]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90node-js%e3%80%91stream%e3%81%a8sse%e3%82%92%e3%81%be%e3%81%a8%e3%82%81%e3%81%a6%e3%81%bf%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Security】Argon2がNodeで標準装備]]></title>
		<link>https://www.masaakiota.net/2025/10/09/%e3%80%90security%e3%80%91argon2%e3%81%8cnode%e3%81%a7%e6%a8%99%e6%ba%96%e8%a3%85%e5%82%99/</link>
		<pubDate>Thu, 09 Oct 2025 08:52:53 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2195</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ハッシュ化</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ハッシュ化は、かつてはMD5などが用いられていました。しかしこれは脆弱であるため、2025年現在はArgon2, Scrypt, Bcryptなどが推奨されています。Argon2とScryptはメモリハードでより突破されにくく、そのうち最も堅牢とされているのがArgon2です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Node.jsネイティブのArgon2</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Argon2はNode.js v24.7から標準搭載されています。しかしかなり複雑な実装となります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// https://nodejs.org/api/crypto.html#cryptoargon2syncalgorithm-parameters
import { argon2Sync, randomBytes, timingSafeEqual } from 'node:crypto';

const CONFIG = {
  parallelism: 4,
  tagLength: 64,
  memory: 65536,
  passes: 3,
  algorithm: 'argon2id',
} as const;

export function hashPassword(password) {
  const nonce = randomBytes(16);
  const tag = argon2Sync(
    CONFIG.algorithm,
    {
      message: password,
      nonce,
      parallelism: CONFIG.parallelism,
      tagLength: CONFIG.tagLength,
      memory: CONFIG.memory,
      passes: CONFIG.passes,
    });
  return {
    algorithm: CONFIG.algorithm,
    parallelism: CONFIG.parallelism,
    tagLength: CONFIG.tagLength,
    memory: CONFIG.memory,
    passes: CONFIG.passes,
    nonceHex: nonce.toString('hex'),
    tagHex: tag.toString('hex'),
  };
}

export function verifyPassword(stored, password) {
  const nonce = Buffer.from(stored.nonceHex, 'hex');
  const expected = Buffer.from(stored.tagHex, 'hex');
  const actual = argon2Sync(stored.algorithm, {
    message: password,
    nonce,
    parallelism: stored.parallelism,
    tagLength: stored.tagLength,
    memory: stored.memory,
    passes: stored.passes,
  });
  return timingSafeEqual(expected, actual);
}

const stored = hashPassword('password');
console.log(verifyPassword(stored, 'password'));  // true
console.log(verifyPassword(stored, 'wrong'));     // false</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ライブラリのArgon2</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ライブラリを使えばかなり楽に描けます。PHCフォーマットもされるため、DB保存もバッチリです。syncがないのが惜しいですが、メンテナンスコストは爆下がりです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import argon2 from 'argon2';

async function main() {
  const password = 'password';
  const hash = await argon2.hash(password);
  const isVerified = await argon2.verify(hash, password);
  console.log({ hash, isVerified });
}

main();</code></pre>
<!-- /wp:code -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Next.jsでは工夫が必要</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Argon2ライブラリはバイナリを含むため、Next.jsでライブラリのArgon2を使う場合は工夫が必要です。以下のようにnext.config.tsで設定します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">const config: NextConfig = {
  webpack: (config, { isServer }) => {
    if (isServer) {
      config.externals.push({
        argon2: 'commonjs argon2',
      });
    }

    return config;
  },
};
</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2195</wp:post_id>
		<wp:post_date><![CDATA[2025-10-09 17:52:53]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-10-09 08:52:53]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-09 19:00:27]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-09 10:00:27]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90security%e3%80%91argon2%e3%81%8cnode%e3%81%a7%e6%a8%99%e6%ba%96%e8%a3%85%e5%82%99]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="node-js"><![CDATA[Node.js]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】@ebay/nice-modal-reactの型強化的な]]></title>
		<link>https://www.masaakiota.net/2025/10/11/%e3%80%90react%e3%80%91ebay-nice-modal-react%e3%81%ae%e5%9e%8b%e5%bc%b7%e5%8c%96%e7%9a%84%e3%81%aa/</link>
		<pubDate>Fri, 10 Oct 2025 23:39:59 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2205</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ReactのDialog事情</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ReactでのDialogは、ボタンと一緒にElementも作成して使うのが一般的です。muiなどですね。ただしこれは結構面倒だったりします。イベント駆動で出したいだけなのに、毎回Element生成も書かないといけません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>そこで@ebay/nice-modal-reactを試しました。これはProviderで一元管理し、わざわざElementを都度生成しなくてもDialogが開けるようになっています。これは便利。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>しかしデメリットもあります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">@ebay/nice-modal-reactのデメリット</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>@ebay/nice-modal-reactはとにかく型が弱いです。インプットはPartialなため漏れが生じてDialogの中で落ちたり、アウトプットはunknownとなっています。これでは厳しいです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">型強化版的な</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そこで似たような使用感で使えるのを作ってみました。GPT5があるとだいぶ楽に作れますね。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// modal.tsx

import React, { createContext, useCallback, useContext, useMemo, useState } from "react";

export type ModalProps&lt;P, R&gt; = P &amp; {
  open: boolean;
  resolve: (value: R) =&gt; void;
  reject: (reason?: unknown) =&gt; void;
  close: () =&gt; void;
}

type ModalComponent&lt;P, R&gt; = (props: ModalProps&lt;P, R&gt;) =&gt; React.ReactNode;

type StackItem = {
  id: number;
  comp: ModalComponent&lt;any, any&gt;;
  props: any;
  resolve: (v: any) =&gt; void;
  reject: (r?: unknown) =&gt; void;
};

type ModalContextValue = {
  show: &lt;P, R&gt;(comp: ModalComponent&lt;P, R&gt;, props: P) =&gt; Promise&lt;R&gt;;
};

const ModalContext = createContext&lt;ModalContextValue | null&gt;(null);

export function ModalProvider({ children }: { children: React.ReactNode }) {
  const [stack, setStack] = useState&lt;StackItem[]&gt;([]);
  const show = useCallback(&lt;P, R,&gt;(comp: ModalComponent&lt;P, R&gt;, props: P) =&gt; {
    return new Promise&lt;R&gt;((resolve, reject) =&gt; {
      setStack((s) =&gt; [
        ...s,
        { id: Date.now() + Math.random(), comp, props, resolve, reject },
      ]);
    });
  }, []);

  const value = useMemo&lt;ModalContextValue&gt;(() =&gt; ({ show }), [show]);

  return (
    &lt;ModalContext.Provider value={value}&gt;
      {children}
      {stack.map((item) =&gt; {
        const close = () =&gt;
          setStack((s) =&gt; s.filter((x) =&gt; x.id !== item.id));
        return (
          &lt;item.comp
            key={item.id}
            {...item.props}
            open={true}
            resolve={(v: any) =&gt; { item.resolve(v); close(); }}
            reject={(r?: unknown) =&gt; { item.reject(r); close(); }}
            close={close}
          /&gt;
        );
      })}
    &lt;/ModalContext.Provider&gt;
  );
}

export function useModal() {
  const ctx = useContext(ModalContext);
  if (!ctx) throw new Error("useModal must be used within ModalProvider");
  return ctx;
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>下記のようにして使います。型安全です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { Button, Dialog, DialogActions, DialogContent, DialogTitle } from "@mui/material";
import { ModalProvider, useModal, type ModalProps } from "./modal";

type Input = { title: string; description: string; };
type Output = string;
type MyDialogProps = ModalProps&lt;Input, Output&gt;;
function MyDialog(
  { title, description, open, close, reject, resolve }: MyDialogProps
) {
  return (
    &lt;Dialog open={open} onClose={close}&gt;
      &lt;DialogTitle&gt;{title}&lt;/DialogTitle&gt;
      &lt;DialogContent&gt;{description}&lt;/DialogContent&gt;
      &lt;DialogActions&gt;
        &lt;Button onClick={() =&gt; reject("error from dialog")}&gt;Error&lt;/Button&gt;
        &lt;Button onClick={() =&gt; resolve("ok from dialog")}&gt;Ok&lt;/Button&gt;
      &lt;/DialogActions&gt;
    &lt;/Dialog&gt;
  );
}

export default function App() {
  return &lt;ModalProvider&gt;
    &lt;Inner /&gt;
  &lt;/ModalProvider&gt;
}

function Inner() {
  const { show } = useModal();
  const handleClick = async () =&gt; {
    try {
      const result = await show(MyDialog, {
        title: 'タイトル',
        description: "説明",
      });
      alert("success: " + result);
    } catch (e) {
      alert("error: " + e);
    }
  };
  return &lt;Button onClick={handleClick}&gt;Show Dialog&lt;/Button&gt;;
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">より安全な</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>上記のコードでは、resolve引数の推論に引っ張られてpropsが間違えてしまうことがあります。これを解決するために、resolveで引数をやめてみました。以下はresolveで引数を渡さないバージョンです。resolveで渡す代わりにイベント駆動を想定しています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { createContext, useCallback, useContext, useMemo, useState } from "react";

type ModalBase = {
  open: boolean;
  resolve: () =&gt; void;
  reject: (reason?: unknown) =&gt; void;
  close: () =&gt; void;
}

export type ModalProps&lt;P&gt; = P &amp; ModalBase;

type ModalComponent&lt;P&gt; = (props: ModalProps&lt;P&gt;) =&gt; React.ReactNode;

type StackItem = {
  id: number;
  comp: ModalComponent&lt;any&gt;;
  props: any;
  resolve: ModalBase['resolve'];
  reject: ModalBase['reject'];
};

type ShowFn = &lt;P&gt;(comp: ModalComponent&lt;P&gt;, props: Omit&lt;P, keyof ModalBase&gt;) =&gt; Promise&lt;void&gt;;

type ModalContextValue = {
  show: ShowFn;
};

const ModalContext = createContext&lt;ModalContextValue | null&gt;(null);

export function ModalProvider({ children }: { children: React.ReactNode }) {
  const [stack, setStack] = useState&lt;StackItem[]&gt;([]);
  const show = useCallback(&lt;P,&gt;(comp: ModalComponent&lt;P&gt;, props: Omit&lt;P, keyof ModalBase&gt;) =&gt; {
    return new Promise&lt;void&gt;((resolve, reject) =&gt; {
      setStack((s) =&gt; [
        ...s,
        { id: Date.now() + Math.random(), comp, props, resolve, reject },
      ]);
    });
  }, []);

  const value = useMemo&lt;ModalContextValue&gt;(() =&gt; ({ show }), [show]);

  return (
    &lt;ModalContext.Provider value={value}&gt;
      {children}
      {stack.map((item) =&gt; {
        const close = () =&gt;
          setStack((s) =&gt; s.filter((x) =&gt; x.id !== item.id));
        return (
          &lt;item.comp
            key={item.id}
            {...item.props}
            open={true}
            resolve={() =&gt; { item.resolve(); close(); }}
            reject={(r?: unknown) =&gt; { item.reject(r); close(); }}
            close={close}
          /&gt;
        );
      })}
    &lt;/ModalContext.Provider&gt;
  );
}

export function useModal() {
  const ctx = useContext(ModalContext);
  if (!ctx) throw new Error("useModal must be used within ModalProvider");
  return ctx;
}</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2205</wp:post_id>
		<wp:post_date><![CDATA[2025-10-11 08:39:59]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-10-10 23:39:59]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-11 10:22:10]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-11 01:22:10]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91ebay-nice-modal-react%e3%81%ae%e5%9e%8b%e5%bc%b7%e5%8c%96%e7%9a%84%e3%81%aa]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【MUI】ラベル下の空白（ノッチ）を消す]]></title>
		<link>https://www.masaakiota.net/2025/10/13/%e3%80%90mui%e3%80%91%e3%83%a9%e3%83%99%e3%83%ab%e4%b8%8b%e3%81%ae%e7%a9%ba%e7%99%bd%ef%bc%88%e3%83%8e%e3%83%83%e3%83%81%ef%bc%89%e3%82%92%e6%b6%88%e3%81%99/</link>
		<pubDate>Sun, 12 Oct 2025 22:10:27 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2213</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">前提</h2>
<!-- /wp:heading -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>@mui/material: ^7.3.2</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 class="wp-block-heading">MUIのノッチ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>MUIではラベルの下に空白ができることがあります。ラベルが重なっている時にはちょうど合っていて良いのですが、ラベルが重なっていないにも関わらずノッチが発生することもあります。明らかにバグだと思うのですが、いまだに改善されません。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">テーマで一気にノッチを外す</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ノッチはプロパティでnotch=falseにすれば解消されます。Selectの場合は、OutlinedInputに指定します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { createTheme, OutlinedInput } from '@mui/material';
import { appColors, appSizes } from "@localrepo/shared/styleConfigs.ts";


export const theme = createTheme({
  components: {
    MuiTextField: {
      defaultProps: {
        InputProps: {
          notched: false
        }
      },
    },
    MuiOutlinedInput: {
      defaultProps: {
        notched: false,
      },
    },
  }
});</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2213</wp:post_id>
		<wp:post_date><![CDATA[2025-10-13 07:10:27]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-10-12 22:10:27]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-13 07:10:27]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-12 22:10:27]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90mui%e3%80%91%e3%83%a9%e3%83%99%e3%83%ab%e4%b8%8b%e3%81%ae%e7%a9%ba%e7%99%bd%ef%bc%88%e3%83%8e%e3%83%83%e3%83%81%ef%bc%89%e3%82%92%e6%b6%88%e3%81%99]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="mui"><![CDATA[MUI]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[server-2546330_640]]></title>
		<link>https://www.masaakiota.net/2023/03/17/gce%e3%81%ae%e7%84%a1%e6%96%99%e6%9e%a0%e3%81%a7wordpress%e3%82%92%e7%ab%8b%e3%81%a1%e4%b8%8a%e3%81%92%e3%81%a6%e3%81%bf%e3%81%9f/server-2546330_640/</link>
		<pubDate>Thu, 16 Mar 2023 16:37:18 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/03/server-2546330_640.jpg</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>23</wp:post_id>
		<wp:post_date><![CDATA[2023-03-17 01:37:18]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-03-16 16:37:18]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-03-17 01:37:18]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-03-16 16:37:18]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[server-2546330_640]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>5</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/03/server-2546330_640.jpg]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/03/server-2546330_640.jpg]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:640;s:6:"height";i:360;s:4:"file";s:30:"2023/03/server-2546330_640.jpg";s:8:"filesize";i:62737;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:30:"server-2546330_640-300x169.jpg";s:5:"width";i:300;s:6:"height";i:169;s:9:"mime-type";s:10:"image/jpeg";s:8:"filesize";i:11655;}s:9:"thumbnail";a:5:{s:4:"file";s:30:"server-2546330_640-150x150.jpg";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:10:"image/jpeg";s:8:"filesize";i:6030;}s:14:"post-thumbnail";a:5:{s:4:"file";s:30:"server-2546330_640-320x180.jpg";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:10:"image/jpeg";s:8:"filesize";i:12536;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-03-17-3.24.05]]></title>
		<link>https://www.masaakiota.net/2023/03/17/%e3%82%b9%e3%82%af%e3%83%ac%e3%82%a4%e3%83%94%e3%83%b3%e3%82%b0%e4%b8%8d%e5%8f%af%e3%82%b5%e3%82%a4%e3%83%88%e3%81%b8%e3%81%ae%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-03-17-3-24-05/</link>
		<pubDate>Thu, 16 Mar 2023 19:17:33 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/03/スクリーンショット-2023-03-17-3.24.05.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>27</wp:post_id>
		<wp:post_date><![CDATA[2023-03-17 04:17:33]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-03-16 19:17:33]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-03-17 04:17:33]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-03-16 19:17:33]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-03-17-3-24-05]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>25</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/03/スクリーンショット-2023-03-17-3.24.05.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/03/スクリーンショット-2023-03-17-3.24.05.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:748;s:6:"height";i:420;s:4:"file";s:58:"2023/03/スクリーンショット-2023-03-17-3.24.05.png";s:8:"filesize";i:159189;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-03-17-3.24.05-300x168.png";s:5:"width";i:300;s:6:"height";i:168;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:57410;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-03-17-3.24.05-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:28885;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-03-17-3.24.05-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:62192;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-03-17-3.24.46]]></title>
		<link>https://www.masaakiota.net/2023/03/17/%e3%82%b9%e3%82%af%e3%83%ac%e3%82%a4%e3%83%94%e3%83%b3%e3%82%b0%e4%b8%8d%e5%8f%af%e3%82%b5%e3%82%a4%e3%83%88%e3%81%b8%e3%81%ae%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-03-17-3-24-46/</link>
		<pubDate>Thu, 16 Mar 2023 19:17:56 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/03/スクリーンショット-2023-03-17-3.24.46.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>28</wp:post_id>
		<wp:post_date><![CDATA[2023-03-17 04:17:56]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-03-16 19:17:56]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-03-17 04:17:56]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-03-16 19:17:56]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-03-17-3-24-46]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>25</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/03/スクリーンショット-2023-03-17-3.24.46.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/03/スクリーンショット-2023-03-17-3.24.46.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:895;s:6:"height";i:684;s:4:"file";s:58:"2023/03/スクリーンショット-2023-03-17-3.24.46.png";s:8:"filesize";i:191087;s:5:"sizes";a:4:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-03-17-3.24.46-300x229.png";s:5:"width";i:300;s:6:"height";i:229;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:50171;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-03-17-3.24.46-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:24609;}s:12:"medium_large";a:5:{s:4:"file";s:58:"スクリーンショット-2023-03-17-3.24.46-768x587.png";s:5:"width";i:768;s:6:"height";i:587;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:175933;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-03-17-3.24.46-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:45910;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-03-17-4.39.31]]></title>
		<link>https://www.masaakiota.net/2023/03/17/%e3%82%b9%e3%82%af%e3%83%ac%e3%82%a4%e3%83%94%e3%83%b3%e3%82%b0%e4%b8%8d%e5%8f%af%e3%82%b5%e3%82%a4%e3%83%88%e3%81%b8%e3%81%ae%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-03-17-4-39-31/</link>
		<pubDate>Thu, 16 Mar 2023 19:40:38 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/03/スクリーンショット-2023-03-17-4.39.31.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>33</wp:post_id>
		<wp:post_date><![CDATA[2023-03-17 04:40:38]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-03-16 19:40:38]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-03-17 04:40:38]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-03-16 19:40:38]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-03-17-4-39-31]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>25</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/03/スクリーンショット-2023-03-17-4.39.31.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/03/スクリーンショット-2023-03-17-4.39.31.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:504;s:6:"height";i:175;s:4:"file";s:58:"2023/03/スクリーンショット-2023-03-17-4.39.31.png";s:8:"filesize";i:36953;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-03-17-4.39.31-300x104.png";s:5:"width";i:300;s:6:"height";i:104;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:18286;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-03-17-4.39.31-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:11937;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-03-17-4.39.31-320x175.png";s:5:"width";i:320;s:6:"height";i:175;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:19989;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-03-19-3.01.31]]></title>
		<link>https://www.masaakiota.net/2023/03/19/chatgpt%e3%81%a7line%e3%82%aa%e3%82%ab%e3%83%9e%e3%83%90%e3%83%bc%e9%96%8b%e8%a8%ad%e3%81%97%e3%81%be%e3%81%97%e3%81%9f/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-03-19-3-01-31/</link>
		<pubDate>Sat, 18 Mar 2023 18:02:31 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/03/スクリーンショット-2023-03-19-3.01.31.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>51</wp:post_id>
		<wp:post_date><![CDATA[2023-03-19 03:02:31]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-03-18 18:02:31]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-03-19 03:02:31]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-03-18 18:02:31]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-03-19-3-01-31]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>50</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/03/スクリーンショット-2023-03-19-3.01.31.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/03/スクリーンショット-2023-03-19-3.01.31.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:370;s:6:"height";i:486;s:4:"file";s:58:"2023/03/スクリーンショット-2023-03-19-3.01.31.png";s:8:"filesize";i:139257;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-03-19-3.01.31-228x300.png";s:5:"width";i:228;s:6:"height";i:300;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:50654;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-03-19-3.01.31-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:21105;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-03-19-3.01.31-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:44194;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[IIibx]]></title>
		<link>https://www.masaakiota.net/2023/04/14/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88/iiibx/</link>
		<pubDate>Fri, 14 Apr 2023 01:01:50 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/04/IIibx.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>68</wp:post_id>
		<wp:post_date><![CDATA[2023-04-14 10:01:50]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-04-14 01:01:50]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-04-14 10:01:50]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-04-14 01:01:50]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[iiibx]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>67</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/04/IIibx.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/04/IIibx.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:1920;s:6:"height";i:1080;s:4:"file";s:17:"2023/04/IIibx.png";s:8:"filesize";i:203667;s:5:"sizes";a:6:{s:6:"medium";a:5:{s:4:"file";s:17:"IIibx-300x169.png";s:5:"width";i:300;s:6:"height";i:169;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:11583;}s:5:"large";a:5:{s:4:"file";s:18:"IIibx-1024x576.png";s:5:"width";i:1024;s:6:"height";i:576;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:76562;}s:9:"thumbnail";a:5:{s:4:"file";s:17:"IIibx-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:4168;}s:12:"medium_large";a:5:{s:4:"file";s:17:"IIibx-768x432.png";s:5:"width";i:768;s:6:"height";i:432;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:48636;}s:9:"1536x1536";a:5:{s:4:"file";s:18:"IIibx-1536x864.png";s:5:"width";i:1536;s:6:"height";i:864;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:139880;}s:14:"post-thumbnail";a:5:{s:4:"file";s:17:"IIibx-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:12516;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-04-14-9.28.35]]></title>
		<link>https://www.masaakiota.net/2023/04/14/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-28-35/</link>
		<pubDate>Fri, 14 Apr 2023 01:02:53 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.28.35.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>69</wp:post_id>
		<wp:post_date><![CDATA[2023-04-14 10:02:53]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-04-14 01:02:53]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-04-14 10:02:53]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-04-14 01:02:53]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-28-35]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>67</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.28.35.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/04/スクリーンショット-2023-04-14-9.28.35.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:529;s:6:"height";i:396;s:4:"file";s:58:"2023/04/スクリーンショット-2023-04-14-9.28.35.png";s:8:"filesize";i:47949;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.28.35-300x225.png";s:5:"width";i:300;s:6:"height";i:225;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:26263;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.28.35-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:10142;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.28.35-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:23842;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-04-14-9.29.35]]></title>
		<link>https://www.masaakiota.net/2023/04/14/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-29-35/</link>
		<pubDate>Fri, 14 Apr 2023 01:04:11 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.29.35.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>70</wp:post_id>
		<wp:post_date><![CDATA[2023-04-14 10:04:11]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-04-14 01:04:11]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-04-14 10:04:11]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-04-14 01:04:11]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-29-35]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>67</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.29.35.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/04/スクリーンショット-2023-04-14-9.29.35.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:796;s:6:"height";i:640;s:4:"file";s:58:"2023/04/スクリーンショット-2023-04-14-9.29.35.png";s:8:"filesize";i:68264;s:5:"sizes";a:4:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.29.35-300x241.png";s:5:"width";i:300;s:6:"height";i:241;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:19099;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.29.35-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:5939;}s:12:"medium_large";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.29.35-768x617.png";s:5:"width";i:768;s:6:"height";i:617;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:72257;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.29.35-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:13470;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-04-14-9.34.43]]></title>
		<link>https://www.masaakiota.net/2023/04/14/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-34-43/</link>
		<pubDate>Fri, 14 Apr 2023 01:05:23 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.34.43.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>71</wp:post_id>
		<wp:post_date><![CDATA[2023-04-14 10:05:23]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-04-14 01:05:23]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-04-14 10:05:23]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-04-14 01:05:23]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-34-43]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>67</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.34.43.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/04/スクリーンショット-2023-04-14-9.34.43.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:562;s:6:"height";i:563;s:4:"file";s:58:"2023/04/スクリーンショット-2023-04-14-9.34.43.png";s:8:"filesize";i:92730;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.34.43-300x300.png";s:5:"width";i:300;s:6:"height";i:300;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:51211;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.34.43-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:16286;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.34.43-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:45430;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-04-14-9.36.53]]></title>
		<link>https://www.masaakiota.net/2023/04/14/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-36-53/</link>
		<pubDate>Fri, 14 Apr 2023 01:06:16 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.36.53.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>72</wp:post_id>
		<wp:post_date><![CDATA[2023-04-14 10:06:16]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-04-14 01:06:16]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-04-14 10:06:16]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-04-14 01:06:16]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-36-53]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>67</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.36.53.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/04/スクリーンショット-2023-04-14-9.36.53.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:633;s:6:"height";i:923;s:4:"file";s:58:"2023/04/スクリーンショット-2023-04-14-9.36.53.png";s:8:"filesize";i:141567;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.36.53-206x300.png";s:5:"width";i:206;s:6:"height";i:300;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:33037;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.36.53-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:13486;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.36.53-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:28299;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【React】react-dialog-hubを公開しました]]></title>
		<link>https://www.masaakiota.net/2025/10/14/%e3%80%90react%e3%80%91react-dialog-hub%e3%82%92%e5%85%ac%e9%96%8b%e3%81%97%e3%81%be%e3%81%97%e3%81%9f/</link>
		<pubDate>Mon, 13 Oct 2025 16:11:22 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2217</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ReactのDialog事情</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Reactでは通常、ダイアログは都度エレメントを生成する必要があります。それを補うためにフックライブラリがあります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以前@ebay/nice-modal-reactを試しましたが、こちらは関数形で綺麗にかけるものの型が弱く、メンテナンス性に欠ける印象がありました。他にもいくつかダイアログ用のフックライブラリはいくつかあるようですが、ざっと見た感じだと欲しいものがなさそうでした。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">ChatGPT5での型作成爆速化</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>型の生成やチェックなどは、人力だけではなかなか大変です。複雑になると人間の頭ではなかなか追いつけません。その点ChatGPT5は複雑なロジックに割と強い傾向があり、型エラーなどの対応の手助け力が高いです。もちろん、人の介入がないとカオスになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>型安全なライブラリを作るのが楽になった昨今、自前でライブラリを作りました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">react-dialog-hub</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>欲しかったのは以下のものです。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>MUIでも使える</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Radixでも使える</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ダイアログの関数制御</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>型安全</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>react-dialog-hubはこれらの要件を満たしています。シンプルなAPIで、すぐに使えます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://www.npmjs.com/package/react-dialog-hub">https://www.npmjs.com/package/react-dialog-hub</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">他ライブラリとの比較</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>他ライブラリとの比較を、第三者目線で作ってもらいました（ChatGPT5）。下記を参照ください。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://mohhh-ok.github.io/react-dialog-hub/docs/comparison">https://mohhh-ok.github.io/react-dialog-hub/docs/comparison</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2217</wp:post_id>
		<wp:post_date><![CDATA[2025-10-14 01:11:22]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-10-13 16:11:22]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-14 01:11:22]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-13 16:11:22]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91react-dialog-hub%e3%82%92%e5%85%ac%e9%96%8b%e3%81%97%e3%81%be%e3%81%97%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【C2PA】c2patool sampleを試してから色々調査してみた]]></title>
		<link>https://www.masaakiota.net/2025/10/14/%e3%80%90c2pa%e3%80%91c2patool-sample%e3%82%92%e8%a9%a6%e3%81%97%e3%81%a6%e3%81%8b%e3%82%89%e8%89%b2%e3%80%85%e8%aa%bf%e6%9f%bb%e3%81%97%e3%81%a6%e3%81%bf%e3%81%9f/</link>
		<pubDate>Tue, 14 Oct 2025 09:37:42 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2221</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">c2pa</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>c2paはAI時代になくてはならない、ファイルのあらゆる情報を証明するための規格です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">c2paのサンプル</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>公式サンプルを試してみました。まずc2paをインストールします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">brew install c2pa</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">c2patool --version

# c2patool 0.23.4</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>サンプルを入れます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">git clone https://github.com/contentauth/c2patool-service-example.git
cd &lt;path_where_you_cloned_repo&gt;/c2patool-service-example
npm install</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>サンプルのバージョンは下記のようになっています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
  "name": "c2pa_serve",
  "version": "0.1.0",
  ...
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>サンプルは実行ファイルのパスがexeからの相対パスになっているため、brewのc2patoolに修正します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">server.jsにある、./c2patool を c2patool　に置換</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>実行します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">npm start</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>サーバーが立ち上がるので、http://localhost:8000にアクセスして画像をアップロードします。c2paが付与されます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">サンプルの中身</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>サンプルはc2paを生成するようになっています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="javascript" class="language-javascript">let command = `c2patool "${filePath}" -m manifest.json -o "${filePath}" -f`;</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">チェーンのテスト</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>c2paは署名をチェーンする特徴があります。つまり、編集履歴を残すことでルートを辿れるようにしています。それを確認してみます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>まずmanifestをサンプルを参考に２つ用意します。publishedとeditedの用途です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">// manifest.json
{
    "ta_url": "http://timestamp.digicert.com",
    "claim_generator": "CAI_Demo/0.1",
    
    "assertions": [
      {
          "label": "c2pa.actions",
          "data": {
              "actions": [
                  {
                      "action": "c2pa.published"
                  }
              ]
          }
      }
  ]
}</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">// manifest2.json
{
  "ta_url": "http://timestamp.digicert.com",
  "claim_generator": "CAI_Demo/0.1",
  "assertions": [
    {
      "label": "c2pa.actions",
      "data": {
        "actions": [
          {
            "action": "c2pa.edited"
          }
        ]
      }
    }
  ]
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>サンプルと同じ生成コマンドで、manifest.json =&gt; manifest2.jsonの順にapplyします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { exec as execCallback } from 'child_process';
import util from 'util';
const exec = util.promisify(execCallback);

const imageFolder = './images';

async function main() {
  try {
    const origin = `${imageFolder}/test.jpg`;
    const img1 = `${imageFolder}/test-v1.jpg`;
    const img2 = `${imageFolder}/test-v2.jpg`;
    const manifest1 = './manifest.json';
    const manifest2 = './manifest2.json';

    const doExec = async (cmd: string) =&gt; {
      let result = await exec(cmd, { maxBuffer: 10 * 1024 * 1024 });
      if (result.stderr) {
        console.log(`[c2patool stderr] ${result.stderr}`);
      }
      return result;
    }

    const applyManifest = async (src: string, dest: string, manifest: string) =&gt; {
      await doExec(`c2patool "${src}" -m ${manifest} -o "${dest}" -f`);
    }

    const outputInfo = async (img: string) =&gt; {
      await doExec(`c2patool "${img}" &gt; ${img}.json`);
    }

    await applyManifest(origin, img1, manifest1);
    await applyManifest(img1, img2, manifest2);
    await outputInfo(img1);
    await outputInfo(img2);
  } catch (err) {
    console.log(err);
  }
}

main();</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>結果、以下のようになりました。v1にはpublishedが入っており、v2にはpublished,editedの両方が入っています。チェーンが効いていることがわかります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">// test-v1.jpg.json
{
  "active_manifest": "urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660",
  "manifests": {
    "urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660": {
      "claim_generator_info": [
        {
          "name": "c2pa-rs",
          "version": "0.67.1",
          "org.contentauth.c2pa_rs": "0.67.1"
        }
      ],
      "title": "test-v1.jpg",
      "instance_id": "xmp:iid:bb71805c-592e-494e-b5d9-f43826d02c23",
      "thumbnail": {
        "format": "image/jpeg",
        "identifier": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.assertions/c2pa.thumbnail.claim"
      },
      "ingredients": [],
      "assertions": [
        {
          "label": "c2pa.actions.v2",
          "data": {
            "actions": [
              {
                "action": "c2pa.created",
                "digitalSourceType": "http://c2pa.org/digitalsourcetype/empty"
              },
              {
                "action": "c2pa.published"
              }
            ]
          }
        }
      ],
      "signature_info": {
        "alg": "Es256",
        "issuer": "C2PA Test Signing Cert",
        "common_name": "C2PA Signer",
        "cert_serial_number": "640229841392226413189608867977836244731148734950",
        "time": "2025-10-14T08:08:09+00:00"
      },
      "label": "urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660"
    }
  },
  "validation_results": {
    "activeManifest": {
      "success": [
        {
          "code": "timeStamp.validated",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.signature",
          "explanation": "timestamp message digest matched: DigiCert SHA256 RSA4096 Timestamp Responder 2025 1"
        },
        {
          "code": "claimSignature.insideValidity",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.signature",
          "explanation": "claim signature valid"
        },
        {
          "code": "claimSignature.validated",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.signature",
          "explanation": "claim signature valid"
        },
        {
          "code": "assertion.hashedURI.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.assertions/c2pa.thumbnail.claim",
          "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/c2pa.thumbnail.claim"
        },
        {
          "code": "assertion.hashedURI.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.assertions/c2pa.actions.v2",
          "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/c2pa.actions.v2"
        },
        {
          "code": "assertion.hashedURI.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.assertions/c2pa.hash.data",
          "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/c2pa.hash.data"
        },
        {
          "code": "assertion.dataHash.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.assertions/c2pa.hash.data",
          "explanation": "data hash valid"
        }
      ],
      "informational": [
        {
          "code": "timeStamp.untrusted",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.signature",
          "explanation": "timestamp cert untrusted: DigiCert SHA256 RSA4096 Timestamp Responder 2025 1"
        }
      ],
      "failure": []
    }
  },
  "validation_state": "Valid"
}</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">// test-v2.jpg.json
{
  "active_manifest": "urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654",
  "manifests": {
    "urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654": {
      "claim_generator_info": [
        {
          "name": "c2pa-rs",
          "version": "0.67.1",
          "org.contentauth.c2pa_rs": "0.67.1"
        }
      ],
      "title": "test-v2.jpg",
      "instance_id": "xmp:iid:37f5b3c9-8078-4882-bb58-1ad8b9e4cdaa",
      "thumbnail": {
        "format": "image/jpeg",
        "identifier": "self#jumbf=/c2pa/urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654/c2pa.assertions/c2pa.thumbnail.claim"
      },
      "ingredients": [
        {
          "title": "test-v1.jpg",
          "format": "image/jpeg",
          "instance_id": "xmp:iid:67dd2edc-2b98-4655-8cdd-74f847b139f8",
          "thumbnail": {
            "format": "image/jpeg",
            "identifier": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.assertions/c2pa.thumbnail.claim"
          },
          "relationship": "parentOf",
          "active_manifest": "urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660",
          "validation_results": {
            "activeManifest": {
              "success": [
                {
                  "code": "timeStamp.validated",
                  "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.signature",
                  "explanation": "timestamp message digest matched: DigiCert SHA256 RSA4096 Timestamp Responder 2025 1"
                },
                {
                  "code": "claimSignature.insideValidity",
                  "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.signature",
                  "explanation": "claim signature valid"
                },
                {
                  "code": "claimSignature.validated",
                  "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.signature",
                  "explanation": "claim signature valid"
                },
                {
                  "code": "assertion.hashedURI.match",
                  "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.assertions/c2pa.thumbnail.claim",
                  "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/c2pa.thumbnail.claim"
                },
                {
                  "code": "assertion.hashedURI.match",
                  "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.assertions/c2pa.actions.v2",
                  "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/c2pa.actions.v2"
                },
                {
                  "code": "assertion.hashedURI.match",
                  "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.assertions/c2pa.hash.data",
                  "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/c2pa.hash.data"
                },
                {
                  "code": "assertion.dataHash.match",
                  "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.assertions/c2pa.hash.data",
                  "explanation": "data hash valid"
                }
              ],
              "informational": [
                {
                  "code": "timeStamp.untrusted",
                  "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.signature",
                  "explanation": "timestamp cert untrusted: DigiCert SHA256 RSA4096 Timestamp Responder 2025 1"
                }
              ],
              "failure": []
            }
          },
          "label": "c2pa.ingredient.v3"
        }
      ],
      "assertions": [
        {
          "label": "c2pa.actions.v2",
          "data": {
            "actions": [
              {
                "action": "c2pa.opened",
                "parameters": {
                  "ingredients": [
                    {
                      "url": "self#jumbf=c2pa.assertions/c2pa.ingredient.v3",
                      "hash": "5rI2JbVrFd0VCBAI03j8Vy7pg5TTbhKlBeefSt2Vs1w="
                    }
                  ]
                }
              },
              {
                "action": "c2pa.edited"
              }
            ]
          }
        }
      ],
      "signature_info": {
        "alg": "Es256",
        "issuer": "C2PA Test Signing Cert",
        "common_name": "C2PA Signer",
        "cert_serial_number": "640229841392226413189608867977836244731148734950",
        "time": "2025-10-14T08:08:09+00:00"
      },
      "label": "urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654"
    },
    "urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660": {
      "claim_generator_info": [
        {
          "name": "c2pa-rs",
          "version": "0.67.1",
          "org.contentauth.c2pa_rs": "0.67.1"
        }
      ],
      "title": "test-v1.jpg",
      "instance_id": "xmp:iid:bb71805c-592e-494e-b5d9-f43826d02c23",
      "thumbnail": {
        "format": "image/jpeg",
        "identifier": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660/c2pa.assertions/c2pa.thumbnail.claim"
      },
      "ingredients": [],
      "assertions": [
        {
          "label": "c2pa.actions.v2",
          "data": {
            "actions": [
              {
                "action": "c2pa.created",
                "digitalSourceType": "http://c2pa.org/digitalsourcetype/empty"
              },
              {
                "action": "c2pa.published"
              }
            ]
          }
        }
      ],
      "signature_info": {
        "alg": "Es256",
        "issuer": "C2PA Test Signing Cert",
        "common_name": "C2PA Signer",
        "cert_serial_number": "640229841392226413189608867977836244731148734950",
        "time": "2025-10-14T08:08:09+00:00"
      },
      "label": "urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660"
    }
  },
  "validation_results": {
    "activeManifest": {
      "success": [
        {
          "code": "timeStamp.validated",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654/c2pa.signature",
          "explanation": "timestamp message digest matched: DigiCert SHA256 RSA4096 Timestamp Responder 2025 1"
        },
        {
          "code": "claimSignature.insideValidity",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654/c2pa.signature",
          "explanation": "claim signature valid"
        },
        {
          "code": "claimSignature.validated",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654/c2pa.signature",
          "explanation": "claim signature valid"
        },
        {
          "code": "assertion.hashedURI.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654/c2pa.assertions/c2pa.thumbnail.claim",
          "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/c2pa.thumbnail.claim"
        },
        {
          "code": "assertion.hashedURI.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654/c2pa.assertions/c2pa.ingredient.v3",
          "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/c2pa.ingredient.v3"
        },
        {
          "code": "assertion.hashedURI.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654/c2pa.assertions/c2pa.actions.v2",
          "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/c2pa.actions.v2"
        },
        {
          "code": "assertion.hashedURI.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654/c2pa.assertions/c2pa.hash.data",
          "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/c2pa.hash.data"
        },
        {
          "code": "assertion.dataHash.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654/c2pa.assertions/c2pa.hash.data",
          "explanation": "data hash valid"
        }
      ],
      "informational": [
        {
          "code": "timeStamp.untrusted",
          "url": "self#jumbf=/c2pa/urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654/c2pa.signature",
          "explanation": "timestamp cert untrusted: DigiCert SHA256 RSA4096 Timestamp Responder 2025 1"
        }
      ],
      "failure": []
    },
    "ingredientDeltas": [
      {
        "ingredientAssertionURI": "self#jumbf=/c2pa/urn:c2pa:b6efdb44-ffad-4bf8-b9c5-897d1e397654/c2pa.assertions/c2pa.ingredient.v3",
        "validationDeltas": {
          "success": [
            {
              "code": "ingredient.manifest.validated",
              "url": "self#jumbf=/c2pa/urn:c2pa:b6dfedd9-f3cc-48ee-ac28-55bc7fb3d660",
              "explanation": "ingredient hash matched"
            }
          ],
          "informational": [],
          "failure": []
        }
      }
    ]
  },
  "validation_state": "Valid"
}</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">タイムスタンプ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>c2paでは以下のように言及されています。</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:paragraph -->
<p>The C2PA specification strongly recommends that a manifest signature contains a trusted time-stamp proving that the signature actually existed at a certain date. Specifically, it recommends using a Time-Stamp Authority (TSA) that complies with&nbsp;<a href="https://datatracker.ietf.org/doc/html/rfc3161" target="_blank" rel="noreferrer noopener">Internet X.509 Public Key Infrastructure Time-Stamp Protocol (RFC 3161)</a>&nbsp;standard.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://opensource.contentauthenticity.org/docs/manifest/understanding-manifest">https://opensource.contentauthenticity.org/docs/manifest/understanding-manifest</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph --></blockquote>
<!-- /wp:quote -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:paragraph -->
<p>The time-stamp is typically defined as part of the signing information. You can set this by using C2PA Tool in the&nbsp;<code>ta_url</code>&nbsp;field or by using the SDK. The time-stamp then appears in the&nbsp;<code>SignatureInfo</code>&nbsp;JSON object when reading the manifest store.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://opensource.contentauthenticity.org/docs/manifest/understanding-manifest">https://opensource.contentauthenticity.org/docs/manifest/understanding-manifest</a></p>
<!-- /wp:paragraph --></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>信頼できるタイムスタンプを含めるようにとのことです。それにはta_urlと一緒にc2patoolを使えと。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>manifestにはta_urlが含まれています。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">"ta_url": "http://timestamp.digicert.com",</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これにより、c2patoolを使用した時点で自動で生成されるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>試しに先ほどのコードをapplyManifestだけにして、Charlesで確認してみました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">HTTP_PROXY=http://127.0.0.1:8888 \
http_proxy=http://127.0.0.1:8888 \
HTTPS_PROXY=http://127.0.0.1:8888 \
https_proxy=http://127.0.0.1:8888 \
ALL_PROXY=http://127.0.0.1:8888 \
all_proxy=http://127.0.0.1:8888 \
NO_PROXY=localhost,127.0.0.1 \
no_proxy=localhost,127.0.0.1 \
tsx test.ts</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>Charlesで、timestamp.digicert.com:80へのアクセスが確認できました。c2patoolsによる署名実行時に、タイムスタンプサーバーへのアクセスも発生していることから、確かな署名プロセスが走っているようです。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">署名</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>使える署名は下記のタイプです</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:paragraph -->
<p>The C2PA specification requires that an "end entity" signing certificate must be either:</p>
<!-- /wp:paragraph -->

<!-- wp:list {"className":""} -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>An S/MIME email certificate (<code>id-kp-emailProtection</code>&nbsp;EKU). This is usually the simplest and least expensive option.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>A document signing certificate (<code>id-kp-documentSigning</code>&nbsp;EKU). Obtaining these kinds of certificates typically have more stringent requirements (like proving your identity) and costs more.</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>For more details, see&nbsp;<a href="https://opensource.contentauthenticity.org/docs/signing/get-cert#certificate-requirements">Certificate requirements</a>&nbsp;below.</p>
<!-- /wp:paragraph --></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p>2025年の間はどのCAで取得してもC2PAに申請すれば良いようです。しかし2026年以降は、C2PAが指定したCAで取得する必要があるとのこと。今現在は下記のCAが参考として挙げられていますが、これが2026年以降のトラストリストになる確証はありません。</p>
<!-- /wp:paragraph -->

<!-- wp:quote -->
<blockquote class="wp-block-quote"><!-- wp:paragraph -->
<p>You must purchase a signing certificate from a certificate authority (CA). The following table provides some links to popular CAs for convenience. This information is for reference only; inclusion does not imply endorsement by CAI or Adobe, Inc.</p>
<!-- /wp:paragraph -->

<!-- wp:table -->
<figure class="wp-block-table"><table class="has-fixed-layout"><thead><tr><th>CA</th><th>S/MIME email signing</th><th>Document signing</th></tr></thead><tbody><tr><td>Digicert</td><td><a href="https://www.digicert.com/tls-ssl/secure-email-smime-certificates" target="_blank" rel="noreferrer noopener">S/MIME email signing</a></td><td><a href="https://www.digicert.com/signing/document-signing-certificates" target="_blank" rel="noreferrer noopener">Document signing</a></td></tr><tr><td>GlobalSign</td><td><a href="https://shop.globalsign.com/en/secure-email" target="_blank" rel="noreferrer noopener">S/MIME email signing</a></td><td><a href="https://shop.globalsign.com/en/document-signing" target="_blank" rel="noreferrer noopener">Document signing</a></td></tr><tr><td>IdenTrust</td><td><a href="https://www.identrust.com/digital-certificates/secure-email-smime" target="_blank" rel="noreferrer noopener">S/MIME email signing</a></td><td><a href="https://www.identrust.com/digital-certificates/document-signing" target="_blank" rel="noreferrer noopener">Document signing</a></td></tr><tr><td>Sectigo</td><td><a href="https://ssl.comodoca.com/s-mime" target="_blank" rel="noreferrer noopener">S/MIME email signing</a></td><td><a href="https://ssl.comodoca.com/document-signing-certificates" target="_blank" rel="noreferrer noopener">Document signing</a></td></tr><tr><td>SSL.com</td><td><a href="https://www.ssl.com/certificates/s-mime-certificates/" target="_blank" rel="noreferrer noopener">S/MIME email signing</a></td><td><a href="https://www.ssl.com/certificates/document-signing-certificates/" target="_blank" rel="noreferrer noopener">Document signing</a></td></tr></tbody></table></figure>
<!-- /wp:table --></blockquote>
<!-- /wp:quote -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2221</wp:post_id>
		<wp:post_date><![CDATA[2025-10-14 18:37:42]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-10-14 09:37:42]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-14 18:52:22]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-14 09:52:22]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90c2pa%e3%80%91c2patool-sample%e3%82%92%e8%a9%a6%e3%81%97%e3%81%a6%e3%81%8b%e3%82%89%e8%89%b2%e3%80%85%e8%aa%bf%e6%9f%bb%e3%81%97%e3%81%a6%e3%81%bf%e3%81%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="c2pa"><![CDATA[C2PA]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【C2PA】ffmpegで変換して署名する]]></title>
		<link>https://www.masaakiota.net/2025/10/14/%e3%80%90c2pa%e3%80%91%e7%8b%ac%e8%87%aa%e5%87%a6%e7%90%86%e5%be%8c%e3%81%ab%e7%bd%b2%e5%90%8d%e3%81%99%e3%82%8b/</link>
		<pubDate>Tue, 14 Oct 2025 14:54:49 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2237</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">C2PAに署名</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>C2PAは、c2patoolを使用して簡単に署名を行うことができます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>詳細はこちらに書かれています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/contentauth/c2pa-rs/blob/main/cli/docs/usage.md">https://github.com/contentauth/c2pa-rs/blob/main/cli/docs/usage.md</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ひとまず署名するだけなら以下でいけます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">c2patool sample/image.jpg -m sample/test.json -o signed_image.jpg</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>もし既存のmanifestが存在していれば、それに追記する形で署名してくれます。それによりルートを辿ることが可能となり、ファイルの信頼性が担保されます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">変換してから署名するには</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>一方ファイルに変更を加えると、ツールによってはC2PA情報が消えます。2025年10月14日時点でほとんどのツールが、C2PA未対応です。たとえばffmpegを使用すると、未知のメタデータとして破棄されるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>このため変換してから署名を行うには一手間必要となります。以下のような流れとなります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>ファイルから既存のC2PAをingredientとして抽出</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>任意の変換処理</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ingredientを使用して署名</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>下記ではそのプロセスを記します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>まず環境構築します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">mkdir c2pa-test
cd c2pa-test
brew install c2patool
pnpm i execa
pnpm i -D @types/node tsx</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>manifest.jsonを用意します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
  "ta_url": "http://timestamp.digicert.com",
  "claim_generator": "MyTestSigner/0.1",
  "assertions": [
    {
      "label": "c2pa.actions",
      "data": {
        "actions": [
          {
            "action": "c2pa.edited",
            "parameters": {
              "test": true,
              "description": "新規追加（テスト用途）"
            }
          }
        ]
      }
    },
    {
      "label": "org.example.testing",
      "data": {
        "is_test": true,
        "note": "この署名はテスト目的で付与されました"
      }
    }
  ]
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>claim_generatorにMyTestSigner/0.1といった独自の値を入れていますが、これはc2patoolによって上書きされるため意味はありません。しかしdescriptionやnoteはそのまま文字列が入ります。そのため、実際にこのマニフェストが適用されることが確認できるようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>C2PA素材をダウンロードします。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://spec.c2pa.org/public-testfiles/video">https://spec.c2pa.org/public-testfiles/video</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回はtruepic-20230212-zoetrope.mp4を使用しました。./assetsディレクトリに保存します。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下コードです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// c2pa-test.ts
import { execa } from 'execa';
import { mkdtempSync } from 'fs';
import { rm } from 'fs/promises';
import os from 'os';
import path from 'path';

const INPUT_FILE = './assets/truepic-20230212-zoetrope.mp4'
const SIGNED_FILE = `${INPUT_FILE}_signed${path.extname(INPUT_FILE)}`
const REPORT_DIR = `report`
const MANIFEST_FILE = './manifest.json'

async function main() {
  await signWithTransform({
    input: INPUT_FILE,
    manifestPath: MANIFEST_FILE,
    output: SIGNED_FILE,
    transform: async ({ input, destination }) => {
      // ffmpeg を使って解像度を半分にスケールする
      console.log(`Transcoding (half size) ${input} -> ${destination}`)
      await execa('ffmpeg', [
        '-y',
        '-hide_banner',
        '-loglevel', 'error',
        '-i', input,
        '-vf', 'scale=iw/2:ih/2',
        '-c:v', 'libx264',
        '-preset', 'veryfast',
        '-crf', '23',
        '-c:a', 'copy',
        destination,
      ])
    }
  })

  // 確認用に署名後のファイルを出力
  console.log(`Reporting -> ${REPORT_DIR}`)
  await execa(`c2patool`, [SIGNED_FILE, '-f', '--output', REPORT_DIR])
}

main();



// 変換（トランスフォーム）込みで署名するプロセス
async function signWithTransform(params: {
  input: string,
  manifestPath: string,
  output: string,
  transform: (params: { input: string, destination: string }) => Promise&lt;void>
}) {
  const { input, manifestPath, output, transform } = params

  // 一時ディレクトリを作成して処理を行う
  await withTmpDir(async (tmpDir) => {

    // ingredientを抽出
    const ingredientDir = path.join(tmpDir, 'ingredient')
    await extractIngredient({
      input,
      ingredientDir
    })

    const transformedPath = path.join(tmpDir, 'transformed')

    // 変換処理を行う
    await transform({ input, destination: transformedPath });

    // ingredientを使用して署名を行う
    await signFile({
      input: transformedPath,
      output,
      manifestPath,
      ingredientDir
    })
  });
}

// 既存のmanifestをingredientとして抽出
async function extractIngredient(params: { input: string, ingredientDir: string }) {
  const { input, ingredientDir } = params
  console.log(`Extracting ingredient from ${input} -> ${ingredientDir}`)
  await execa(`c2patool`, [input, '--ingredient', '--output', ingredientDir])
}

// ingredientを使用して署名
async function signFile(params: { input: string, output: string, manifestPath: string, ingredientDir: string }) {
  const { input, output, manifestPath, ingredientDir } = params
  console.log(`Signing ${input} with manifest ${manifestPath} and ingredient ${ingredientDir} to ${output}`)
  await execa(`c2patool`, [input, '-m', manifestPath, '-p', ingredientDir, '-f', '-d', '-o', output])
}


// 一時ディレクトリを作成して処理を行うユーティリティ
async function withTmpDir&lt;T = unknown>(fn: (tmpDir: string) => Promise&lt;T>): Promise&lt;T> {
  const tmpDir = mkdtempSync(path.join(os.tmpdir(), 'c2patool-sign-with-transform-'))
  try {
    return await fn(tmpDir)
  } catch (e) {
    throw e
  } finally {
    await rm(tmpDir, { recursive: true, force: true })
  }
}
</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これを実行します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">tsx c2pa-test.ts</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>transorm, signedそれぞれのファイルと、reportディレクトリが生成されます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>reportディレクトリを確認してみます。manifest.jsonとmanifest_store.jsonが生成されました。このうちmanifest.jsonは人が読む用、manifest_store.jsonは機械が読む用だとのことです。しかし今回は同じような出力になりました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>manifest.jsonを確認すると、ちゃんとテスト用で流し込んだmanifestの情報が入っていることが確認できます。またValidステータスもtrueとなっていることから、成功です。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">// manifest.json
{
  "active_manifest": "urn:c2pa:4d988781-35f4-4142-bfd5-869b5071bf16",
  "manifests": {
    "urn:c2pa:4d988781-35f4-4142-bfd5-869b5071bf16": {
      "claim_generator_info": [
        {
          "name": "c2pa-rs",
          "version": "0.67.1",
          "org.contentauth.c2pa_rs": "0.67.1"
        }
      ],
      "title": "truepic-20230212-zoetrope.mp4_signed.mp4",
      "instance_id": "xmp:iid:1fe6cb90-7992-4006-bed6-fd6a2d2dd325",
      "ingredients": [
        {
          "title": "truepic-20230212-zoetrope.mp4",
          "format": "video/mp4",
          "instance_id": "xmp:iid:5bb5af77-ee4c-44d8-8c0b-20c6b604d774",
          "relationship": "parentOf",
          "active_manifest": "com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794",
          "validation_results": {
            "activeManifest": {
              "success": [
                {
                  "code": "timeStamp.validated",
                  "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.signature",
                  "explanation": "timestamp message digest matched: Truepic Lens Time-Stamping Authority"
                },
                {
                  "code": "claimSignature.insideValidity",
                  "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.signature",
                  "explanation": "claim signature valid"
                },
                {
                  "code": "claimSignature.validated",
                  "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.signature",
                  "explanation": "claim signature valid"
                },
                {
                  "code": "assertion.hashedURI.match",
                  "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/com.truepic.libc2pa",
                  "explanation": "hashed uri matched: self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/com.truepic.libc2pa"
                },
                {
                  "code": "assertion.hashedURI.match",
                  "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/stds.exif",
                  "explanation": "hashed uri matched: self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/stds.exif"
                },
                {
                  "code": "assertion.hashedURI.match",
                  "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/stds.exif__1",
                  "explanation": "hashed uri matched: self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/stds.exif__1"
                },
                {
                  "code": "assertion.hashedURI.match",
                  "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/stds.exif__2",
                  "explanation": "hashed uri matched: self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/stds.exif__2"
                },
                {
                  "code": "assertion.hashedURI.match",
                  "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/com.truepic.custom.odometry",
                  "explanation": "hashed uri matched: self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/com.truepic.custom.odometry"
                },
                {
                  "code": "assertion.hashedURI.match",
                  "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/c2pa.hash.bmff.v2",
                  "explanation": "hashed uri matched: self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/c2pa.hash.bmff.v2"
                },
                {
                  "code": "assertion.hashedURI.match",
                  "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/stds.exif__3",
                  "explanation": "hashed uri matched: self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/stds.exif__3"
                },
                {
                  "code": "assertion.bmffHash.match",
                  "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.assertions/c2pa.hash.bmff.v2",
                  "explanation": "data hash valid"
                }
              ],
              "informational": [
                {
                  "code": "timeStamp.untrusted",
                  "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.signature",
                  "explanation": "timestamp cert untrusted: Truepic Lens Time-Stamping Authority"
                }
              ],
              "failure": [
                {
                  "code": "signingCredential.expired",
                  "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794/c2pa.signature",
                  "explanation": "certificate expired"
                }
              ]
            }
          },
          "label": "c2pa.ingredient.v3"
        }
      ],
      "assertions": [
        {
          "label": "c2pa.actions.v2",
          "data": {
            "actions": [
              {
                "action": "c2pa.opened",
                "parameters": {
                  "ingredients": [
                    {
                      "url": "self#jumbf=c2pa.assertions/c2pa.ingredient.v3",
                      "hash": "UBXZ8VsuwAIgT8c53x0NM8Bio1fFFGYWc+q2RTrSpIg="
                    }
                  ]
                }
              },
              {
                "action": "c2pa.edited",
                "parameters": {
                  "description": "新規追加（テスト用途）",
                  "test": true
                }
              }
            ]
          }
        },
        {
          "label": "c2pa.hash.bmff.v3",
          "data": {
            "exclusions": [
              {
                "xpath": "/uuid",
                "length": null,
                "data": [
                  {
                    "offset": 8,
                    "value": "2P7D1hsOSDySl1goh37EgQ=="
                  }
                ],
                "subset": null,
                "version": null,
                "flags": null,
                "exact": null
              },
              {
                "xpath": "/ftyp",
                "length": null,
                "data": null,
                "subset": null,
                "version": null,
                "flags": null,
                "exact": null
              },
              {
                "xpath": "/mfra",
                "length": null,
                "data": null,
                "subset": null,
                "version": null,
                "flags": null,
                "exact": null
              }
            ],
            "alg": "sha256",
            "hash": "+bLZaoW/IF/FXjgTFNiEHUEKRMT503JRqTvmjyHYpRw=",
            "name": "jumbf manifest"
          }
        },
        {
          "label": "org.example.testing",
          "data": {
            "note": "この署名はテスト目的で付与されました",
            "is_test": true
          }
        }
      ],
      "signature_info": {
        "alg": "Es256",
        "issuer": "C2PA Test Signing Cert",
        "common_name": "C2PA Signer",
        "cert_serial_number": "640229841392226413189608867977836244731148734950",
        "time": "2025-10-14T14:20:14+00:00"
      },
      "label": "urn:c2pa:4d988781-35f4-4142-bfd5-869b5071bf16"
    },
    "com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794": {
      "claim_generator": "Truepic_Lens_SDK_libc2pa/2.5.1",
      "claim_generator_info": [
        {
          "name": "Truepic Lens SDK libc2pa C++ Library",
          "version": "2.5.1"
        }
      ],
      "title": "f5ba0ad3-7e5f-4f67-b909-ea6ff1cd5536.mp4",
      "format": "video/mp4",
      "instance_id": "f5ba0ad3-7e5f-4f67-b909-ea6ff1cd5536",
      "ingredients": [],
      "assertions": [
        {
          "label": "com.truepic.libc2pa",
          "data": {
            "git_hash": "023bb51",
            "lib_name": "Truepic C2PA C++ Library",
            "lib_version": "2.5.1",
            "target_spec_version": "1.2"
          }
        },
        {
          "label": "stds.exif",
          "data": {
            "@context": {
              "EXIF": "http://ns.adobe.com/EXIF/1.0/",
              "EXIFEX": "http://cipa.jp/EXIF/2.32/",
              "dc": "http://purl.org/dc/elements/1.1/",
              "rdf": "http://www.w3.org/1999/02/22-rdf-syntax-ns#",
              "tiff": "http://ns.adobe.com/tiff/1.0/",
              "xmp": "http://ns.adobe.com/xap/1.0/"
            },
            "EXIF:GPSAltitude": "123.5",
            "EXIF:GPSHorizontalAccuracy": "12.2",
            "EXIF:GPSLatitude": "43.152072200000",
            "EXIF:GPSLongitude": "-77.580530000000",
            "EXIF:GPSTimeStamp": "2023-02-12T18:40:14Z"
          },
          "kind": "Json"
        },
        {
          "label": "stds.exif__1",
          "data": {
            "@context": {
              "EXIF": "http://ns.adobe.com/EXIF/1.0/",
              "EXIFEX": "http://cipa.jp/EXIF/2.32/",
              "dc": "http://purl.org/dc/elements/1.1/",
              "rdf": "http://www.w3.org/1999/02/22-rdf-syntax-ns#",
              "tiff": "http://ns.adobe.com/tiff/1.0/",
              "xmp": "http://ns.adobe.com/xap/1.0/"
            },
            "EXIF:Make": "Google",
            "EXIF:Model": "Pixel 5"
          },
          "instance": 1,
          "kind": "Json"
        },
        {
          "label": "stds.exif__2",
          "data": {
            "@context": {
              "EXIF": "http://ns.adobe.com/EXIF/1.0/",
              "EXIFEX": "http://cipa.jp/EXIF/2.32/",
              "dc": "http://purl.org/dc/elements/1.1/",
              "rdf": "http://www.w3.org/1999/02/22-rdf-syntax-ns#",
              "tiff": "http://ns.adobe.com/tiff/1.0/",
              "xmp": "http://ns.adobe.com/xap/1.0/"
            },
            "EXIF:DateTimeOriginal": "2023-02-12T18:40:18Z"
          },
          "instance": 2,
          "kind": "Json"
        },
        {
          "label": "com.truepic.custom.odometry",
          "data": {
            "attitude": [
              {
                "azimuth": -1.2673875,
                "pitch": 0.0050304295,
                "roll": -1.3032154,
                "timestamp": "2023-02-12T18:40:19Z"
              }
            ],
            "geomagnetism": [
              {
                "timestamp": "2023-02-12T18:40:19Z",
                "x": -40.9875,
                "y": 12.375,
                "z": -51.3375
              }
            ],
            "gravity": [
              {
                "timestamp": "2023-02-12T18:40:19Z",
                "x": 9.4504795,
                "y": -0.07717214,
                "z": 2.630324
              }
            ],
            "lens": "Back",
            "pressure": [
              {
                "timestamp": "2023-02-12T18:40:19Z",
                "value": 995.23145
              }
            ],
            "rotation_rate": [
              {
                "timestamp": "2023-02-12T18:40:19Z",
                "x": -0.014202199,
                "y": -0.02519745,
                "z": 0.01175881
              }
            ],
            "user_acceleration": [
              {
                "timestamp": "2023-02-12T18:40:19Z",
                "x": 9.633504,
                "y": -0.050249275,
                "z": 2.641078
              }
            ]
          }
        },
        {
          "label": "c2pa.hash.bmff.v2",
          "data": {
            "alg": "sha256",
            "exclusions": [
              {
                "data": [
                  {
                    "offset": 8,
                    "value": "2P7D1hsOSDySl1goh37EgQ=="
                  }
                ],
                "xpath": "/uuid"
              },
              {
                "xpath": "/ftyp"
              },
              {
                "xpath": "/mfra"
              }
            ],
            "hash": "nEzS9vlbVhdhYr8FO8gtNdLvKPaPz0iAaDj4y6Q5pV0=",
            "name": "JUMBF manifest"
          }
        },
        {
          "label": "stds.exif__3",
          "data": {
            "@context": {
              "EXIF": "http://ns.adobe.com/EXIF/1.0/",
              "EXIFEX": "http://cipa.jp/EXIF/2.32/",
              "dc": "http://purl.org/dc/elements/1.1/",
              "rdf": "http://www.w3.org/1999/02/22-rdf-syntax-ns#",
              "tiff": "http://ns.adobe.com/tiff/1.0/",
              "xmp": "http://ns.adobe.com/xap/1.0/"
            },
            "QuickTime:Duration": "7.4085"
          },
          "instance": 3,
          "kind": "Json"
        }
      ],
      "signature_info": {
        "alg": "Es256",
        "issuer": "Truepic",
        "common_name": "Truepic Lens SDK v1.1.3 in Vision Camera v3.1.5",
        "cert_serial_number": "638965998870479504364222036280408796540361537597",
        "time": "2023-02-12T18:40:19+00:00"
      },
      "label": "com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794"
    }
  },
  "validation_results": {
    "activeManifest": {
      "success": [
        {
          "code": "timeStamp.validated",
          "url": "self#jumbf=/c2pa/urn:c2pa:4d988781-35f4-4142-bfd5-869b5071bf16/c2pa.signature",
          "explanation": "timestamp message digest matched: DigiCert SHA256 RSA4096 Timestamp Responder 2025 1"
        },
        {
          "code": "claimSignature.insideValidity",
          "url": "self#jumbf=/c2pa/urn:c2pa:4d988781-35f4-4142-bfd5-869b5071bf16/c2pa.signature",
          "explanation": "claim signature valid"
        },
        {
          "code": "claimSignature.validated",
          "url": "self#jumbf=/c2pa/urn:c2pa:4d988781-35f4-4142-bfd5-869b5071bf16/c2pa.signature",
          "explanation": "claim signature valid"
        },
        {
          "code": "assertion.hashedURI.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:4d988781-35f4-4142-bfd5-869b5071bf16/c2pa.assertions/c2pa.ingredient.v3",
          "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/c2pa.ingredient.v3"
        },
        {
          "code": "assertion.hashedURI.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:4d988781-35f4-4142-bfd5-869b5071bf16/c2pa.assertions/c2pa.actions.v2",
          "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/c2pa.actions.v2"
        },
        {
          "code": "assertion.hashedURI.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:4d988781-35f4-4142-bfd5-869b5071bf16/c2pa.assertions/c2pa.hash.bmff.v3",
          "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/c2pa.hash.bmff.v3"
        },
        {
          "code": "assertion.hashedURI.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:4d988781-35f4-4142-bfd5-869b5071bf16/c2pa.assertions/org.example.testing",
          "explanation": "hashed uri matched: self#jumbf=c2pa.assertions/org.example.testing"
        },
        {
          "code": "assertion.bmffHash.match",
          "url": "self#jumbf=/c2pa/urn:c2pa:4d988781-35f4-4142-bfd5-869b5071bf16/c2pa.assertions/c2pa.hash.bmff.v3",
          "explanation": "data hash valid"
        }
      ],
      "informational": [
        {
          "code": "timeStamp.untrusted",
          "url": "self#jumbf=/c2pa/urn:c2pa:4d988781-35f4-4142-bfd5-869b5071bf16/c2pa.signature",
          "explanation": "timestamp cert untrusted: DigiCert SHA256 RSA4096 Timestamp Responder 2025 1"
        }
      ],
      "failure": []
    },
    "ingredientDeltas": [
      {
        "ingredientAssertionURI": "self#jumbf=/c2pa/urn:c2pa:4d988781-35f4-4142-bfd5-869b5071bf16/c2pa.assertions/c2pa.ingredient.v3",
        "validationDeltas": {
          "success": [
            {
              "code": "ingredient.manifest.validated",
              "url": "self#jumbf=/c2pa/com.truepic:urn:uuid:74b6ec09-7311-4a30-be60-76136a169794",
              "explanation": "ingredient hash matched"
            }
          ],
          "informational": [],
          "failure": []
        }
      }
    ]
  },
  "validation_state": "Valid"
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2237</wp:post_id>
		<wp:post_date><![CDATA[2025-10-14 23:54:49]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-10-14 14:54:49]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-15 20:10:39]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-15 11:10:39]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90c2pa%e3%80%91%e7%8b%ac%e8%87%aa%e5%87%a6%e7%90%86%e5%be%8c%e3%81%ab%e7%bd%b2%e5%90%8d%e3%81%99%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="c2pa"><![CDATA[C2PA]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【開発】インフラ・バック・フロントを分かりやすく例えてみた]]></title>
		<link>https://www.masaakiota.net/2025/10/16/%e3%80%90%e9%96%8b%e7%99%ba%e3%80%91%e3%82%a4%e3%83%b3%e3%83%95%e3%83%a9%e3%83%bb%e3%83%90%e3%83%83%e3%82%af%e3%83%bb%e3%83%95%e3%83%ad%e3%83%b3%e3%83%88%e3%82%92%e5%88%86%e3%81%8b%e3%82%8a%e3%82%84/</link>
		<pubDate>Wed, 15 Oct 2025 18:28:55 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2246</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">システム構築の役割分担</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>システム構築は、概ね以下の３つに分類されます。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>インフラ（サーバー系）</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>バック（API系）</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>フロント（UI系）</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>本当はさらにインフラの前段階があったり、プロジェクト統括役がいたりなど挙げればキリがありませんが、一般的なシステム構築案件に携わる主要役割はこの３つの層かと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今回はこれを、例えてみます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">音楽バンドで例えてみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>音楽バンドで例えると、以下のようになります。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>音響</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>インスト</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ボーカル</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>最もリスナーに近いのがボーカルで、ほとんどの人の印象に残る部分です。それを支えるのがインストですね。さらに欠かせないのが音響システムの構築とオペレーションとなります。はい。これ以外にブッキング担当やライブハウス運営などがいたりします。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">飲食店で例えてみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>次に飲食店で例えてみます。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>什器設置・メンテナンス</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>キッチン</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ホール</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>ホールは店の顔とも言えますが、有名シェフがいたりするとキッチンが顔になったりもするかと思います。最近はオープンキッチンなどもありますね。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以前APIとフロントの説明にこの飲食店での例えを使ったことがあります。お客さんから注文を受けたホールがキッチンに伝え、出来上がった料理をお客さんに提供するという流れは、APIとフロントの役割とよく合致しています。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">もっと例えてみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>私の経験では上記２つが限界でしたので、以下はChatGPTに書いてもらいました。私の経験外でもあるので、そのまま載せます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">🎬 映画制作で例える

インフラ（サーバー系）：撮影機材・照明・スタジオ設備

バック（API系）：撮影・編集チーム（カメラマン、エディター）

フロント（UI系）：俳優・ナレーション・映像演出

最終的に観客が目にするのは俳優（フロント）ですが、映像の繋ぎや効果音（バック）がなければ作品は成立せず、それらを支えるスタジオ環境（インフラ）が不可欠です。


🏗 建築で例える

インフラ（サーバー系）：地盤・基礎工事・配管・電気系統

バック（API系）：設計・構造設計・内部機構（空調・配線）

フロント（UI系）：内装・外観デザイン・インテリア

家を見に来た人は内装（UI）ばかり注目しますが、見えない部分（API・インフラ）が最もトラブルを防ぐ要です。


🚗 自動車で例える

インフラ：シャーシ・電装・エンジンマウント

バック：エンジン制御・ブレーキ制御・通信系ECU

フロント：操作系・ダッシュボード・外観デザイン

ドライバーが直接触れるのはUI（ハンドル・メーター類）ですが、その挙動を制御するバック（ECU）と、それを安定稼働させるインフラ（電源・構造体）が三位一体で動いています。


🧩 教育現場で例える

インフラ：校舎・ネット環境・教材の準備

バック：授業設計・カリキュラム・テスト作成

フロント：先生による授業・生徒とのやりとり

生徒が「よい授業だ」と感じるのは先生の話（フロント）ですが、それを支える教材設計（バック）と環境整備（インフラ）がなければ成立しません。</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2246</wp:post_id>
		<wp:post_date><![CDATA[2025-10-16 03:28:55]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-10-15 18:28:55]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-19 17:35:09]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-19 08:35:09]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90%e9%96%8b%e7%99%ba%e3%80%91%e3%82%a4%e3%83%b3%e3%83%95%e3%83%a9%e3%83%bb%e3%83%90%e3%83%83%e3%82%af%e3%83%bb%e3%83%95%e3%83%ad%e3%83%b3%e3%83%88%e3%82%92%e5%88%86%e3%81%8b%e3%82%8a%e3%82%84]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="%e9%96%8b%e7%99%ba"><![CDATA[開発]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Zed】Cursorから乗り換えてみての初感]]></title>
		<link>https://www.masaakiota.net/2025/10/18/%e3%80%90zed%e3%80%91cursor%e3%81%8b%e3%82%89%e4%b9%97%e3%82%8a%e6%8f%9b%e3%81%88%e3%81%a6%e3%81%bf%e3%81%a6%e3%81%ae%e5%88%9d%e6%84%9f/</link>
		<pubDate>Sat, 18 Oct 2025 04:19:00 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2256</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Zed editor</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Zed editorはRust製の高速なエディタです。Atomというエディタの元開発者によるもので、次世代エディタを謳っています。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>もともとAtomはGithubによって開発されていました。MicrosoftがGithubを買収したことによりVSCode一本となり、Atomの開発が終了。その後Atomの元開発者たちが立ち上がり、次世代のエディタを作ろうとなったそうです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>VSCodeはElectronで作成されており重いのが欠点です。しかし高機能であるため2025年10月18日現在ほぼスタンダードとして愛用されています。そこへZed editorが切り崩しをかけている状態です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>ZedはRustで書かれており、とても高速なのが特徴です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">解説動画</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>情報の灯台さんが解説されています。これでzedの存在を知りました。</p>
<!-- /wp:paragraph -->

<!-- wp:embed {"url":"https://www.youtube.com/watch?v=I6tV8zyjzy0","type":"video","providerNameSlug":"youtube","responsive":true,"className":"wp-embed-aspect-16-9 wp-has-aspect-ratio"} -->
<figure class="wp-block-embed is-type-video is-provider-youtube wp-block-embed-youtube wp-embed-aspect-16-9 wp-has-aspect-ratio"><div class="wp-block-embed__wrapper">
https://www.youtube.com/watch?v=I6tV8zyjzy0
</div></figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Zedを使ってみた。</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p><a href="https://zed.dev">https://zed.dev</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>起動時にcursorからの乗り換えプロセスを走らせられます。その後実際に数時間ほど使ってみましたが、かなり良さげな印象です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今の所、Next.jsでの開発において、追加設定なしでも下記のような機能が確認できました。</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul class="wp-block-list"><!-- wp:list-item -->
<li>HTML開始タグ編集時に終了タグも自動置換</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>自動フォーマット</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Github便利パネル</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>調べてみた所、すでにHTML拡張が入っていました。フォーマットについては、自動でprettierのような挙動をするようです。これは後日、dprintに乗り換えました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">Ligatureがデフォルトで有効</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>これはZedを使うまで知りませんでした。&gt;=といった表記を重ねて表示できるようです。VSCodeだとデフォルトで無効ですがZedでは有効なため、気づけたようです。これはかなり熱いです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Zedでは追加の設定は不要ですが、VSCodeでは下記のようにしてできるみたいです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://qiita.com/gehnmai/items/1b6593660e1e3ee9bcae">https://qiita.com/gehnmai/items/1b6593660e1e3ee9bcae</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">AI</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>AI機能については、APIキーを入力します。主要なProviderに加え、色々あるようです。GPT5はOpenAIでOrganizationの認証が必要です。私はなぜかID認証に失敗し、問い合わせてみたものの解決せずひとまずClaudeでやることにしました。必要に応じてCursorを併用しようと思います。</p>
<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->
<h3 class="wp-block-heading">MacでのCompletionショートカットを調整</h3>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>MacではCtrl + Spaceが英語/日本語切り替えに割り当てられている関係から、Completionが使えません。そのためZedの方でCompletionのショートカットを変更します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Zed =&gt; Setting =&gt; Open Keymap</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>からeditor: show completionsを選択します。Ctrl + Spaceとなっているため、例えば以下のキーを割り当てます。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Cmd + Space</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">まとめ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>数日は使わないとはっきりとは言えませんが、かなり良いです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>今の所はNext.jsプロジェクトだけでしか試していませんので、今後色々みていきたいと思います。ちょっとしたことはこのページに追記していきたいと思います。軽さは正義、Zedが今後伸びていくのは確実です。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2256</wp:post_id>
		<wp:post_date><![CDATA[2025-10-18 13:19:00]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-10-18 04:19:00]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-20 09:32:26]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-20 00:32:26]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90zed%e3%80%91cursor%e3%81%8b%e3%82%89%e4%b9%97%e3%82%8a%e6%8f%9b%e3%81%88%e3%81%a6%e3%81%bf%e3%81%a6%e3%81%ae%e5%88%9d%e6%84%9f]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="%e3%82%a8%e3%83%87%e3%82%a3%e3%82%bf"><![CDATA[エディタ]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_9d5fe507f2c07a8dea4601610a393379]]></wp:meta_key>
		<wp:meta_value><![CDATA[<iframe title="VSCode代替・超高速エディタ「Zed」ついにWindowsに上陸（Mac／Linux／Windows)" width="1140" height="641" src="https://www.youtube.com/embed/I6tV8zyjzy0?feature=oembed" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_oembed_time_9d5fe507f2c07a8dea4601610a393379]]></wp:meta_key>
		<wp:meta_value><![CDATA[1760920310]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Zed】dprintフォーマッタを導入してみる]]></title>
		<link>https://www.masaakiota.net/2025/10/19/%e3%80%90zed%e3%80%91dprint%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%83%e3%82%bf%e3%82%92%e5%b0%8e%e5%85%a5%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b/</link>
		<pubDate>Sat, 18 Oct 2025 18:05:13 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2264</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Zedのフォーマッタ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Zedのフォーマッタは、デフォルトではPrettierのような挙動をします。Prettier撲滅委員の私としては見過ごせません。さっそくdprintを導入することにしました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">拡張機能</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Zedの拡張機能としてdprintはありました。早速インストールしたのですが動きません。それまでに色々といじっていたのが原因かもしれませんが、そもそもプラグインのバージョンが0.0.1となんとも心許ないため、下記のようにしました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">とりあえずプロジェクトに入れてみる</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>以下のようにして入れました。TypeScriptのプロジェクトです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="bash" class="language-bash">pnpm i -D dprint
pnpm dprint config init
pnpm dprint config add typescript
pnpm dprint config add json
pnpm dprint config add markdown
pnpm dprint config add dockerfile</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>zedの設定ファイルをいじります。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>./.zed/settings.json</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
  "format_on_save":"on",
  "formatter":{
    "external":{
      "command":"./node_modules/.bin/dprint",
      "arguments":["fmt","--stdin","{buffer_path}"
    ]}
  }
}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでひとまず入れることができました。プロジェクトに入れたため、他のメンバーにも強制できます。開始メンバーの特権ですはい。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2264</wp:post_id>
		<wp:post_date><![CDATA[2025-10-19 03:05:13]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-10-18 18:05:13]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-10-19 17:36:16]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-10-19 08:36:16]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90zed%e3%80%91dprint%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%83%e3%82%bf%e3%82%92%e5%b0%8e%e5%85%a5%e3%81%97%e3%81%a6%e3%81%bf%e3%82%8b]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="%e3%82%a8%e3%83%87%e3%82%a3%e3%82%bf"><![CDATA[エディタ]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Google Cloud】aertje/cloud-tasks-emulatorをhttps環境で使う]]></title>
		<link>https://www.masaakiota.net/2025/11/02/%e3%80%90google-cloud%e3%80%91aertje-cloud-tasks-emulator%e3%82%92https%e7%92%b0%e5%a2%83%e3%81%a7%e4%bd%bf%e3%81%86/</link>
		<pubDate>Sun, 02 Nov 2025 13:31:04 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2284</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Cloud Tasksのエミュレータ</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>現在公式FirebaseエミュレータにCloud Tasksは入っていません。そこでaertje/cloud-tasks-emulatorを使います。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/aertje/cloud-tasks-emulator">https://github.com/aertje/cloud-tasks-emulator</a></p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">問題点</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>ここで問題があります。ローカルでhttp開発している分には大丈夫かと思うのですが、httpsだと使えません。ローカルでは通常自己証明証を使ってhttpsを使用しますが、この自己証明書が問題のようです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">Post https://local.xxx.net:3000/yyy:⁠ x509: certificate signed by unknown authority</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>issueも建てられていますが、解決の目処は立っていないようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/aertje/cloud-tasks-emulator/issues/106">https://github.com/aertje/cloud-tasks-emulator/issues/106</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>このissueでは、Dockerのビルドからカスタムする方法が紹介されていますが、これだけのために余計なファイルは増やしたくありません。困りました。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">リバースプロキシを使う</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>そこでリバースプロキシを使うことにしました。エミュレータ=&gt;http=&gt;httpsの流れなら、自己署名証明書を使っていても問題ありません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class=""># compose.yml
...
  caddy-proxy:
    image: caddy:2-alpine
    restart: unless-stopped
    ports:
      - "8080:8080"
    command: caddy reverse-proxy --from :8080 --to https://host.docker.internal:3000 --insecure
    extra_hosts:
      - "host.docker.internal:host-gateway"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>テストします。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">curl http://localhost:8080/yyy</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでhttp=>httpsの導線を作れました。ただしこのアドレスはホスト側なので、docker内でのURLにする必要があります。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">client.createTask({
  parent,
  task: {
    httpRequest: {
      url: "http://caddy-proxy:8080/yyy",
      ...</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これでtaskが成功しました。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2284</wp:post_id>
		<wp:post_date><![CDATA[2025-11-02 22:31:04]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-11-02 13:31:04]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-11-02 22:53:47]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-11-02 13:53:47]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90google-cloud%e3%80%91aertje-cloud-tasks-emulator%e3%82%92https%e7%92%b0%e5%a2%83%e3%81%a7%e4%bd%bf%e3%81%86]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="gcp"><![CDATA[Google Cloud]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Tanstack Form】複数値でのValidation]]></title>
		<link>https://www.masaakiota.net/2025/11/07/%e3%80%90tanstack-form%e3%80%91%e8%a4%87%e6%95%b0%e5%80%a4%e3%81%a7%e3%81%aevalidation/</link>
		<pubDate>Thu, 06 Nov 2025 19:56:45 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2289</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">Tanstack Formでの複数値でのValidation</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Tanstack Formでは、通常一つ一つのコンポーネントをFieldで囲む使い方をします。そのため互いに干渉することはありません。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>例えば以下のコードでは、confirmフィールドの変更時にvalidationが走りますが、passwordフィールドの変更時には走りません。またfieldApi.form.getFieldValue('password')も変更されません。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">&lt;form.Field name="password"&gt;
  {(field) =&gt; (
    &lt;input
      value={field.state.value}
      onChange={(e) =&gt; field.setValue(e.target.value)}
    /&gt;
  )}
&lt;/form.Field&gt;

&lt;form.Field
  name="passwordConfirm"
  validators={{
    onChange: ({ value, fieldApi }) =&gt; value !== fieldApi.form.getFieldValue("password") &amp;&amp; "一致しません",
  }}
&gt;
  {(field) =&gt; (
    &lt;&gt;
      &lt;input
        value={field.state.value}
        onChange={(e) =&gt; field.setValue(e.target.value)}
      /&gt;
      {field.state.meta.errors[0]}
    &lt;/&gt;
  )}
&lt;/form.Field&gt;</code></pre>
<!-- /wp:code -->

<!-- wp:heading -->
<h2 class="wp-block-heading">onChangeListenToを使う</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>これを解消するためにSubscriptionで複数値を検知したりしていたのですが、実際はもっと簡単にできます。複数検知するには、onChangeListenToを指定します。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">  validators={{
    onChangeListenTo: ["password"], // これを追加
    onChange: ({ value, fieldApi }) =&gt; value !== fieldApi.form.getFieldValue("password") &amp;&amp; "一致しません",
  }}</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで、password変更時にもvalidationが走ります。また、getFieldValueも更新されます。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>以下は全体のコードです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">import { useForm } from "@tanstack/react-form";

const defaultValues = {
  password: "",
  passwordConfirm: "",
};
export function ValidationTest() {
  const form = useForm({ defaultValues });
  return (
    &lt;div style={{ display: "flex", flexDirection: "column", gap: "1rem" }}&gt;
      &lt;form.Field name="password"&gt;
        {(field) =&gt; (
          &lt;input
            value={field.state.value}
            onChange={(e) =&gt; field.setValue(e.target.value)}
          /&gt;
        )}
      &lt;/form.Field&gt;
      &lt;form.Field
        name="passwordConfirm"
        validators={{
          onChangeListenTo: ["password"],
          onChange: ({ value, fieldApi }) =&gt; value !== fieldApi.form.getFieldValue("password") &amp;&amp; "一致しません",
        }}
      &gt;
        {(field) =&gt; (
          &lt;&gt;
            &lt;input
              value={field.state.value}
              onChange={(e) =&gt; field.setValue(e.target.value)}
            /&gt;
            {field.state.meta.errors[0]}
          &lt;/&gt;
        )}
      &lt;/form.Field&gt;
    &lt;/div&gt;
  );
}</code></pre>
<!-- /wp:code -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2289</wp:post_id>
		<wp:post_date><![CDATA[2025-11-07 04:56:45]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-11-06 19:56:45]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-11-07 04:59:51]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-11-06 19:59:51]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90tanstack-form%e3%80%91%e8%a4%87%e6%95%b0%e5%80%a4%e3%81%a7%e3%81%aevalidation]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【AgGrid React】日付ピッカーが表示されない問題]]></title>
		<link>https://www.masaakiota.net/2025/11/09/%e3%80%90aggrid%e3%80%91%e6%97%a5%e4%bb%98%e3%83%94%e3%83%83%e3%82%ab%e3%83%bc%e3%81%8c%e8%a1%a8%e7%a4%ba%e3%81%95%e3%82%8c%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c/</link>
		<pubDate>Sat, 08 Nov 2025 15:17:47 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2296</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。WordPressからNextra移行を真剣に考えてます。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">環境</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>・ag-grid-community: ^34.2.0<br>・ag-grid-react: ^34.2.0,</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">AgGridでのtype:'date'</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>AgGridではcoldefにtypeを指定することで、起動するエディタを指定することができます。type='date'だと、編集時に日付ピッカーが起動します。これはAgGridにデフォルトで定義されているcolumn typeによるものです。ちなみにcolumn typeは独自で追加することも可能です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">エディタが起動しないことがある</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>エディタが起動しないこともあります。すったもんだした挙句、すでに入っている値によることがわかりました。具体的には、値がnullなどの場合はなぜかエディタが起動しないようです。こんなことってあるんですね。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">エディタを指定すると解決する</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>なぜかエディタを具体的に指定すると解決するようです。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code class="">{ headerName: "日付", field: "my_date", type: "date", cellEditor: "agDateStringCellEditor", editable: true }</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>風の噂では、AgGridよりTanstack Tableの方がモダンとのことです。すでに他ライブラリでいろいろお世話になっているので、Tanstackも検討しようと思います。</p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2296</wp:post_id>
		<wp:post_date><![CDATA[2025-11-09 00:17:47]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-11-08 15:17:47]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-11-09 02:20:24]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-11-08 17:20:24]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90aggrid%e3%80%91%e6%97%a5%e4%bb%98%e3%83%94%e3%83%83%e3%82%ab%e3%83%bc%e3%81%8c%e8%a1%a8%e7%a4%ba%e3%81%95%e3%82%8c%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[【Nuqs】nuqs requires an adapter to work with your framework]]></title>
		<link>https://www.masaakiota.net/2025/11/10/%e3%80%90react%e3%80%91nuqs-requires-an-adapter-to-work-with-your-framework/</link>
		<pubDate>Mon, 10 Nov 2025 08:05:49 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/?p=2301</guid>
		<description></description>
		<content:encoded><![CDATA[<!-- wp:paragraph -->
<p>こんにちは、フリーランスエンジニアの太田雅昭です。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">環境</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>nuqs: 2.7.1</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">モノレポでのnuqsの扱い</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>モノレポでは複数箇所でnuqsをインストールすることも多々あるかと思います。しかし複数で別のインスタンスが生成されてしまい、Adaptorが認識されない問題があるようです。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://github.com/47ng/nuqs/issues/798">https://github.com/47ng/nuqs/issues/798</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Viteのdevでは発生しないため、本番で突然エラーになるといったことになります。</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 class="wp-block-heading">nuqsを一本にする</h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>一本化するにはいろいろ方法はあるかと思いますが、今回は再エクスポートすることにしました。</p>
<!-- /wp:paragraph -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="typescript" class="language-typescript">// src/nuqs/nuqs.ts

export * from "nuqs";
export * from "nuqs/adapters/tanstack-router";</code></pre>
<!-- /wp:code -->

<!-- wp:code -->
<pre class="wp-block-code"><code lang="json" class="language-json">{
  "name": "@repo/ui",
  "exports": {
    ".": "./src/index.ts",
    "./nuqs": "./src/nuqs/nuqs.ts"</code></pre>
<!-- /wp:code -->

<!-- wp:paragraph -->
<p>これで大丈夫です。</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p></p>
<!-- /wp:paragraph -->]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>2301</wp:post_id>
		<wp:post_date><![CDATA[2025-11-10 17:05:49]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-11-10 08:05:49]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-11-10 17:07:52]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-11-10 08:07:52]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[closed]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%80%90react%e3%80%91nuqs-requires-an-adapter-to-work-with-your-framework]]></wp:post_name>
		<wp:status><![CDATA[publish]]></wp:status>
		<wp:post_parent>0</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[post]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
										<category domain="category" nicename="react"><![CDATA[React]]></category>
						<wp:postmeta>
		<wp:meta_key><![CDATA[_edit_last]]></wp:meta_key>
		<wp:meta_value><![CDATA[1]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-disabled]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-insert]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-header-label]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-device-target]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alignment]]></wp:meta_key>
		<wp:meta_value><![CDATA[none]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-heading-levels]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:0:{}]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-alttext]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-visibility_hide_by_default]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-hide_counter]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-exclude]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_ez-toc-position-specific]]></wp:meta_key>
		<wp:meta_value><![CDATA[]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_lightning_design_setting]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:1:{s:6:"layout";s:7:"default";}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-04-14-9.37.13]]></title>
		<link>https://www.masaakiota.net/2023/04/14/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-37-13/</link>
		<pubDate>Fri, 14 Apr 2023 01:06:44 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.37.13.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>73</wp:post_id>
		<wp:post_date><![CDATA[2023-04-14 10:06:44]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-04-14 01:06:44]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-04-14 10:06:44]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-04-14 01:06:44]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-37-13]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>67</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.37.13.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/04/スクリーンショット-2023-04-14-9.37.13.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:563;s:6:"height";i:735;s:4:"file";s:58:"2023/04/スクリーンショット-2023-04-14-9.37.13.png";s:8:"filesize";i:109022;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.37.13-230x300.png";s:5:"width";i:230;s:6:"height";i:300;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:35697;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.37.13-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:12476;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.37.13-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:29255;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-04-14-9.38.27]]></title>
		<link>https://www.masaakiota.net/2023/04/14/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-38-27/</link>
		<pubDate>Fri, 14 Apr 2023 01:09:00 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.38.27.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>74</wp:post_id>
		<wp:post_date><![CDATA[2023-04-14 10:09:00]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-04-14 01:09:00]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-04-14 10:09:00]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-04-14 01:09:00]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-38-27]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>67</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.38.27.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/04/スクリーンショット-2023-04-14-9.38.27.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:567;s:6:"height";i:324;s:4:"file";s:58:"2023/04/スクリーンショット-2023-04-14-9.38.27.png";s:8:"filesize";i:45284;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.38.27-300x171.png";s:5:"width";i:300;s:6:"height";i:171;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:25493;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.38.27-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:12939;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.38.27-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:27881;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-04-14-9.39.56]]></title>
		<link>https://www.masaakiota.net/2023/04/14/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-39-56/</link>
		<pubDate>Fri, 14 Apr 2023 01:09:11 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.39.56.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>75</wp:post_id>
		<wp:post_date><![CDATA[2023-04-14 10:09:11]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-04-14 01:09:11]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-04-14 10:09:11]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-04-14 01:09:11]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-39-56]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>67</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.39.56.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/04/スクリーンショット-2023-04-14-9.39.56.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:700;s:6:"height";i:643;s:4:"file";s:58:"2023/04/スクリーンショット-2023-04-14-9.39.56.png";s:8:"filesize";i:118756;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.39.56-300x276.png";s:5:"width";i:300;s:6:"height";i:276;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:42803;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.39.56-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:15181;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.39.56-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:33650;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-04-14-9.40.10]]></title>
		<link>https://www.masaakiota.net/2023/04/14/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-40-10/</link>
		<pubDate>Fri, 14 Apr 2023 01:09:24 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.40.10.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>76</wp:post_id>
		<wp:post_date><![CDATA[2023-04-14 10:09:24]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-04-14 01:09:24]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-04-14 10:09:24]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-04-14 01:09:24]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-40-10]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>67</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.40.10.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/04/スクリーンショット-2023-04-14-9.40.10.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:732;s:6:"height";i:937;s:4:"file";s:58:"2023/04/スクリーンショット-2023-04-14-9.40.10.png";s:8:"filesize";i:156704;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.40.10-234x300.png";s:5:"width";i:234;s:6:"height";i:300;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:35810;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.40.10-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:13201;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.40.10-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:29795;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-04-14-9.40.25]]></title>
		<link>https://www.masaakiota.net/2023/04/14/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-40-25/</link>
		<pubDate>Fri, 14 Apr 2023 01:09:46 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.40.25.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>77</wp:post_id>
		<wp:post_date><![CDATA[2023-04-14 10:09:46]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-04-14 01:09:46]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-04-14 10:09:46]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-04-14 01:09:46]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-40-25]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>67</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.40.25.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/04/スクリーンショット-2023-04-14-9.40.25.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:564;s:6:"height";i:325;s:4:"file";s:58:"2023/04/スクリーンショット-2023-04-14-9.40.25.png";s:8:"filesize";i:43702;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.40.25-300x173.png";s:5:"width";i:300;s:6:"height";i:173;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:25283;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.40.25-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:12612;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.40.25-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:27947;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-04-14-9.44.27]]></title>
		<link>https://www.masaakiota.net/2023/04/14/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-44-27/</link>
		<pubDate>Fri, 14 Apr 2023 01:11:33 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.44.27.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>78</wp:post_id>
		<wp:post_date><![CDATA[2023-04-14 10:11:33]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-04-14 01:11:33]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-04-14 10:11:33]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-04-14 01:11:33]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-44-27]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>67</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.44.27.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/04/スクリーンショット-2023-04-14-9.44.27.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:567;s:6:"height";i:851;s:4:"file";s:58:"2023/04/スクリーンショット-2023-04-14-9.44.27.png";s:8:"filesize";i:95659;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.44.27-200x300.png";s:5:"width";i:200;s:6:"height";i:300;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:25827;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.44.27-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:11447;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.44.27-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:16199;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-04-14-9.50.41]]></title>
		<link>https://www.masaakiota.net/2023/04/14/%e3%83%97%e3%83%a9%e3%82%a4%e3%83%99%e3%83%bc%e3%83%88%e3%81%a7gcp%e3%81%aeoauth%e3%82%af%e3%83%a9%e3%82%a4%e3%82%a2%e3%83%b3%e3%83%88id%e3%83%bb%e3%82%b7%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-50-41/</link>
		<pubDate>Fri, 14 Apr 2023 01:11:41 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.50.41.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>79</wp:post_id>
		<wp:post_date><![CDATA[2023-04-14 10:11:41]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-04-14 01:11:41]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-04-14 10:11:41]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-04-14 01:11:41]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-04-14-9-50-41]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>67</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/04/スクリーンショット-2023-04-14-9.50.41.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/04/スクリーンショット-2023-04-14-9.50.41.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:1640;s:6:"height";i:138;s:4:"file";s:58:"2023/04/スクリーンショット-2023-04-14-9.50.41.png";s:8:"filesize";i:25835;s:5:"sizes";a:6:{s:6:"medium";a:5:{s:4:"file";s:57:"スクリーンショット-2023-04-14-9.50.41-300x25.png";s:5:"width";i:300;s:6:"height";i:25;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:2672;}s:5:"large";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.50.41-1024x86.png";s:5:"width";i:1024;s:6:"height";i:86;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:15709;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.50.41-150x138.png";s:5:"width";i:150;s:6:"height";i:138;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:2159;}s:12:"medium_large";a:5:{s:4:"file";s:57:"スクリーンショット-2023-04-14-9.50.41-768x65.png";s:5:"width";i:768;s:6:"height";i:65;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:10648;}s:9:"1536x1536";a:5:{s:4:"file";s:59:"スクリーンショット-2023-04-14-9.50.41-1536x129.png";s:5:"width";i:1536;s:6:"height";i:129;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:27040;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-04-14-9.50.41-320x138.png";s:5:"width";i:320;s:6:"height";i:138;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:1845;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-08-21-8.08.56]]></title>
		<link>https://www.masaakiota.net/2023/08/21/%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e3%82%b3%e3%83%bc%e3%83%89%e7%94%9f%e6%88%90%e3%80%82claude-vs-gpt-4/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-08-21-8-08-56/</link>
		<pubDate>Sun, 20 Aug 2023 23:19:41 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/08/スクリーンショット-2023-08-21-8.08.56.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>132</wp:post_id>
		<wp:post_date><![CDATA[2023-08-21 08:19:41]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-08-20 23:19:41]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-08-21 08:19:41]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-08-20 23:19:41]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-08-21-8-08-56]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>129</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/08/スクリーンショット-2023-08-21-8.08.56.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/08/スクリーンショット-2023-08-21-8.08.56.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:1403;s:6:"height";i:1848;s:4:"file";s:58:"2023/08/スクリーンショット-2023-08-21-8.08.56.png";s:8:"filesize";i:422058;s:5:"sizes";a:6:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-08-21-8.08.56-228x300.png";s:5:"width";i:228;s:6:"height";i:300;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:45994;}s:5:"large";a:5:{s:4:"file";s:59:"スクリーンショット-2023-08-21-8.08.56-777x1024.png";s:5:"width";i:777;s:6:"height";i:1024;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:280871;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-08-21-8.08.56-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:16375;}s:12:"medium_large";a:5:{s:4:"file";s:59:"スクリーンショット-2023-08-21-8.08.56-768x1012.png";s:5:"width";i:768;s:6:"height";i:1012;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:276708;}s:9:"1536x1536";a:5:{s:4:"file";s:60:"スクリーンショット-2023-08-21-8.08.56-1166x1536.png";s:5:"width";i:1166;s:6:"height";i:1536;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:469870;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-08-21-8.08.56-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:28994;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-08-21-8.09.48]]></title>
		<link>https://www.masaakiota.net/2023/08/21/%e3%83%97%e3%83%ad%e3%82%b0%e3%83%a9%e3%83%9f%e3%83%b3%e3%82%b0%e3%82%b3%e3%83%bc%e3%83%89%e7%94%9f%e6%88%90%e3%80%82claude-vs-gpt-4/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-08-21-8-09-48/</link>
		<pubDate>Sun, 20 Aug 2023 23:20:43 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/08/スクリーンショット-2023-08-21-8.09.48.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>133</wp:post_id>
		<wp:post_date><![CDATA[2023-08-21 08:20:43]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-08-20 23:20:43]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-08-21 08:20:43]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-08-20 23:20:43]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-08-21-8-09-48]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>129</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/08/スクリーンショット-2023-08-21-8.09.48.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/08/スクリーンショット-2023-08-21-8.09.48.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:1779;s:6:"height";i:2031;s:4:"file";s:58:"2023/08/スクリーンショット-2023-08-21-8.09.48.png";s:8:"filesize";i:521114;s:5:"sizes";a:6:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2023-08-21-8.09.48-263x300.png";s:5:"width";i:263;s:6:"height";i:300;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:39176;}s:5:"large";a:5:{s:4:"file";s:59:"スクリーンショット-2023-08-21-8.09.48-897x1024.png";s:5:"width";i:897;s:6:"height";i:1024;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:267828;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-08-21-8.09.48-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:13364;}s:12:"medium_large";a:5:{s:4:"file";s:58:"スクリーンショット-2023-08-21-8.09.48-768x877.png";s:5:"width";i:768;s:6:"height";i:877;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:215999;}s:9:"1536x1536";a:5:{s:4:"file";s:60:"スクリーンショット-2023-08-21-8.09.48-1345x1536.png";s:5:"width";i:1345;s:6:"height";i:1536;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:465998;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2023-08-21-8.09.48-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:20970;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-11-03-17.38.28]]></title>
		<link>https://www.masaakiota.net/2023/11/03/%e3%80%90%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88%e3%80%91%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88%e3%81%ab%e3%82%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-11-03-17-38-28/</link>
		<pubDate>Fri, 03 Nov 2023 08:45:12 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/11/スクリーンショット-2023-11-03-17.38.28.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>303</wp:post_id>
		<wp:post_date><![CDATA[2023-11-03 17:45:12]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-03 08:45:12]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-03 17:45:12]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-03 08:45:12]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-11-03-17-38-28]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>302</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/11/スクリーンショット-2023-11-03-17.38.28.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/11/スクリーンショット-2023-11-03-17.38.28.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:1589;s:6:"height";i:764;s:4:"file";s:59:"2023/11/スクリーンショット-2023-11-03-17.38.28.png";s:8:"filesize";i:116280;s:5:"sizes";a:6:{s:6:"medium";a:5:{s:4:"file";s:59:"スクリーンショット-2023-11-03-17.38.28-300x144.png";s:5:"width";i:300;s:6:"height";i:144;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:14167;}s:5:"large";a:5:{s:4:"file";s:60:"スクリーンショット-2023-11-03-17.38.28-1024x492.png";s:5:"width";i:1024;s:6:"height";i:492;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:85609;}s:9:"thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2023-11-03-17.38.28-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:7560;}s:12:"medium_large";a:5:{s:4:"file";s:59:"スクリーンショット-2023-11-03-17.38.28-768x369.png";s:5:"width";i:768;s:6:"height";i:369;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:55651;}s:9:"1536x1536";a:5:{s:4:"file";s:60:"スクリーンショット-2023-11-03-17.38.28-1536x739.png";s:5:"width";i:1536;s:6:"height";i:739;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:147020;}s:14:"post-thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2023-11-03-17.38.28-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:18116;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-11-03-17.40.54]]></title>
		<link>https://www.masaakiota.net/2023/11/03/%e3%80%90%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88%e3%80%91%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88%e3%81%ab%e3%82%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-11-03-17-40-54/</link>
		<pubDate>Fri, 03 Nov 2023 08:46:41 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/11/スクリーンショット-2023-11-03-17.40.54.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>304</wp:post_id>
		<wp:post_date><![CDATA[2023-11-03 17:46:41]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-03 08:46:41]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-03 17:46:41]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-03 08:46:41]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-11-03-17-40-54]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>302</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/11/スクリーンショット-2023-11-03-17.40.54.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/11/スクリーンショット-2023-11-03-17.40.54.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:1203;s:6:"height";i:703;s:4:"file";s:59:"2023/11/スクリーンショット-2023-11-03-17.40.54.png";s:8:"filesize";i:90619;s:5:"sizes";a:5:{s:6:"medium";a:5:{s:4:"file";s:59:"スクリーンショット-2023-11-03-17.40.54-300x175.png";s:5:"width";i:300;s:6:"height";i:175;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:15799;}s:5:"large";a:5:{s:4:"file";s:60:"スクリーンショット-2023-11-03-17.40.54-1024x598.png";s:5:"width";i:1024;s:6:"height";i:598;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:89454;}s:9:"thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2023-11-03-17.40.54-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:7440;}s:12:"medium_large";a:5:{s:4:"file";s:59:"スクリーンショット-2023-11-03-17.40.54-768x449.png";s:5:"width";i:768;s:6:"height";i:449;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:60662;}s:14:"post-thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2023-11-03-17.40.54-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:17335;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-11-03-17.38.28-1]]></title>
		<link>https://www.masaakiota.net/2023/11/03/%e3%80%90%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88%e3%80%91%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88%e3%81%ab%e3%82%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-11-03-17-38-28-1/</link>
		<pubDate>Fri, 03 Nov 2023 08:46:57 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/11/スクリーンショット-2023-11-03-17.38.28-1.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>305</wp:post_id>
		<wp:post_date><![CDATA[2023-11-03 17:46:57]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-03 08:46:57]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-03 17:46:57]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-03 08:46:57]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-11-03-17-38-28-1]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>302</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/11/スクリーンショット-2023-11-03-17.38.28-1.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/11/スクリーンショット-2023-11-03-17.38.28-1.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:1589;s:6:"height";i:764;s:4:"file";s:61:"2023/11/スクリーンショット-2023-11-03-17.38.28-1.png";s:8:"filesize";i:113772;s:5:"sizes";a:6:{s:6:"medium";a:5:{s:4:"file";s:61:"スクリーンショット-2023-11-03-17.38.28-1-300x144.png";s:5:"width";i:300;s:6:"height";i:144;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:13634;}s:5:"large";a:5:{s:4:"file";s:62:"スクリーンショット-2023-11-03-17.38.28-1-1024x492.png";s:5:"width";i:1024;s:6:"height";i:492;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:80238;}s:9:"thumbnail";a:5:{s:4:"file";s:61:"スクリーンショット-2023-11-03-17.38.28-1-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:6922;}s:12:"medium_large";a:5:{s:4:"file";s:61:"スクリーンショット-2023-11-03-17.38.28-1-768x369.png";s:5:"width";i:768;s:6:"height";i:369;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:52198;}s:9:"1536x1536";a:5:{s:4:"file";s:62:"スクリーンショット-2023-11-03-17.38.28-1-1536x739.png";s:5:"width";i:1536;s:6:"height";i:739;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:137708;}s:14:"post-thumbnail";a:5:{s:4:"file";s:61:"スクリーンショット-2023-11-03-17.38.28-1-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:17162;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2023-11-03-17.40.59]]></title>
		<link>https://www.masaakiota.net/2023/11/03/%e3%80%90%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88%e3%80%91%e3%83%96%e3%83%83%e3%82%af%e3%83%9e%e3%83%bc%e3%82%af%e3%83%ac%e3%83%83%e3%83%88%e3%81%ab%e3%82%88/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-11-03-17-40-59/</link>
		<pubDate>Fri, 03 Nov 2023 08:49:05 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2023/11/スクリーンショット-2023-11-03-17.40.59.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>306</wp:post_id>
		<wp:post_date><![CDATA[2023-11-03 17:49:05]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2023-11-03 08:49:05]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2023-11-03 17:49:05]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2023-11-03 08:49:05]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2023-11-03-17-40-59]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>302</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2023/11/スクリーンショット-2023-11-03-17.40.59.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2023/11/スクリーンショット-2023-11-03-17.40.59.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:1201;s:6:"height";i:797;s:4:"file";s:59:"2023/11/スクリーンショット-2023-11-03-17.40.59.png";s:8:"filesize";i:125611;s:5:"sizes";a:5:{s:6:"medium";a:5:{s:4:"file";s:59:"スクリーンショット-2023-11-03-17.40.59-300x199.png";s:5:"width";i:300;s:6:"height";i:199;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:16518;}s:5:"large";a:5:{s:4:"file";s:60:"スクリーンショット-2023-11-03-17.40.59-1024x680.png";s:5:"width";i:1024;s:6:"height";i:680;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:108205;}s:9:"thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2023-11-03-17.40.59-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:6684;}s:12:"medium_large";a:5:{s:4:"file";s:59:"スクリーンショット-2023-11-03-17.40.59-768x510.png";s:5:"width";i:768;s:6:"height";i:510;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:68889;}s:14:"post-thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2023-11-03-17.40.59-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:14243;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット-2024-01-11-13.40.37]]></title>
		<link>https://www.masaakiota.net/2024/01/11/%e3%80%90react%e3%80%91dnd-kit%e3%81%a8mui%e3%82%92%e7%b5%84%e3%81%bf%e5%90%88%e3%82%8f%e3%81%9b%e3%81%a7%e3%83%89%e3%83%a9%e3%83%83%e3%82%b0%e3%81%a7%e3%81%8d%e3%81%aa%e3%81%84%e5%95%8f%e9%a1%8c/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2024-01-11-13-40-37/</link>
		<pubDate>Thu, 11 Jan 2024 04:41:14 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2024/01/スクリーンショット-2024-01-11-13.40.37.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>428</wp:post_id>
		<wp:post_date><![CDATA[2024-01-11 13:41:14]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-01-11 04:41:14]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-01-11 13:41:14]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-01-11 04:41:14]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2024-01-11-13-40-37]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>421</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2024/01/スクリーンショット-2024-01-11-13.40.37.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2024/01/スクリーンショット-2024-01-11-13.40.37.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:726;s:6:"height";i:468;s:4:"file";s:59:"2024/01/スクリーンショット-2024-01-11-13.40.37.png";s:8:"filesize";i:76477;s:5:"sizes";a:3:{s:6:"medium";a:5:{s:4:"file";s:59:"スクリーンショット-2024-01-11-13.40.37-300x193.png";s:5:"width";i:300;s:6:"height";i:193;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:26687;}s:9:"thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2024-01-11-13.40.37-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:10452;}s:14:"post-thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2024-01-11-13.40.37-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:22752;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット 2024-10-14 3.07.46]]></title>
		<link>https://www.masaakiota.net/2024/10/14/%e3%80%90react%e3%80%91%e8%a1%a8%e7%a4%ba%e3%82%92%e3%81%9d%e3%81%ae%e3%81%be%e3%81%bepdf%e3%81%ab%e5%a4%89%e6%8f%9b%e3%81%99%e3%82%8b/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2024-10-14-3-07-46/</link>
		<pubDate>Sun, 13 Oct 2024 18:15:12 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2024/10/スクリーンショット-2024-10-14-3.07.46.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>738</wp:post_id>
		<wp:post_date><![CDATA[2024-10-14 03:15:12]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-10-13 18:15:12]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-10-14 03:15:12]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-10-13 18:15:12]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2024-10-14-3-07-46]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>737</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2024/10/スクリーンショット-2024-10-14-3.07.46.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2024/10/スクリーンショット-2024-10-14-3.07.46.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:2117;s:6:"height";i:732;s:4:"file";s:58:"2024/10/スクリーンショット-2024-10-14-3.07.46.png";s:8:"filesize";i:115864;s:5:"sizes";a:7:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2024-10-14-3.07.46-300x104.png";s:5:"width";i:300;s:6:"height";i:104;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:9200;}s:5:"large";a:5:{s:4:"file";s:59:"スクリーンショット-2024-10-14-3.07.46-1024x354.png";s:5:"width";i:1024;s:6:"height";i:354;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:52566;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2024-10-14-3.07.46-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:4520;}s:12:"medium_large";a:5:{s:4:"file";s:58:"スクリーンショット-2024-10-14-3.07.46-768x266.png";s:5:"width";i:768;s:6:"height";i:266;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:35916;}s:9:"1536x1536";a:5:{s:4:"file";s:59:"スクリーンショット-2024-10-14-3.07.46-1536x531.png";s:5:"width";i:1536;s:6:"height";i:531;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:89088;}s:9:"2048x2048";a:5:{s:4:"file";s:59:"スクリーンショット-2024-10-14-3.07.46-2048x708.png";s:5:"width";i:2048;s:6:"height";i:708;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:126847;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2024-10-14-3.07.46-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:10969;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット 2024-10-14 3.08.22]]></title>
		<link>https://www.masaakiota.net/2024/10/14/%e3%80%90react%e3%80%91%e8%a1%a8%e7%a4%ba%e3%82%92%e3%81%9d%e3%81%ae%e3%81%be%e3%81%bepdf%e3%81%ab%e5%a4%89%e6%8f%9b%e3%81%99%e3%82%8b/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2024-10-14-3-08-22/</link>
		<pubDate>Sun, 13 Oct 2024 18:15:34 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2024/10/スクリーンショット-2024-10-14-3.08.22.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>739</wp:post_id>
		<wp:post_date><![CDATA[2024-10-14 03:15:34]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-10-13 18:15:34]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-10-14 03:15:34]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-10-13 18:15:34]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2024-10-14-3-08-22]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>737</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2024/10/スクリーンショット-2024-10-14-3.08.22.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2024/10/スクリーンショット-2024-10-14-3.08.22.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:1324;s:6:"height";i:413;s:4:"file";s:58:"2024/10/スクリーンショット-2024-10-14-3.08.22.png";s:8:"filesize";i:63424;s:5:"sizes";a:5:{s:6:"medium";a:5:{s:4:"file";s:57:"スクリーンショット-2024-10-14-3.08.22-300x94.png";s:5:"width";i:300;s:6:"height";i:94;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:4020;}s:5:"large";a:5:{s:4:"file";s:59:"スクリーンショット-2024-10-14-3.08.22-1024x319.png";s:5:"width";i:1024;s:6:"height";i:319;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:24204;}s:9:"thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2024-10-14-3.08.22-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:2702;}s:12:"medium_large";a:5:{s:4:"file";s:58:"スクリーンショット-2024-10-14-3.08.22-768x240.png";s:5:"width";i:768;s:6:"height";i:240;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:16689;}s:14:"post-thumbnail";a:5:{s:4:"file";s:58:"スクリーンショット-2024-10-14-3.08.22-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:6586;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット 2024-10-28 13.31.07]]></title>
		<link>https://www.masaakiota.net/2024/10/28/%e3%80%90html%e3%80%91%e8%a1%a8%e7%a4%ba%e3%82%b5%e3%82%a4%e3%82%ba%e3%82%88%e3%82%8a%e5%a4%a7%e3%81%8d%e3%82%81%e3%81%ae%e7%94%bb%e5%83%8f%e3%82%92%e4%bd%bf%e3%81%86%e3%81%ae%e3%81%8c%e3%81%84/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2024-10-28-13-31-07/</link>
		<pubDate>Mon, 28 Oct 2024 04:35:32 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2024/10/スクリーンショット-2024-10-28-13.31.07.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>766</wp:post_id>
		<wp:post_date><![CDATA[2024-10-28 13:35:32]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2024-10-28 04:35:32]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2024-10-28 13:35:32]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2024-10-28 04:35:32]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[open]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2024-10-28-13-31-07]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>765</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2024/10/スクリーンショット-2024-10-28-13.31.07.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2024/10/スクリーンショット-2024-10-28-13.31.07.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:1790;s:6:"height";i:452;s:4:"file";s:59:"2024/10/スクリーンショット-2024-10-28-13.31.07.png";s:8:"filesize";i:861162;s:5:"sizes";a:6:{s:6:"medium";a:5:{s:4:"file";s:58:"スクリーンショット-2024-10-28-13.31.07-300x76.png";s:5:"width";i:300;s:6:"height";i:76;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:35571;}s:5:"large";a:5:{s:4:"file";s:60:"スクリーンショット-2024-10-28-13.31.07-1024x259.png";s:5:"width";i:1024;s:6:"height";i:259;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:293369;}s:9:"thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2024-10-28-13.31.07-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:33432;}s:12:"medium_large";a:5:{s:4:"file";s:59:"スクリーンショット-2024-10-28-13.31.07-768x194.png";s:5:"width";i:768;s:6:"height";i:194;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:179914;}s:9:"1536x1536";a:5:{s:4:"file";s:60:"スクリーンショット-2024-10-28-13.31.07-1536x388.png";s:5:"width";i:1536;s:6:"height";i:388;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:563821;}s:14:"post-thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2024-10-28-13.31.07-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:67895;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット 2025-03-15 17.30.31]]></title>
		<link>https://www.masaakiota.net/2025/03/15/%e3%80%90ebay%e3%80%91oauth2%e5%88%a9%e7%94%a8%e3%81%ae%e3%81%9f%e3%82%81%e3%81%ae%e3%80%81%e5%bf%85%e8%a6%81%e3%81%aa%e5%80%a4%e3%81%ae%e5%8f%96%e5%be%97/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2025-03-15-17-30-31/</link>
		<pubDate>Sat, 15 Mar 2025 08:53:23 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2025/03/スクリーンショット-2025-03-15-17.30.31.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1348</wp:post_id>
		<wp:post_date><![CDATA[2025-03-15 17:53:23]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-15 08:53:23]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-03-15 17:53:23]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-03-15 08:53:23]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2025-03-15-17-30-31]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>1345</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2025/03/スクリーンショット-2025-03-15-17.30.31.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2025/03/スクリーンショット-2025-03-15-17.30.31.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:1499;s:6:"height";i:1715;s:4:"file";s:59:"2025/03/スクリーンショット-2025-03-15-17.30.31.png";s:8:"filesize";i:522683;s:5:"sizes";a:6:{s:6:"medium";a:5:{s:4:"file";s:59:"スクリーンショット-2025-03-15-17.30.31-262x300.png";s:5:"width";i:262;s:6:"height";i:300;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:56889;}s:5:"large";a:5:{s:4:"file";s:60:"スクリーンショット-2025-03-15-17.30.31-895x1024.png";s:5:"width";i:895;s:6:"height";i:1024;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:381982;}s:9:"thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2025-03-15-17.30.31-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:21249;}s:12:"medium_large";a:5:{s:4:"file";s:59:"スクリーンショット-2025-03-15-17.30.31-768x879.png";s:5:"width";i:768;s:6:"height";i:879;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:306319;}s:9:"1536x1536";a:5:{s:4:"file";s:61:"スクリーンショット-2025-03-15-17.30.31-1343x1536.png";s:5:"width";i:1343;s:6:"height";i:1536;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:668160;}s:14:"post-thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2025-03-15-17.30.31-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:42576;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット 2025-03-15 17.28.39]]></title>
		<link>https://www.masaakiota.net/2025/03/15/%e3%80%90ebay%e3%80%91oauth2%e5%88%a9%e7%94%a8%e3%81%ae%e3%81%9f%e3%82%81%e3%81%ae%e3%80%81%e5%bf%85%e8%a6%81%e3%81%aa%e5%80%a4%e3%81%ae%e5%8f%96%e5%be%97/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2025-03-15-17-28-39-2/</link>
		<pubDate>Sat, 15 Mar 2025 09:03:57 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2025/03/スクリーンショット-2025-03-15-17.28.39-1.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1354</wp:post_id>
		<wp:post_date><![CDATA[2025-03-15 18:03:57]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-15 09:03:57]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-03-15 18:03:57]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-03-15 09:03:57]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2025-03-15-17-28-39-2]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>1345</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2025/03/スクリーンショット-2025-03-15-17.28.39-1.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2025/03/スクリーンショット-2025-03-15-17.28.39-1.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:2167;s:6:"height";i:1217;s:4:"file";s:61:"2025/03/スクリーンショット-2025-03-15-17.28.39-1.png";s:8:"filesize";i:213370;s:5:"sizes";a:7:{s:6:"medium";a:5:{s:4:"file";s:61:"スクリーンショット-2025-03-15-17.28.39-1-300x168.png";s:5:"width";i:300;s:6:"height";i:168;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:19716;}s:5:"large";a:5:{s:4:"file";s:62:"スクリーンショット-2025-03-15-17.28.39-1-1024x575.png";s:5:"width";i:1024;s:6:"height";i:575;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:120630;}s:9:"thumbnail";a:5:{s:4:"file";s:61:"スクリーンショット-2025-03-15-17.28.39-1-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:9461;}s:12:"medium_large";a:5:{s:4:"file";s:61:"スクリーンショット-2025-03-15-17.28.39-1-768x431.png";s:5:"width";i:768;s:6:"height";i:431;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:80965;}s:9:"1536x1536";a:5:{s:4:"file";s:62:"スクリーンショット-2025-03-15-17.28.39-1-1536x863.png";s:5:"width";i:1536;s:6:"height";i:863;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:206112;}s:9:"2048x2048";a:5:{s:4:"file";s:63:"スクリーンショット-2025-03-15-17.28.39-1-2048x1150.png";s:5:"width";i:2048;s:6:"height";i:1150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:294570;}s:14:"post-thumbnail";a:5:{s:4:"file";s:61:"スクリーンショット-2025-03-15-17.28.39-1-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:21681;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
					<item>
		<title><![CDATA[スクリーンショット 2025-03-16 23.31.41]]></title>
		<link>https://www.masaakiota.net/2025/03/15/%e3%80%90ebay%e3%80%91oauth2%e5%88%a9%e7%94%a8%e3%81%ae%e3%81%9f%e3%82%81%e3%81%ae%e3%80%81%e5%bf%85%e8%a6%81%e3%81%aa%e5%80%a4%e3%81%ae%e5%8f%96%e5%be%97/%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2025-03-16-23-31-41/</link>
		<pubDate>Sun, 16 Mar 2025 14:38:27 +0000</pubDate>
		<dc:creator><![CDATA[masaakiota]]></dc:creator>
		<guid isPermaLink="false">https://www.masaakiota.net/wp-content/uploads/2025/03/スクリーンショット-2025-03-16-23.31.41.png</guid>
		<description></description>
		<content:encoded><![CDATA[]]></content:encoded>
		<excerpt:encoded><![CDATA[]]></excerpt:encoded>
		<wp:post_id>1364</wp:post_id>
		<wp:post_date><![CDATA[2025-03-16 23:38:27]]></wp:post_date>
		<wp:post_date_gmt><![CDATA[2025-03-16 14:38:27]]></wp:post_date_gmt>
		<wp:post_modified><![CDATA[2025-03-16 23:38:27]]></wp:post_modified>
		<wp:post_modified_gmt><![CDATA[2025-03-16 14:38:27]]></wp:post_modified_gmt>
		<wp:comment_status><![CDATA[]]></wp:comment_status>
		<wp:ping_status><![CDATA[closed]]></wp:ping_status>
		<wp:post_name><![CDATA[%e3%82%b9%e3%82%af%e3%83%aa%e3%83%bc%e3%83%b3%e3%82%b7%e3%83%a7%e3%83%83%e3%83%88-2025-03-16-23-31-41]]></wp:post_name>
		<wp:status><![CDATA[inherit]]></wp:status>
		<wp:post_parent>1345</wp:post_parent>
		<wp:menu_order>0</wp:menu_order>
		<wp:post_type><![CDATA[attachment]]></wp:post_type>
		<wp:post_password><![CDATA[]]></wp:post_password>
		<wp:is_sticky>0</wp:is_sticky>
						<wp:attachment_url><![CDATA[https://www.masaakiota.net/wp-content/uploads/2025/03/スクリーンショット-2025-03-16-23.31.41.png]]></wp:attachment_url>
											<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attached_file]]></wp:meta_key>
		<wp:meta_value><![CDATA[2025/03/スクリーンショット-2025-03-16-23.31.41.png]]></wp:meta_value>
		</wp:postmeta>
							<wp:postmeta>
		<wp:meta_key><![CDATA[_wp_attachment_metadata]]></wp:meta_key>
		<wp:meta_value><![CDATA[a:6:{s:5:"width";i:1518;s:6:"height";i:1641;s:4:"file";s:59:"2025/03/スクリーンショット-2025-03-16-23.31.41.png";s:8:"filesize";i:322913;s:5:"sizes";a:6:{s:6:"medium";a:5:{s:4:"file";s:59:"スクリーンショット-2025-03-16-23.31.41-278x300.png";s:5:"width";i:278;s:6:"height";i:300;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:44254;}s:5:"large";a:5:{s:4:"file";s:60:"スクリーンショット-2025-03-16-23.31.41-947x1024.png";s:5:"width";i:947;s:6:"height";i:1024;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:247447;}s:9:"thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2025-03-16-23.31.41-150x150.png";s:5:"width";i:150;s:6:"height";i:150;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:15694;}s:12:"medium_large";a:5:{s:4:"file";s:59:"スクリーンショット-2025-03-16-23.31.41-768x830.png";s:5:"width";i:768;s:6:"height";i:830;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:187523;}s:9:"1536x1536";a:5:{s:4:"file";s:61:"スクリーンショット-2025-03-16-23.31.41-1421x1536.png";s:5:"width";i:1421;s:6:"height";i:1536;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:411955;}s:14:"post-thumbnail";a:5:{s:4:"file";s:59:"スクリーンショット-2025-03-16-23.31.41-320x180.png";s:5:"width";i:320;s:6:"height";i:180;s:9:"mime-type";s:9:"image/png";s:8:"filesize";i:34435;}}s:10:"image_meta";a:12:{s:8:"aperture";s:1:"0";s:6:"credit";s:0:"";s:6:"camera";s:0:"";s:7:"caption";s:0:"";s:17:"created_timestamp";s:1:"0";s:9:"copyright";s:0:"";s:12:"focal_length";s:1:"0";s:3:"iso";s:1:"0";s:13:"shutter_speed";s:1:"0";s:5:"title";s:0:"";s:11:"orientation";s:1:"0";s:8:"keywords";a:0:{}}}]]></wp:meta_value>
		</wp:postmeta>
							</item>
				</channel>
</rss>
	